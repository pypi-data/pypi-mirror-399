from enum import StrEnum
from gllm_core.schema import Chunk as Chunk
from pydantic import BaseModel

class InputType(StrEnum):
    """Enum for input types used in graph element descriptions."""
    NODE = 'node'
    RELATIONSHIP = 'relationship'
    PROPERTY = 'property'

class RelationshipTypeFormat(StrEnum):
    '''Enum for relationship type formats.

    This enum defines the valid formats for specifying relationship types:
    - STRING: Relationship types are specified as simple strings (e.g., "WORKS_AT")
    - TUPLE: Relationship types are specified as 3-tuples in the format
      (source_type, relationship_type, target_type)
    '''
    STRING = 'string'
    TUPLE = 'tuple'

class Node(BaseModel):
    '''Represents a node in a graph with associated properties.

    Attributes:
        id (str): A unique identifier for the node.
        type (str): The type or label of the node. Defaults to "Node".
        properties (dict): Additional properties and metadata associated with the node.
    '''
    id: str
    type: str
    properties: dict

class Relationship(BaseModel):
    '''Represents a directed relationship between two nodes in a graph.

    Attributes:
        source (Node): The source node of the relationship.
        target (Node): The target node of the relationship.
        type (str): The type of the relationship. Defaults to "Relationship".
        properties (dict): Additional properties associated with the relationship.
    '''
    source: Node
    target: Node
    type: str
    properties: dict

class GraphDocument(BaseModel):
    """Represents a graph document consisting of nodes and relationships.

    Attributes:
        nodes (list[Node]): A list of nodes in the graph.
        relationships (list[Relationship]): A list of relationships in the graph.
        source (Chunk | None): The document from which the graph information is derived.
    """
    nodes: list[Node]
    relationships: list[Relationship]
    source: Chunk | None

class SimpleNode(BaseModel):
    '''Represents a node in a graph with associated properties.

    This class is to be used as the schema for the LMInvoker\'s structured output.

    Attributes:
        id (str): A unique identifier for the node.
        type (str): The type or label of the node. Defaults to "Node".
    '''
    id: str
    type: str

class SimpleRelationship(BaseModel):
    """Represents a simple directed relationship between two nodes in a graph.

    This class is to be used as the schema for the LMInvoker's structured output.

    Attributes:
        source_node_id (str): The ID of the source node.
        source_node_type (str): The type of the source node.
        target_node_id (str): The ID of the target node.
        target_node_type (str): The type of the target node.
        type (str): The type of the relationship.
    """
    source_node_id: str
    source_node_type: str
    target_node_id: str
    target_node_type: str
    type: str

class GraphResponse(BaseModel):
    """Represents a graph response generated by LM Invoker containing nodes and relationships.

    Attributes:
        nodes (list[SimpleNode] | None): A list of nodes generated by LM Invoker.
        relationships (list[SimpleRelationship] | None): A list of relationships generated by LM Invoker.
    """
    nodes: list[SimpleNode] | None
    relationships: list[SimpleRelationship] | None
PrimitiveNodeType = str
PrimitiveRelationshipType = str | tuple[str, str, str]

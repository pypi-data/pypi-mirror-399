<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GGUF Keys & Values – Ollama Inspect</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      :root { color-scheme: light dark; }
      code { background: rgba(127,127,127,0.15); padding: 0.1rem 0.3rem; border-radius: 4px; }
      .k { white-space: pre-wrap; word-break: break-word; }
      .preview { color: #6c757d; display: block; }
      .hidden { display: none; }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <header class="mb-3">
        <h1 class="h3 mb-2">
          GGUF Keys & Values{% if model_name %} – {{ model_name }}{% endif %}
        </h1>
        <div class="text-muted small mb-3">
          File: <code>{{ model_path }}</code>
          · Total keys: <span class="badge text-bg-secondary" id="count">{{ keys_count }}</span>
          ·
          {% if filename %}
            <a class="link-secondary" href="/api/items?filename={{ filename }}" target="_blank" rel="noopener">JSON</a>
          {% else %}
            <a class="link-secondary" href="/api/items" target="_blank" rel="noopener">JSON</a>
          {% endif %}
        </div>
        {% if error %}
          <div class="alert alert-warning" role="alert">{{ error }}</div>
        {% endif %}
        <div class="mb-3" style="max-width: 720px;">
          <input id="search" class="form-control" type="search" placeholder="Filter keys or values... (type to filter)" autofocus />
        </div>
      </header>

      <ul id="keys" class="list-group">
        {% for k, preview, full, expandable in items %}
          <li class="key-item list-group-item">
            <div class="row g-3 align-items-start">
              <div class="col-md-4 k"><code>{{ k }}</code></div>
              <div class="col-md-8 v position-relative">
                {% if expandable %}
                  <button class="toggle btn btn-sm btn-outline-secondary position-absolute top-0 end-0" aria-expanded="false" title="Show full value">Expand</button>
                {% endif %}
                <span class="preview">{{ preview }}</span>
                <pre class="full hidden">{{ full }}</pre>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>

    <script>
      const search = document.getElementById('search');
      const items = Array.from(document.querySelectorAll('.key-item'));
      const count = document.getElementById('count');
      function applyFilter() {
        const q = search.value.toLowerCase();
        let visible = 0;
        for (const li of items) {
          const text = li.textContent.toLowerCase();
          const show = !q || text.includes(q);
          li.style.display = show ? '' : 'none';
          if (show) visible++;
        }
        count.textContent = visible;
      }
      search.addEventListener('input', applyFilter);

      // Expand/collapse per item
      for (const li of items) {
        const btn = li.querySelector('button.toggle');
        const full = li.querySelector('.full');
        const preview = li.querySelector('.preview');
        if (!full || !preview) continue;
        if (!btn) continue; // Not expandable; nothing to wire
        btn.addEventListener('click', () => {
          const isHidden = full.classList.contains('hidden');
          if (isHidden) {
            full.classList.remove('hidden');
            preview.classList.add('hidden');
            btn.textContent = 'Collapse';
            btn.setAttribute('aria-expanded', 'true');
            btn.title = 'Hide full value';
          } else {
            full.classList.add('hidden');
            preview.classList.remove('hidden');
            btn.textContent = 'Expand';
            btn.setAttribute('aria-expanded', 'false');
            btn.title = 'Show full value';
          }
        });
      }
    </script>
    <!-- Bootstrap JS (optional, for future interactive components) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>
  </body>
  </html>

import{r as d,j as e,u as G,L as J,t as y}from"./vendor-tanstack-zpsXWFxg.js";import{aT as b,aU as U,aV as X,aW as z,aX as Z,aY as K,T as ee,M as te,aZ as se,U as T,V as I,X as F,Y as O,_,Z as M,$ as A,a0 as S,C as Q,F as ne,o as ae,a_ as re,H as $,I as Y,y as oe,a$ as le,a1 as C,a2 as V,b0 as ie,b1 as ce,b2 as de,b3 as ue,b4 as E,b5 as me,L as P,b6 as v,R as fe,E as xe,k as he,l as pe,m as ge,b7 as je,b8 as ve,b9 as w,ba as be,bb as ye,bc as k}from"./index-4D6ue93A.js";import{A as Ne,X as we,Y as Se,b as Ce}from"./vendor-recharts-C8e6QlQ9.js";import{f as N}from"./vendor-date-ByQxM3Xh.js";import{aq as Ee,ar as Pe,as as ke}from"./vendor-radix-CrLZvj36.js";import{E as Re,J as De,p as q,R as B,f as Le,a as Te,b as Ie,g as Fe}from"./utilities-QRfZWmbT.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-codemirror-KWel9Npa.js";import"./vendor-forms-DEIP3aGx.js";const Oe=({active:t,payload:s})=>{if(!t||!s||!s.length)return null;const n=s[0]?.payload;return!n||typeof n.time!="number"||typeof n.count!="number"?null:e.jsxs("div",{className:"bg-popover border rounded-lg p-2 shadow-md",children:[e.jsxs("div",{className:"text-sm font-medium",children:[n.count," events"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:N(new Date(n.time),"PPp")})]})},_e={count:{label:"Events",color:"hsl(262.1 83.3% 57.8%)"}},Me=d.forwardRef(function({data:s,className:a,showAxis:n=!0,startDate:l,endDate:c,onCursorChange:f},i){const r=d.useRef(null);d.useImperativeHandle(i,()=>({clearSelection:()=>{}}));const u=d.useMemo(()=>{const o=s.map(m=>({time:new Date(m.start_time).getTime(),count:m.count,label:m.label}));if(l&&c){const m=l.getTime(),j=c.getTime();(o.length===0||o[0].time>m)&&o.unshift({time:m,count:0,label:""}),(o.length===0||o[o.length-1].time<j)&&o.push({time:j,count:0,label:""})}return o},[s,l,c]),x=o=>{if(o.activeLabel!==void 0&&f){const m=typeof o.activeLabel=="number"?o.activeLabel:Number(o.activeLabel);Number.isNaN(m)||f(new Date(m))}},h=()=>{f?.(null)};return e.jsx("div",{ref:r,className:b("relative",a),children:e.jsx(U,{config:_e,className:"h-full w-[calc(100%+3rem)] -mx-6",children:e.jsxs(Ne,{data:u,margin:{top:0,right:0,bottom:0,left:0},onMouseMove:x,onMouseLeave:h,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"eventsGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--color-count)",stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:"var(--color-count)",stopOpacity:0})]})}),e.jsx(we,{dataKey:"time",tickFormatter:o=>N(new Date(o),"HH:mm"),tick:{fontSize:12},axisLine:!1,tickLine:!1,domain:["dataMin","dataMax"],hide:!n}),e.jsx(Se,{hide:!0,domain:[0,o=>Math.max(1,o)]}),e.jsx(X,{content:e.jsx(Oe,{})}),e.jsx(Ce,{type:"monotone",dataKey:"count",stroke:"var(--color-count)",strokeWidth:2,fill:"url(#eventsGradient)",dot:!1,activeDot:!1,isAnimationActive:!1})]})})})});function Ae({data:t,className:s,startDate:a,endDate:n}){return e.jsx("div",{className:b("relative",s),children:e.jsx(Me,{data:t,className:"h-full w-full",showAxis:!1,startDate:a,endDate:n})})}const Qe=()=>{const[{data:t},{data:s},{data:a},{data:n},{data:l},{data:c}]=G({queries:[z(),Z(),K(),ee(),te(),se()]});return{resourceOptions:d.useMemo(()=>{const i=[];for(const r of t??[])i.push({id:r.id,name:r.name,type:"automation",resourceId:`prefect.automation.${r.id}`});for(const r of s??[])i.push({id:r.id,name:r.name??"",type:"block",resourceId:`prefect.block-document.${r.id}`});for(const r of a??[])i.push({id:r.id,name:r.name,type:"deployment",resourceId:`prefect.deployment.${r.id}`});for(const r of n??[])i.push({id:r.id,name:r.name,type:"flow",resourceId:`prefect.flow.${r.id}`});for(const r of l??[])i.push({id:r.name,name:r.name,type:"work-pool",resourceId:`prefect.work-pool.${r.name}`});for(const r of c??[])i.push({id:r.id,name:r.name,type:"work-queue",resourceId:`prefect.work-queue.${r.id}`});return i},[t,s,a,n,l,c])}},$e={automation:"Automation",block:"Block",deployment:"Deployment",flow:"Flow","work-pool":"Work Pool","work-queue":"Work Queue"};function Ye(t){return e.jsx(d.Suspense,{children:e.jsx(Ve,{...t})})}function Ve({selectedResourceIds:t,onResourceIdsChange:s}){const[a,n]=d.useState(""),l=d.useDeferredValue(a),{resourceOptions:c}=Qe(),f=d.useMemo(()=>l?c.filter(u=>u.name.toLowerCase().includes(l.toLowerCase())):c,[c,l]),i=d.useMemo(()=>{const u={automation:[],block:[],deployment:[],flow:[],"work-pool":[],"work-queue":[]};for(const x of f)u[x.type].push(x);return u},[f]),r=u=>{const x=t.includes(u);s(x?t.filter(h=>h!==u):[...t,u]),n("")};return e.jsxs(T,{children:[e.jsx(I,{"aria-label":"Filter by resource",selected:t.length>0,children:t.length>0?`${t.length} resource${t.length===1?"":"s"} selected`:"All resources"}),e.jsxs(F,{children:[e.jsx(O,{value:a,onValueChange:n,placeholder:"Search resources..."}),e.jsx(_,{children:"No resources found"}),e.jsx(M,{children:Object.entries(i).map(([u,x])=>x.length>0?e.jsx(A,{heading:$e[u],children:x.map(h=>e.jsx(S,{value:h.resourceId,selected:t.includes(h.resourceId),onSelect:r,closeOnSelect:!1,children:h.name},h.resourceId))},u):null)})]})]})}function qe({...t}){return e.jsx(Ee,{"data-slot":"collapsible",...t})}function Be({...t}){return e.jsx(Pe,{"data-slot":"collapsible-trigger",...t})}function He({...t}){return e.jsx(ke,{"data-slot":"collapsible-content",...t})}function We({occurred:t}){const s=new Date(t),a=N(s,"h:mm:ss a"),n=N(s,"MMM do, yyyy");return e.jsxs("div",{className:"flex flex-col text-right text-sm w-24 shrink-0",children:[e.jsx("span",{children:a}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n})]})}function Ge({event:t,isLast:s}){const a=t.resource["prefect.resource.id"]||"",n=q(a),l=B[n];return e.jsxs("div",{className:"relative flex items-start justify-center w-10 h-full",children:[e.jsx("div",{className:b("absolute left-1/2 w-px -translate-x-1/2 bg-border",s?"top-0 h-5":"top-0 bottom-0"),style:{top:"-1rem",bottom:s?"auto":"-1rem"}}),e.jsx("div",{className:"relative flex items-center justify-center w-10 h-10 rounded-full bg-background border border-border",children:e.jsx(Y,{id:l,className:"h-5 w-5 text-muted-foreground"})})]})}function Je(t){const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${n}`}function Ue({eventId:t,eventName:s,occurred:a}){const n=Le(s),l=Je(new Date(a));return e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx(J,{to:"/events/event/$eventDate/$eventId",params:{eventDate:l,eventId:t},className:"text-left font-medium hover:underline",children:n}),e.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:s})]})}function Xe(t){return t["prefect.resource.role"]}function R(t){return t["prefect.resource.id"]||""}function D(t){return t["prefect.resource.name"]||t["prefect.name"]||t["prefect-cloud.name"]||null}function ze({related:t}){if(!t||t.length===0)return null;const s=[],a=[];for(const n of t)Xe(n)==="tag"?s.push(n):a.push(n);return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Related Resources"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.map(n=>{const l=R(n),f=D(n)||l,i=q(l),r=Ie[i],u=B[i];return e.jsxs(Te,{resource:n,relatedResources:t,className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground hover:underline",children:[r&&e.jsx("span",{children:r}),e.jsx(Y,{id:u,className:"h-4 w-4"}),e.jsx("span",{children:f})]},l)}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.map(n=>{const l=R(n),c=D(n)||l.split(".").pop();return e.jsx(oe,{variant:"secondary",children:c},l)})})]})]})}function Ze({event:t,isLast:s}){const[a,n]=d.useState(!1);return e.jsxs("div",{className:"grid grid-cols-[6rem_2.5rem_1fr] gap-4 items-start py-4",children:[e.jsx(We,{occurred:t.occurred}),e.jsx(Ge,{event:t,isLast:s}),e.jsx(qe,{open:a,onOpenChange:n,children:e.jsxs(Q,{className:"py-4",children:[e.jsx(ne,{className:"py-0",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(Ue,{eventId:t.id,eventName:t.event,occurred:t.occurred}),e.jsx(Re,{event:t}),t.related&&t.related.length>0&&e.jsx(ze,{related:t.related})]})}),e.jsx("div",{className:"px-6 pt-2",children:e.jsx(Be,{asChild:!0,children:e.jsxs(ae,{variant:"ghost",size:"sm",className:"w-full justify-center gap-2 text-muted-foreground","aria-label":a?"Collapse event details":"Expand event details",children:[e.jsx(re,{className:b("h-4 w-4 transition-transform duration-200",a&&"rotate-180")}),e.jsx("span",{className:"text-xs",children:a?"Hide raw event":"Show raw event"})]})})}),e.jsx(He,{children:e.jsx($,{className:"pt-4",children:e.jsx(De,{value:JSON.stringify(t,null,2),className:"max-h-96 overflow-auto"})})})]})})]})}function Ke({events:t,className:s}){return!t||t.length===0?null:e.jsx("ol",{className:b("list-none p-0 m-0",s),children:t.map((a,n)=>e.jsx("li",{children:e.jsx(Ze,{event:a,isLast:n===t.length-1})},a.id))})}const L=2;function et({filter:t,selectedEventTypes:s,onEventTypesChange:a}){const[n,l]=d.useState(""),c=d.useDeferredValue(n),{data:f=[]}=y(le("event",t)),i=d.useMemo(()=>{const o=new Set;for(const m of f){const j=Fe(m.value);for(const p of j)o.add(p)}return Array.from(o).sort()},[f]),r=d.useMemo(()=>c?i.filter(o=>o.toLowerCase().includes(c.toLowerCase())):i,[i,c]),u=o=>{const m=s.includes(o);a(m?s.filter(j=>j!==o):[...s,o])},x=()=>{a([])},h=()=>{if(s.length===0)return"All event types";const o=s.slice(0,L),m=s.length-L;return e.jsxs("div",{className:"flex flex-1 min-w-0 items-center gap-2",children:[e.jsx("div",{className:"flex flex-1 min-w-0 items-center gap-2 overflow-hidden",children:e.jsx("span",{className:"truncate",children:o.join(", ")})}),m>0&&e.jsxs(V,{variant:"bodySmall",className:"shrink-0",children:["+ ",m]})]})};return e.jsxs(T,{children:[e.jsx(I,{"aria-label":"Filter by event type",selected:s.length===0,children:h()}),e.jsxs(F,{children:[e.jsx(O,{value:n,onValueChange:l,placeholder:"Search event types..."}),e.jsxs(M,{children:[e.jsx(_,{children:"No event types found"}),e.jsxs(A,{children:[e.jsxs(S,{"aria-label":"All event types",onSelect:x,closeOnSelect:!1,value:"__all__",children:[e.jsx(C,{checked:s.length===0}),"All event types"]}),r.map(o=>e.jsxs(S,{"aria-label":o,onSelect:()=>u(o),closeOnSelect:!1,value:o,children:[e.jsx(C,{checked:s.includes(o)}),o]},o))]})]})]})]})}const tt=50;function st({filter:t}){const[s,a]=d.useState(1),n=d.useRef(new Map),l=d.useRef(JSON.stringify(t));d.useEffect(()=>{const p=JSON.stringify(t);l.current!==p&&(n.current.clear(),a(1),l.current=p)},[t]);const c=y(ie(t));d.useEffect(()=>{c.data?.next_page&&n.current.set(1,c.data.next_page)},[c.data?.next_page]);const f=s>1?n.current.get(s-1):null,i=y({...ce(f??""),enabled:s>1&&!!f});d.useEffect(()=>{i.data?.next_page&&s>1&&n.current.set(s,i.data.next_page)},[i.data?.next_page,s]);const r=c.data?.total??0,u=Math.ceil(r/tt),x=s===1?c.data?.events??[]:i.data?.events??c.data?.events??[],h=s>1&&i.isLoading;return{events:x,currentPage:s,totalPages:u,total:r,isLoadingNextPage:h,goToPage:p=>{p<1||p>u||p>1&&!n.current.has(p-1)||a(p)},goToNextPage:()=>{s<u&&n.current.has(s)&&a(s+1)},goToPreviousPage:()=>{s>1&&a(s-1)}}}function nt({search:t,onSearchChange:s}){const a=de(t),n=ue(t),l=E({...t,rangeType:"range",start:a.from,end:a.to}),c=E({resource:t.resource,rangeType:"range",start:a.from,end:a.to}),{events:f,currentPage:i,totalPages:r,isLoadingNextPage:u,goToNextPage:x,goToPreviousPage:h}=st({filter:n}),{data:o}=y(me(l)),m=g=>{s({resource:g})},j=g=>{s({event:g})},p=g=>{g?.type==="span"?s({rangeType:"span",seconds:g.seconds}):g?.type==="range"&&s({rangeType:"range",start:g.startDate.toISOString(),end:g.endDate.toISOString()})},[H,W]=d.useState(!1);return d.useEffect(()=>{const g=()=>{W(window.scrollY>100)};return window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)},[]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-semibold",children:"Event Feed"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-[2fr_1fr]",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(P,{children:"Resource"}),e.jsx(d.Suspense,{fallback:e.jsx(v,{className:"h-10 w-full"}),children:e.jsx(Ye,{selectedResourceIds:t.resource??[],onResourceIdsChange:m})})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(P,{children:"Events"}),e.jsx(d.Suspense,{fallback:e.jsx(v,{className:"h-10 w-full"}),children:e.jsx(et,{filter:c,selectedEventTypes:t.event??[],onEventTypesChange:j})})]})]}),e.jsx(Q,{className:b("sticky top-0 z-10 transition-shadow",H&&"shadow-lg"),children:e.jsxs($,{className:"pt-6",children:[e.jsx(Ae,{data:o??[],className:"h-32",startDate:new Date(a.from),endDate:new Date(a.to)}),e.jsx("div",{className:"flex justify-center pt-3",children:e.jsx(fe,{value:t.rangeType==="range"&&t.start&&t.end?{type:"range",startDate:new Date(t.start),endDate:new Date(t.end)}:{type:"span",seconds:t.seconds??-86400},onValueChange:p})})]})}),f.length===0?e.jsxs(xe,{children:[e.jsx(he,{id:"Calendar"}),e.jsx(pe,{children:"No events found"}),e.jsx(ge,{children:"No events match your current filters. Try adjusting your date range or filters."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{events:f}),r>1&&e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx(je,{children:e.jsxs(ve,{children:[e.jsx(w,{children:e.jsx(be,{onClick:h,disabled:i<=1})}),e.jsx(w,{children:e.jsxs(V,{variant:"bodySmall",className:"px-2",children:["Page ",i," of ",r]})}),e.jsx(w,{children:e.jsx(ye,{onClick:x,disabled:i>=r})})]})})}),u&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(v,{className:"h-8 w-32"})})]})]})}function at(){return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(v,{className:"h-8 w-48"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(v,{className:"h-10 w-48"}),e.jsx(v,{className:"h-10 w-48"}),e.jsx(v,{className:"h-10 w-48"})]}),e.jsx(v,{className:"h-32 w-full"}),e.jsx(v,{className:"h-64 w-full"})]})}function xt(){const t=k.useSearch(),s=k.useNavigate(),a=n=>{s({to:".",search:l=>({...l,...n}),replace:!0})};return e.jsx(d.Suspense,{fallback:e.jsx(at,{}),children:e.jsx(nt,{search:t,onSearchChange:a})})}export{xt as component};
//# sourceMappingURL=index-D9lzBQgy.js.map

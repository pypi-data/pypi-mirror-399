import{j as e,L as C,t as B,r as c,C as K,l as He,E as We,m as Je,h as Ze,s as me}from"./vendor-tanstack-zpsXWFxg.js";import{O as xe,p as X,q as Y,o as j,I as k,r as ee,s as Q,t as E,u as F,B as qe,g as Ke,h as re,br as Xe,bB as Ye,bD as es,a2 as M,J as oe,aJ as ss,T as pe,ay as ns,cE as ts,ce as Z,N as as,aP as rs,as as je,at as ge,av as L,au as A,c6 as os,aT as fe,an as ve,U as ls,V as is,X as cs,Y as ds,_ as us,Z as hs,$ as ms,a0 as le,a4 as xs,cF as Se,cG as se,ac as Ce,ai as De,ao as f,aj as y,ak as _,al as N,am as T,x as U,ap as ne,bi as te,ad as we,ae as be,af as ye,ag as _e,S as ps,a as js,b as gs,c as fs,e as vs,cH as Ss,cI as Cs,aI as Ds,cJ as ws,cK as bs,a9 as ys,cL as _s,bU as Ne,bR as Te,bS as Re,bT as Ee,C as Ns,cM as Ts,cN as Rs,b6 as Es,cO as Fs,cP as Ms,cQ as Is,aH as ie,aw as ce}from"./index-4D6ue93A.js";import{D as Fe}from"./delete-confirmation-dialog-CyYzB0GU.js";import{M as ks,r as Ls}from"./vendor-markdown-dkNYO1DR.js";import{D as As,W as Ps}from"./work-pool-filter-BgXQKQe_.js";import{S as Vs}from"./sort-filter-CXIm-Was.js";import{S as zs,a as Me,F as Ie}from"./flow-runs-pagination-D80ghJOr.js";import{u as ke,F as Le}from"./use-flow-runs-selected-rows-cUmzYLLn.js";import{D as Us}from"./deployment-links-DSmgJPWm.js";import{S as Os}from"./index-DCTkiMGg.js";import{a0 as $s,$ as Bs}from"./vendor-date-ByQxM3Xh.js";import{d as Ae,b as R,g as q,c as V,i as Qs,f as P,n as z,j as Gs,e as de}from"./vendor-forms-DEIP3aGx.js";import{c as Hs}from"./vendor-recharts-C8e6QlQ9.js";import{c as Pe}from"./cronstrue-Ceqsf2vJ.js";import{aw as Ws}from"./vendor-radix-CrLZvj36.js";import{u as Js}from"./use-delete-confirmation-dialog-D3RwBW_o.js";import{u as Zs,a as qs}from"./use-quick-run-BGqKUy84.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-codemirror-KWel9Npa.js";import"./work-queue-icon-text-C_de9ueT.js";const Ve=({search:s,sort:n,stateFilter:r,deploymentFilter:a,workPoolFilter:t})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 pr-2 border-r-2",children:[e.jsx("div",{className:"min-w-56",children:e.jsx(xe,{"aria-label":"search by run name",placeholder:"Search by run name",value:s.value,onChange:i=>s.onChange(i.target.value)})}),e.jsx("div",{className:"min-w-56",children:e.jsx(zs,{selectedFilters:r.value,onSelectFilter:r.onSelect})}),a&&e.jsx("div",{className:"min-w-56",children:e.jsx(As,{selectedDeployments:a.value,onSelectDeployments:a.onSelect})}),t&&e.jsx("div",{className:"min-w-56",children:e.jsx(Ps,{selectedWorkPools:t.value,onSelectWorkPools:t.onSelect})})]}),e.jsx(Vs,{value:n.value,onSelect:n.onSelect})]}),Ks=({id:s,onDelete:n})=>{const r=a=>{navigator.clipboard.writeText(a),F.success("ID copied")};return e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"size-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(k,{id:"MoreVertical",className:"size-4"})]})}),e.jsxs(ee,{align:"end",children:[e.jsx(Q,{children:"Actions"}),e.jsx(E,{onClick:()=>r(s),children:"Copy ID"}),e.jsx(C,{to:"/deployments/deployment/$id/edit",params:{id:s},children:e.jsx(E,{children:"Edit"})}),e.jsx(E,{onClick:n,children:"Delete"}),e.jsx(C,{to:"/deployments/deployment/$id/duplicate",params:{id:s},children:e.jsx(E,{children:"Duplicate"})})]})]})},Xs=({deployment:s})=>e.jsx(qe,{children:e.jsxs(Ke,{children:[e.jsx(re,{children:e.jsx(Xe,{to:"/deployments",className:"text-xl font-semibold",children:"Deployments"})}),e.jsx(Ye,{}),e.jsx(re,{className:"text-xl font-semibold",children:e.jsx(es,{children:s.name})})]})}),Ys=({deployment:s})=>{const n=JSON.stringify(s.job_variables??{},null,2),r=JSON.stringify(s.pull_steps??[],null,2);return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(M,{variant:"h4",children:"Job Variables"}),e.jsx(oe,{copy:!0,disabled:!0,hideLineNumbers:!0,value:n}),e.jsx(M,{variant:"h4",children:"Pull Steps "}),e.jsx(oe,{copy:!0,disabled:!0,hideLineNumbers:!0,value:r})]})},en=({deployment:s})=>e.jsx("div",{className:"prose max-w-none",children:e.jsx(ks,{remarkPlugins:[Ls],children:s.description})}),sn=s=>{const{data:n,error:r}=B(ss(s)),a=c.useMemo(()=>n?n.map(o=>o.flow_id):[],[n]),{data:t,error:i}=B(pe({flows:{id:{any_:a},operator:"and_"},offset:0,sort:"CREATED_DESC"},{enabled:a.length>0})),u=c.useMemo(()=>t?new Map(t.map(o=>[o.id,o])):new Map,[t]);return n&&n.length===0?{status:"success",error:null,data:[]}:n&&u.size>0?{status:"success",error:null,data:n.map(o=>{const d=u.get(o.flow_id);return{...o,flow:d}})}:r||i?{status:"error",error:r||i,data:void 0}:{status:"pending",error:null,data:void 0}},ze=s=>{const{data:n,error:r}=B(ns(s)),a=c.useMemo(()=>n?n.results.map(o=>o.flow_id):[],[n]),{data:t,error:i}=B(pe({flows:{id:{any_:a},operator:"and_"},offset:0,sort:"CREATED_DESC"},{enabled:a.length>0})),u=c.useMemo(()=>t?new Map(t.map(o=>[o.id,o])):new Map,[t]);return n&&n.results.length===0?{status:"success",error:null,data:{...n,results:[]}}:n&&u.size>0?{status:"success",error:null,data:{...n,results:n.results.map(o=>{const d=u.get(o.flow_id);return{...o,flow:d}})}}:r||i?{status:"error",error:r||i,data:void 0}:{status:"pending",error:null,data:void 0}},D=K("/deployments/deployment/$id"),nn=({deployment:s})=>{const[n,r,{clearSet:a,onSelectRow:t}]=ke(),[i,u]=rn(),[o,d]=on(),[l,m]=ln(),[h,x]=cn(),b=an(),{data:g}=ze({deployments:{operator:"and_",id:{any_:[s.id]}},flow_runs:{name:{like_:o||void 0},state:{name:{any_:h.length===0?void 0:h},operator:"or_"},operator:"and_"},limit:i.limit,page:i.page,sort:l}),p=c.useMemo(()=>{if(g)return{...g,results:g.results.map(Ge=>({...Ge,deployment:s}))}},[g,s]),G=b?()=>{b(),a()}:void 0,O=tn(s);return e.jsxs("div",{className:"flex flex-col gap-2",children:[O&&e.jsxs("div",{className:"flex flex-col gap-2 border-b py-2",children:[e.jsx(M,{variant:"bodyLarge",children:"Next Run"}),e.jsx(ts,{flowRun:O})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Le,{count:p?.count,results:p?.results,selectedRows:n,setSelectedRows:r}),e.jsx(Ve,{search:{value:o,onChange:d},sort:{value:l,onSelect:m},stateFilter:{value:new Set(h),onSelect:x}})]}),e.jsx(Me,{flowRuns:p?.results,selectedRows:n,onSelect:t,onClearFilters:G}),p&&e.jsx(Ie,{count:p.count,pagination:i,onChangePagination:u,pages:p.pages})]})]})};function tn(s){const{data:n}=sn({deployments:{id:{any_:[s.id]},operator:"and_"},flow_runs:{state:{name:{any_:["Scheduled"]},operator:"and_"},operator:"and_"},sort:"EXPECTED_START_TIME_ASC",limit:1,offset:0});return c.useMemo(()=>{if(!(!n||!n[0]))return{...n[0],deployment:s}},[n,s])}function an(){const{runs:s}=D.useSearch(),n=D.useNavigate(),r=c.useCallback(()=>{n({to:".",search:t=>({...t,runs:void 0}),replace:!0})},[n]);return c.useMemo(()=>!!s,[s])?r:void 0}function rn(){const{runs:s}=D.useSearch(),n=D.useNavigate(),r=c.useCallback(t=>{n({to:".",search:i=>({...i,runs:{...s,...t}}),replace:!0})},[n,s]);return[c.useMemo(()=>({page:s?.page??1,limit:s?.limit??10}),[s?.limit,s?.page]),r]}function on(){const{runs:s}=D.useSearch(),n=D.useNavigate(),r=c.useCallback(t=>{n({to:".",search:i=>({...i,runs:{...s,flowRuns:{...s?.flowRuns,name:t}}}),replace:!0})},[n,s]);return[c.useMemo(()=>s?.flowRuns?.name??"",[s?.flowRuns?.name]),r]}function ln(){const{runs:s}=D.useSearch(),n=D.useNavigate(),r=c.useCallback(t=>{n({to:".",search:i=>({...i,runs:{...s,sort:t}}),replace:!0})},[n,s]);return[c.useMemo(()=>s?.sort??"START_TIME_DESC",[s?.sort]),r]}function cn(){const{runs:s}=D.useSearch(),n=D.useNavigate(),r=c.useCallback(t=>{n({to:".",search:i=>({...i,runs:{...s,flowRuns:{...s?.flowRuns,state:t?Array.from(t):void 0}}}),replace:!0})},[n,s]);return[c.useMemo(()=>s?.flowRuns?.state??Z,[s?.flowRuns?.state]),r]}const w=K("/deployments/deployment/$id"),dn=({deployment:s})=>{const[n,r,{clearSet:a,onSelectRow:t}]=ke(),[i,u]=hn(),[o,d]=mn(),[l,m]=xn(),[h,x]=pn(),b=un(),{data:g}=ze({deployments:{operator:"and_",id:{any_:[s.id]}},flow_runs:{name:{like_:o||void 0},state:{name:{any_:h.length===0?void 0:h},operator:"or_"},operator:"and_"},limit:i.limit,page:i.page,sort:l}),p=c.useMemo(()=>{if(g)return{...g,results:g.results.map(O=>({...O,deployment:s}))}},[g,s]),G=b?()=>{b(),a()}:void 0;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Le,{count:p?.count,results:p?.results,selectedRows:n,setSelectedRows:r}),e.jsx(Ve,{search:{value:o,onChange:d},sort:{value:l,onSelect:m},stateFilter:{value:new Set(h),onSelect:x}})]}),e.jsx(Me,{flowRuns:p?.results,selectedRows:n,onSelect:t,onClearFilters:G}),p&&p.results.length>0&&e.jsx(Ie,{count:p.count,pagination:i,onChangePagination:u,pages:p.pages})]})};function un(){const{upcoming:s}=w.useSearch(),n=w.useNavigate(),r=c.useCallback(()=>{n({to:".",search:t=>({...t,upcoming:void 0}),replace:!0})},[n]);return c.useMemo(()=>!!s,[s])?r:void 0}function hn(){const{upcoming:s}=w.useSearch(),n=w.useNavigate(),r=c.useCallback(t=>{n({to:".",search:i=>({...i,upcoming:{...s,...t}}),replace:!0})},[n,s]);return[c.useMemo(()=>({page:s?.page??1,limit:s?.limit??5}),[s?.limit,s?.page]),r]}function mn(){const{upcoming:s}=w.useSearch(),n=w.useNavigate(),r=c.useCallback(t=>{n({to:".",search:i=>({...i,upcoming:{...s,flowRuns:{...s?.flowRuns,name:t}}}),replace:!0})},[n,s]);return[c.useMemo(()=>s?.flowRuns?.name??"",[s?.flowRuns?.name]),r]}function xn(){const{upcoming:s}=w.useSearch(),n=w.useNavigate(),r=c.useCallback(t=>{n({to:".",search:i=>({...i,upcoming:{...s,sort:t}}),replace:!0})},[n,s]);return[c.useMemo(()=>s?.sort??"START_TIME_ASC",[s?.sort]),r]}function pn(){const{upcoming:s}=w.useSearch(),n=w.useNavigate(),r=c.useCallback(t=>{n({to:".",search:i=>({...i,upcoming:{...s,flowRuns:{...s?.flowRuns,state:t?Array.from(t):void 0}}}),replace:!0})},[n,s]);return[c.useMemo(()=>s?.flowRuns?.state??["Scheduled"],[s?.flowRuns?.state]),r]}const $=Ze(),jn=[$.accessor("key",{header:"Key"}),$.accessor("value",{header:"Override"}),$.accessor("defaultValue",{header:"Default"}),$.accessor("type",{header:"Type"})],gn=s=>c.useMemo(()=>{if(!s.parameter_openapi_schema)return[];const n=s.parameter_openapi_schema.properties,r=s.parameters;return Object.keys(n).sort((a,t)=>n[a].position-n[t].position).map(a=>{const t=n[a];return{key:a,value:r[a],defaultValue:t.default,type:t.type}})},[s]),fn=({deployment:s})=>{const[n,r]=c.useState(""),a=gn(s),t=c.useDeferredValue(n),i=c.useMemo(()=>a.filter(o=>o.key.toLowerCase().includes(t.toLowerCase())||o.value?.toString().toLowerCase().includes(t.toLowerCase())||o.defaultValue?.toString().toLowerCase().includes(t.toLowerCase())||o.type?.toString().toLowerCase().includes(t.toLowerCase())),[a,t]),u=He({data:i,columns:jn,getCoreRowModel:Je(),defaultColumn:{maxSize:300},getPaginationRowModel:We()});return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(M,{variant:"bodySmall",className:"text-muted-foreground",children:[i.length," ",as(i.length,"parameter")]}),e.jsx("div",{className:"sm:col-span-2 md:col-span-2 lg:col-span-3",children:e.jsx(xe,{className:"sm:col-span-2 md:col-span-2 lg:col-span-3",placeholder:"Search parameters",value:n,onChange:o=>r(o.target.value)})})]}),e.jsx(rs,{table:u})]})},vn=K("/deployments/deployment/$id"),Sn=({deployment:s})=>{const{tab:n}=vn.useSearch(),r=Cn(s);return e.jsxs(je,{defaultValue:r[0].value,value:n,children:[e.jsx(ge,{children:r.map(({value:a,LinkComponent:t})=>e.jsx(t,{},a))}),r.map(({value:a,ViewComponent:t})=>e.jsx(t,{},a))]})};function Cn(s){return c.useMemo(()=>[{value:"Runs",LinkComponent:()=>e.jsx(C,{to:".",search:{tab:"Runs"},children:e.jsx(A,{value:"Runs",children:"Runs"})}),ViewComponent:()=>e.jsx(L,{value:"Runs",children:e.jsx(nn,{deployment:s})})},{value:"Upcoming",LinkComponent:()=>e.jsx(C,{to:".",search:{tab:"Upcoming"},children:e.jsx(A,{value:"Upcoming",children:"Upcoming"})}),ViewComponent:()=>e.jsx(L,{value:"Upcoming",children:e.jsx(dn,{deployment:s})})},{value:"Parameters",LinkComponent:()=>e.jsx(C,{to:".",search:{tab:"Parameters"},children:e.jsx(A,{value:"Parameters",children:"Parameters"})}),ViewComponent:()=>e.jsx(L,{value:"Parameters",children:e.jsx(fn,{deployment:s})})},{value:"Configuration",LinkComponent:()=>e.jsx(C,{to:".",search:{tab:"Configuration"},children:e.jsx(A,{value:"Configuration",children:"Configuration"})}),ViewComponent:()=>e.jsx(L,{value:"Configuration",children:e.jsx(Ys,{deployment:s})})},{value:"Description",LinkComponent:()=>e.jsx(C,{to:".",search:{tab:"Description"},children:e.jsx(A,{value:"Description",children:"Description"})}),ViewComponent:()=>e.jsx(L,{value:"Description",children:e.jsx(en,{deployment:s})})}],[s])}const v=()=>e.jsx("dd",{className:"text-muted-foreground text-sm",children:"None"}),ue=({children:s})=>e.jsx("dt",{className:"text-sm text-muted-foreground",children:s}),S=({className:s,children:n})=>e.jsx("dd",{className:fe("text-sm",s),children:n}),Dn=({deployment:s})=>{const n=[{field:"Status",ComponentValue:()=>s.status?e.jsx("dd",{children:e.jsx(Os,{status:s.status})}):e.jsx(v,{})},{field:"Created",ComponentValue:()=>s.created?e.jsx(S,{className:"font-mono",children:s.created}):e.jsx(v,{})},{field:"Updated",ComponentValue:()=>s.updated?e.jsx(S,{className:"font-mono",children:s.updated}):e.jsx(v,{})},{field:"Entrypoint",ComponentValue:()=>s.entrypoint?e.jsx(S,{children:s.entrypoint}):e.jsx(v,{})},{field:"Path",ComponentValue:()=>s.path?e.jsx(S,{children:s.path}):e.jsx(v,{})},{field:"Concurrency Limit",ComponentValue:()=>s.global_concurrency_limit?e.jsx(S,{children:s.global_concurrency_limit.limit}):e.jsx(v,{})}],r=[{field:"Flow ID",ComponentValue:()=>e.jsx(S,{children:s.flow_id})},{field:"Deployment ID",ComponentValue:()=>e.jsx(S,{children:s.id})},{field:"Deployment Version",ComponentValue:()=>s.version?e.jsx(S,{children:s.version}):e.jsx(v,{})},{field:"Storage Document ID",ComponentValue:()=>s.storage_document_id?e.jsx(S,{children:s.storage_document_id}):e.jsx(v,{})},{field:"Infrastructure Document ID",ComponentValue:()=>s.infrastructure_document_id?e.jsx(S,{children:s.infrastructure_document_id}):e.jsx(v,{})},{field:"Tags",ComponentValue:()=>s.tags&&s.tags.length>0?e.jsx("dd",{children:e.jsx(os,{tags:s.tags,maxTagsDisplayed:4})}):e.jsx(v,{})}];return e.jsxs("div",{children:[e.jsx("ul",{className:"flex flex-col gap-3",children:n.map(({field:a,ComponentValue:t})=>e.jsx("li",{children:e.jsxs("dl",{children:[e.jsx(ue,{children:a}),e.jsx(t,{})]})},a))}),e.jsx("hr",{className:"my-3"}),e.jsx("ul",{className:"flex flex-col gap-3",children:r.map(({field:a,ComponentValue:t})=>e.jsx("li",{children:e.jsxs("dl",{children:[e.jsx(ue,{children:a}),e.jsx(t,{})]})},a))})]})};var Ue=$s();const H=s=>{let n="",r=!1;try{Ue.CronExpressionParser.parse(s),n=Pe.toString(s),r=!0}catch{r=!1,n="Invalid expression"}return{description:n,isCronValid:r}},wn=({onChange:s,...n})=>{const[r,a]=c.useState(H(String(n.value)).description),[t,i]=c.useState(H(String(n.value)).isCronValid),u=o=>{if(s){s(o);const{description:d,isCronValid:l}=H(o.target.value);a(d),i(l)}};return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(ve,{...n,onChange:u}),e.jsx(M,{variant:"bodySmall",className:Hs(t?"text-muted-foreground":"text-red-500"),children:r})]})};function Oe(s){return s.replaceAll("/"," / ").replaceAll("_"," ")}const he=Intl.DateTimeFormat().resolvedOptions().timeZone,$e=[{label:"UTC",value:"Etc/UTC"},{label:Oe(he),value:he}],Be=Intl.supportedValuesOf("timeZone").map(s=>({label:Oe(s),value:s})).slice(0,5),bn=[...$e,...Be],Qe=({selectedValue:s="",onSelect:n})=>{const[r,a]=c.useState(""),t=c.useDeferredValue(r),i=c.useMemo(()=>$e.filter(d=>d.label.toLowerCase().includes(t.toLowerCase())||d.value.toLowerCase().includes(t.toLowerCase())),[t]),u=c.useMemo(()=>Be.filter(d=>d.label.toLowerCase().includes(t.toLowerCase())||d.value.toLowerCase().includes(t.toLowerCase())),[t]),o=c.useMemo(()=>bn.find(({value:d})=>d===s),[s]);return e.jsxs(ls,{children:[e.jsx(is,{selected:!!s,"aria-label":"Select timezone",children:o?.label??"Select timezone"}),e.jsxs(cs,{children:[e.jsx(ds,{value:r,onValueChange:a,placeholder:"Search"}),e.jsx(us,{children:"No timezone found"}),e.jsx(hs,{children:e.jsxs(ms,{children:[i.length>0&&e.jsx(Q,{children:"Suggested timezones"}),i.map(({label:d,value:l})=>e.jsx(le,{selected:s===l,onSelect:m=>{n(m),a("")},value:l,children:d},l)),e.jsx(xs,{}),u.length>0&&e.jsx(Q,{children:"All timezones"}),u.map(({label:d,value:l})=>e.jsx(le,{selected:s===l,onSelect:m=>{n(m),a("")},value:l,children:d},l))]})})]})]})},yn=s=>{try{return Ue.CronExpressionParser.parse(s),!0}catch{return!1}},_n=R({active:q(),schedule:R({cron:V().refine(yn),timezone:V().default("Etc/UTC"),day_or:q().default(!0)})}),W={active:!0,schedule:{cron:"* * * * *",timezone:"Etc/UTC",day_or:!0}},Nn=({deployment_id:s,scheduleToEdit:n,onSubmit:r})=>{const{createDeploymentSchedule:a,isPending:t}=Se(),{updateDeploymentSchedule:i,isPending:u}=se(),o=Ae({resolver:Ce(_n),defaultValues:W});c.useEffect(()=>{if(n){const{active:l,schedule:m}=n;if("cron"in m){const{cron:h,day_or:x,timezone:b}=m;o.reset({active:l,schedule:{cron:h,day_or:x,timezone:b??"Etc/UTC"}})}}else o.reset(W)},[o,n]);const d=l=>{const m=()=>{o.reset(W),r()};n?i({deployment_id:s,schedule_id:n.id,...l},{onSuccess:()=>{F.success("Deployment schedule updated")},onError:h=>{const x=h.message||"Unknown error while updating deployment schedule.";o.setError("root",{message:x})},onSettled:m}):a({deployment_id:s,...l},{onSuccess:()=>{F.success("Deployment schedule created")},onError:h=>{const x=h.message||"Unknown error while creating deployment schedule.";o.setError("root",{message:x})},onSettled:m})};return e.jsx(De,{...o,children:e.jsxs("form",{onSubmit:l=>{o.handleSubmit(d)(l)},className:"space-y-4",children:[e.jsx(f,{children:o.formState.errors.root?.message}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(y,{control:o.control,name:"active",render:({field:l})=>e.jsxs(_,{children:[e.jsx(N,{children:"Active"}),e.jsx(T,{children:e.jsx(U,{className:"block",checked:l.value,onCheckedChange:l.onChange})}),e.jsx(f,{})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-3/4",children:e.jsx(y,{control:o.control,name:"schedule.cron",render:({field:l})=>e.jsxs(_,{children:[e.jsx(N,{children:"Value"}),e.jsx(T,{children:e.jsx(wn,{...l})}),e.jsx(f,{})]})})}),e.jsx(y,{control:o.control,name:"schedule.day_or",render:({field:l})=>e.jsxs(_,{children:[e.jsxs(N,{"aria-label":"Day Or",children:["Day Or ",e.jsx(Tn,{})]}),e.jsx(T,{children:e.jsx(U,{className:"block",checked:l.value,onCheckedChange:l.onChange})}),e.jsx(f,{})]})})]}),e.jsx(y,{control:o.control,name:"schedule.timezone",render:({field:l})=>e.jsxs(_,{children:[e.jsx(N,{children:"Timezone"}),e.jsx(T,{children:e.jsx(Qe,{selectedValue:l.value,onSelect:l.onChange})}),e.jsx(f,{})]})})]}),e.jsxs(ne,{children:[e.jsx(te,{asChild:!0,children:e.jsx(j,{variant:"outline",children:"Close"})}),e.jsx(j,{type:"submit",loading:t||u,children:"Save"})]})]})})},Tn=()=>e.jsxs(we,{children:[e.jsx(te,{asChild:!0,children:e.jsx("button",{type:"button",className:"cursor-help",children:e.jsx(k,{id:"Info",className:"size-4 inline"})})}),e.jsxs(be,{"aria-describedby":void 0,children:[e.jsx(ye,{children:e.jsx(_e,{children:"Day Or"})}),e.jsx(M,{children:'When the "Day Or" value is off, this schedule will connect day of the month and day of the week entries using OR logic; when on it will connect them using AND logic.'})]})]}),Rn=[{label:"Seconds",value:"seconds"},{label:"Minutes",value:"minutes"},{label:"Hours",value:"hours"},{label:"Days",value:"days"}],I={seconds:1,minutes:60,hours:3600,days:24*3600},En=s=>{let n=s;const r=Math.floor(s/I.days);if(n%=I.days,n===0)return{interval_value:r,interval_time:"days"};const a=Math.floor(s/I.hours);if(n%=I.hours,n===0)return{interval_value:a,interval_time:"hours"};const t=Math.floor(s/I.minutes);return n%=I.minutes,n===0?{interval_value:t,interval_time:"minutes"}:{interval_value:n,interval_time:"seconds"}},Fn=R({active:q(),schedule:R({interval_value:z().or(V()).pipe(Gs.number()),interval_time:P(["seconds","minutes","hours","days"]),anchor_date:Qs(),timezone:V().default("Etc/UTC")})}),J={active:!0,schedule:{interval_value:60,interval_time:"minutes",anchor_date:new Date,timezone:"Etc/UTC"}},Mn=({deployment_id:s,scheduleToEdit:n,onSubmit:r})=>{const{createDeploymentSchedule:a,isPending:t}=Se(),{updateDeploymentSchedule:i,isPending:u}=se(),o=Ae({resolver:Ce(Fn),defaultValues:J});c.useEffect(()=>{if(n){const{active:l,schedule:m}=n;if("interval"in m){const{interval:h,anchor_date:x,timezone:b}=m,{interval_value:g,interval_time:p}=En(h);o.reset({active:l,schedule:{interval_value:g,interval_time:p,anchor_date:x?new Date(x):new Date,timezone:b??"Etc/UTC"}})}}else o.reset(J)},[o,n]);const d=l=>{const m=()=>{o.reset(J),r()};n?i({deployment_id:s,schedule_id:n.id,active:l.active,schedule:{interval:l.schedule.interval_value*I[l.schedule.interval_time],anchor_date:l.schedule.anchor_date.toISOString(),timezone:l.schedule.timezone}},{onSuccess:()=>{F.success("Deployment schedule updated")},onError:h=>{const x=h.message||"Unknown error while updating deployment schedule.";o.setError("root",{message:x})},onSettled:m}):a({deployment_id:s,active:l.active,schedule:{interval:l.schedule.interval_value*I[l.schedule.interval_time],anchor_date:l.schedule.anchor_date.toISOString(),timezone:l.schedule.timezone}},{onSuccess:()=>{F.success("Deployment schedule created")},onError:h=>{const x=h.message||"Unknown error while creating deployment schedule.";o.setError("root",{message:x})},onSettled:m})};return e.jsx(De,{...o,children:e.jsxs("form",{onSubmit:l=>{o.handleSubmit(d)(l)},className:"space-y-4",children:[e.jsx(f,{children:o.formState.errors.root?.message}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(y,{control:o.control,name:"active",render:({field:l})=>e.jsxs(_,{children:[e.jsx(N,{children:"Active"}),e.jsx(T,{children:e.jsx(U,{className:"block",checked:l.value,onCheckedChange:l.onChange})}),e.jsx(f,{})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-3/4",children:e.jsx(y,{control:o.control,name:"schedule.interval_value",render:({field:l})=>e.jsxs(_,{children:[e.jsx(N,{children:"Value"}),e.jsx(T,{children:e.jsx(ve,{...l})}),e.jsx(f,{})]})})}),e.jsx(y,{control:o.control,name:"schedule.interval_time",render:({field:l})=>e.jsxs(_,{children:[e.jsx(N,{children:"Interval"}),e.jsxs(ps,{onValueChange:l.onChange,defaultValue:l.value,value:l.value,children:[e.jsx(T,{children:e.jsx(js,{children:e.jsx(gs,{placeholder:"Select interval"})})}),e.jsx(fs,{children:Rn.map(({label:m,value:h})=>e.jsx(vs,{value:h,children:m},h))})]}),e.jsx(f,{})]})})]}),e.jsx(y,{control:o.control,name:"schedule.anchor_date",render:({field:l})=>e.jsxs(_,{className:"flex flex-col",children:[e.jsx(N,{children:"Anchor date"}),e.jsxs(Ss,{children:[e.jsx(Cs,{asChild:!0,children:e.jsx(T,{children:e.jsxs(j,{variant:"outline",className:fe("w-full",!l.value&&"text-muted-foreground"),children:[Ds(l.value,"dateTime"),e.jsx(k,{id:"Calendar",className:"ml-auto size-4 opacity-50"})]})})}),e.jsx(ws,{className:"w-auto p-0",align:"start",children:e.jsx(bs,{mode:"single",selected:l.value,onSelect:l.onChange})})]}),e.jsx(f,{})]})}),e.jsx(y,{control:o.control,name:"schedule.timezone",render:({field:l})=>e.jsxs(_,{children:[e.jsx(N,{children:"Timezone"}),e.jsx(T,{children:e.jsx(Qe,{selectedValue:l.value,onSelect:l.onChange})}),e.jsx(f,{})]})})]}),e.jsxs(ne,{children:[e.jsx(te,{asChild:!0,children:e.jsx(j,{variant:"outline",children:"Close"})}),e.jsx(j,{type:"submit",loading:t||u,children:"Save"})]})]})})},In=()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(M,{children:"Sorry, modifying RRule schedules via the UI is currently unsupported; select a different schedule type above or modify your schedule in code."}),e.jsxs(ne,{children:[e.jsx(Ws,{asChild:!0,children:e.jsx(j,{variant:"outline",children:"Close"})}),e.jsx(j,{disabled:!0,children:"Save"})]})]}),kn=({deploymentId:s,onOpenChange:n,open:r,scheduleToEdit:a,onSubmit:t})=>{const[i,u]=c.useState("interval");c.useEffect(()=>{if(!a)return;const{schedule:d}=a;"interval"in d?u("interval"):"cron"in d?u("cron"):u("rrule")},[a]);const o=[{value:"interval",label:"Interval",Component:()=>e.jsx(Mn,{deployment_id:s,onSubmit:t,scheduleToEdit:a})},{value:"cron",label:"Cron",Component:()=>e.jsx(Nn,{deployment_id:s,onSubmit:t,scheduleToEdit:a})},{value:"rrule",label:"RRule",Component:()=>e.jsx(In,{})}];return e.jsx(we,{open:r,onOpenChange:n,children:e.jsxs(be,{"aria-describedby":void 0,children:[e.jsx(ye,{children:e.jsxs(_e,{children:[a?"Edit":"Add"," Schedule"]})}),e.jsxs(je,{defaultValue:o[0].value,value:i,children:[e.jsx(ge,{children:o.map(({value:d,label:l})=>e.jsx(A,{value:d,onClick:()=>u(d),children:l},d))}),o.map(({value:d,Component:l})=>e.jsx(L,{value:d,children:e.jsx(l,{})},d))]})]})})},ae=s=>{const{schedule:n}=s;return"interval"in n?`Every ${ys(n.interval*1e3)}`:"cron"in n?Pe.toString(n.cron):Bs(n.rrule).toText()},Ln=()=>{const[s,n]=Js(),{deleteDeploymentSchedule:r}=_s();return[s,t=>n({title:"Delete Schedule",description:`Are you sure you want to delete ${ae(t)} schedule?`,onConfirm:()=>{const{id:i,deployment_id:u}=t;if(!u)throw new Error("'deployment_id' expected");r({deployment_id:u,schedule_id:i},{onSuccess:()=>F.success("Schedule deleted"),onError:o=>{const d=o.message||"Unknown error while deleting schedule.";console.error(d)}})}})]},An=({deploymentSchedule:s,onEditSchedule:n})=>{const[r,a]=Ln(),t=o=>{navigator.clipboard.writeText(o),F.success("ID copied")},i=()=>a(s),u=()=>n(s.id);return e.jsxs(e.Fragment,{children:[e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"size-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(k,{id:"MoreVertical",className:"size-4"})]})}),e.jsxs(ee,{align:"end",children:[e.jsx(Q,{children:"Actions"}),e.jsx(E,{onClick:()=>t(s.id),children:"Copy ID"}),e.jsx(E,{onClick:u,children:"Edit"}),e.jsx(E,{onClick:i,children:"Delete"})]})]}),e.jsx(Fe,{...r})]})},Pn=({deploymentSchedule:s,disabled:n})=>{const{updateDeploymentSchedule:r}=se(),a=t=>{const{id:i,deployment_id:u}=s;if(!u)throw new Error("'deployment_id' expected");r({schedule_id:i,deployment_id:u,active:t},{onSuccess:()=>F.success(`Deployment schedule ${t?"active":"paused"}`),onError:o=>{const d=o.message||"Unknown error while updating deployment schedule.";console.error(d)}})};return e.jsx(Ne,{children:e.jsxs(Te,{children:[e.jsx(Re,{asChild:!0,children:e.jsx("div",{children:e.jsx(U,{"aria-label":`toggle ${ae(s)}`,checked:s.active,onCheckedChange:a,disabled:n})})}),n&&e.jsx(Ee,{children:"Pause or resume this schedule"})]})})},Vn=({deploymentSchedule:s,disabled:n,onEditSchedule:r})=>e.jsx(Ns,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(M,{children:ae(s)}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx(Pn,{deploymentSchedule:s,disabled:n}),e.jsx(An,{deploymentSchedule:s,onEditSchedule:r})]})]})}),zn=({deployment:s})=>{const{updateDeployment:n}=Ts(),r=t=>{n({id:s.id,paused:!t},{onSuccess:()=>{F.success(`Deployment ${t?"active":"paused"}`)},onError:i=>{const u=i.message||"Unknown error while updating deployment";console.error(u)}})},a=s.entrypoint===""||s.entrypoint===null;return e.jsx(Ne,{children:e.jsxs(Te,{children:[e.jsx(Re,{asChild:!0,children:e.jsx("div",{children:e.jsx(U,{"aria-label":"Pause or resume all schedules",disabled:a,onCheckedChange:r,checked:!s.paused})})}),e.jsx(Ee,{children:"Pause or resume all schedules"})]})})},Un=3,On=({deployment:s,onAddSchedule:n,onEditSchedule:r})=>{const a=c.useMemo(()=>s.schedules?s.schedules.sort((t,i)=>t.created?i.created?Date.parse(t.created)-Date.parse(i.created):1:-1):[],[s.schedules]);return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{variant:"bodySmall",className:"text-muted-foreground",children:"Schedules"}),(a.length>Un||s.paused)&&e.jsx(zn,{deployment:s})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[a.map(t=>e.jsx(Vn,{disabled:s.paused,deploymentSchedule:t,onEditSchedule:r},t.id)),e.jsx("div",{children:e.jsxs(j,{size:"sm",onClick:n,children:[e.jsx(k,{id:"Plus",className:"mr-2 size-4"})," Schedule"]})})]})]})},$n=({deployment:s})=>e.jsx(c.Suspense,{fallback:e.jsx(Gn,{numSkeletons:2}),children:e.jsx(Bn,{deployment:s})}),Bn=({deployment:s})=>{const{data:n}=me(Rs(`prefect.deployment.${s.id}`));return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Triggers"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Qn,{automations:n}),e.jsx(C,{to:"/automations/create",search:{actions:{type:"run-deployment",deploymentId:s.id,parameters:s.parameters}},children:e.jsxs(j,{size:"sm",children:[e.jsx(k,{id:"Plus",className:"mr-2 size-4"})," Add"]})})]})]})},Qn=({automations:s})=>e.jsx("ul",{className:"flex flex-col gap-1",children:s.map(n=>e.jsx("li",{children:e.jsxs(C,{to:"/automations/automation/$id",params:{id:n.id},className:"flex items-center text-xs",children:[e.jsx(k,{id:"Bot",className:"mr-1 size-4"}),e.jsx("div",{children:n.name})]})},n.id))}),Gn=({numSkeletons:s=1})=>e.jsx("ul",{className:"flex flex-col gap-1",children:Array.from({length:s}).map((n,r)=>e.jsx("li",{children:e.jsx(Es,{className:"h-4 w-full"})},r))}),Hn=({deployment:s})=>{const{onQuickRun:n,isPending:r}=Zs();return e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(j,{loading:r,children:["Run ",e.jsx(k,{className:"ml-1 size-4",id:"Play"})]})}),e.jsx(ee,{children:e.jsxs(Fs,{children:[e.jsx(E,{onClick:()=>n(s.id),children:"Quick run"}),e.jsx(C,{to:"/deployments/deployment/$id/run",params:{id:s.id},search:{parameters:s.parameters},children:e.jsx(E,{children:"Custom run"})})]})})]})},Wn=({id:s})=>{const[n,r]=c.useState({open:!1,scheduleIdToEdit:""}),{data:a}=me(Ms(s)),[t,i]=qs(),u=c.useMemo(()=>{if(!(!a.schedules||!n.scheduleIdToEdit))return a.schedules.find(h=>h.id===n.scheduleIdToEdit)},[a.schedules,n.scheduleIdToEdit]),o=()=>r({open:!0,scheduleIdToEdit:""}),d=h=>r({open:!0,scheduleIdToEdit:h}),l=()=>r({open:!1,scheduleIdToEdit:""}),m=h=>{h||l()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex align-middle justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Xs,{deployment:a}),e.jsx(Us,{deployment:a})]}),e.jsxs("div",{className:"flex align-middle gap-2",children:[e.jsx(Hn,{deployment:a}),e.jsx(Ks,{id:s,onDelete:()=>i(a,{shouldNavigate:!0})})]})]}),e.jsxs("div",{className:"grid gap-4",style:{gridTemplateColumns:"5fr 1fr"},children:[e.jsx("div",{className:"flex flex-col gap-5",children:e.jsx(Sn,{deployment:a})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(On,{deployment:a,onAddSchedule:o,onEditSchedule:d}),e.jsx($n,{deployment:a}),e.jsx("hr",{}),e.jsx(Dn,{deployment:a})]})]})]}),e.jsx(kn,{deploymentId:s,open:n.open,onOpenChange:m,scheduleToEdit:u,onSubmit:l}),e.jsx(Fe,{...t})]})};R({tab:P(["Runs","Upcoming","Parameters","Configuration","Description"]).default("Runs"),runs:R({flowRuns:R({name:V().optional(),state:de(P(ce)).optional().default(Z).catch(Z)}).optional(),page:z().int().positive().optional().default(1).catch(1),limit:z().int().positive().optional().default(10).catch(10),sort:P(ie).optional().default("START_TIME_DESC").catch("START_TIME_DESC")}).optional(),upcoming:R({flowRuns:R({name:V().optional(),state:de(P(ce)).optional().default(["Scheduled"]).catch(["Scheduled"])}).optional(),page:z().int().positive().optional().default(1).catch(1),limit:z().int().positive().optional().default(5).catch(5),sort:P(ie).optional().default("START_TIME_ASC").catch("START_TIME_ASC")}).optional()});function xt(){const{id:s}=Is.useParams();return e.jsx(Wn,{id:s})}export{xt as component};
//# sourceMappingURL=deployment._id-CpP2g_Os.js.map

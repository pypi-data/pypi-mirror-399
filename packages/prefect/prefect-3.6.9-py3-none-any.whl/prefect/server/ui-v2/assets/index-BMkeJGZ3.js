import{j as e,C as N,r as p,l as q,E as J,m as K,h as Q,L as ue}from"./vendor-tanstack-zpsXWFxg.js";import{p as me,q as he,o as d,I as k,r as xe,s as je,t as T,u as v,bg as W,x as X,O as Y,aP as Z,E as ee,k as se,l as ne,m as ae,n as re,D as te,a2 as oe,bh as ge,ac as ce,ad as _,ae as V,af as E,ag as G,ai as ie,ao as u,aj as x,ak as j,al as g,am as y,an as C,ap as M,bi as P,bj as ye,ah as pe,bk as be,bl as Ce,bm as ve,as as fe,at as Le,au as O,av as F,B as we,g as Se,h as ke}from"./index-4D6ue93A.js";import{d as le,b as I,n as w,c as h,g as De,j as S,f as Re}from"./vendor-forms-DEIP3aGx.js";import{T as Te,a as Ae,b as Ne}from"./task-run-concurrency-limits-reset-dialog-BsmDt_jY.js";import"./vendor-react-Bce9NwRC.js";import"./vendor-radix-CrLZvj36.js";import"./vendor-recharts-C8e6QlQ9.js";import"./vendor-codemirror-KWel9Npa.js";import"./vendor-date-ByQxM3Xh.js";const _e=({onEditRow:s,onDeleteRow:n,...a})=>{const r=i=>{navigator.clipboard.writeText(i),v.success("ID copied")},t=a.row.original;return e.jsxs(me,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"size-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(k,{id:"MoreVertical",className:"size-4"})]})}),e.jsxs(xe,{align:"end",children:[e.jsx(je,{children:"Actions"}),e.jsx(T,{onClick:()=>r(t.id),children:"Copy ID"}),e.jsx(T,{onClick:()=>n(t),children:"Delete"}),e.jsx(T,{onClick:()=>s(t),children:"Edit"})]})]})},Ve=s=>{const{updateGlobalConcurrencyLimit:n}=W(),a=(i,o)=>{n({id_or_name:o,active:i},{onSuccess:()=>{v.success("Concurrency limit updated")},onError:c=>{const l=c.message||"Unknown error while updating active field.";console.error(l)}})},r=s.getValue(),t=s.row.original.id;return e.jsx(X,{"aria-label":"toggle active",checked:r,onCheckedChange:i=>a(i,t)})},z=N("/concurrency-limits/"),b=Q(),Ee=({onEditRow:s,onDeleteRow:n})=>[b.accessor("name",{header:"Name"}),b.accessor("limit",{header:"Limit"}),b.accessor("active_slots",{header:"Active Slots"}),b.accessor("slot_decay_per_second",{header:"Slots Decay Per Second"}),b.accessor("active",{header:"Active",cell:Ve}),b.display({id:"actions",cell:a=>e.jsx("div",{className:"flex flex-row justify-end",children:e.jsx(_e,{...a,onEditRow:s,onDeleteRow:n})})})],Ge=({data:s,onEditRow:n,onDeleteRow:a})=>{const r=z.useNavigate(),{search:t}=z.useSearch(),i=p.useDeferredValue(t??""),o=p.useMemo(()=>s.filter(c=>c.name.toLowerCase().includes(i.toLowerCase())),[s,i]);return e.jsx(Me,{data:o,onDeleteRow:a,onEditRow:n,searchValue:t,onSearchChange:c=>{r({to:".",search:l=>({...l,search:c})})}})};function Me({data:s,onDeleteRow:n,onEditRow:a,onSearchChange:r,searchValue:t}){const i=q({data:s,columns:Ee({onDeleteRow:n,onEditRow:a}),getCoreRowModel:K(),getPaginationRowModel:J()});return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Y,{className:"max-w-72",placeholder:"Search global concurrency limit",value:t,onChange:o=>r(o.target.value)}),e.jsx(Z,{table:i})]})}const Pe=({onAdd:s})=>e.jsxs(ee,{children:[e.jsx(se,{id:"AlignVerticalJustifyStart"}),e.jsx(ne,{children:"Add a concurrency limit"}),e.jsx(ae,{children:"Global concurrency limits can be applied to flow runs, task runs and any operation where you want to control concurrency."}),e.jsxs(re,{children:[e.jsxs(d,{onClick:s,children:["Add Concurrency Limit ",e.jsx(k,{id:"Plus",className:"size-4 ml-2"})]}),e.jsx(te,{id:"global-concurrency-guide"})]})]}),Ie=({onAdd:s})=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(oe,{className:"font-semibold",children:"Global Concurrency Limits"}),e.jsx(d,{onClick:s,size:"icon",className:"size-7",variant:"outline","aria-label":"add global concurrency limit",children:e.jsx(k,{id:"Plus",className:"size-4"})})]}),Oe=I({active:De().default(!0),denied_slots:w().default(0).or(h()).pipe(S.number()),limit:w().default(0).or(h()).pipe(S.number()),name:h().min(2,{message:"Name must be at least 2 characters"}).default(""),slot_decay_per_second:w().default(0).or(h()).pipe(S.number()),active_slots:w().default(0).or(h()).pipe(S.number())}),A={active:!0,name:"",limit:0,slot_decay_per_second:0,denied_slots:0,active_slots:0},Fe=({limitToUpdate:s,onSubmit:n})=>{const{createGlobalConcurrencyLimit:a,status:r}=ge(),{updateGlobalConcurrencyLimit:t,status:i}=W(),o=le({resolver:ce(Oe),defaultValues:A});return p.useEffect(()=>{if(s){const{active:l,name:D,limit:f,slot_decay_per_second:L,active_slots:de}=s;o.reset({active:l,name:D,limit:f,slot_decay_per_second:L,active_slots:de})}else o.reset(A)},[o,s]),{form:o,saveOrUpdate:l=>{const D=()=>{o.reset(A),n()};s?.id?t({id_or_name:s.id,...l},{onSuccess:()=>{v.success("Limit updated")},onError:f=>{const L=f.message||"Unknown error while updating limit.";o.setError("root",{message:L})},onSettled:D}):a(l,{onSuccess:()=>{v.success("Limit created")},onError:f=>{const L=f.message||"Unknown error while creating variable.";o.setError("root",{message:L})},onSettled:D})},isLoading:r==="pending"||i==="pending"}},U=({limitToUpdate:s,onOpenChange:n,onSubmit:a})=>{const{form:r,isLoading:t,saveOrUpdate:i}=Fe({limitToUpdate:s,onSubmit:a}),o=s?`Update ${s.name}`:"Add Concurrency Limit";return e.jsx(_,{open:!0,onOpenChange:n,children:e.jsxs(V,{"aria-describedby":void 0,children:[e.jsx(E,{children:e.jsx(G,{children:o})}),e.jsx(ie,{...r,children:e.jsxs("form",{onSubmit:c=>{r.handleSubmit(i)(c)},className:"space-y-4",children:[e.jsx(u,{children:r.formState.errors.root?.message}),e.jsx(x,{control:r.control,name:"name",render:({field:c})=>e.jsxs(j,{children:[e.jsx(g,{children:"Name"}),e.jsx(y,{children:e.jsx(C,{type:"text",autoComplete:"off",...c})}),e.jsx(u,{})]})}),e.jsx(x,{control:r.control,name:"limit",render:({field:c})=>e.jsxs(j,{children:[e.jsx(g,{children:"Concurrency Limit"}),e.jsx(y,{children:e.jsx(C,{type:"number",...c})}),e.jsx(u,{})]})}),e.jsx(x,{control:r.control,name:"slot_decay_per_second",render:({field:c})=>e.jsxs(j,{children:[e.jsx(g,{children:"Slot Decay Per Second"}),e.jsx(y,{children:e.jsx(C,{type:"number",...c})}),e.jsx(u,{})]})}),s&&e.jsx(x,{control:r.control,name:"active_slots",render:({field:c})=>e.jsxs(j,{children:[e.jsx(g,{children:"Active Slots"}),e.jsx(y,{children:e.jsx(C,{type:"number",...c})}),e.jsx(u,{})]})}),e.jsx(x,{control:r.control,name:"active",render:({field:c})=>e.jsxs(j,{children:[e.jsx(g,{children:"Active"}),e.jsx(y,{children:e.jsx(X,{className:"block",checked:c.value,onCheckedChange:c.onChange})}),e.jsx(u,{})]})}),e.jsxs(M,{children:[e.jsx(P,{asChild:!0,children:e.jsx(d,{variant:"outline",children:"Close"})}),e.jsx(d,{type:"submit",loading:t,children:s?"Update":"Save"})]})]})})]})})},ze=({limit:s,onOpenChange:n,onDelete:a})=>{const{deleteGlobalConcurrencyLimit:r,isPending:t}=ye(),i=o=>{r(o,{onSuccess:()=>{v.success("Concurrency limit deleted")},onError:c=>{const l=c.message||"Unknown error while deleting concurrency limit.";console.error(l)},onSettled:a})};return e.jsx(_,{open:!0,onOpenChange:n,children:e.jsxs(V,{children:[e.jsx(E,{children:e.jsx(G,{children:"Delete Concurrency Limit"})}),e.jsxs(pe,{children:["Are you sure you want to delete ",s.name]}),e.jsxs(M,{children:[e.jsx(P,{asChild:!0,children:e.jsx(d,{variant:"outline",children:"Close"})}),e.jsx(d,{variant:"destructive",onClick:()=>i(s.id),loading:t,children:"Delete"})]})]})})},Ue=({openDialog:s,onCloseDialog:n,onOpenChange:a})=>{const{dialog:r,data:t}=s;switch(r){case"create":return e.jsx(U,{onOpenChange:a,onSubmit:n});case"delete":return e.jsx(ze,{limit:t,onOpenChange:a,onDelete:n});case"edit":return e.jsx(U,{onOpenChange:a,limitToUpdate:t,onSubmit:n});default:return null}},$e=()=>{const[s,n]=p.useState({dialog:null,data:void 0}),{data:a}=be(),r=()=>n({dialog:"create",data:void 0}),t=l=>n({dialog:"edit",data:l}),i=l=>n({dialog:"delete",data:l}),o=()=>n({dialog:null,data:void 0}),c=l=>{l||o()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Ie,{onAdd:r}),a.length===0?e.jsx(Pe,{onAdd:r}):e.jsx(Ge,{data:a,onEditRow:t,onDeleteRow:i}),e.jsx(Ue,{openDialog:s,onCloseDialog:o,onOpenChange:c})]})},Be=s=>{const a=s.getValue().length;return a===0?"None":a},He=s=>{const n=s.getValue(),a=s.row.original.id;return e.jsx(ue,{params:{id:a},to:"/concurrency-limits/concurrency-limit/$id",children:n})},$=N("/concurrency-limits/"),R=Q(),qe=({onDeleteRow:s,onResetRow:n})=>[R.accessor("tag",{header:"Tag",cell:He}),R.accessor("concurrency_limit",{header:"Slots"}),R.accessor("active_slots",{header:"Active Task Runs",cell:Be}),R.display({id:"actions",cell:a=>{const r=a.row.original;return e.jsx("div",{className:"flex flex-row justify-end",children:e.jsx(Te,{id:r.id,onDelete:()=>s(r),onReset:()=>n(r)})})}})],Je=({data:s,onDeleteRow:n,onResetRow:a})=>{const r=$.useNavigate(),{search:t}=$.useSearch(),i=p.useDeferredValue(t??""),o=p.useMemo(()=>s.filter(c=>c.tag.toLowerCase().includes(i.toLowerCase())),[s,i]);return e.jsx(Ke,{data:o,onDeleteRow:n,onResetRow:a,searchValue:t,onSearchChange:c=>{r({to:".",search:l=>({...l,search:c})})}})};function Ke({data:s,onDeleteRow:n,onResetRow:a,onSearchChange:r,searchValue:t}){const i=q({data:s,columns:qe({onDeleteRow:n,onResetRow:a}),getCoreRowModel:K(),getPaginationRowModel:J()});return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Y,{className:"max-w-72",placeholder:"Search active task limit",value:t,onChange:o=>r(o.target.value)}),e.jsx(Z,{table:i})]})}const Qe=({onAdd:s})=>e.jsxs(ee,{children:[e.jsx(se,{id:"CircleArrowOutUpRight"}),e.jsx(ne,{children:"Add a concurrency limit for your task runs"}),e.jsx(ae,{children:"Creating a limit allows you to limit the number of tasks running simultaneously with a given tag."}),e.jsxs(re,{children:[e.jsxs(d,{onClick:s,children:["Add Concurrency Limit ",e.jsx(k,{id:"Plus",className:"size-4 ml-2"})]}),e.jsx(te,{id:"task-concurrency-guide"})]})]}),We=({onAdd:s})=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(oe,{className:"font-semibold",children:"Task Run Concurrency Limits"}),e.jsx(d,{onClick:s,size:"icon",className:"size-7",variant:"outline","aria-label":"add task run concurrency limit",children:e.jsx(k,{id:"Plus",className:"size-4"})})]}),Xe=I({tag:h().min(1),concurrency_limit:w().default(0).or(h()).pipe(S.number())}),B={tag:"",concurrency_limit:0},Ye=({onOpenChange:s,onSubmit:n})=>{const{createTaskRunConcurrencyLimit:a,isPending:r}=Ce(),t=le({resolver:ce(Xe),defaultValues:B}),i=o=>{a(o,{onSuccess:()=>{v.success("Concurrency limit added")},onError:c=>{const l=c.message||"Unknown error while updating limit.";t.setError("root",{message:l})},onSettled:()=>{t.reset(B),n()}})};return e.jsx(_,{open:!0,onOpenChange:s,children:e.jsxs(V,{"aria-describedby":void 0,children:[e.jsx(E,{children:e.jsx(G,{children:"Add Task Run Concurrency Limit"})}),e.jsx(ie,{...t,children:e.jsxs("form",{onSubmit:o=>{t.handleSubmit(i)(o)},className:"space-y-4",children:[e.jsx(u,{children:t.formState.errors.root?.message}),e.jsx(x,{control:t.control,name:"tag",render:({field:o})=>e.jsxs(j,{children:[e.jsx(g,{children:"Tag"}),e.jsx(y,{children:e.jsx(C,{type:"text",autoComplete:"off",...o})}),e.jsx(u,{})]})}),e.jsx(x,{control:t.control,name:"concurrency_limit",render:({field:o})=>e.jsxs(j,{children:[e.jsx(g,{children:"Concurrency Limit"}),e.jsx(y,{children:e.jsx(C,{type:"number",...o})}),e.jsx(u,{})]})}),e.jsxs(M,{children:[e.jsx(P,{asChild:!0,children:e.jsx(d,{variant:"outline",children:"Close"})}),e.jsx(d,{type:"submit",loading:r,children:"Add"})]})]})})]})})},Ze=({openDialog:s,onCloseDialog:n,onOpenChange:a})=>{const{dialog:r,data:t}=s;switch(r){case"create":return e.jsx(Ye,{onOpenChange:a,onSubmit:n});case"reset":return e.jsx(Ne,{data:t,onOpenChange:a,onReset:n});case"delete":return e.jsx(Ae,{data:t,onOpenChange:a,onDelete:n});default:return null}},es=()=>{const[s,n]=p.useState({dialog:null,data:void 0}),{data:a}=ve(),r=()=>n({dialog:"create",data:void 0}),t=l=>n({dialog:"delete",data:l}),i=l=>n({dialog:"reset",data:l}),o=()=>n({dialog:null,data:void 0}),c=l=>{l||o()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(We,{onAdd:r}),a.length===0?e.jsx(Qe,{onAdd:r}):e.jsx(Je,{data:a,onDeleteRow:t,onResetRow:i}),e.jsx(Ze,{openDialog:s,onCloseDialog:o,onOpenChange:c})]})},H=N("/concurrency-limits/"),m={global:{tabSearchValue:"global",displayValue:"Global"},"task-run":{tabSearchValue:"task-run",displayValue:"Task Run"}},ss=({globalView:s,taskRunView:n})=>{const{tab:a}=H.useSearch(),r=H.useNavigate();return e.jsxs(fe,{defaultValue:"Global",value:a,children:[e.jsxs(Le,{children:[e.jsx(O,{value:m.global.tabSearchValue,onClick:()=>{r({to:"/concurrency-limits",search:{tab:m.global.tabSearchValue}})},children:m.global.displayValue}),e.jsx(O,{value:m["task-run"].tabSearchValue,onClick:()=>{r({to:"/concurrency-limits",search:{tab:m["task-run"].tabSearchValue}})},children:m["task-run"].displayValue})]}),e.jsx(F,{value:m.global.tabSearchValue,children:s}),e.jsx(F,{value:m["task-run"].tabSearchValue,children:n})]})},ns=()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(as,{}),e.jsx(ss,{globalView:e.jsx($e,{}),taskRunView:e.jsx(es,{})})]}),as=()=>e.jsx(we,{children:e.jsx(Se,{children:e.jsx(ke,{className:"text-xl font-semibold",children:"Concurrency"})})});I({search:h().optional(),tab:Re(["global","task-run"]).default("global")});const hs=ns;export{hs as component};
//# sourceMappingURL=index-BMkeJGZ3.js.map

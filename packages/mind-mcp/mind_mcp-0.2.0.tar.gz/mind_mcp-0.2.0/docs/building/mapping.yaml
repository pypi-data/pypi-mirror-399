# Repo-to-Graph Mapping
#
# What in the repository becomes what in the graph.
# Used by ingest pipeline to convert docs/code to nodes/links.
#
# DOCS: docs/building/PATTERNS_Mind_Graph_System.md

version: "2.0"

# =============================================================================
# SPACES — Where work happens
# =============================================================================

spaces:
  # Directory structure → Space nodes
  from_directories:
    - pattern: "docs/{area}/{module}/"
      creates:
        node: Space
        properties:
          id: "space_{area}_{module}"
          name: "{module}"
          type: "module"
          area: "{area}"

    - pattern: "docs/{module}/"
      creates:
        node: Space
        properties:
          id: "space_{module}"
          name: "{module}"
          type: "module"

    - pattern: "engine/{area}/"
      creates:
        node: Space
        properties:
          id: "space_engine_{area}"
          name: "{area}"
          type: "code_area"

  # Special spaces
  static:
    - id: "space_project_root"
      name: "Project Root"
      type: "root"

    - id: "space_building"
      name: "Building mind"
      type: "meta"

# =============================================================================
# NARRATIVES — What we know/believe/want
# =============================================================================

narratives:
  # Doc files → Narrative nodes
  from_docs:
    - pattern: "OBJECTIVES_*.md"
      creates:
        node: Narrative
        properties:
          type: "objectives"
        extract:
          - section: "PRIMARY OBJECTIVES"
            as: "objectives"
          - section: "NON-OBJECTIVES"
            as: "non_objectives"
          - section: "TRADEOFFS"
            as: "tradeoffs"

    - pattern: "PATTERNS_*.md"
      creates:
        node: Narrative
        properties:
          type: "pattern"
        extract:
          - section: "## *"
            as: "pattern_section"

    - pattern: "BEHAVIORS_*.md"
      creates:
        node: Narrative
        properties:
          type: "behavior"
        extract:
          - section: "### B*"
            as: "behavior"
            properties:
              id: "from_heading"

    - pattern: "VALIDATION_*.md"
      creates:
        node: Narrative
        properties:
          type: "validation"
        extract:
          - section: "### V*"
            as: "invariant"

    - pattern: "ALGORITHM_*.md"
      creates:
        node: Narrative
        properties:
          type: "algorithm"

    - pattern: "IMPLEMENTATION_*.md"
      creates:
        node: Narrative
        properties:
          type: "implementation"

    - pattern: "HEALTH_*.md"
      creates:
        node: Narrative
        properties:
          type: "health"

    - pattern: "SYNC_*.md"
      creates:
        node: Narrative
        properties:
          type: "sync"

  # Markers → Narrative nodes
  from_markers:
    - pattern: "@mind:todo {content}"
      creates:
        node: Narrative
        properties:
          type: "goal"
          status: "pending"
          content: "{content}"

    - pattern: "@mind:escalation {content}"
      creates:
        node: Narrative
        properties:
          type: "escalation"
          status: "pending"
          content: "{content}"

    - pattern: "@mind:proposition {content}"
      creates:
        node: Narrative
        properties:
          type: "proposition"
          status: "pending"
          content: "{content}"

# =============================================================================
# THINGS — File pointers, external refs
# =============================================================================

things:
  from_files:
    - pattern: "*.py"
      creates:
        node: Thing
        properties:
          type: "file"
          path: "{full_path}"
          name: "{filename}"

    - pattern: "*.md"
      creates:
        node: Thing
        properties:
          type: "file"
          path: "{full_path}"
          name: "{filename}"

    - pattern: "*.yaml"
      creates:
        node: Thing
        properties:
          type: "file"
          path: "{full_path}"
          name: "{filename}"

  # External refs (extracted from docs)
  from_content:
    - pattern: "https://{url}"
      creates:
        node: Thing
        properties:
          type: "external"
          uri: "https://{url}"

    - pattern: "falkor://{path}"
      creates:
        node: Thing
        properties:
          type: "db"
          uri: "falkor://{path}"

# =============================================================================
# ACTORS — Who does work
# =============================================================================

actors:
  static:
    - id: "actor_human"
      name: "Human"
      type: "human"
      weight: 1.0
      energy: 1.0

  from_config:
    file: "agents.yaml"
    creates:
      node: Actor
      properties:
        type: "agent"
        weight: 0.8
        energy: 0.0

# =============================================================================
# LINKS — Relationships (9 types per schema v1.2)
# =============================================================================

links:
  # Spatial containment (INVERTED: Space → contents)
  contains:
    - when: "Narrative extracted from doc in {module} directory"
      creates:
        link: contains
        from: "Space (module)"
        to: "Narrative"

    - when: "Actor assigned to Space in config"
      creates:
        link: contains
        from: "Space"
        to: "Actor"

    - when: "Thing (file) in directory"
      creates:
        link: contains
        from: "Space"
        to: "Thing"

  # Actor → Moment (who said/did this)
  expresses:
    - when: "Actor creates Moment"
      creates:
        link: expresses
        from: "Actor"
        to: "Moment"

  # Moment → Any (what it touches)
  about:
    - when: "Moment references Narrative"
      creates:
        link: about
        from: "Moment"
        to: "Narrative"

    - when: "Moment modifies Thing"
      creates:
        link: about
        from: "Moment"
        to: "Thing"

    - when: "Marker appears in doc"
      creates:
        link: about
        from: "Narrative (marker)"
        to: "Narrative (containing doc)"

  # Any → Any (semantic relationships)
  relates:
    - when: "CHAIN section references another doc"
      creates:
        link: relates
        from: "Narrative (this doc)"
        to: "Narrative (referenced doc)"
        properties:
          direction: "chain"

    - when: "OBJECTIVES SERVED table references objective"
      creates:
        link: relates
        from: "Narrative (behavior)"
        to: "Narrative (objective)"
        properties:
          direction: "supports"

    - when: "Agent believes Narrative"
      creates:
        link: relates
        from: "Actor"
        to: "Narrative"
        properties:
          role: "believer"

    - when: "Actor originated Narrative"
      creates:
        link: relates
        from: "Actor"
        to: "Narrative"
        properties:
          role: "originator"

  # Thing → Actor (possession/attachment)
  attached_to:
    - when: "Thing belongs to Actor"
      creates:
        link: attached_to
        from: "Thing"
        to: "Actor"

  # Space → Space (navigation)
  leads_to:
    - when: "Spaces logically connected"
      creates:
        link: leads_to
        from: "Space"
        to: "Space"

  # Moment → Moment (temporal)
  sequence:
    - when: "Moments in sequence"
      creates:
        link: sequence
        from: "Moment (earlier)"
        to: "Moment (later)"

  # Moment → Moment (causal possibility)
  primes:
    - when: "Moment enables future Moment"
      creates:
        link: primes
        from: "Moment"
        to: "Moment (possible)"

  # Thing → Thing (transformation)
  can_become:
    - when: "Thing can transform"
      creates:
        link: can_become
        from: "Thing"
        to: "Thing"

# =============================================================================
# MOMENTS — Created at runtime, not ingested
# =============================================================================

moments:
  triggers:
    - "Human writes message"
    - "Agent thinks"
    - "Agent queries graph"
    - "Human makes decision"
    - "Git commit occurs"

  # Links created with Moments use: expresses, about, sequence
  # Space containment uses: contains (Space → Moment)

# =============================================================================
# EXTRACTION RULES
# =============================================================================

extraction:
  granularity:
    - level: "file"
      creates: "one Narrative per doc file"

    - level: "section"
      creates: "one Narrative per ## heading"
      when: "doc has clear sections"

    - level: "item"
      creates: "one Narrative per list item or behavior"
      when: "OBJECTIVES list, BEHAVIORS list, etc."

  default: "file"

  properties:
    - from: "STATUS: {value}"
      to: "status"

    - from: "CREATED: {value}"
      to: "created_at"

    - from: "## CHAIN"
      to: "chain_refs"

# =============================================================================
# PHYSICS DEFAULTS
# =============================================================================

physics:
  narratives:
    objectives:
      weight: 0.9
      energy: 0.0
    pattern:
      weight: 0.8
      energy: 0.0
    behavior:
      weight: 0.7
      energy: 0.0
    validation:
      weight: 0.85
      energy: 0.0
    algorithm:
      weight: 0.75
      energy: 0.0
    implementation:
      weight: 0.7
      energy: 0.0
    health:
      weight: 0.7
      energy: 0.0
    sync:
      weight: 0.6
      energy: 0.2
    goal:
      weight: 0.85
      energy: 0.3
    escalation:
      weight: 0.9
      energy: 0.5
    proposition:
      weight: 0.6
      energy: 0.2

  spaces:
    module:
      weight: 0.6
      energy: 0.0
    code_area:
      weight: 0.6
      energy: 0.0
    meta:
      weight: 0.8
      energy: 0.0
    root:
      weight: 0.5
      energy: 0.0

  things:
    file:
      weight: 0.4
      energy: 0.0
    external:
      weight: 0.3
      energy: 0.0
    db:
      weight: 0.5
      energy: 0.0

  # Link defaults (v1.2: no conductivity, weight controls flow)
  links:
    contains:
      weight: 1.0
    expresses:
      weight: 0.9
    about:
      weight: 0.7
    relates:
      weight: 0.6
    attached_to:
      weight: 0.5
    leads_to:
      weight: 0.8
    sequence:
      weight: 0.9
    primes:
      weight: 0.4
    can_become:
      weight: 0.3

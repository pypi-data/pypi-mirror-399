[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "lims2-sdk"
version = "0.7.7"
description = "生信云平台 Python SDK，提供图表上传和文件存储功能"
readme = "README.md"
requires-python = ">=3.9"
authors = [
    {name = "Lims2 Team", email = "support@lims2.com"}
]
license = {text = "MIT"}

dependencies = [
    "requests>=2.25.0",
    "click>=8.0.0",
    "oss2>=2.15.0",
    "orjson>=3.8.0",
    "tenacity>=8.0.0",
    "plotly==6.2.0",
    "kaleido==0.2.1",
]


[project.scripts]
lims2 = "lims2_cli.main:cli"

[tool.setuptools]
package-dir = {"" = "src"}
packages = ["lims2", "lims2_cli"]

# 明确指定包含的包数据
[tool.setuptools.package-data]
"*" = ["py.typed"]

# 排除开发和测试文件
[tool.setuptools.exclude-package-data]
"*" = ["tests", "tests.*", "*.tests", "*.tests.*"]

# Ruff 配置 - 替代 black + isort + flake8
[tool.ruff]
# 目标 Python 版本
target-version = "py39"
# 行长度
line-length = 88

[tool.ruff.lint]
# 启用的规则集
select = [
    "E",    # pycodestyle errors
    "W",    # pycodestyle warnings
    "F",    # pyflakes
    "I",    # isort
    "N",    # pep8-naming
    "UP",   # pyupgrade
    "C90",  # mccabe
    "B",    # flake8-bugbear
]
# 忽略的规则
ignore = [
    "E501",  # line too long (handled by formatter)
    "B008",  # do not perform function call in argument defaults
    "B904",  # raise exceptions with `raise ... from err` (not critical for now)
]

# 排除文件
exclude = [
    ".eggs",
    ".git",
    ".hg",
    ".mypy_cache",
    ".tox",
    ".venv",
    "_build",
    "buck-out",
    "build",
    "dist",
]

# McCabe 复杂度设置
[tool.ruff.lint.mccabe]
max-complexity = 10

# isort 设置
[tool.ruff.lint.isort]
known-first-party = ["lims2", "lims2_cli"]

# 格式化设置
[tool.ruff.format]
quote-style = "double"
indent-style = "space"
line-ending = "auto"

# uv 配置
[tool.uv]
# 开发依赖组
dev-dependencies = [
    "pytest>=7.0.0",
    "pytest-cov>=4.0.0",
    "pytest-mock>=3.10.0",
    "pytest-asyncio>=0.21.0",
    "ruff>=0.1.0",
    "pre-commit>=3.0.0",
    "build>=0.10.0",
]

# 指定Python版本约束 - 移动到正确的位置

# pip相关配置
[tool.uv.pip]
# 预发布版本策略
prerelease = "disallow"
# 额外索引URL（如果需要）
# extra-index-url = []

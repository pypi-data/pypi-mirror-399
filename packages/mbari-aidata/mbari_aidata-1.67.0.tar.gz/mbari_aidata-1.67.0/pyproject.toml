[tool.ruff]
line-length = 170

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"

[tool.pytest.ini_options]
testpaths = ["tests"]
# Exclude 'data' directories from pytest test discovery to prevent collecting test data files as tests.
# Do not place test code in any 'data' directory.
norecursedirs = ["tator", ".*", "dist", "build", "*.egg", "data", "logs", "docker", "transformers_cache"]

[tool.poetry]
name = "mbari-aidata"
version = "1.67.0"
description = "Command line tool to do extract, transform, load and download operations on AI data for a number of projects at MBARI that require detection, clustering or classification workflows."
authors = [
    "Danelle Cline <dcline@mbari.org>"
]
license = "Apache"
readme = "README.md"
packages = [
    { include = "mbari_aidata" },
]
exclude = ["tests", "logs", "data", "docker", "transformers_cache"]

[tool.poetry.scripts]
aidata = "mbari_aidata.__main__:cli"

[tool.poetry.dependencies]
python = ">=3.10,<3.13"
redis = "5.0.7"
tator = "1.2.3"
ephem = ">=4.1.6"
moviepy = ">=2.1.1"
opencv-contrib-python = "4.11.0.86"
pytz = ">=2024.1"
piexif = ">=1.1.3"
click = ">=8.1.7"
tqdm = "4.67.1"
requests = ">=2.32.3"
pascal-voc-writer = ">=0.1.4"
albumentations = ">=1.4.15"
albucore = ">=0.0.16"
pandas = "^2.0"
pyarrow = "^15.0"
numpy = ">=1.24,<2"
torch = "2.2.0"
torchvision = "0.17.0"
transformers = "^4.42.4"

[tool.semantic_release]
branch = "main"
commit_message = "{version}\n\nAutomatically generated by python-semantic-release"
upload_to_PyPI = false
upload_to_release = true
tag_format = "v{version}"
commit_version_number = true
allow_zero_version = true
commit_parser = "angular"
logging_use_named_masks = true
major_on_zero = true
assets = []
version_variables = ["mbari_aidata/__init__.py:__version__"]
version_toml = ["pyproject.toml:tool.poetry.version"]
build_command = "pip install poetry && poetry build"

[tool.semantic_release.commit_parser_options]
allowed_tags = [
    "build",
    "chore",
    "ci",
    "docs",
    "feat",
    "fix",
    "perf",
    "style",
    "refactor",
    "test"
]
minor_tags = ["feat"]
patch_tags = ["fix", "perf"]

[tool.semantic_release.remote.token]
env = "GITHUB_TOKEN"

[tool.semantic_release.changelog]
changelog_file = "CHANGELOG.md"
exclude_commit_patterns = [
  '''chore(?:\([^)]*?\))?: .+''',
  '''ci(?:\([^)]*?\))?: .+''',
  '''refactor(?:\([^)]*?\))?: .+''',
  '''style(?:\([^)]*?\))?: .+''',
  '''test(?:\([^)]*?\))?: .+''',
  '''build\((?!deps\): .+)''',
  '''Merged? .*''',
  '''Initial Commit.*''',
  # Old semantic-release version commits
  '''^\d+\.\d+\.\d+''',
]

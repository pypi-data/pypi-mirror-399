# CI/CD Standardization Checklist

This checklist defines the standard CI/CD and publishing workflow for all kryten-* microservices.

## 1. Single Source of Truth
- [ ] Ensure `pyproject.toml` exists and contains the correct `version`.
- [ ] Remove `VERSION` file if it exists.
- [ ] Ensure `__init__.py` (if it has version) reads from package metadata or is kept in sync.

## 2. GitHub Actions Workflows
- [ ] Create/Update `.github/workflows/release.yml`:
  - [ ] Triggers on `push` to `main` when `pyproject.toml` changes.
  - [ ] Reads version from `pyproject.toml` using `grep`.
  - [ ] Creates Git tag `vX.Y.Z`.
  - [ ] Creates GitHub Release.
- [ ] Create/Update `.github/workflows/python-publish.yml` (optional, if separate from release):
  - [ ] Triggers on `release` `published`.
  - [ ] Uses `poetry build` and `pypi-publish`.

## 3. Local Publishing Scripts
- [ ] Add `publish.sh` (Bash):
  - [ ] Reads version from `pyproject.toml`.
  - [ ] Supports `--clean`, `--build`, `--testpypi`, `--publish`.
- [ ] Add `publish.ps1` (PowerShell):
  - [ ] Reads version from `pyproject.toml`.
  - [ ] Supports `-Clean`, `-Build`, `-TestPyPI`, `-Publish`.

## 4. Documentation
- [ ] Update `PUBLISHING.md`:
  - [ ] Document the automated workflow (push `pyproject.toml` -> Release -> Publish).
  - [ ] Document manual scripts (`publish.sh`/`publish.ps1`).
  - [ ] Remove references to `VERSION` file.

## 5. Build Configuration
- [ ] Update `MANIFEST.in`:
  - [ ] Remove `include VERSION`.
  - [ ] Ensure `LICENSE` and `README.md` are included.
- [ ] Update `setup.py` (if present):
  - [ ] Ensure it reads version from `pyproject.toml` (or use `poetry`/`hatchling` backend).

## 6. Verification
- [ ] Run `./publish.ps1 -Clean -Build` locally to verify build works.
- [ ] Commit and push changes.
- [ ] Verify GitHub Actions run correctly on next version bump.

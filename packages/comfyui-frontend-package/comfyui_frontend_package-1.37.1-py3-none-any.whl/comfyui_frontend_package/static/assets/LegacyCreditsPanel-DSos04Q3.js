var G=Object.defineProperty;var r=(v,_)=>G(v,"name",{value:_,configurable:!0});import{g as J,s as K,ad as F,d as Q,ae as P,q as j,a as q,G as W}from"./vendor-primevue-rR0TB_Js.js";import{a2 as z,bh as X,bi as M,_ as k,m as Y,$ as Z,o as ee,a1 as te,z as se,l as ae,dm as oe,dn as ie}from"./index-FoJ8Eu4a.js";import{r as b,w as O,ci as V,bq as H,E as I,h as ne,c as $,d as f,j as U,z as c,br as o,k as d,A as w,u as n,e as l,q as B,l as re,s as le}from"./vendor-other-BxP-0xn6.js";import{u as ce}from"./vendor-vue-BEnTqVKr.js";import"./vendor-xterm-CWYFmgbN.js";import"./vendor-three-BsnVSA6y.js";import"./vendor-tiptap-4vvRsqpM.js";var R=(v=>(v.CREDIT_ADDED="credit_added",v.ACCOUNT_CREATED="account_created",v.API_USAGE_STARTED="api_usage_started",v.API_USAGE_COMPLETED="api_usage_completed",v))(R||{});const N=V.create({baseURL:M(),headers:{"Content-Type":"application/json"}}),de=r(()=>{const v=b(!1),_=b(null),{d:x}=ce();O(()=>M(),e=>{N.defaults.baseURL=e});const A=r((e,s,y)=>{if(X(e))return;let p;if(!V.isAxiosError(e))p=`${s} failed: ${e instanceof Error?e.message:String(e)}`;else{const a=e,i=a.response?.status;i&&y?.[i]?p=y[i]:p=a.response?.data?.message??`${s} failed with status ${i}`}_.value=p},"handleRequestError"),g=r(async(e,s)=>{const{errorContext:y,routeSpecificErrors:p}=s;v.value=!0,_.value=null;try{return(await e()).data}catch(a){return A(a,y,p),null}finally{v.value=!1}},"executeRequest");function m(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}r(m,"formatEventType");function u(e){const s=new Date(e);return x(s,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}r(u,"formatDate");function S(e){return e.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}r(S,"formatJsonKey");function C(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}r(C,"formatJsonValue");function D(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}r(D,"getEventSeverity");function E(e){const{amount:s,api_name:y,model:p,...a}=e.params||{};return Object.keys(a).length>0}r(E,"hasAdditionalInfo");function L(e){const{...s}=e.params||{};return Object.entries(s).map(([y,p])=>{const a=S(y),i=C(p);return`<strong>${a}:</strong> ${i}`}).join("<br>")}r(L,"getTooltipContent");function t(e){return e?(e/100).toFixed(2):"0.00"}r(t,"formatAmount");async function h({page:e=1,limit:s=10}={}){const y="Fetching customer events",p={400:"Invalid input, object invalid",404:"Not found"},a=await z().getAuthHeader();return a?await g(()=>N.get("/customers/events",{params:{page:e,limit:s},headers:a}),{errorContext:y,routeSpecificErrors:p}):(_.value="Authentication header is missing",null)}return r(h,"getMyEvents"),{isLoading:v,error:_,getMyEvents:h,formatEventType:m,getEventSeverity:D,formatAmount:t,hasAdditionalInfo:E,formatDate:u,formatJsonKey:S,formatJsonValue:C,getTooltipContent:L}},"useCustomerEventsService"),ue={key:0,class:"flex items-center justify-center p-8"},me={key:1,class:"p-4"},pe={class:"event-details"},fe={key:0,class:"font-semibold text-green-500"},ve={key:1},ge={key:2,class:"flex flex-col gap-1"},he={class:"font-semibold"},_e={class:"text-sm text-smoke-400"},ye=H({__name:"UsageLogsTable",setup(v,{expose:_}){const x=b([]),A=b(!0),g=b(null),m=de(),u=b({page:1,limit:7,total:0,totalPages:0}),S=I(()=>(u.value.page-1)*u.value.limit),C=I(()=>{const t=new Map;return x.value.forEach(h=>{m.hasAdditionalInfo(h)&&h.event_id&&t.set(h.event_id,m.getTooltipContent(h))}),t}),D=r(async()=>{A.value=!0,g.value=null;try{const t=await m.getMyEvents({page:u.value.page,limit:u.value.limit});t?(t.events&&(x.value=t.events),t.page&&(u.value.page=t.page),t.limit&&(u.value.limit=t.limit),t.total&&(u.value.total=t.total),t.totalPages&&(u.value.totalPages=t.totalPages),Y()?.checkForCompletedTopup(t.events)):g.value=m.error.value||"Failed to load events"}catch(t){g.value=t instanceof Error?t.message:"Unknown error",console.error("Error loading events:",t)}finally{A.value=!1}},"loadEvents"),E=r(t=>{u.value.page=t.page+1,D().catch(h=>{console.error("Error loading events:",h)})},"onPageChange");return _({refresh:r(async()=>{u.value.page=1,await D()},"refresh")}),(t,h)=>{const e=ne("tooltip");return f(),$("div",null,[A.value?(f(),$("div",ue,[c(o(J))])):g.value?(f(),$("div",me,[c(o(K),{severity:"error",closable:!1},{default:d(()=>[w(n(g.value),1)]),_:1})])):(f(),U(o(F),{key:2,value:x.value,paginator:!0,rows:u.value.limit,"total-records":u.value.total,first:S.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:E},{default:d(()=>[c(o(P),{field:"event_type",header:t.$t("credits.eventType")},{body:d(({data:s})=>[c(o(Q),{value:o(m).formatEventType(s.event_type),severity:o(m).getEventSeverity(s.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),c(o(P),{field:"details",header:t.$t("credits.details")},{body:d(({data:s})=>[l("div",pe,[s.event_type===o(R).CREDIT_ADDED?(f(),$("div",fe,n(t.$t("credits.added"))+" $"+n(o(m).formatAmount(s.params?.amount)),1)):s.event_type===o(R).ACCOUNT_CREATED?(f(),$("div",ve,n(t.$t("credits.accountInitialized")),1)):s.event_type===o(R).API_USAGE_COMPLETED?(f(),$("div",ge,[l("div",he,n(s.params?.api_name||"API"),1),l("div",_e,n(t.$t("credits.model"))+": "+n(s.params?.model||"-"),1)])):B("",!0)])]),_:1},8,["header"]),c(o(P),{field:"createdAt",header:t.$t("credits.time")},{body:d(({data:s})=>[w(n(o(m).formatDate(s.createdAt)),1)]),_:1},8,["header"]),c(o(P),{field:"params",header:t.$t("credits.additionalInfo")},{body:d(({data:s})=>[o(m).hasAdditionalInfo(s)?re((f(),U(k,{key:0,variant:"textonly",size:"icon-sm","aria-label":t.$t("credits.additionalInfo")},{default:d(()=>h[0]||(h[0]=[l("i",{class:"pi pi-info-circle"},null,-1)])),_:2},1032,["aria-label"])),[[e,{escape:!1,value:C.value.get(s.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):B("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),Ce={class:"flex h-full flex-col"},$e={class:"mb-2 text-2xl font-bold"},be={class:"flex flex-col gap-2"},xe={class:"text-sm font-medium text-muted"},Ae={class:"flex items-center justify-between"},Ee={class:"flex flex-row items-center"},ke={key:1,class:"text-xs text-muted"},we={class:"flex items-center justify-between"},Se={key:0,class:"grow"},De={class:"text-sm font-medium"},Te={class:"text-xs text-muted"},Pe={class:"flex flex-row gap-2"},Fe=H({__name:"LegacyCreditsPanel",setup(v){const{buildDocsUrl:_,docsPaths:x}=Z(),A=ee(),g=z(),m=te(),u=se(),{isActiveSubscription:S}=ae(),C=I(()=>g.loading),D=I(()=>g.isFetchingBalance),E=b(null),L=I(()=>g.lastBalanceUpdateTime?g.lastBalanceUpdateTime.toLocaleString():"");O(()=>g.lastBalanceUpdateTime,(a,i)=>{a&&a!==i&&E.value&&E.value.refresh()});const t=r(()=>{A.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),h=r(async()=>{await m.accessBillingPortal()},"handleCreditsHistoryClick"),e=r(async()=>{await u.execute("Comfy.ContactSupport")},"handleMessageSupport"),s=r(()=>{window.open(_("/tutorials/api-nodes/faq",{includeLocale:!0}),"_blank")},"handleFaqClick"),y=r(()=>{window.open(_(x.partnerNodesPricing,{includeLocale:!0}),"_blank")},"handleOpenPartnerNodesInfo"),p=b([]);return(a,i)=>(f(),U(o(W),{value:"Credits",class:"credits-container h-full"},{default:d(()=>[l("div",Ce,[l("h2",$e,n(a.$t("credits.credits")),1),c(o(j)),l("div",be,[l("h3",xe,n(a.$t("credits.yourCreditBalance")),1),l("div",Ae,[c(oe,{"text-class":"text-3xl font-bold"}),C.value?(f(),U(o(q),{key:0,width:"2rem",height:"2rem"})):o(S)?(f(),U(k,{key:1,loading:C.value,onClick:t},{default:d(()=>[w(n(a.$t("credits.purchaseCredits")),1)]),_:1},8,["loading"])):B("",!0)]),l("div",Ee,[D.value?(f(),U(o(q),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):L.value?(f(),$("div",ke,n(a.$t("credits.lastUpdated"))+": "+n(L.value),1)):B("",!0),c(k,{variant:"muted-textonly",size:"icon-sm","aria-label":a.$t("g.refresh"),onClick:i[0]||(i[0]=()=>o(m).fetchBalance())},{default:d(()=>i[1]||(i[1]=[l("i",{class:"pi pi-refresh"},null,-1)])),_:1},8,["aria-label"])])]),l("div",we,[l("h3",null,n(a.$t("credits.activity")),1),c(k,{variant:"muted-textonly",loading:C.value,onClick:h},{default:d(()=>[i[2]||(i[2]=l("i",{class:"pi pi-arrow-up-right"},null,-1)),w(" "+n(a.$t("credits.invoiceHistory")),1)]),_:1},8,["loading"])]),p.value.length>0?(f(),$("div",Se,[c(o(F),{value:p.value,"show-headers":!1},{default:d(()=>[c(o(P),{field:"title",header:a.$t("g.name")},{body:d(({data:T})=>[l("div",De,n(T.title),1),l("div",Te,n(T.timestamp),1)]),_:1},8,["header"]),c(o(P),{field:"amount",header:a.$t("g.amount")},{body:d(({data:T})=>[l("div",{class:le(["text-center text-base font-medium",T.isPositive?"text-sky-500":"text-red-400"])},n(T.isPositive?"+":"-")+"$"+n(o(ie)(T.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):B("",!0),c(o(j)),c(ye,{ref_key:"usageLogsTableRef",ref:E},null,512),l("div",Pe,[c(k,{variant:"muted-textonly",onClick:s},{default:d(()=>[i[3]||(i[3]=l("i",{class:"pi pi-question-circle"},null,-1)),w(" "+n(a.$t("credits.faqs")),1)]),_:1}),c(k,{variant:"muted-textonly",onClick:y},{default:d(()=>[i[4]||(i[4]=l("i",{class:"pi pi-question-circle"},null,-1)),w(" "+n(a.$t("subscription.partnerNodesCredits")),1)]),_:1}),c(k,{variant:"muted-textonly",onClick:e},{default:d(()=>[i[5]||(i[5]=l("i",{class:"pi pi-comments"},null,-1)),w(" "+n(a.$t("credits.messageSupport")),1)]),_:1})])])]),_:1}))}});export{Fe as default};
//# sourceMappingURL=LegacyCreditsPanel-DSos04Q3.js.map

import{a as H}from"./chunk-DFR323EV.js";import{a as M,b as g}from"./chunk-7AYLLUS2.js";import{a as I}from"./chunk-ULT7T2WM.js";import{d as p}from"./chunk-N73QEIV2.js";import{b as l}from"./chunk-JC2BH436.js";var h=l(I());var w=l(M()),y=l(H());var a=class{constructor(i){this.dialogRect=null;this.dialogOffsetX=0;this.dialogOffsetY=0;this.handlePointerDown=i=>{let e=window.visualViewport,t=this.dialogRect,o=this.dialogHeaderElement,n,s,m=(r,L)=>{this.dialogOffsetX=Math.max(r-n,-t.left),this.dialogOffsetY=Math.max(L-s,-t.top),this.dialogOffsetX=Math.min(this.dialogOffsetX,e.width-t.right),this.dialogOffsetY=Math.min(this.dialogOffsetY,e.height-t.bottom),this.element.style.transform=`translate(${this.dialogOffsetX}px, ${this.dialogOffsetY}px)`},f=r=>{m(r.clientX,r.clientY)},u=r=>{r.preventDefault(),m(r.touches[0].clientX,r.touches[0].clientY)},O=r=>{o.releasePointerCapture(r.pointerId),o.removeEventListener("pointermove",f)},b=r=>{o.removeEventListener("touchmove",u)};i instanceof PointerEvent?(n=i.clientX-this.dialogOffsetX,s=i.clientY-this.dialogOffsetY,o.setPointerCapture(i.pointerId),o.addEventListener("pointermove",f),o.addEventListener("pointerup",O,{once:!0})):(n=i.touches[0].clientX-this.dialogOffsetX,s=i.touches[0].clientY-this.dialogOffsetY,o.addEventListener("touchmove",u),o.addEventListener("touchend",b,{once:!0}))};if(this.element=i,this.formElement=this.element.querySelector('form[method="dialog"]'),!this.formElement)throw new Error(`${this} requires child <form method="dialog">`);this.dialogHeaderElement=this.element.querySelector(".dialog-header"),this.isModal=this.element.hasAttribute("df-modal"),this.induceOpen=this.evalInducer("df-induce-open",(...e)=>this.openDialog(...e)),this.induceClose=this.evalInducer("df-induce-close",(...e)=>this.closeDialog(...e))}evalInducer(i,e){var o;let t=(o=this.element)==null?void 0:o.getAttribute(i);if(!(0,h.default)(t))return()=>{};try{let n=new Function("...args",`return ${g(t,{startRule:"InduceExpression"})}`);return(...s)=>{n.call(this,...s)&&e(...s)}}catch(n){throw new Error(`Error while parsing <dialog ${i}="${t}">: ${n}.`)}}openDialog(i,...e){let t=window.visualViewport;this.element.open||!t||(this.isModal?this.element.showModal():(this.element.show(),this.dialogHeaderElement&&!this.dialogRect&&(this.dialogRect=this.element.getBoundingClientRect(),this.dialogOffsetY=Math.max((t.height-this.dialogRect.height)/2,0),this.element.style.transform=`translate(${this.dialogOffsetX}px, ${this.dialogOffsetY}px)`,this.dialogHeaderElement.addEventListener("pointerdown",this.handlePointerDown),this.dialogHeaderElement.addEventListener("touchstart",this.handlePointerDown))),this.element.addEventListener("close",()=>this.closeDialog(),{once:!0}))}closeDialog(i,e){this.element.close(e)}getDataValue(i){return null}isButtonActive(i,e,t,...o){return!1}isOpen(){return this.element.open}updateOperability(...i){this.induceOpen(...i),this.induceClose(...i)}forceVisibility(i){this.formElement===i&&this.openDialog()}},d=class extends a{constructor(e){super(e);this.formIsValid=()=>!1;this.registerInducer=e=>{e instanceof CustomEvent&&(this.form=e.detail.form,this.formIsValid=this.form.isValid,this.form.isValid=this.isDialogValid.bind(this),this.form.formset.registerInducer(this))};let t=e.querySelector('form[method="dialog"]');if(!t)throw new Error(`${e} requires child <form method="dialog">`);t.addEventListener("django-formset-connected",this.registerInducer,{once:!0})}isDialogValid(){return this.element.open?this.formIsValid():!0}openDialog(e,...t){if(!this.element.open){if(!this.form)throw new Error(`${this}.form has never been registered`);this.form.setPristine(),this.form.untouch(),(e==null?void 0:e.element)instanceof HTMLButtonElement&&(0,y.default)(t[0])&&t[0].call(e,this.form.path),super.openDialog(e,...t)}}closeDialog(e,t){var o,n;if(!(!((e==null?void 0:e.element)instanceof HTMLButtonElement)||!(0,h.default)(t)))switch(t){case"apply":this.formIsValid()&&this.element.close("apply");break;case"close":this.element.blur(),this.element.close("close");break;case"reset":(o=this.form)==null||o.resetToInitial();break;case"clear":(n=this.form)==null||n.resetToInitial(),this.element.blur(),this.element.close("clear");break;default:break}}getDataValue(e){return this.form.getDataValue(e)}isButtonActive(e,t,o,...n){return o&&(0,w.default)(p(this.form.path,e),o.path)&&t(...n)}},E=Symbol("FormDialog"),D,v=class extends(D=HTMLDialogElement,E,D){constructor(){super(),this[E]=new d(this)}};export{a,v as b};

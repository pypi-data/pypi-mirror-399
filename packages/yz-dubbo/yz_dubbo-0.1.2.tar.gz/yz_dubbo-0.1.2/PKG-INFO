Metadata-Version: 2.4
Name: yz-dubbo
Version: 0.1.2
Summary: æœ‰èµ Dubbo SDK - æ”¯æŒ Dubbo RPC è°ƒç”¨
Author-email: YouzanTech <tech@youzan.com>
License: MIT
Project-URL: Homepage, https://github.com/youzan/yz-dubbo
Project-URL: Documentation, https://github.com/youzan/yz-dubbo/blob/main/README.md
Project-URL: Repository, https://github.com/youzan/yz-dubbo.git
Project-URL: Issues, https://github.com/youzan/yz-dubbo/issues
Keywords: dubbo,rpc,youzan
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: httpx>=0.24.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: flake8>=6.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"

# YZ-Dubbo

æœ‰èµ Dubbo SDK - åŸºäº Tether ç½‘å…³çš„ Dubbo RPC è°ƒç”¨å°è£…

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **ç®€å•æ˜“ç”¨**: æä¾›ç®€æ´çš„å‡½æ•°å¼ API
- â±ï¸ **è¶…æ—¶æ§åˆ¶**: æ”¯æŒè‡ªå®šä¹‰è¶…æ—¶æ—¶é—´,é»˜è®¤3ç§’

## å®‰è£…

```bash
# å¼€å‘æ¨¡å¼å®‰è£…
cd packages/yz_dubbo
pip install -e .

# æˆ–ä» requirements.txt å®‰è£…
pip install -r requirements.txt
```

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€è°ƒç”¨

```python
from yz_dubbo import invoke

# è°ƒç”¨ Dubbo æœåŠ¡
result = invoke(
    service_name="com.youzan.service.UserService",
    method_name="getUserInfo",
    args=[{"userId": 123}]
)

print(result)  # ç›´æ¥è¿”å›å“åº”æ•°æ®
```

### è‡ªå®šä¹‰ Headers

```python
result = invoke(
    service_name="com.youzan.service.OrderService",
    method_name="createOrder",
    args=[{"productId": 456, "quantity": 1}],
    headers={
        "X-Request-Id": "req-123",
        "X-Tenant-Id": "tenant-456"
    }
)
```

### è®¾ç½®è¶…æ—¶æ—¶é—´

```python
result = invoke(
    service_name="com.youzan.service.PaymentService",
    method_name="pay",
    args=[payment_data],
    timeout=10000  # 10ç§’è¶…æ—¶
)
```

### ä»£ç é…ç½®

```python
from yz_dubbo import DubboConfig, DubboClient

# ä½¿ç”¨é¢„è®¾ç¯å¢ƒ
config = DubboConfig(env="prod")

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
client = DubboClient(config=config)
result = client.invoke(
    service_name="com.youzan.service.UserService",
    method_name="getUser",
    args=[{"userId": 123}]
)
client.close()
```

## é”™è¯¯å¤„ç†

### é”™è¯¯ç å¯¹ç…§è¡¨

| é”™è¯¯ç  | è¯´æ˜ | HTTP Status |
|--------|------|-------------|
| `ERR_CLIENT_ERROR` | å®¢æˆ·ç«¯é”™è¯¯ | 400 |
| `ERR_TIMEOUT` | è¯·æ±‚è¶…æ—¶ | 504 |
| `ERR_PARAMS_TYPE_ERROR` | å‚æ•°ç±»å‹é”™è¯¯ | 400 |
| `ERR_FLOW_LIMIT` | æµé‡é™åˆ¶ | 429 |
| `ERR_SERVICE_UNAVAILABLE` | æœåŠ¡ä¸å¯ç”¨ | 503 |
| `ERR_INTERNAL_SERVER_ERROR` | å†…éƒ¨é”™è¯¯ | 500 |
| `ERR_NETWORK_ERROR` | ç½‘ç»œé”™è¯¯ | 503 |

### å¼‚å¸¸å¤„ç†ç¤ºä¾‹

```python
from yz_dubbo import invoke, DubboError, ErrorCode

try:
    result = invoke(
        service_name="com.youzan.service.UserService",
        method_name="getUser",
        args=[{"userId": 123}]
    )
    print(f"æˆåŠŸ: {result}")

except DubboError as e:
    print(f"é”™è¯¯ç : {e.code}")
    print(f"é”™è¯¯ä¿¡æ¯: {e.message}")
    print(f"ä¸Šä¸‹æ–‡: {e.context}")

    # æ ¹æ®é”™è¯¯ç å¤„ç†
    if e.code == ErrorCode.ERR_TIMEOUT:
        print("è¯·æ±‚è¶…æ—¶,è¯·ç¨åé‡è¯•")
    elif e.code == ErrorCode.ERR_NETWORK_ERROR:
        print("ç½‘ç»œé”™è¯¯")
    else:
        print("å…¶ä»–é”™è¯¯")
```

## API å‚è€ƒ

### invoke()

```python
def invoke(
    service_name: str,
    method_name: str,
    args: Optional[List[Any]] = None,
    headers: Optional[Dict[str, str]] = None,
    timeout: int = 3000,
) -> Any
```

**å‚æ•°**:
- `service_name`: æœåŠ¡æ¥å£å (å¦‚ `com.youzan.service.UserService`)
- `method_name`: æ–¹æ³•å
- `args`: å‚æ•°åˆ—è¡¨ (é»˜è®¤ä¸º `[]`)
- `headers`: è‡ªå®šä¹‰è¯·æ±‚å¤´ (é»˜è®¤ä¸º `{}`)
- `timeout`: è¶…æ—¶æ—¶é—´,å•ä½æ¯«ç§’ (é»˜è®¤ `3000`)

**è¿”å›å€¼**: ç›´æ¥è¿”å›æœåŠ¡å“åº”çš„ JSON æ•°æ®

**å¼‚å¸¸**: æŠ›å‡º `DubboError`

### DubboClient

```python
class DubboClient:
    def __init__(self, config: Optional[DubboConfig] = None) -> None
    def invoke(
        self,
        service_name: str,
        method_name: str,
        args: Optional[List[Any]] = None,
        headers: Optional[Dict[str, str]] = None,
        timeout: int = 3000
    ) -> Any
    def close(self) -> None
```

### DubboConfig

```python
class DubboConfig:
    def __init__(
        self,
        env: Optional[str] = None,
        host: Optional[str] = None,
        port: int = 80,
        timeout: int = 3000,
        from_app: Optional[str] = None
    ) -> None
```

## é¡¹ç›®ç»“æ„

```
yz_dubbo/
â”œâ”€â”€ __init__.py         # å¯¹å¤– API å¯¼å‡º
â”œâ”€â”€ client.py           # æ ¸å¿ƒå®¢æˆ·ç«¯å®ç°
â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”œâ”€â”€ errors.py           # é”™è¯¯å®šä¹‰
â””â”€â”€ py.typed            # ç±»å‹æ ‡è®°
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åˆ‡æ¢ç¯å¢ƒ?

**A**: æœ‰ä¸‰ç§æ–¹å¼:
```python
# 1. ç¯å¢ƒå˜é‡
export DUBBO_ENV=prod

# 2. ä»£ç é…ç½®
from yz_dubbo import DubboConfig
config = DubboConfig(env="prod")

```

### Q: è¶…æ—¶æ—¶é—´å¦‚ä½•è®¾ç½®?

**A**: å¯ä»¥å…¨å±€è®¾ç½®æˆ–å•æ¬¡è°ƒç”¨è®¾ç½®:
```python
# å…¨å±€è®¾ç½®
config = DubboConfig(timeout=10000)

# å•æ¬¡è°ƒç”¨ (æ¨è)
invoke(..., timeout=5000)
```

### Q: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰ Headers?

**A**: é€šè¿‡ `headers` å‚æ•°ä¼ é€’:
```python
result = invoke(
    service_name="com.youzan.service.UserService",
    method_name="getUser",
    args=[{"userId": 123}],
    headers={
        "X-Request-Id": "req-123",
        "X-Custom-Header": "custom-value"
    }
)
```

### Q: è¿”å›å€¼æ˜¯ä»€ä¹ˆæ ¼å¼?

**A**: ç›´æ¥è¿”å›æœåŠ¡å“åº”çš„ JSON æ•°æ®,ä¸åšé¢å¤–åŒ…è£…:
```python
result = invoke(...)
# result å°±æ˜¯æœåŠ¡è¿”å›çš„åŸå§‹æ•°æ®,å¯èƒ½æ˜¯ dictã€list æˆ–å…¶ä»– JSON ç±»å‹
```

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€: `/packages/yz_dubbo`
- æµ‹è¯•ç›®å½•: `/tests/yz_dubbo`

---

**YZ-Dubbo - è®© Dubbo è°ƒç”¨æ›´ç®€å•** ğŸš€

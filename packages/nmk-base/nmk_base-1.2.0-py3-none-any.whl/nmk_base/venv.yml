config:
  # Venv dependencies list (direct packages dependencies)
  venvPkgDeps:
    - ${PACKAGESREFS} # Default: all referenced plug-ins

  # Venv archives list (direct archive dependencies)
  venvArchiveDeps: []

  # Venv requirement files list
  venvFileDeps: []

  # Venv requirement files merged content
  venvFileDepsContent:
    __resolver__: nmk_base.venvbuilder.FileDepsContentResolver

  # Venv folder name
  venvName:
    __resolver__: nmk_base.backends.VenvNameResolver

  # Venv root folder
  venvRoot:
    __resolver__: nmk_base.backends.VenvRootResolver

  # Venv merged requirements file
  venvRequirements: requirements.txt

  # Venv state file
  venvState: ${outputDir}/requirements.txt

  # Template for merged requirements file
  venvRequirementsTemplate: ${BASEDIR}/templates/requirements.txt

  # Current venv bon folder
  venvBin:
    __resolver__: nmk_base.venvbuilder.BinResolver

  # Current venv python executable
  venvPython:
    __resolver__: nmk_base.venvbuilder.ExeResolver

  # Contribute to ignored files
  gitIgnoredFiles:
    - ${venvName}

  # State if backend use requirements file
  backendUseRequirements:
    __resolver__: nmk_base.backends.BackendUseRequirementsResolver

  # Buffer item for "requirements file re-generated" info
  venvRequirementsUpdated: false

  # Input file for venv update
  venvUpdateInput: ${PROJECTDIR}/${venvRequirements}

tasks:
  # Generate merged requirements file
  py.req:
    description: Merge python venv requirements
    emoji: ":snake:.:spiral_notepad: "
    input:
      - ${venvFileDeps}
      - ${venvArchiveDeps}
      - ${venvRequirementsTemplate}
    output: ${PROJECTDIR}/${venvRequirements}
    params:
      template: ${venvRequirementsTemplate}
      file_updated_info: venvRequirementsUpdated
    builder: nmk_base.common.TemplateBuilder
    if: ${backendUseRequirements}

  # Update venv from dependencies
  py.venv:
    description: Update python venv
    emoji: ":snake:.:inbox_tray:"
    deps:
      - py.req
      - out
    appendToDeps: setup
    output:
      - ${venvRoot}
      - ${venvState}
    input: ${venvUpdateInput}
    builder: nmk_base.venvbuilder.VenvUpdateBuilder
    params:
      requirements_updated: ${venvRequirementsUpdated}
      is_ci: ${gitEnableDirtyCheck}

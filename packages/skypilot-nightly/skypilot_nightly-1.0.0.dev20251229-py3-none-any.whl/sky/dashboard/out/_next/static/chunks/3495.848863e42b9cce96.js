"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3495],{98418:function(e,s,t){t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(60998).Z)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]])},23495:function(e,s,t){t.r(s),t.d(s,{ContextDetails:function(){return A},GPUs:function(){return z},InfrastructureSection:function(){return E}});var a=t(85893),l=t(67294),r=t(55739);t(9353);var n=t(26409),o=t(98418),i=t(13626),c=t(23001),d=t(17853);function m(e){return null==e?"-":e===Math.floor(e)?Math.floor(e).toString():e.toFixed(1)}function u(e,s,t){if(!t||0===e.length)return null;let a=e.reduce((e,t)=>{let a=t[s];return e+(null!=a?a:0)},0);return a>0?a:null}var x=t(32045),h=t(23266),p=t(68969),g=t(29326),f=t(50326),y=t(30803),j=t(42557),b=t(29749),N=t(69123);function v(e){let{isOpen:s,onClose:t,onSave:n,poolData:o=null,isLoading:i=!1}=e,[c,d]=(0,l.useState)(""),[m,u]=(0,l.useState)(""),[x,h]=(0,l.useState)("ubuntu"),[p,v]=(0,l.useState)(null),[w,S]=(0,l.useState)(""),[C,_]=(0,l.useState)({}),k=null!==o;(0,l.useEffect)(()=>{if(k&&o){var e,s,t;d(o.name||""),u(((null===(e=o.config)||void 0===e?void 0:e.hosts)||[]).join("\n")),h((null===(s=o.config)||void 0===s?void 0:s.user)||"ubuntu"),S((null===(t=o.config)||void 0===t?void 0:t.password)||"")}else d(""),u(""),h("ubuntu"),v(null),S("");_({})},[k,o]);let P=()=>{let e={};return c.trim()||(e.poolName="Pool name is required"),m.trim()||(e.hosts="At least one host is required"),x.trim()||(e.sshUser="SSH user is required"),p||w||(e.auth="Either SSH key file or password is required"),_(e),0===Object.keys(e).length},U=async()=>{if(!P())return;let e={hosts:m.split("\n").map(e=>e.trim()).filter(e=>e.length>0),user:x};try{if(p){let s=p.name;await (0,g.hY)(s,p),e.identity_file="~/.sky/ssh_keys/".concat(s)}w&&(e.password=w),n(c,e)}catch(e){console.error("Failed to upload SSH key:",e),_({...C,keyUpload:"Failed to upload SSH key"})}},D=()=>{i||t()};return(0,a.jsx)(f.Vq,{open:s,onOpenChange:D,children:(0,a.jsxs)(f.cZ,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)(f.fK,{children:(0,a.jsx)(f.$N,{children:k?"Edit SSH Node Pool: ".concat(null==o?void 0:o.name):"Add SSH Node Pool"})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b._,{htmlFor:"poolName",children:"Pool Name"}),(0,a.jsx)(j.I,{id:"poolName",placeholder:"my-ssh-cluster",value:c,onChange:e=>d(e.target.value),disabled:k,className:"placeholder:text-gray-500 ".concat(C.poolName?"border-red-500":"")}),C.poolName&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:C.poolName})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b._,{htmlFor:"hosts",children:"Hosts (one per line)"}),(0,a.jsx)(N.g,{id:"hosts",placeholder:"192.168.1.10\n192.168.1.11\nhostname.example.com",value:m,onChange:e=>u(e.target.value),rows:6,className:"placeholder:text-gray-500 ".concat(C.hosts?"border-red-500":"")}),C.hosts&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:C.hosts})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b._,{htmlFor:"sshUser",children:"SSH User"}),(0,a.jsx)(j.I,{id:"sshUser",placeholder:"ubuntu",value:x,onChange:e=>h(e.target.value),className:"placeholder:text-gray-500 ".concat(C.sshUser?"border-red-500":"")}),C.sshUser&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:C.sshUser})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b._,{htmlFor:"keyFile",children:"SSH Private Key File"}),(0,a.jsx)(j.I,{id:"keyFile",type:"file",accept:".pem,.key,id_rsa,id_ed25519",onChange:e=>{var s;return v((null===(s=e.target.files)||void 0===s?void 0:s[0])||null)},className:"border-0 bg-transparent p-0 shadow-none focus:ring-0 file:mr-2 file:text-sm file:py-1 file:px-3 file:border file:border-gray-300 file:rounded file:bg-gray-50 hover:file:bg-gray-100 file:cursor-pointer"}),C.keyUpload&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:C.keyUpload})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b._,{htmlFor:"password",children:"Password (optional, if sudo requires a password)"}),(0,a.jsx)(j.I,{id:"password",type:"password",placeholder:"Leave empty if using passwordless sudo",value:w,onChange:e=>S(e.target.value),className:"placeholder:text-gray-500"})]}),C.auth&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:C.auth})]}),(0,a.jsxs)(f.cN,{children:[(0,a.jsx)(y.z,{variant:"outline",onClick:D,disabled:i,children:"Cancel"}),(0,a.jsx)(y.z,{onClick:U,disabled:i,className:"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-300 disabled:text-gray-500",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{size:16,className:"mr-2"}),"Saving..."]}):k?"Update Pool":"Create Pool"})]})]})})}var w=t(6378),S=t(36856),C=t(51214),_=t(11163),k=t(41664),P=t.n(k),U=t(36989);t(37673);var D=t(88950);let F=C.nb.REFRESH_INTERVAL,I=C.MO.NAME_TRUNCATE_LENGTH,M=e=>{let{gpu:s,heightClass:t="h-4",wrapperClassName:l=""}=e,r=(null==s?void 0:s.gpu_total)||0,n=(null==s?void 0:s.gpu_not_ready)||0,o=(null==s?void 0:s.gpu_free)||0,i=Math.max(0,r-o-n),c="".concat(n," not ready"),d="".concat(i," used"),m="".concat(o," free"),u=r>0?e=>e/r*100:()=>0,x=u(n),h=u(i),p=u(o);return(0,a.jsxs)("div",{className:"bg-gray-100 rounded-md flex overflow-hidden shadow-sm ".concat(t," ").concat(l).trim(),children:[x>0&&(0,a.jsx)("div",{style:{width:"".concat(x,"%"),fontSize:"clamp(8px, 1.2vw, 12px)"},title:c,className:"bg-gray-400 h-full flex items-center justify-center text-white font-medium overflow-hidden whitespace-nowrap px-1",children:x>15&&c}),h>0&&(0,a.jsx)("div",{style:{width:"".concat(h,"%"),fontSize:"clamp(8px, 1.2vw, 12px)"},title:d,className:"bg-yellow-500 h-full flex items-center justify-center text-white font-medium overflow-hidden whitespace-nowrap px-1",children:h>15&&d}),p>0&&(0,a.jsx)("div",{style:{width:"".concat(p,"%"),fontSize:"clamp(8px, 1.2vw, 12px)"},title:m,className:"bg-green-700 h-full flex items-center justify-center text-white font-medium overflow-hidden whitespace-nowrap px-1",children:p>15&&m})]})};function E(e){let{title:s,isLoading:t,isDataLoaded:l,contexts:n,gpus:o,groupedPerContextGPUs:i,groupedPerNodeGPUs:c,handleContextClick:d,contextStats:x={},jobsData:h={},isJobsDataLoading:p=!0,isSSH:g=!1,isSlurm:f=!1,actionButton:y=null,contextWorkspaceMap:j={},contextErrors:b={}}=e,N=n||[];return t&&0===N.length?(0,a.jsx)("div",{className:"rounded-lg border bg-card text-card-foreground shadow-sm mb-6",children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:s}),(0,a.jsxs)("div",{className:"flex items-center justify-center py-6",children:[(0,a.jsx)(r.Z,{size:24,className:"mr-3"}),(0,a.jsxs)("span",{className:"text-gray-500",children:["Loading ",s,"..."]})]})]})}):l&&0===N.length?(0,a.jsx)("div",{className:"rounded-lg border bg-card text-card-foreground shadow-sm mb-6",children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:s}),y]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["No ",s," found or ",s," is not configured."]})]})}):N.length>0?(0,a.jsx)("div",{className:"rounded-lg border bg-card text-card-foreground shadow-sm mb-6",children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:s}),(0,a.jsxs)("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:[N.length," ",1===N.length?g?"pool":f?"cluster":"context":g?"pools":f?"clusters":"contexts"]})]}),y]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"overflow-x-auto rounded-md border border-gray-200 shadow-sm bg-white",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/4",children:"Name"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/8",children:"Clusters"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/8",children:"Jobs"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/8",children:"Nodes"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/8",children:"CPU"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/8",children:"Memory"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/4",children:"GPU Types"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/8",children:"GPUs"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200 ".concat(N.length>5?"max-h-[250px] overflow-y-auto block":""),children:N.map(e=>{var s,t;let n=i[e]||[],o=c[e]||[],f=n.reduce((e,s)=>e+(s.gpu_total||0),0),y=g?"ssh/".concat(e.replace(/^ssh-/,"")):"kubernetes/".concat(e),N=x[y]||{clusters:0,jobs:0},v=Object.keys(x).length>0&&x[y]||l,w=i&&Object.keys(i).length>0||l,S=c&&Object.keys(c).length>0||l,C=w?Object.keys(n.reduce((e,s)=>(e[s.gpu_name]=(e[s.gpu_name]||0)+(s.gpu_total||0),e),{})).join(", "):null,_=u(o,"cpu_count",S),k=u(o,"memory_gb",S),P=g?e.replace(/^ssh-/,""):e,D=j[e]||[],F=D.length>1?" (workspaces: ".concat(D.join(", "),")"):"";return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)(U.Md,{content:"".concat(P).concat(F),className:"text-sm text-muted-foreground",children:(0,a.jsxs)("span",{className:"text-blue-600 hover:underline cursor-pointer",onClick:()=>d(e),children:[P.length>I?"".concat(P.substring(0,Math.floor((I-3)/2)),"...").concat(P.substring(P.length-Math.ceil((I-3)/2))):P,F&&(0,a.jsx)("span",{className:"text-xs text-gray-500 ml-1",children:F})]})})}),(0,a.jsx)("td",{className:"p-3",children:v?N.clusters>0?(0,a.jsx)("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:N.clusters}):(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-xs font-medium",children:"0"}):(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(r.Z,{size:12})})}),(0,a.jsx)("td",{className:"p-3",children:p?(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-xs font-medium",children:(0,a.jsx)(r.Z,{size:12})}):(null===(s=h[y])||void 0===s?void 0:s.jobs)?(0,a.jsx)("span",{className:"px-2 py-0.5 bg-green-100 text-green-800 rounded text-xs font-medium",children:null===(t=h[y])||void 0===t?void 0:t.jobs}):(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-xs font-medium",children:"0"})}),(0,a.jsx)("td",{className:"p-3",children:S?(0,a.jsx)("span",{className:0===o.length&&b[e]?"text-gray-400":"",title:0===o.length&&b[e]?b[e]:"",children:0===o.length&&b[e]?"0*":o.length}):(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(r.Z,{size:16})})}),(0,a.jsx)("td",{className:"p-3",children:S?m(_):(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(r.Z,{size:16})})}),(0,a.jsx)("td",{className:"p-3",children:S?null==k?"-":"".concat(k.toFixed(1)," GB"):(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(r.Z,{size:16})})}),(0,a.jsx)("td",{className:"p-3",children:w?C||"-":(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(r.Z,{size:16})})}),(0,a.jsx)("td",{className:"p-3",children:w?f:(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(r.Z,{size:16})})})]},e)})})]})})}),o&&o.length>0&&(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"overflow-x-auto rounded-md border border-gray-200 shadow-sm bg-white",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/4 whitespace-nowrap",children:["GPU",(0,a.jsxs)("span",{className:"ml-2 px-2 py-0.5 bg-green-100 text-green-800 rounded-full text-xs font-medium whitespace-nowrap",children:[o.reduce((e,s)=>e+s.gpu_free,0)," ","of"," ",o.reduce((e,s)=>e+s.gpu_total,0)," ","free"]})]}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/4",children:"Requestable"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-1/2",children:(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{children:"Utilization"})})})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200 ".concat(o.length>5?"max-h-[250px] overflow-y-auto block":""),children:o.map(e=>{let s=i?Object.values(i).flat().filter(s=>{if(s.gpu_name!==e.gpu_name)return!1;if(f)return!0;let t=s.context||s.cluster;return!!t&&(g?t.startsWith("ssh-"):!t.startsWith("ssh-"))}).map(e=>e.gpu_requestable_qty_per_node).filter((e,s,t)=>t.indexOf(e)===s).join(", "):"-";return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"p-3 font-medium w-24 whitespace-nowrap",children:e.gpu_name}),(0,a.jsxs)("td",{className:"p-3 text-xs text-gray-600",children:[s||"-"," / node"]}),(0,a.jsx)("td",{className:"p-3 w-2/3",children:(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)(M,{gpu:e,heightClass:"h-5",wrapperClassName:"flex-1 min-w-[100px] w-full"})})})]},e.gpu_name)})})]})})})]})]})}):null}function A(e){let{contextName:s,gpusInContext:t,nodesInContext:n}=e,o=s.startsWith("ssh-"),[i,c]=(0,l.useState)([]),[u,x]=(0,l.useState)("$__all"),[h,p]=(0,l.useState)({from:"now-1h",to:"now"}),[g,f]=(0,l.useState)(!1),[y,j]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{j(await (0,d.TO)())})()},[]);let b=(0,l.useCallback)(async()=>{if(y){f(!0);try{let e=(0,d.ki)(),t="in-cluster"===s?"^$":s,a="query="+encodeURIComponent('group by (node) (DCGM_FI_DEV_GPU_TEMP{cluster=~"'.concat(t,'"} or label_replace(amd_gpu_gfx_activity{cluster=~"').concat(t,'"}, "node", "$1", "hostname", "(.*)"))')),l="/api/datasources/proxy/1/api/v1/query?".concat(a);try{let s=await fetch("".concat(e).concat(l),{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(s.ok){let e=await s.json();if(e.data&&e.data.result&&e.data.result.length>0){let s=e.data.result.map(e=>e.metric.node).filter(Boolean).sort();c(s),console.log("Successfully fetched hosts for cluster ".concat(t||"in-cluster",":"),s)}else console.log("No nodes found for this cluster"),c([])}else console.log("HTTP ".concat(s.status," from ").concat(l,": ").concat(s.statusText)),c([])}catch(e){console.log("Failed to fetch from ".concat(l,":"),e),c([])}}catch(e){console.error("Error fetching available hosts:",e),c([])}finally{f(!1)}}},[y,s]);(0,l.useEffect)(()=>{y&&n&&n.length>0&&b()},[n,y,b]);let N=e=>{let t=(0,d.ki)(),a="in-cluster"===s?"^$":s;return"".concat(t,"/d-solo/skypilot-dcgm-cluster-dashboard/skypilot-dcgm-kubernetes-cluster-dashboard?orgId=1&timezone=browser&var-datasource=prometheus&var-host=").concat(encodeURIComponent(u),"&var-gpu=$__all&var-cluster=").concat(encodeURIComponent(a),"&refresh=5s&theme=light&from=").concat(encodeURIComponent(h.from),"&to=").concat(encodeURIComponent(h.to),"&panelId=").concat(e,"&__feature.dashboardSceneSolo")},v=e=>{p({"15m":{from:"now-15m",to:"now"},"1h":{from:"now-1h",to:"now"},"6h":{from:"now-6h",to:"now"},"24h":{from:"now-24h",to:"now"},"7d":{from:"now-7d",to:"now"}}[e])};return(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("div",{className:"rounded-lg border bg-card text-card-foreground shadow-sm h-full",children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("h4",{className:"text-lg font-semibold",children:"Available GPUs"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:t.map(e=>(0,a.jsxs)("div",{className:"p-3 bg-gray-50 rounded-md border border-gray-200 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1.5 flex-wrap",children:[(0,a.jsxs)("div",{className:"font-medium text-gray-800 text-sm",children:[e.gpu_name,(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(Requestable: ",e.gpu_requestable_qty_per_node," / node)"]})]}),(0,a.jsxs)("span",{className:"text-xs font-medium",children:[e.gpu_free," free / ",e.gpu_total," total"]})]}),(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(M,{gpu:e,heightClass:"h-4",wrapperClassName:"w-full"})})]},e.gpu_name))}),n&&n.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Nodes"}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-md border border-gray-200 shadow-sm",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-100",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600",children:"Node"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600",children:"IP Address"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600",children:"vCPU"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600",children:"Memory (GB)"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600",children:"GPU"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600",children:"GPU Utilization"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((e,s)=>{let t="-";if(null!==e.cpu_count&&void 0!==e.cpu_count){let s=m(e.cpu_count);if(null!==e.cpu_free&&void 0!==e.cpu_free){let a=m(e.cpu_free);t="".concat(a," of ").concat(s," free")}else t=s}let l="-";if(null!==e.memory_gb&&void 0!==e.memory_gb){let s=e.memory_gb.toFixed(1);if(null!==e.memory_free_gb&&void 0!==e.memory_free_gb){let t=e.memory_free_gb.toFixed(1);l="".concat(t," of ").concat(s," free")}else l=s}let r=!1===e.is_ready?"0 of ".concat(e.gpu_total," free (Node NotReady)"):"".concat(e.gpu_free," of ").concat(e.gpu_total," free");return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"p-3 whitespace-nowrap text-gray-700",children:e.node_name}),(0,a.jsx)("td",{className:"p-3 whitespace-nowrap text-gray-700",children:e.ip_address||"-"}),(0,a.jsx)("td",{className:"p-3 whitespace-nowrap text-gray-700",children:t}),(0,a.jsx)("td",{className:"p-3 whitespace-nowrap text-gray-700",children:l}),(0,a.jsx)("td",{className:"p-3 whitespace-nowrap text-gray-700",children:e.gpu_name}),(0,a.jsx)("td",{className:"p-3 whitespace-nowrap text-gray-700",children:r})]},"".concat(e.node_name,"-").concat(s))})})]})})]}),y&&t&&t.length>0&&!o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-4 mt-6",children:"GPU Metrics"}),(0,a.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 rounded-md border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[n&&n.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"host-select",className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Node:"}),(0,a.jsxs)("select",{id:"host-select",value:u,onChange:e=>{x(e.target.value)},disabled:g,className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-sky-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"$__all",children:"All Nodes"}),i.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),g&&(0,a.jsx)("div",{className:"ml-2",children:(0,a.jsx)(r.Z,{size:16})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Time Range:"}),(0,a.jsx)("div",{className:"flex gap-1",children:[{label:"15m",value:"15m"},{label:"1h",value:"1h"},{label:"6h",value:"6h"},{label:"24h",value:"24h"},{label:"7d",value:"7d"}].map(e=>(0,a.jsx)("button",{onClick:()=>v(e.value),className:"px-2 py-1 text-xs font-medium rounded border transition-colors ".concat(h.from==="now-".concat(e.value)&&"now"===h.to?"bg-sky-blue text-white border-sky-blue":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"),children:e.label},e.value))})]})]}),(0,a.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:n&&n.length>0?(0,a.jsxs)(a.Fragment,{children:["Showing:"," ","$__all"===u?"All nodes":u," ","• Time: ",h.from," to ",h.to,i.length>0&&(0,a.jsxs)("span",{children:[" ","• ",i.length," nodes available"]})]}):(0,a.jsxs)(a.Fragment,{children:["Cluster:"," ",o?s.replace(/^ssh-/,""):s," ","• Time: ",h.from," to ",h.to," • Showing metrics for all nodes in cluster"]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 shadow-sm",children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("iframe",{src:N("6"),width:"100%",height:"400",frameBorder:"0",title:"GPU Utilization",className:"rounded"},"gpu-util-".concat(u,"-").concat(h.from,"-").concat(h.to))})}),(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 shadow-sm",children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("iframe",{src:N("18"),width:"100%",height:"400",frameBorder:"0",title:"GPU Memory",className:"rounded"},"gpu-memory-".concat(u,"-").concat(h.from,"-").concat(h.to))})}),(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 shadow-sm",children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("iframe",{src:N("10"),width:"100%",height:"400",frameBorder:"0",title:"GPU Power Consumption",className:"rounded"},"gpu-power-".concat(u,"-").concat(h.from,"-").concat(h.to))})}),(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 shadow-sm",children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("iframe",{src:N("12"),width:"100%",height:"400",frameBorder:"0",title:"GPU Temperature",className:"rounded"},"gpu-temp-".concat(u,"-").concat(h.from,"-").concat(h.to))})}),(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 shadow-sm",children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("iframe",{src:N("22"),width:"100%",height:"400",frameBorder:"0",title:"CPU Utilization",className:"rounded"},"cpu-util-".concat(u,"-").concat(h.from,"-").concat(h.to))})}),(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 shadow-sm",children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("iframe",{src:N("21"),width:"100%",height:"400",frameBorder:"0",title:"Memory Utilization",className:"rounded"},"memory-util-".concat(u,"-").concat(h.from,"-").concat(h.to))})})]})]})]})})})}function H(e){var s;let{poolName:t,gpusInContext:i,nodesInContext:c,handleDeploySSHPool:d,handleEditSSHPool:m,handleDeleteSSHPool:u,poolConfig:x}=e,[h,p]=(0,l.useState)(null),[j,b]=(0,l.useState)(!0),[N,v]=(0,l.useState)({isOpen:!1,action:null,loading:!1}),[w,S]=(0,l.useState)({isOpen:!1,logs:"",isStreaming:!1,deploymentComplete:!1,deploymentSuccess:!1,requestId:null});(0,l.useEffect)(()=>{(async()=>{try{b(!0);let e=await (0,g.IS)(t);p(e)}catch(e){console.error("Failed to fetch SSH Node Pool status:",e),p({pool_name:t,status:"Error",reason:"Failed to fetch status"})}finally{b(!1)}})()},[t]);let{deployDisabled:C}=(()=>{if(!h)return{deployDisabled:!0};let e=h.status;return"Ready"===e?{deployDisabled:!0}:"Error"===e?{deployDisabled:!0}:{deployDisabled:!1}})(),_=async()=>{v({...N,loading:!0});try{if("deploy"===N.action){v({isOpen:!1,action:null,loading:!1}),S({isOpen:!0,logs:"",isStreaming:!0,deploymentComplete:!1,deploymentSuccess:!1,requestId:null});try{let e=(await d(t)).request_id;S(s=>({...s,requestId:e}));let s=new AbortController;await (0,g.wJ)({requestId:e,signal:s.signal,onNewLog:e=>{S(s=>({...s,logs:s.logs+e}))}}),S(e=>({...e,isStreaming:!1,deploymentComplete:!0,deploymentSuccess:!0})),setTimeout(async()=>{(async()=>{try{let e=await (0,g.IS)(t);p(e)}catch(e){console.error("Failed to fetch SSH Node Pool status after deployment:",e)}})()},1e3)}catch(e){console.error("Deployment failed:",e),S(s=>({...s,isStreaming:!1,deploymentComplete:!0,deploymentSuccess:!1,logs:s.logs+"\nDeployment failed: ".concat(e.message)}))}}else if("delete"===N.action){v({isOpen:!1,action:null,loading:!1}),S({isOpen:!0,logs:"",isStreaming:!0,deploymentComplete:!1,deploymentSuccess:!1,requestId:null});try{let e=(await (0,g.ez)(t)).request_id;S(s=>({...s,requestId:e})),e&&await (0,g.mF)({requestId:e,signal:null,onNewLog:e=>{S(s=>({...s,logs:s.logs+e}))},operationType:"down"}),await u(t),S(e=>({...e,isStreaming:!1,deploymentComplete:!0,deploymentSuccess:!0,logs:e.logs+"\nSSH Node Pool teardown completed successfully."}))}catch(e){console.error("Down operation failed:",e),S(s=>({...s,isStreaming:!1,deploymentComplete:!0,deploymentSuccess:!1,logs:s.logs+"\nTeardown failed: ".concat(e.message)}))}}}catch(e){console.error("Action failed:",e),v({...N,loading:!1})}},k=()=>{v({isOpen:!1,action:null,loading:!1})},P=()=>{S({isOpen:!1,logs:"",isStreaming:!1,deploymentComplete:!1,deploymentSuccess:!1,requestId:null}),w.deploymentComplete&&setTimeout(()=>{(async()=>{try{let e=await (0,g.IS)(t);p(e)}catch(e){console.error("Failed to refresh status:",e)}})()},1e3)},U="deploy"===N.action?{title:"Deploy SSH Node Pool",description:'Are you sure you want to deploy SSH Node Pool "'.concat(t,'"?'),details:["• Set up SkyPilot runtime on the configured SSH hosts","• Install required components and dependencies","• Make the node pool available for workloads","","This process may take a few minutes to complete."]}:{title:"Delete SSH Node Pool",description:'Are you sure you want to delete SSH Node Pool "'.concat(t,'"?'),details:["• Clean up any deployed resources","• Remove the SSH Node Pool configuration"]};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"rounded-lg border bg-card text-card-foreground shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 pt-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"SSH Node Pool Details"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("button",{className:"px-3 py-1 text-sm border rounded flex items-center ".concat(C?"border-gray-300 bg-gray-100 text-gray-400 cursor-not-allowed":"border-green-300 bg-green-50 text-green-700 hover:bg-green-100"),onClick:C?void 0:()=>{v({isOpen:!0,action:"deploy",loading:!1})},disabled:C,children:[(0,a.jsx)(n.Z,{className:"w-4 h-4 mr-2"}),"Deploy"]}),(0,a.jsxs)("button",{className:"px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 flex items-center text-red-600 hover:text-red-700",onClick:()=>{v({isOpen:!0,action:"delete",loading:!1})},children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gray-600 font-medium text-base",children:"Pool Name"}),(0,a.jsx)("div",{className:"text-base mt-1",children:t})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gray-600 font-medium text-base",children:"Nodes"}),(0,a.jsx)("div",{className:"text-base mt-1",children:c?c.length:0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gray-600 font-medium text-base",children:"Status"}),(0,a.jsx)("div",{className:"text-base mt-1",children:j?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(r.Z,{size:16,className:"mr-2"}),(0,a.jsx)("span",{className:"text-gray-500",children:"Loading..."})]}):h?(0,a.jsx)(e=>{let{status:s,reason:t}=e,l="Ready"===s,r="Not Ready"===s?"Click Deploy to set up this node pool":t;return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-medium ".concat(l?"bg-green-100":"bg-red-100"," ").concat(l?"text-green-800":"text-red-800"),children:s}),!l&&r&&(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["(",r,")"]})]})},{status:h.status,reason:h.reason}):(0,a.jsx)("span",{className:"text-gray-500",children:"Unknown"})})]})]})})]})}),(0,a.jsx)(A,{contextName:"ssh-".concat(t),gpusInContext:i,nodesInContext:c}),(0,a.jsx)(f.Vq,{open:N.isOpen,onOpenChange:k,children:(0,a.jsxs)(f.cZ,{className:"sm:max-w-md",children:[(0,a.jsxs)(f.fK,{className:"",children:[(0,a.jsx)(f.$N,{className:"",children:U.title}),(0,a.jsx)(f.Be,{className:"",children:U.description})]}),(0,a.jsx)("div",{className:"py-4",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsx)("p",{className:"font-medium mb-2",children:"This will:"}),U.details.map((e,s)=>(0,a.jsx)("p",{className:""===e?"pt-2":"",children:e},s))]})}),(0,a.jsxs)(f.cN,{className:"",children:[(0,a.jsx)(y.z,{variant:"outline",onClick:k,disabled:N.loading,className:"",children:"Cancel"}),(0,a.jsx)(y.z,{onClick:_,disabled:N.loading,className:"deploy"===N.action?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white",children:N.loading?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{size:16,className:"mr-2"}),"deploy"===N.action?"Deploying...":"Deleting..."]}):"deploy"===N.action?"Deploy":"Delete"})]})]})}),(0,a.jsx)(f.Vq,{open:w.isOpen,onOpenChange:w.isStreaming?void 0:P,children:(0,a.jsxs)(f.cZ,{className:"sm:max-w-4xl max-h-[80vh]",children:[(0,a.jsxs)(f.fK,{className:"",children:[(0,a.jsxs)(f.$N,{className:"",children:["Deploying SSH Node Pool: ",t]}),(0,a.jsx)(f.Be,{className:"",children:w.isStreaming?"Deployment in progress. Do not close this dialog.":w.deploymentSuccess?"Deployment completed successfully!":"Deployment completed with errors."})]}),(0,a.jsx)("div",{className:"py-4",children:(0,a.jsxs)("div",{className:"bg-black text-green-400 p-4 rounded-md font-mono text-sm max-h-96 overflow-y-auto",children:[(0,a.jsx)("pre",{className:"whitespace-pre-wrap",children:(s=w.logs)?s.split("\n").map(e=>(e=e.replace(/\x1b\[[0-9;]*m/g,"")).match(/^D \d{2}-\d{2} \d{2}:\d{2}:\d{2}/)?null:e=(e=e.replace(/├──/g,"├─")).replace(/└──/g,"└─")).filter(e=>null!==e&&""!==e.trim()).join("\n"):""}),w.isStreaming&&(0,a.jsxs)("div",{className:"flex items-center mt-2",children:[(0,a.jsx)(r.Z,{size:16,className:"mr-2 text-green-400"}),(0,a.jsx)("span",{className:"text-green-400",children:"Streaming logs..."})]})]})}),(0,a.jsx)(f.cN,{className:"",children:(0,a.jsx)(y.z,{onClick:P,disabled:w.isStreaming,className:w.deploymentSuccess?"bg-green-600 hover:bg-green-700 text-white":w.deploymentComplete&&!w.deploymentSuccess?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-600 hover:bg-gray-700 text-white",children:w.isStreaming?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{size:16,className:"mr-2"}),"Deploying..."]}):"Close"})})]})})]})}function z(){let[e,s]=(0,l.useState)(!0),[t,n]=(0,l.useState)(!0),[o,d]=(0,l.useState)(!0),m=l.useRef(null),u=(0,c.X)(),[f,y]=(0,l.useState)(!1),[j,b]=(0,l.useState)(!1),N=(0,_.useRouter)(),[C,k]=(0,l.useState)([]),[I,M]=(0,l.useState)([]),[z,L]=(0,l.useState)([]),[O,R]=(0,l.useState)([]),[G,Z]=(0,l.useState)([]),[q,T]=(0,l.useState)([]),[W,B]=(0,l.useState)([]),[$,V]=(0,l.useState)([]),[J,K]=(0,l.useState)(0),[X,Q]=(0,l.useState)(0),[Y,ee]=(0,l.useState)({}),[es,et]=(0,l.useState)({}),[ea,el]=(0,l.useState)({}),[er,en]=(0,l.useState)({}),[eo,ei]=(0,l.useState)("all"),[ec,ed]=(0,l.useState)([]),[em,eu]=(0,l.useState)({}),[ex,eh]=(0,l.useState)(!1),[ep,eg]=(0,l.useState)(null),[ef,ey]=(0,l.useState)(!1),[ej,eb]=(0,l.useState)(!0),[eN,ev]=(0,l.useState)({}),[ew,eS]=(0,l.useState)(null),[eC,e_]=(0,l.useState)(null),ek=l.useCallback(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{showLoadingIndicators:!0},{showLoadingIndicators:t=!0,forceRefresh:a=!1}=e;t&&(s(!0),n(!0),ey(!0),eb(!0));try{async function l(e){await eP(e),await eF(e)}await Promise.all([l(a),eD(a),eU(a)])}catch(e){console.error("Error in fetchData:",e),en({}),k([]),M([]),L([]),R([]),ee({}),et({}),el({}),ed([]),y(!0),s(!1),V([]),K(0),Q(0),b(!0),eu({}),ey(!1),ev({}),eb(!1)}finally{t&&(s(!1),n(!1),ey(!1),eb(!1)),o&&t&&d(!1)}},[o]),eP=async e=>{try{let t=e?await (0,x.Xg)():await w.default.get(x.Xg);if(t){let{workspaces:e,allContextNames:a,allGPUs:l,perContextGPUs:r,perNodeGPUs:n,allSlurmGPUs:o,perClusterSlurmGPUs:i,perNodeSlurmGPUs:c,contextStats:d,contextWorkspaceMap:m,contextErrors:u}=t;en(e||{}),k(a||[]),M(l||[]),L(r||[]),R(n||[]),Z(o||[]),T(i||[]),B(c||[]),ee(d||{}),et(m||{}),el(u||{});let x=Object.keys(e||{});ed(x.sort()),y(!0),s(!1)}else null===t&&(en({}),k([]),M([]),L([]),R([]),Z([]),T([]),B([]),ee({}),et({}),el({}),ed([]),y(!0),s(!1))}catch(e){console.error("Error in fetchKubernetesData:",e),en({}),k([]),M([]),L([]),R([]),Z([]),T([]),B([]),ee({}),et({}),el({}),ed([]),y(!0),s(!1)}},eU=async e=>{try{let s=e?await (0,p.getManagedJobs)({allUsers:!0,skipFinished:!0,fields:["cloud","region"]}):await w.default.get(p.getManagedJobs,[{allUsers:!0,skipFinished:!0,fields:["cloud","region"]}]),t=(null==s?void 0:s.jobs)||[];ev(await (0,x.R8)(t)),eb(!1)}catch(e){console.error("Error in fetchManagedJobsData:",e),ev({}),eb(!1)}},eD=async e=>{try{let s=e?await (0,x.ef)():await w.default.get(x.ef,[e]);s?(V(s.clouds||[]),K(s.totalClouds||0),Q(s.enabledClouds||0),b(!0)):null===s&&(V([]),K(0),Q(0),b(!0))}catch(e){console.error("Error in fetchCloudData:",e),V([]),K(0),Q(0),b(!0)}},eF=async e=>{try{let s=e?await (0,g.It)():await w.default.get(g.It);eu(s),ey(!1)}catch(e){console.error("Failed to fetch SSH Node Pools:",e),eu({}),ey(!1)}},eI=(e,s)=>{eg({name:e,config:s}),eh(!0)},eM=async e=>{try{await (0,g.MV)(e),await eF(),e_(null),N.push("/infra")}catch(e){throw console.error("Failed to delete SSH Node Pool:",e),e}},eE=async e=>{try{await (0,g._x)(e)}catch(e){throw console.error("Failed to deploy SSH Node Pool:",e),e}},eA=async(e,s)=>{ey(!0);try{let t={...em};t[e]=s,await (0,g.Ri)(t),await eF(),eh(!1)}catch(e){console.error("Failed to save SSH Node Pool:",e),alert("Failed to save SSH Node Pool. Please try again.")}finally{ey(!1)}};(0,l.useEffect)(()=>{m.current=ek},[ek]),(0,l.useEffect)(()=>{(async()=>{await S.ZP.preloadForPage("infra"),await ek({showLoadingIndicators:!0}),eS(new Date)})()},[]),(0,l.useEffect)(()=>{let e=!0,s=setInterval(()=>{e&&m.current&&"visible"===window.document.visibilityState&&m.current({showLoadingIndicators:!1})},F);return()=>{e=!1,clearInterval(s)}},[]),(0,l.useEffect)(()=>()=>{y(!1),b(!1),ey(!1),d(!0),eb(!1)},[]);let eH=async()=>{w.default.invalidate(h.getClusters),w.default.invalidate(p.getManagedJobs,[{allUsers:!0,skipFinished:!0,fields:["cloud","region"]}]),w.default.invalidate(x.Xg),w.default.invalidate(x.ef,[!1]),w.default.invalidate(g.It),m.current&&(await m.current({showLoadingIndicators:!0,forceRefresh:!0}),eS(new Date))};(0,l.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"r"===e.key&&(e.preventDefault(),eH())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(I||[]).length,(I||[]).reduce((e,s)=>e+s.gpu_total,0),(I||[]).reduce((e,s)=>e+s.gpu_free,0);let ez=l.useMemo(()=>z?z.reduce((e,s)=>{let{context:t}=s;return e[t]||(e[t]=[]),e[t].push(s),e},{}):{},[z]),eL=l.useCallback(e=>"all"===eo?e:e.filter(e=>(es[e]||[]).includes(eo)),[eo,es]),eO=l.useMemo(()=>{if(e&&0===Object.keys(er).length)return null;if("all"===eo){let e=new Set;return Object.values(er).forEach(s=>{s.clouds&&Array.isArray(s.clouds)&&s.clouds.forEach(s=>{let t=s.toLowerCase().split("/")[0];e.add(t)})}),Array.from(e)}{let e=er[eo];if(!e||!e.clouds||!Array.isArray(e.clouds))return[];let s=new Set;return e.clouds.forEach(e=>{let t=e.toLowerCase().split("/")[0];s.add(t)}),Array.from(s)}},[eo,er,e]),eR=l.useMemo(()=>$&&0!==$.length?null===eO?$:$.filter(e=>eO.includes(e.name.toLowerCase())):[],[$,eO]),eG=l.useMemo(()=>eR.length,[eR]),eZ=l.useMemo(()=>C&&Array.isArray(C)?eL(C.filter(e=>e.startsWith("ssh-"))):[],[C,eL]),eq=l.useMemo(()=>C&&Array.isArray(C)?eL(C.filter(e=>!e.startsWith("ssh-"))):[],[C,eL]),eT=l.useMemo(()=>{if(!z||!I)return[];let e=new Set;return z.forEach(s=>{s.context.startsWith("ssh-")&&e.add(s.gpu_name)}),I.filter(s=>e.has(s.gpu_name))},[I,z]),eW=l.useMemo(()=>{if(!z||!I)return[];let e=new Set;return z.forEach(s=>{s.context.startsWith("ssh-")||e.add(s.gpu_name)}),I.filter(s=>e.has(s.gpu_name))},[I,z]),eB=l.useMemo(()=>q&&Array.isArray(q)?[...new Set(q.map(e=>e.cluster))].sort():[],[q]),e$=l.useMemo(()=>q?q.reduce((e,s)=>{let{cluster:t}=s;return e[t]||(e[t]=[]),e[t].push(s),e},{}):{},[q]),eV=l.useMemo(()=>W?W.reduce((e,s)=>{let{cluster:t}=s;return e[t]||(e[t]=[]),e[t].push(s),e},{}):{},[W]),eJ=l.useMemo(()=>O?O.reduce((e,s)=>{let{context:t}=s;return e[t]||(e[t]=[]),e[t].push(s),e},{}):{},[O]);(0,l.useEffect)(()=>{N.isReady&&N.query.context&&e_(decodeURIComponent(Array.isArray(N.query.context)?N.query.context[0]:N.query.context))},[N.isReady,N.query.context]);let eK=e=>{e_(e);let s="/infra/".concat(encodeURIComponent(e));N.asPath!==s&&N.push(s)},eX=s=>{let t=ez[s]||[],l=eJ[s]||[];if(e&&!f)return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64",children:[(0,a.jsx)(r.Z,{size:32,className:"mb-4"}),(0,a.jsx)("span",{className:"text-gray-500 text-lg",children:"Loading Context..."})]});if(s.startsWith("ssh-")){let e=s.replace(/^ssh-/,"");return(0,a.jsx)(H,{poolName:e,gpusInContext:t,nodesInContext:l,handleDeploySSHPool:eE,handleEditSSHPool:eI,handleDeleteSSHPool:eM,poolConfig:em[e]})}return(0,a.jsx)(A,{contextName:s,gpusInContext:t,nodesInContext:l})},eQ=()=>t&&(!$||0===$.length)?(0,a.jsx)("div",{className:"rounded-lg border bg-card text-card-foreground shadow-sm mb-6",children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Cloud"}),(0,a.jsxs)("div",{className:"flex items-center justify-center py-6",children:[(0,a.jsx)(r.Z,{size:24,className:"mr-3"}),(0,a.jsx)("span",{className:"text-gray-500",children:"Loading Cloud..."})]})]})}):(0,a.jsx)("div",{className:"rounded-lg border bg-card text-card-foreground shadow-sm mb-6",children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Cloud"}),(0,a.jsxs)("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:[eG," of ",J," enabled"]})]}),eR&&0!==eR.length?(0,a.jsx)("div",{className:"overflow-x-auto rounded-md border border-gray-200 shadow-sm bg-white",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-32",children:"Cloud"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-24",children:"Clusters"}),(0,a.jsx)("th",{className:"p-3 text-left font-medium text-gray-600 w-24",children:"Jobs"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:eR.map(e=>{let s=j&&void 0!==e.clusters&&void 0!==e.jobs;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"p-3 font-medium text-gray-700",children:e.name}),(0,a.jsx)("td",{className:"p-3",children:s?e.clusters>0?(0,a.jsx)("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:e.clusters}):(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-xs font-medium",children:"0"}):(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(r.Z,{size:16})})}),(0,a.jsx)("td",{className:"p-3",children:s?e.jobs>0?(0,a.jsx)("span",{className:"px-2 py-0.5 bg-green-100 text-green-800 rounded text-xs font-medium",children:e.jobs}):(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-500 rounded text-xs font-medium",children:"0"}):(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(r.Z,{size:16})})})]},e.name)})})]})}):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"all"===eo?"No enabled clouds available.":'No enabled clouds for workspace "'.concat(eo,'".')})]})}),eY=()=>(0,a.jsx)(E,{title:"SSH Node Pool",isLoading:e,isDataLoaded:f,contexts:eZ,gpus:eT,groupedPerContextGPUs:ez,groupedPerNodeGPUs:eJ,handleContextClick:eK,contextStats:Y,jobsData:eN,isJobsDataLoading:ej,isSSH:!0,contextWorkspaceMap:es,contextErrors:ea,actionButton:null}),e0=()=>(0,a.jsx)(E,{title:"Kubernetes",isLoading:e,isDataLoaded:f,contexts:eq,gpus:eW,groupedPerContextGPUs:ez,groupedPerNodeGPUs:eJ,handleContextClick:eK,contextStats:Y,jobsData:eN,isJobsDataLoading:ej,isSSH:!1,contextWorkspaceMap:es,contextErrors:ea}),e1=()=>(0,a.jsx)(E,{title:"Slurm",isLoading:e,isDataLoaded:f,contexts:eB,gpus:G,groupedPerContextGPUs:e$,groupedPerNodeGPUs:eV,handleContextClick:eK,contextStats:{},jobsData:{},isJobsDataLoading:!1,isSSH:!1,isSlurm:!0,contextWorkspaceMap:{}}),e2=e||t;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4 h-5",children:[(0,a.jsxs)("div",{className:"text-base flex items-center",children:[(0,a.jsx)(P(),{href:"/infra",className:"text-sky-blue hover:underline ".concat(eC?"":"cursor-default"),children:"Infrastructure"}),eC&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mx-2 text-gray-500",children:"›"}),eC.startsWith("ssh-")?(0,a.jsx)(P(),{href:"/infra",className:"text-sky-blue hover:underline cursor-pointer",children:"SSH Node Pool"}):(0,a.jsx)(P(),{href:"/infra",className:"text-sky-blue hover:underline cursor-pointer",children:"Kubernetes"}),(0,a.jsx)("span",{className:"mx-2 text-gray-500",children:"›"}),(0,a.jsx)("span",{className:"text-sky-blue",children:eC.startsWith("ssh-")?eC.replace(/^ssh-/,""):eC})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[ec.length>0&&(0,a.jsxs)("div",{className:"flex items-center mr-4",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Workspace:"}),(0,a.jsxs)(D.Ph,{value:eo,onValueChange:ei,children:[(0,a.jsx)(D.i4,{className:"w-40 h-8 text-sm",children:(0,a.jsx)(D.ki,{})}),(0,a.jsxs)(D.Bw,{children:[(0,a.jsx)(D.Ql,{value:"all",children:"All Workspaces"}),ec.map(e=>(0,a.jsx)(D.Ql,{value:e,children:e},e))]})]})]}),e2&&(0,a.jsxs)("div",{className:"flex items-center mr-2",children:[(0,a.jsx)(r.Z,{size:15,className:"mt-0"}),(0,a.jsx)("span",{className:"ml-2 text-gray-500",children:"Loading..."})]}),!e2&&ew&&(0,a.jsx)(U.$3,{timestamp:ew,className:"mr-2"}),(0,a.jsxs)("button",{onClick:eH,disabled:e2,className:"text-sky-blue hover:text-sky-blue-bright flex items-center",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4 mr-1.5"}),!u&&"Refresh"]})]})]}),(()=>{if(eC)return e&&!f?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64",children:[(0,a.jsx)(r.Z,{size:32,className:"mb-4"}),(0,a.jsx)("span",{className:"text-gray-500 text-lg",children:"Loading Context..."})]}):eX(eC);let s=[];s.push({name:"Slurm",render:e1,hasActivity:eB.length>0,priority:1}),s.push({name:"Kubernetes",render:e0,hasActivity:eq.length>0,priority:2}),s.push({name:"Cloud",render:eQ,hasActivity:X>0,priority:3}),s.push({name:"SSH Node Pool",render:eY,hasActivity:eZ.length>0&&function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.some(e=>{let t=Y[s?"ssh/".concat(e.replace(/^ssh-/,"")):"kubernetes/".concat(e)]||{clusters:0,jobs:0};return t.clusters>0||t.jobs>0})}(eZ,!0),priority:4});let t=s.sort((e,s)=>e.hasActivity!==s.hasActivity?e.hasActivity?-1:1:e.priority-s.priority);return(0,a.jsx)(a.Fragment,{children:t.map((e,s)=>(0,a.jsx)(l.Fragment,{children:e.render()},s))})})(),(0,a.jsx)(v,{isOpen:ex,onClose:()=>eh(!1),onSave:eA,poolData:ep,isLoading:ef})]})}},42557:function(e,s,t){t.d(s,{I:function(){return n}});var a=t(85893),l=t(67294),r=t(32350);let n=l.forwardRef((e,s)=>{let{className:t,type:l,...n}=e;return(0,a.jsx)("input",{type:l,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},29749:function(e,s,t){t.d(s,{_:function(){return d}});var a=t(85893),l=t(67294),r=t(75320),n=l.forwardRef((e,s)=>(0,a.jsx)(r.WV.label,{...e,ref:s,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));n.displayName="Label";var o=t(12003),i=t(32350);let c=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(n,{ref:s,className:(0,i.cn)(c(),t),...l})});d.displayName=n.displayName},69123:function(e,s,t){t.d(s,{g:function(){return n}});var a=t(85893),l=t(67294),r=t(32350);let n=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...l})});n.displayName="Textarea"},12003:function(e,s,t){t.d(s,{j:function(){return n}});var a=t(90512);let l=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,r=a.W,n=(e,s)=>t=>{var a;if((null==s?void 0:s.variants)==null)return r(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:n,defaultVariants:o}=s,i=Object.keys(n).map(e=>{let s=null==t?void 0:t[e],a=null==o?void 0:o[e];if(null===s)return null;let r=l(s)||l(a);return n[e][r]}),c=t&&Object.entries(t).reduce((e,s)=>{let[t,a]=s;return void 0===a||(e[t]=a),e},{});return r(e,i,null==s?void 0:null===(a=s.compoundVariants)||void 0===a?void 0:a.reduce((e,s)=>{let{class:t,className:a,...l}=s;return Object.entries(l).every(e=>{let[s,t]=e;return Array.isArray(t)?t.includes({...o,...c}[s]):({...o,...c})[s]===t})?[...e,t,a]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8056],{50326:function(e,t,r){r.d(t,{$N:function(){return p},Be:function(){return h},Vq:function(){return c},cN:function(){return g},cZ:function(){return d},fK:function(){return f}});var o=r(85893),a=r(67294),s=r(6327),n=r(32350),l=r(43767);let c=s.fC;s.xz;let u=s.h_;s.x8;let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)(s.aV,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...a})});i.displayName=s.aV.displayName;let d=a.forwardRef((e,t)=>{let{className:r,children:a,...c}=e;return(0,o.jsxs)(u,{children:[(0,o.jsx)(i,{}),(0,o.jsxs)(s.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...c,children:[a,(0,o.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 data-[state=open]:text-gray-500",children:[(0,o.jsx)(l.Z,{className:"h-4 w-4"}),(0,o.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});d.displayName=s.VY.displayName;let f=e=>{let{className:t,...r}=e;return(0,o.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})};f.displayName="DialogHeader";let g=e=>{let{className:t,...r}=e;return(0,o.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};g.displayName="DialogFooter";let p=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)(s.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",r),...a})});p.displayName=s.Dx.displayName;let h=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)(s.dk,{ref:t,className:(0,n.cn)("text-sm text-gray-500",r),...a})});h.displayName=s.dk.displayName},23266:function(e,t,r){r.d(t,{GH:function(){return f},QL:function(){return p},Sl:function(){return d},getClusters:function(){return u},uR:function(){return i}});var o=r(67294),a=r(15821),s=r(47145),n=r(93225),l=r(6378);let c={UP:"RUNNING",STOPPED:"STOPPED",INIT:"LAUNCHING",null:"TERMINATED"};async function u(){let{clusterNames:e=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await s.x.fetch("/status",{cluster_names:e,all_users:!0,include_credentials:!1,include_handle:!1,summary_response:null==e})).map(e=>{let t="";t=e.zone?e.zone:e.region,"SSH"===e.cloud&&(null==t?void 0:t.startsWith("ssh-"))&&(t=t.substring(4));let r=t;return t&&t.length>25&&(t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;if(!e||e.length<=t)return e;if(t<=3)return"...";let r=Math.floor((t-3)/2),o=r+(t-3)%2;return 0===r?e.substring(0,o)+"...":e.substring(0,o)+"..."+e.substring(e.length-r)}(t,25)),{status:c[e.status],cluster:e.name,user:e.user_name,user_hash:e.user_hash,cluster_hash:e.cluster_hash,cloud:e.cloud,region:e.region,infra:t?e.cloud+" ("+t+")":e.cloud,full_infra:r?"".concat(e.cloud," (").concat(r,")"):e.cloud,cpus:e.cpus,mem:e.memory,gpus:e.accelerators,resources_str:e.resources_str,resources_str_full:e.resources_str_full,time:new Date(1e3*e.launched_at),num_nodes:e.nodes,workspace:e.workspace,autostop:e.autostop,last_event:e.last_event,to_down:e.to_down,cluster_name_on_cloud:e.cluster_name_on_cloud,jobs:[],command:e.last_creation_command||e.last_use,task_yaml:e.last_creation_yaml||"{}",events:[{time:new Date(1e3*e.launched_at),event:"Cluster created."}]}})}catch(e){throw console.error("Error fetching clusters:",e),e}}async function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{let r={days:t,dashboard_summary_response:!0};e&&(r.cluster_hashes=[e]);let o=await s.x.fetch("/cost_report",r);console.log("Raw cluster history data:",o);let a=o.map(e=>{let t="Unknown";e.cloud?t=e.cloud:e.resources&&e.resources.cloud&&(t=e.resources.cloud);let r=e.user_name||"-";return{status:e.status?c[e.status]:"TERMINATED",cluster:e.name,user:r,user_hash:e.user_hash,cluster_hash:e.cluster_hash,cloud:t,region:"",infra:t,full_infra:t,resources_str:e.resources_str,resources_str_full:e.resources_str_full,time:e.launched_at?new Date(1e3*e.launched_at):null,num_nodes:e.num_nodes||1,duration:e.duration,total_cost:e.total_cost,workspace:e.workspace||"default",autostop:-1,last_event:e.last_event,to_down:!1,cluster_name_on_cloud:null,usage_intervals:e.usage_intervals,command:e.last_creation_command||"",task_yaml:e.last_creation_yaml||"{}",events:[{time:e.launched_at?new Date(1e3*e.launched_at):new Date,event:"Cluster created."}]}});return console.log("Processed cluster history data:",a),a}catch(e){throw console.error("Error fetching cluster history:",e),e}}async function d(e){let{clusterName:t,jobId:r,onNewLog:o,workspace:n,signal:l}=e;try{await s.x.stream("/logs",{follow:!1,cluster_name:t,job_id:r,tail:5e3,override_skypilot_config:{active_workspace:n||"default"}},o,{signal:l})}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Error in streamClusterJobLogs:",e),(0,a.C)("Error in streamClusterJobLogs: ".concat(e.message),"error")}}async function f(e){let{clusterName:t,jobIds:r=null,workspace:o}=e;try{let e=await s.x.fetch("/download_logs",{cluster_name:t,job_ids:r?r.map(String):null,override_skypilot_config:{active_workspace:o||"default"}}),l=Object.values(e||{});if(!l.length){(0,a.C)("No logs found to download.","warning");return}let c=window.location.origin,u="".concat(c).concat(n.f4,"/download"),i=await fetch("".concat(u,"?relative=items"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_paths:l})});if(!i.ok){let e=await i.text();throw Error("Download failed: ".concat(i.status," ").concat(e))}let d=await i.blob(),f=window.URL.createObjectURL(d),g=document.createElement("a"),p=new Date().toISOString().replace(/[:.]/g,"-"),h=r&&1===r.length?"job-".concat(r[0]):"jobs";g.href=f,g.download="".concat(t,"-").concat(h,"-logs-").concat(p,".zip"),document.body.appendChild(g),g.click(),g.remove(),window.URL.revokeObjectURL(f)}catch(e){console.error("Error downloading logs:",e),(0,a.C)("Error downloading logs: ".concat(e.message),"error")}}async function g(e){let{clusterName:t,workspace:r}=e;try{return(await s.x.fetch("/queue",{cluster_name:t,all_users:!0,override_skypilot_config:{active_workspace:r}})).map(e=>{var o;let a=e.end_at?e.end_at:Date.now()/1e3,s=0,n=0;return e.submitted_at&&(s=a-e.submitted_at),e.start_at&&(n=a-e.start_at),{id:e.job_id,status:e.status,job:e.job_name,user:e.username,user_hash:e.user_hash,gpus:e.accelerators||{},submitted_at:e.submitted_at?new Date(1e3*e.submitted_at):null,resources:e.resources,cluster:t,total_duration:s,job_duration:n,infra:"",logs:"",workspace:r||"default",git_commit:(null===(o=e.metadata)||void 0===o?void 0:o.git_commit)||"-"}})}catch(e){throw console.error("Error fetching cluster jobs:",e),e}}function p(e){let{cluster:t,job:r=null}=e,[a,s]=(0,o.useState)(null),[n,c]=(0,o.useState)(null),[i,d]=(0,o.useState)(!0),[f,p]=(0,o.useState)(!0),h=(0,o.useCallback)(async()=>{if(t)try{d(!0);let e=await l.ZP.get(u,[{clusterNames:[t]}]);if(e.length>0)return s(e[0]),e[0];return console.error("No cluster data found for cluster:",t),null}catch(e){console.error("Error fetching cluster data:",e)}finally{d(!1)}return null},[t]),m=(0,o.useCallback)(async e=>{if(t)try{p(!0);let r=await l.ZP.get(g,[{clusterName:t,workspace:e||"default"}]);c(r)}catch(e){console.error("Error fetching cluster job data:",e)}finally{p(!1)}},[t]),_=(0,o.useCallback)(async()=>{l.ZP.invalidate(u,[{clusterNames:[t]}]);let e=await h();e&&(l.ZP.invalidate(g,[{clusterName:t,workspace:e.workspace||"default"}]),await m(e.workspace))},[h,m,t]),w=(0,o.useCallback)(async()=>{a&&(l.ZP.invalidate(g,[{clusterName:t,workspace:a.workspace||"default"}]),await m(a.workspace))},[m,a,t]);return(0,o.useEffect)(()=>{(async()=>{let e=await h();e&&m(e.workspace)})()},[t,r,h,m]),{clusterData:a,clusterJobData:n,loading:i,clusterDetailsLoading:i,clusterJobsLoading:f,refreshData:_,refreshClusterJobsOnly:w}}},32045:function(e,t,r){r.d(t,{R8:function(){return d},Xg:function(){return c},ef:function(){return l}});var o=r(93225),a=r(47145),s=r(94545),n=r(6378);async function l(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let{getClusters:e}=await Promise.resolve().then(r.bind(r,23266)),{getManagedJobs:t}=await Promise.resolve().then(r.bind(r,68969)),{getWorkspaces:a,getEnabledClouds:s}=await Promise.resolve().then(r.bind(r,17324));try{let r={jobs:[]};try{r=await n.ZP.get(t,[{allUsers:!0,skipFinished:!0,fields:["cloud","region"]}])}catch(e){console.error("Error fetching managed jobs:",e)}let l=(null==r?void 0:r.jobs)||[],c=[];try{c=await n.ZP.get(e)}catch(e){console.error("Error fetching clusters:",e)}let u=c||[],i=[];try{let e=await n.ZP.get(a),t=Object.keys(e||{});if(0===t.length)console.warn("No accessible workspaces found"),i=[];else{let e=new Set;await Promise.all(t.map(async t=>{try{let r=await n.ZP.get(s,[t,!1]);Array.isArray(r)&&r.forEach(t=>{t&&e.add(t.toLowerCase())})}catch(e){console.error("Error fetching enabled clouds for workspace ".concat(t,":"),e)}})),i=Array.from(e),console.log("Aggregated enabled clouds across all workspaces:",i)}}catch(e){console.error("Error fetching enabled clouds:",e),i=[]}let d={};o.$m.forEach(e=>{let t=i.includes(e.toLowerCase());d[e]={name:e,clusters:0,jobs:0,enabled:t}}),u.forEach(e=>{if(e.cloud){let t=e.cloud;d[t]&&(d[t].clusters+=1,d[t].enabled=!0)}}),l.forEach(e=>{if(e.cloud){let t=e.cloud;d[t]&&(d[t].jobs+=1,d[t].enabled=!0)}});let f=o.$m.length,g=Object.values(d).filter(e=>e.enabled).length;return{clouds:Object.values(d).filter(e=>e.enabled).sort((e,t)=>e.name.localeCompare(t.name)),totalClouds:f,enabledClouds:g}}catch(e){throw console.error("Error fetching cloud infrastructure:",e),e}}async function c(){try{console.log("[DEBUG] Starting workspace-aware infrastructure fetch");let{getWorkspaces:e}=await Promise.resolve().then(r.bind(r,17324));console.log("[DEBUG] About to call getWorkspaces()");let t=await e();if(console.log("[DEBUG] Workspaces data received:",t),console.log("[DEBUG] Number of accessible workspaces:",Object.keys(t||{}).length),console.log("[DEBUG] Workspace names:",Object.keys(t||{})),!t||0===Object.keys(t).length)return console.log("[DEBUG] No accessible workspaces found - returning empty result"),{workspaces:{},allContextNames:[],allGPUs:[],perContextGPUs:[],perNodeGPUs:[],allSlurmGPUs:[],perClusterSlurmGPUs:[],perNodeSlurmGPUs:[],contextStats:{},contextWorkspaceMap:{},contextErrors:{}};let{getEnabledClouds:o}=await Promise.resolve().then(r.bind(r,17324)),a={},s=[],l={};await Promise.allSettled(Object.entries(t).map(async e=>{let[t,r]=e;console.log("Fetching infrastructure for workspace: ".concat(t));try{console.log("[DEBUG] Fetching enabled clouds for workspace: ".concat(t));let e=await o(t,!0);console.log("[DEBUG] Expanded clouds for ".concat(t,":"),e),a[t]={config:r,clouds:e,contexts:[]},console.log("[DEBUG] Processing expandedClouds for ".concat(t,":"),e),e&&Array.isArray(e)?e.forEach(e=>{if(console.log("[DEBUG] Processing infraItem: ".concat(e)),e.toLowerCase().startsWith("kubernetes/")){let r=e.replace(/^kubernetes\//i,"");console.log("[DEBUG] Extracted kubernetes context: ".concat(r)),s.push(r),l[r]||(l[r]=[]),l[r].includes(t)||l[r].push(t),a[t].contexts.push(r)}else if(e.toLowerCase().startsWith("ssh/")){let r=e.replace(/^ssh\//i,""),o="ssh-".concat(r);console.log("[DEBUG] Extracted SSH context: ".concat(o)),s.push(o),l[o]||(l[o]=[]),l[o].includes(t)||l[o].push(t),a[t].contexts.push(o)}}):console.log("[DEBUG] No expanded clouds or not an array for ".concat(t))}catch(e){throw console.error("Failed to fetch infrastructure for workspace ".concat(t,":"),e),e}}));let{getClusters:c}=await Promise.resolve().then(r.bind(r,23266)),i=[];try{i=await n.ZP.get(c)}catch(e){console.error("Error fetching clusters:",e)}let d=i||[],g={};try{g=await f(d)}catch(e){console.error("Error fetching context clusters:",e)}let p=[...new Set(s)].filter(e=>e&&"string"==typeof e),m={allGPUs:[],perContextGPUs:[],perNodeGPUs:[],contextErrors:{}};try{m=await u(p)}catch(e){console.error("Error fetching Kubernetes GPUs:",e)}let _={allSlurmGPUs:[],perClusterSlurmGPUs:[],perNodeSlurmGPUs:[]};try{_=await h(),console.log("[DEBUG] Slurm GPU data in infra.jsx:",_)}catch(e){console.error("Error fetching Slurm GPUs:",e)}let w={workspaces:a,allContextNames:[...new Set(s)].sort(),allGPUs:m.allGPUs||[],perContextGPUs:m.perContextGPUs||[],perNodeGPUs:m.perNodeGPUs||[],allSlurmGPUs:_.allSlurmGPUs||[],perClusterSlurmGPUs:_.perClusterSlurmGPUs||[],perNodeSlurmGPUs:_.perNodeSlurmGPUs||[],contextStats:g,contextWorkspaceMap:l,contextErrors:m.contextErrors||{}};return console.log("[DEBUG] Final result:",w),console.log("[DEBUG] All contexts found:",s),console.log("[DEBUG] Context workspace map:",l),w}catch(e){throw console.error("[DEBUG] Failed to fetch workspace infrastructure:",e),console.error("[DEBUG] Error stack:",e.stack),e}}async function u(e){try{var t,r,o,a,s,n,l,c,u,d,f;if(!e||0===e.length)return{allGPUs:[],perContextGPUs:[],perNodeGPUs:[],contextErrors:{}};let g={},p={},h={},m={},_=await Promise.allSettled(e.map(e=>i(e))),w={};for(let r=0;r<e.length;r++){let o=_[r];if("fulfilled"===o.status)w[e[r]]=o.value,console.log("[CONTEXT_DEBUG] Context node info result:",e[r],o.value);else{let a=(null===(t=o.reason)||void 0===t?void 0:t.message)||"string"==typeof o.reason&&o.reason||"Context may be unavailable or timed out";console.warn("Failed to get node info for context ".concat(e[r],":"),a),w[e[r]]={},m[e[r]]=a}}for(let t of e){let e=w[t]||{};if(e&&Object.keys(e).length>0){let a={};for(let s in e){let n=e[s];if(!n){console.warn("No node data for node ".concat(s," in context ").concat(t));continue}let l=n.accelerator_type||"-",c=(null===(r=n.total)||void 0===r?void 0:r.accelerator_count)||0,u=(null===(o=n.free)||void 0===o?void 0:o.accelerators_available)||0,i=!1!==n.is_ready;c>0&&(a[l]||(a[l]={gpu_name:l,gpu_requestable_qty_per_node:0,gpu_total:0,gpu_free:0,gpu_not_ready:0,context:t}),a[l].gpu_total+=c,a[l].gpu_free+=u,!1===i&&(a[l].gpu_not_ready+=c),a[l].gpu_requestable_qty_per_node=c)}for(let e in p[t]=Object.values(a),a)e in g?(g[e].gpu_total+=a[e].gpu_total,g[e].gpu_free+=a[e].gpu_free,g[e].gpu_not_ready+=a[e].gpu_not_ready):g[e]={gpu_total:a[e].gpu_total,gpu_free:a[e].gpu_free,gpu_not_ready:a[e].gpu_not_ready,gpu_name:e}}else p[t]=[]}for(let t of e){let e=w[t];if(e&&Object.keys(e).length>0)for(let r in e){let o=e[r];if(!o){console.warn("No node data for node ".concat(r," in context ").concat(t));continue}let i=o.accelerator_type||"-",m=null!==(n=null===(a=o.total)||void 0===a?void 0:a.accelerator_count)&&void 0!==n?n:0,_=null!==(l=null===(s=o.free)||void 0===s?void 0:s.accelerators_available)&&void 0!==l?l:0,w=!1!==o.is_ready,y=null!==(c=o.cpu_count)&&void 0!==c?c:null,P=null!==(u=o.memory_gb)&&void 0!==u?u:null,b=null!==(d=o.cpu_free)&&void 0!==d?d:null,E=null!==(f=o.memory_free_gb)&&void 0!==f?f:null;h["".concat(t,"/").concat(r)]={node_name:o.name||r,gpu_name:i,gpu_total:m,gpu_free:_,ip_address:o.ip_address||null,context:t,cpu_count:y,memory_gb:P,cpu_free:b,memory_free_gb:E,is_ready:w},"-"===i||!p[t]||p[t].some(e=>e.gpu_name===i)||(i in g||(g[i]={gpu_total:0,gpu_free:0,gpu_not_ready:0,gpu_name:i}),p[t].find(e=>e.gpu_name===i)||p[t].push({gpu_name:i,gpu_not_ready:0,gpu_requestable_qty_per_node:"-",gpu_total:0,gpu_free:0,context:t}))}}return console.log("[CONTEXT_DEBUG] All GPUs summary:",g),console.log("[CONTEXT_DEBUG] Per context GPUs data:",p),console.log("[CONTEXT_DEBUG] Per node GPUs data:",h),console.log("[CONTEXT_DEBUG] Context errors:",m),{allGPUs:Object.values(g).sort((e,t)=>(e.gpu_name||"").localeCompare(t.gpu_name||"")),perContextGPUs:Object.values(p).flat().sort((e,t)=>(e.context||"").localeCompare(t.context||"")||(e.gpu_name||"").localeCompare(t.gpu_name||"")),perNodeGPUs:Object.values(h).sort((e,t)=>(e.context||"").localeCompare(t.context||"")||(e.node_name||"").localeCompare(t.node_name||"")||(e.gpu_name||"").localeCompare(t.gpu_name||"")),contextErrors:m}}catch(e){throw console.error("[infra.jsx] Error in getKubernetesGPUsFromContexts:",e),e}}async function i(e){try{let t=await a.x.post("/kubernetes_node_info",{context:e});if(!t.ok){let r="Failed to get kubernetes node info for context ".concat(e," with status ").concat(t.status,", error: ").concat(t.statusText);throw Error(r)}let r=t.headers.get("X-Skypilot-Request-ID")||t.headers.get("x-request-id");if(!r)throw Error("No request ID received from server for kubernetes node info");let o=await a.x.get("/api/get?request_id=".concat(r));if(!o.ok){let t=await (0,s.oN)(o),r="Failed to get kubernetes node info result for context ".concat(e," with status ").concat(o.status,", error: ").concat(t);throw Error(r)}let n=await o.json();return(n.return_value?JSON.parse(n.return_value):{}).node_info_dict||{}}catch(t){throw console.warn("[infra.jsx] Context ".concat(e," unavailable or timed out:"),t.message),t}}async function d(e){try{let t={};return e.forEach(e=>{let r=null;if("Kubernetes"===e.cloud)(r=e.region)&&(r="kubernetes/".concat(r));else if("SSH"===e.cloud&&(r=e.region)){let e=r.startsWith("ssh-")?r.substring(4):r;r="ssh/".concat(e)}r&&(t[r]||(t[r]={clusters:0,jobs:0}),t[r].jobs+=1)}),t}catch(e){throw console.error("=== Error in getContextJobs ===",e),e}}async function f(e){try{let t={};return e.forEach(e=>{let r=null;if("Kubernetes"===e.cloud)(r=e.region)&&(r="kubernetes/".concat(r));else if("SSH"===e.cloud&&(r=e.region)){let e=r.startsWith("ssh-")?r.substring(4):r;r="ssh/".concat(e)}r&&(t[r]||(t[r]={clusters:0,jobs:0}),t[r].clusters+=1)}),t}catch(e){throw console.error("=== Error in getContextClusters ===",e),e}}async function g(){try{let e=await a.x.post("/slurm_gpu_availability",{});if(!e.ok){let t="Failed to get slurm cluster GPUs with status ".concat(e.status);throw Error(t)}let t=e.headers.get("X-Skypilot-Request-ID")||e.headers.get("x-request-id");if(!t)throw Error("No request ID received from server for slurm cluster GPUs");let r=await a.x.get("/api/get?request_id=".concat(t));if(500===r.status){try{let e=await r.json();if(e.detail&&e.detail.error)try{let t=JSON.parse(e.detail.error);console.error("Error fetching Slurm cluster GPUs:",t.message)}catch(e){console.error("Error parsing JSON for Slurm error:",e)}}catch(e){console.error("Error parsing JSON for Slurm 500 response:",e)}return[]}if(!r.ok){let e="Failed to get slurm cluster GPUs result with status ".concat(r.status);throw Error(e)}let o=await r.json();return o.return_value?JSON.parse(o.return_value):[]}catch(e){return console.error("Error fetching Slurm cluster GPUs:",e),[]}}async function p(){try{let e=await a.x.get("/slurm_node_info");if(!e.ok){let t="Failed to get slurm node info with status ".concat(e.status);throw Error(t)}let t=e.headers.get("X-Skypilot-Request-ID")||e.headers.get("x-request-id");if(!t)throw Error("No request ID received from server for slurm node info");let r=await a.x.get("/api/get?request_id=".concat(t));if(500===r.status){try{let e=await r.json();if(e.detail&&e.detail.error)try{let t=JSON.parse(e.detail.error);console.error("Error fetching Slurm per node GPUs:",t.message)}catch(e){console.error("Error parsing JSON for Slurm node error:",e)}}catch(e){console.error("Error parsing JSON for Slurm node 500 response:",e)}return[]}if(!r.ok){let e="Failed to get slurm node info result with status ".concat(r.status);throw Error(e)}let o=await r.json();return o.return_value?JSON.parse(o.return_value):[]}catch(e){return console.error("Error fetching Slurm per node GPUs:",e),[]}}async function h(){try{let e=await g(),t=await p(),r={},o={},a={};for(let t of e){let e=t[0];for(let a of t[1]){let t=a[0],s=a[1].join(", "),n=a[2],l=a[3];t in r?(r[t].gpu_total+=n,r[t].gpu_free+=l):r[t]={gpu_total:n,gpu_free:l,gpu_name:t},o["".concat(e,"#").concat(t)]={gpu_name:t,gpu_requestable_qty_per_node:s,gpu_total:n,gpu_free:l,cluster:e}}}for(let e of t){let t=e.slurm_cluster_name||"default";a["".concat(t,"/").concat(e.node_name,"/").concat(e.gpu_type||"-")]={node_name:e.node_name,gpu_name:e.gpu_type||"-",gpu_total:e.total_gpus||0,gpu_free:e.free_gpus||0,cluster:t,partition:e.partition||"default"}}return{allSlurmGPUs:Object.values(r).sort((e,t)=>e.gpu_name.localeCompare(t.gpu_name)),perClusterSlurmGPUs:Object.values(o).sort((e,t)=>e.cluster.localeCompare(t.cluster)||e.gpu_name.localeCompare(t.gpu_name)),perNodeSlurmGPUs:Object.values(a).sort((e,t)=>(e.cluster||"").localeCompare(t.cluster||"")||(e.node_name||"").localeCompare(t.node_name||"")||(e.gpu_name||"").localeCompare(t.gpu_name||""))}}catch(e){return console.error("Error fetching Slurm GPUs:",e),{allSlurmGPUs:[],perClusterSlurmGPUs:[],perNodeSlurmGPUs:[]}}}},29326:function(e,t,r){r.d(t,{IS:function(){return d},It:function(){return s},MV:function(){return l},Ri:function(){return n},_x:function(){return u},ez:function(){return i},hY:function(){return c},mF:function(){return g},wJ:function(){return f}});var o=r(93225),a=r(15821);async function s(){try{let e=await fetch("".concat(o.f4,"/ssh_node_pools"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){return console.error("Error fetching SSH Node Pools:",e),{}}}async function n(e){try{let t=await fetch("".concat(o.f4,"/ssh_node_pools"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error updating SSH Node Pools:",e),e}}async function l(e){try{let t=await fetch("".concat(o.f4,"/ssh_node_pools/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error deleting SSH Node Pool:",e),e}}async function c(e,t){try{let r=new FormData;r.append("key_name",e),r.append("key_file",t);let a=await fetch("".concat(o.f4,"/ssh_node_pools/keys"),{method:"POST",body:r});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}catch(e){throw console.error("Error uploading SSH key:",e),e}}async function u(e){try{let t=await fetch("".concat(o.f4,"/ssh_node_pools/").concat(e,"/deploy"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error deploying SSH Node Pool:",e),e}}async function i(e){try{let t=await fetch("".concat(o.f4,"/ssh_node_pools/").concat(e,"/down"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error tearing down SSH Node Pool:",e),e}}async function d(e){try{let t=await fetch("".concat(o.f4,"/ssh_node_pools/").concat(e,"/status"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Error fetching SSH Node Pool status:",e),e}}async function f(e){let t,{requestId:r,signal:s,onNewLog:n}=e,l=Date.now(),c=new Promise(e=>{let r=()=>{let o=Date.now()-l;o>=3e5?e({timeout:!0}):t=setTimeout(r,3e5-o)};t=setTimeout(r,3e5)}),u=(async()=>{try{let e=await fetch("".concat(o.f4,"/api/stream?request_id=").concat(r,"&format=plain&tail=").concat(1e3,"&follow=true"),{method:"GET",headers:{"Content-Type":"application/json"},...s?{signal:s}:{}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let a=e.body.getReader();try{for(;;){let{done:e,value:t}=await a.read();if(e)break;l=Date.now();let r=new TextDecoder().decode(t);n(r)}}finally{a.cancel(),t&&clearTimeout(t)}return{timeout:!1}}catch(e){if(t&&clearTimeout(t),"AbortError"===e.name)return{timeout:!1};throw e}})(),i=await Promise.race([u,c]);if(t&&clearTimeout(t),i.timeout){(0,a.C)("SSH deployment log stream timed out after ".concat(300,"s of inactivity"),"warning");return}}async function g(e){let t,{requestId:r,signal:s,onNewLog:n,operationType:l="operation"}=e,c=Date.now(),u=new Promise(e=>{let r=()=>{let o=Date.now()-c;o>=3e5?e({timeout:!0}):t=setTimeout(r,3e5-o)};t=setTimeout(r,3e5)}),i=(async()=>{try{let e=await fetch("".concat(o.f4,"/api/stream?request_id=").concat(r,"&format=plain&tail=").concat(1e3,"&follow=true"),{method:"GET",headers:{"Content-Type":"application/json"},...s?{signal:s}:{}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let a=e.body.getReader();try{for(;;){let{done:e,value:t}=await a.read();if(e)break;c=Date.now();let r=new TextDecoder().decode(t);n(r)}}finally{a.cancel(),t&&clearTimeout(t)}return{timeout:!1}}catch(e){if(t&&clearTimeout(t),"AbortError"===e.name)return{timeout:!1};throw e}})(),d=await Promise.race([i,u]);if(t&&clearTimeout(t),d.timeout){(0,a.C)("SSH ".concat(l," log stream timed out after ").concat(300,"s of inactivity"),"warning");return}}},53081:function(e,t,r){r.d(t,{R:function(){return a}});var o=r(47145);async function a(){try{let e=await o.x.get("/users");if(!e.ok)throw Error("Failed to fetch users with status ".concat(e.status));return(await e.json()).map(e=>({userId:e.id,username:e.name,role:e.role,created_at:e.created_at}))||[]}catch(e){throw console.error("Failed to fetch users:",e),e}}},19238:function(e,t,r){r.d(t,{C:function(){return s},w:function(){return n}});var o=r(47145),a=r(94545);async function s(){try{return(await o.x.fetch("/volumes",{},"GET")).map(e=>{var t,r,o;let a=e.cloud||"";return e.region&&(a+="/".concat(e.region)),e.zone&&(a+="/".concat(e.zone)),{name:e.name,launched_at:e.launched_at,user_hash:e.user_hash,user_name:e.user_name||"-",workspace:e.workspace||"-",last_attached_at:e.last_attached_at,status:e.status,type:e.type,cloud:e.cloud,region:e.region,zone:e.zone,infra:a,size:"".concat(e.size,"Gi"),config:e.config,storage_class:(null===(t=e.config)||void 0===t?void 0:t.storage_class_name)||"-",access_mode:(null===(r=e.config)||void 0===r?void 0:r.access_mode)||"-",namespace:(null===(o=e.config)||void 0===o?void 0:o.namespace)||"-",name_on_cloud:e.name_on_cloud,usedby_pods:e.usedby_pods,usedby_clusters:e.usedby_clusters}})||[]}catch(e){throw console.error("Failed to fetch volumes:",e),e}}async function n(e){let t="";try{let r=await o.x.post("/volumes/delete",{names:[e]});if(!r.ok)return console.error("Initial API request to delete volume failed with status ".concat(r.status)),{success:!1,msg:"Failed to delete volume with status ".concat(r.status)};let s=r.headers.get("X-SkyPilot-Request-ID")||r.headers.get("X-Request-ID");if(!s)return console.error("No request ID received from server for deleting volume"),{success:!1,msg:"No request ID received from server for deleting volume"};let n=await o.x.get("/api/get?request_id=".concat(s));if(!n.ok){let e=await (0,a.oN)(n);return t="Failed to delete volume with status ".concat(n.status,", error: ").concat(e),console.error(t),{success:!1,msg:t}}return{success:!0}}catch(e){return console.error(t="Failed to delete volume: ".concat(e)),{success:!1,msg:t}}}},23001:function(e,t,r){r.d(t,{X:function(){return a}});var o=r(67294);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,r]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let t=()=>{r(window.innerWidth<e)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e]),t}},36856:function(e,t,r){var o=r(6378),a=r(23266),s=r(68969),n=r(17324),l=r(53081),c=r(19238),u=r(32045),i=r(29326);let d={base:{getClusters:{fn:a.getClusters,args:[]},getManagedJobs:{fn:s.aT,args:[{allUsers:!0}]},getWorkspaces:{fn:n.getWorkspaces,args:[]},getUsers:{fn:l.R,args:[]},getCloudInfrastructure:{fn:u.ef,args:[!1]},getSSHNodePools:{fn:i.It,args:[]},getVolumes:{fn:c.C,args:[]}},dynamic:{getEnabledClouds:{fn:n.getEnabledClouds,requiresWorkspaces:!0}},pages:{clusters:["getClusters","getWorkspaces"],jobs:["getManagedJobs","getClusters","getWorkspaces","getUsers"],infra:["getClusters","getManagedJobs","getCloudInfrastructure","getSSHNodePools"],workspaces:["getWorkspaces","getClusters","getManagedJobs","getEnabledClouds"],users:["getUsers","getClusters","getManagedJobs"],volumes:["getVolumes"]}};class f{async preloadForPage(e,t){let{backgroundPreload:r=!0,force:o=!1}=t||{};if(!d.pages[e]){console.warn("Unknown page: ".concat(e));return}console.log("[CachePreloader] Preloading cache for page: ".concat(e));try{await this._loadPageData(e,o),r&&this._backgroundPreloadOtherPages(e)}catch(t){console.error("[CachePreloader] Error preloading for page ".concat(e,":"),t)}}async _loadPageData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=d.pages[e],a=[];for(let e of r)if(d.base[e]){let{fn:r,args:s}=d.base[e];t&&o.ZP.invalidate(r,s),a.push(o.ZP.get(r,s).then(e=>(this._markAsPreloaded(r,s),e)))}else"getEnabledClouds"===e&&a.push(this._loadEnabledCloudsForAllWorkspaces(t));await Promise.allSettled(a),console.log("[CachePreloader] Loaded data for page: ".concat(e))}async _loadEnabledCloudsForAllWorkspaces(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e&&o.ZP.invalidate(n.getWorkspaces);let t=await o.ZP.get(n.getWorkspaces),r=Object.keys(t||{}).map(t=>(e&&o.ZP.invalidate(n.getEnabledClouds,[t]),o.ZP.get(n.getEnabledClouds,[t])));await Promise.allSettled(r)}catch(e){console.error("[CachePreloader] Error loading enabled clouds:",e)}}_backgroundPreloadOtherPages(e){if(this.isPreloading)return;this.isPreloading=!0;let t=new Set(d.pages[e]),r=new Set;Object.keys(d.pages).filter(t=>t!==e).forEach(e=>{d.pages[e].forEach(e=>{t.has(e)||r.add(e)})}),console.log("[CachePreloader] Background preloading ".concat(r.size," unique functions: ").concat(Array.from(r).join(", "))),Promise.allSettled(Array.from(r).map(async e=>{try{if(d.base[e]){let{fn:t,args:r}=d.base[e];await o.ZP.get(t,r),this._markAsPreloaded(t,r)}else"getEnabledClouds"===e&&await this._loadEnabledCloudsForAllWorkspaces(!1);console.log("[CachePreloader] Background loaded function: ".concat(e))}catch(t){console.error("[CachePreloader] Background load failed for function ".concat(e,":"),t)}})).then(()=>{this.isPreloading=!1,console.log("[CachePreloader] Background preloading complete")})}async preloadBaseFunctions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("[CachePreloader] Preloading all base functions");let t=Object.entries(d.base).map(t=>{let[r,{fn:a,args:s}]=t;return e&&o.ZP.invalidate(a,s),o.ZP.get(a,s).catch(e=>{console.error("[CachePreloader] Failed to preload ".concat(r,":"),e)})});await Promise.allSettled(t),console.log("[CachePreloader] Base functions preloaded")}getCacheStats(){return{...o.ZP.getStats(),isPreloading:this.isPreloading}}wasRecentlyPreloaded(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this._generateKey(e,t),o=this.recentlyPreloaded.get(r);if(!o)return!1;let a=Date.now()-o<this.PRELOAD_GRACE_PERIOD;return a||this.recentlyPreloaded.delete(r),a}_markAsPreloaded(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this._generateKey(e,t);this.recentlyPreloaded.set(r,Date.now())}_generateKey(e,t){let r=e.toString(),o=this._simpleHash(r),a=t.length>0?JSON.stringify(t):"";return"".concat(o,"_").concat(a)}_simpleHash(e){let t=5381;for(let r=0;r<e.length;r++)t=(t<<5)+t+e.charCodeAt(r);return t>>>0}clearCache(){o.ZP.clear(),this.isPreloading=!1,this.preloadPromises.clear(),this.recentlyPreloaded.clear(),console.log("[CachePreloader] Cache cleared")}constructor(){this.isPreloading=!1,this.preloadPromises=new Map,this.recentlyPreloaded=new Map,this.PRELOAD_GRACE_PERIOD=5e3}}let g=new f;o.ZP.setPreloader(g),t.ZP=g}}]);
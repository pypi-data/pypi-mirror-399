FROM jdxcode/mise:latest

WORKDIR /app

COPY .config ./.config
COPY mise.toml ./mise.toml
RUN mise trust mise.toml

RUN mise install
RUN mise run docker-prepare || true

COPY . ./
ARG task
ARG MORTENLJ_MISE_LIB_VERSION
ARG MORTENLJ_MISE_LIB_CLEAN_VERSION
RUN mise run ${task}
RUN find > filelist.txt

[project]
name = "protobunny"
classifiers = [
  "Development Status :: 3 - Alpha",
  "Intended Audience :: Developers",
  "License :: OSI Approved :: MIT License",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Topic :: Communications",
  "Topic :: Software Development :: Libraries :: Application Frameworks",
  "Topic :: System :: Distributed Computing"
]
version = "0.1.2"
description = "A type-safe, sync/async Python messaging library."
authors = [
  {name = "Domenico Nappo", email = "domenico.nappo@am-flow.com"},
  {name = "Sander Koelstra", email = "sander.koelstra@am-flow.com.com"},
  {name = "Sem Mulder", email = "sem.mulder@am-flow.com"}
]
keywords = [
  "messaging",
  "protobuf",
  "queues",
  "mqtt",
  "amqp",
  "rabbitmq",
  "redis",
  "mosquitto",
  "nats"
]
requires-python = ">=3.10,<3.14"
readme = "README.md"
dependencies = [
  "betterproto[compiler]>=2.0.0b7,<3",
  "can-ada>=2.0.0",
  "click>=8.2.1",
  "grpcio-tools>=1.62.0,<2",
  "tomli ; python_version < '3.11'",
  "typing-extensions; python_version < '3.11'"
]

[project.optional-dependencies]
rabbitmq = ["aio-pika>=7.1.0"]
redis = ["redis<8"]
numpy = ["numpy>=1.26"]
mosquitto = ["aiomqtt>=2.4.0"]
nats = ["nats-py>=2.12.0"]

[project.scripts]
protobunny = "protobunny.wrapper:main"

[project.urls]
homepage = "https://am-flow.github.io/protobunny"
repository = "https://github.com/am-flow/protobunny"
issues = "https://github.com/am-flow/protobunny/issues"

[build-system]
requires = ["poetry-core>=1.0.0", "betterproto[compiler]==2.0.0b7", "grpcio-tools==1.76.0"]
build-backend = "setuptools.build_meta"

[dependency-groups]
dev = [
  "ipdb>=0.13.11,<0.14",
  "waiting>=1.5.0,<2",
  "ipython>=8.11.0,<9",
  "pytest>=7.2.2,<8",
  "pytest-env>=1.1.3",
  "pytest-cov>=4.0.0,<5",
  "pytest-mock>=3.14.0,<4",
  "pytest-asyncio>=0.23.7,<0.24",
  "ruff>=0.1.14,<0.2",
  "mypy>=1.9.0,<2",
  "types-protobuf>=4.25.0.20240410,<5",
  "yamllint>=1.37.1",
  "toml-sort>=0.24.3",
  "fakeredis>=2.33.0",
  "tox>=4.30.3",
  "flaky>=3.8.1"
]
docs = [
  "sphinx>=8.1.3",
  "sphinx-rtd-theme>=0.5.1",
  "furo>=2025.12.19",
  "pypandoc-binary>=1.16.2",
  "myst-parser>=4.0.1"
]

[tool.coverage.run]
omit = ["test.py", "*/tests/*"]
disable_warnings = ["couldnt-parse"]

[tool.mypy]
ignore_missing_imports = true
strict = true
exclude = "scripts|build|tests|todo"

[tool.protobunny]
messages-directory = "protobunny/protobuf"
generated-package-name = "protobunny.core"
generated-package-root = ""
force-required-fields = true
backend = "redis"
mode = "async"
log-task-in-redis = true
log-task-in-nats = true

[tool.pytest.ini_options]
addopts = "--junitxml=pytest_report.xml --cov=. --cov-report=term --cov-report=xml --cov-report html --no-success-flaky-report"
testpaths = ["./tests/"]
asyncio_mode = "auto"
markers = [
  "integration: tests requiring a real connection to the servers. They don't run with 'make test'"
]
cache_dir = ".cache/pytest"
log_cli_level = "DEBUG"

[tool.pytest_env]
RABBITMQ_HOST = "localhost"
RABBITMQ_PORT = 5672
RABBITMQ_USER = "guest"
RABBITMQ_PASS = "guest"
RABBITMQ_VHOST = "/test"
REDIS_HOST = "localhost"
REDIS_PORT = 6379
REDIS_USER = "default"
REDIS_PASS = "guest"
REDIS_VHOST = "11"
MQTT_HOST = "localhost"
MQTT_PORT = 1883

[tool.ruff]
select = ["F", "E", "W", "I", "T"]
line-length = 100
exclude = ["scripts"]
ignore = ["E501"]
cache-dir = ".cache/ruff"

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"

[tool.setuptools]
package-data = {"protobunny" = ["protobunny/protobuf/*.proto", "protobunny/__init__.py.j2", "protobunny/asyncio/__init__.py.j2", "scripts/*.py"]}

import{J as ve,ac as we,K as ye,r,f as ge,o as be,ag as $e,N as _,Q as ee,R as n,c as o,b as a,W as t,Y as Ve,aa as Ce,X as i,a as le,ad as ke,ah as oe,z as De}from"./index-CQ1e8Rg2.js";import{F as Fe,I as Ae,E as k,i as d,l as f,n as D,p as F,r as Se,o as T,q as M,_ as Ie}from"./_plugin-vue_export-helper-BT-Tziy0.js";import{L as Te}from"./VSelect-Dq3R77CJ.js";import{V as ne,a as ae}from"./LoadingSpinner.vue_vue_type_style_index_0_scoped_0c8a0411_lang-CFC-BkcE.js";import{V as Me}from"./VDataTable-BEubtEN7.js";import{V as ze,a as Ne}from"./VContainer-B7Xha58s.js";import{V as z}from"./VDialog-BGiUw7Oe.js";import{V as w}from"./VSpacer-D6LhfFl4.js";import{V as N,f as xe}from"./VMenu-CKVvE6pr.js";import{V as se}from"./VForm-DtaBZjhF.js";import{V as Ee}from"./VAutocomplete-BKQU6vnU.js";import{d as te}from"./VTextField-DXQqEL9v.js";import{V as ie}from"./VAlert-sJGLcmWj.js";import"./forwardRefs-CZ4-LRRh.js";const qe={class:"d-flex align-center justify-space-between flex-wrap ga-4"},Be={class:"text-h5 text-sm-h4 font-weight-bold mb-1"},Ue={class:"text-body-2 text-medium-emphasis mb-0"},Pe={class:"d-flex ga-2"},He={class:"d-none d-sm-inline ml-2"},Re={class:"d-none d-sm-inline ml-2"},Le={class:"d-flex align-center"},je={class:"d-flex flex-nowrap align-center"},Ge={class:"text-center py-8"},he={class:"text-h6 text-medium-emphasis"},Je={class:"text-body-2 text-medium-emphasis mb-4"},Ke={class:"flow-dropdown-title"},Qe={class:"flow-dropdown-selection"},We={class:"text-caption"},Xe={class:"text-caption"},Ye=ve({__name:"crons",setup(Oe){const y=we("showSnackbar",()=>{}),{t:A}=ye(),P=r([]),S=r(!1),x=r(!0),E=r(!1),g=r(!1),b=r(!1),u=r({flow_id:"",cron:""}),I=r(null),q=r(!1);r(new Set);const $=r(!1),p=r({id:"",cron:""}),B=r(!1),V=r(!1),m=r(null),U=r(!1),H=r({}),R=r([]),re=ge(()=>[{title:A("crons.tableHeaderFlow"),key:"flow_id"},{title:A("crons.tableHeaderSchedule"),key:"cron",width:"200px"},{title:A("crons.tableHeaderId"),key:"id",width:"250px"},{title:A("common.actions"),key:"actions",align:"end",sortable:!1,width:"160px"}]);be(async()=>{await L(),await C()}),$e(async()=>{await j()});const L=async()=>{try{const e=(await Fe.listFlowsApiV1FlowsGet({})).items||[],s=await Ae.listInstancesApiV1InstancesGet({}),v={};for(const c of s.items||[])v[c.id]=`${c.adapter_name} / ${c.identifier}`;const W={},X=[];for(const c of e){const Y=c.nodes.map(Z=>v[Z]||Z),Ze=Y.length>0?Y.join(" → "):"Empty",O=`${c.name} (${c.id})`;W[c.id]=O,X.push({id:c.id,displayName:O})}H.value=W,R.value=X}catch(l){console.error("Failed to load metadata",l)}},C=async()=>{S.value=!0;try{const l=await k.listCronsApiV1CronsGet({});P.value=l.items||[]}catch(l){console.error(l),y("Failed to load crons","error")}finally{S.value=!1,x.value=!1}},j=async()=>{await L(),await C()},de=l=>H.value[l]||l,G=()=>{u.value={flow_id:"",cron:""},g.value=!0},h=()=>{g.value=!1},J=async()=>{if(!(!u.value.flow_id||!u.value.cron)){E.value=!0;try{await k.createCronApiV1CronsPost({requestBody:u.value}),g.value=!1,await C()}catch(l){console.error(l),y("Failed to create cron","error")}finally{E.value=!1}}},ue=l=>{I.value=l,b.value=!0},me=async()=>{if(I.value){q.value=!0;try{await k.deleteCronApiV1CronsCronIdDelete({cronId:I.value.id}),b.value=!1,I.value=null,await C()}catch(l){console.error(l),y("Failed to delete cron","error")}finally{q.value=!1}}},ce=l=>{m.value=l,V.value=!0},fe=async()=>{if(!m.value)return;const l=m.value,e=!l.enabled;U.value=!0;try{await k.updateCronApiV1CronsCronIdPatch({cronId:l.id,requestBody:{enabled:e}}),l.enabled=e,V.value=!1,m.value=null}catch(s){console.error(s),y("Failed to update cron","error")}finally{U.value=!1}},pe=l=>{p.value={id:l.id,cron:l.cron},$.value=!0},K=()=>{$.value=!1},Q=async()=>{if(p.value.cron){B.value=!0;try{await k.updateCronApiV1CronsCronIdPatch({cronId:p.value.id,requestBody:{cron:p.value.cron}}),$.value=!1,await C()}catch(l){console.error(l),y("Failed to update cron","error")}finally{B.value=!1}}};return(l,e)=>(ee(),_(Ne,{fluid:""},{default:n(()=>[o(ne,{class:"mb-6"},{default:n(()=>[o(ae,{cols:"12"},{default:n(()=>[a("div",qe,[a("div",null,[a("h1",Be,t(l.$t("crons.title")),1),a("p",Ue,t(l.$t("crons.description")),1)]),a("div",Pe,[o(d,{color:"primary",variant:"tonal",icon:l.$vuetify.display.xs,onClick:j,loading:S.value},{default:n(()=>[o(f,{icon:"mdi-refresh"}),a("span",He,t(l.$t("common.refresh")),1)]),_:1},8,["icon","loading"]),o(d,{color:"primary",icon:l.$vuetify.display.xs,onClick:G},{default:n(()=>[o(f,{icon:"mdi-plus"}),a("span",Re,t(l.$t("crons.createCron")),1)]),_:1},8,["icon"])])])]),_:1})]),_:1}),o(ne,null,{default:n(()=>[o(ae,{cols:"12"},{default:n(()=>[o(D,{class:"card-outlined"},{default:n(()=>[x.value?(ee(),_(F,{key:0,class:"pa-0"},{default:n(()=>[o(Te,{text:l.$t("crons.loadingCrons")},null,8,["text"])]),_:1})):Ve("",!0),Ce(o(Me,{items:P.value,headers:re.value,loading:S.value,"items-per-page-text":l.$t("common.itemsPerPage"),"items-per-page-options":[10,25,50,100],class:"elevation-0"},{"item.flow_id":n(({item:s})=>[a("div",Le,[o(Se,{color:s.enabled?"primary":"grey",variant:"tonal",size:"32",class:"mr-3"},{default:n(()=>[o(f,{icon:"mdi-sitemap",size:"16"})]),_:1},8,["color"]),a("span",{class:le(["font-weight-medium",{"text-medium-emphasis":!s.enabled}])},t(de(s.flow_id)),3)])]),"item.cron":n(({item:s})=>[o(ze,{color:s.enabled?"info":"grey",variant:"tonal",size:"small",label:""},{default:n(()=>[o(f,{icon:"mdi-clock-outline",size:"small",class:"mr-1"}),i(" "+t(s.cron),1)]),_:2},1032,["color"])]),"item.id":n(({item:s})=>[a("code",{class:le(["text-caption",{"text-medium-emphasis":!s.enabled}])},t(s.id),3)]),"item.actions":n(({item:s})=>[a("div",je,[o(d,{icon:s.enabled?"mdi-pause":"mdi-play",variant:"text",size:"small",color:s.enabled?"warning":"success",onClick:v=>ce(s)},null,8,["icon","color","onClick"]),o(d,{icon:"mdi-pencil-outline",variant:"text",size:"small",onClick:v=>pe(s)},null,8,["onClick"]),o(d,{icon:"mdi-delete-outline",variant:"text",size:"small",color:"error",onClick:v=>ue(s)},null,8,["onClick"])])]),"no-data":n(()=>[a("div",Ge,[o(f,{icon:"mdi-clock-outline",size:"64",color:"medium-emphasis",class:"mb-4"}),a("div",he,t(l.$t("crons.noScheduledTasks")),1),a("div",Je,t(l.$t("crons.createCronJobToAutomateFlowExecution")),1),o(d,{color:"primary","prepend-icon":"mdi-plus",onClick:G},{default:n(()=>[i(t(l.$t("crons.createCron")),1)]),_:1})])]),_:1},8,["items","headers","loading","items-per-page-text"]),[[ke,!x.value]])]),_:1})]),_:1})]),_:1}),o(z,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s),"max-width":"500px",persistent:"",fullscreen:l.$vuetify.display.smAndDown},{default:n(()=>[o(D,{rounded:l.$vuetify.display.smAndDown?"0":"xl"},{default:n(()=>[o(T,{class:"d-flex align-center pa-4"},{default:n(()=>[o(f,{icon:"mdi-plus-circle",class:"mr-2"}),i(" "+t(l.$t("crons.createScheduledTask"))+" ",1),o(w),o(d,{icon:"mdi-close",variant:"text",size:"small",onClick:h})]),_:1}),o(N),o(F,{class:"pa-4"},{default:n(()=>[o(se,{ref:"form",onSubmit:oe(J,["prevent"])},{default:n(()=>[o(Ee,{modelValue:u.value.flow_id,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value.flow_id=s),items:R.value,"item-title":"displayName","item-value":"id",label:l.$t("crons.flow"),"prepend-inner-icon":"mdi-sitemap",rules:[s=>!!s||l.$t("common.required")],class:"mb-4"},{item:n(({props:s,item:v})=>[o(xe,De(s,{class:"flow-dropdown-item"}),{title:n(()=>[a("div",Ke,t(v.raw.displayName),1)]),_:2},1040)]),selection:n(({item:s})=>[a("div",Qe,t(s.raw.displayName),1)]),_:1},8,["modelValue","items","label","rules"]),o(te,{modelValue:u.value.cron,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.cron=s),label:l.$t("crons.cronExpression"),placeholder:"*/30 * * * *","prepend-inner-icon":"mdi-clock-outline",rules:[s=>!!s||l.$t("common.required")],hint:l.$t("crons.standardCronFormatHint"),"persistent-hint":""},null,8,["modelValue","label","rules","hint"]),o(ie,{type:"info",variant:"tonal",density:"compact",class:"mt-4"},{default:n(()=>[a("div",We,[a("strong",null,t(l.$t("crons.cronFieldsTitle")),1),e[9]||(e[9]=a("br",null,null,-1)),i(" • 5 "+t(l.$t("crons.fields"))+": ",1),e[10]||(e[10]=a("code",null,"min hr day month week",-1)),e[11]||(e[11]=a("br",null,null,-1)),i(" • 6 "+t(l.$t("crons.fields"))+": ",1),e[12]||(e[12]=a("code",null,"sec min hr day month week",-1)),e[13]||(e[13]=a("br",null,null,-1)),i(" • 7 "+t(l.$t("crons.fields"))+": ",1),e[14]||(e[14]=a("code",null,"sec min hr day month week year",-1)),e[15]||(e[15]=a("br",null,null,-1)),e[16]||(e[16]=a("br",null,null,-1)),a("strong",null,t(l.$t("crons.examples")),1),e[17]||(e[17]=a("br",null,null,-1)),e[18]||(e[18]=i(" • ",-1)),e[19]||(e[19]=a("code",null,"*/5 * * * *",-1)),i(" - "+t(l.$t("crons.everyFiveMinutes")),1),e[20]||(e[20]=a("br",null,null,-1)),e[21]||(e[21]=i(" • ",-1)),e[22]||(e[22]=a("code",null,"30 * * * * *",-1)),i(" - "+t(l.$t("crons.everyMinuteAt30s")),1),e[23]||(e[23]=a("br",null,null,-1)),e[24]||(e[24]=i(" • ",-1)),e[25]||(e[25]=a("code",null,"0 0 * * *",-1)),i(" - "+t(l.$t("crons.dailyAtMidnight")),1)])]),_:1})]),_:1},512)]),_:1}),o(N),o(M,{class:"pa-2 pa-sm-4"},{default:n(()=>[o(w),o(d,{variant:"text",onClick:h},{default:n(()=>[i(t(l.$t("common.cancel")),1)]),_:1}),o(d,{color:"primary",onClick:J,loading:E.value,disabled:!u.value.flow_id||!u.value.cron},{default:n(()=>[i(t(l.$t("common.create")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["rounded"])]),_:1},8,["modelValue","fullscreen"]),o(z,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=s=>b.value=s),"max-width":"400px",persistent:""},{default:n(()=>[o(D,{rounded:"xl"},{default:n(()=>[o(T,{class:"d-flex align-center pa-4"},{default:n(()=>[o(f,{icon:"mdi-alert-circle",color:"error",class:"mr-2"}),i(" "+t(l.$t("crons.deleteScheduledTask")),1)]),_:1}),o(F,null,{default:n(()=>[i(t(l.$t("crons.confirmDeleteMessage")),1)]),_:1}),o(M,{class:"pa-4"},{default:n(()=>[o(w),o(d,{variant:"text",onClick:e[3]||(e[3]=s=>b.value=!1)},{default:n(()=>[i(t(l.$t("common.cancel")),1)]),_:1}),o(d,{color:"error",variant:"tonal",onClick:me,loading:q.value},{default:n(()=>[i(t(l.$t("common.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(z,{modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=s=>$.value=s),"max-width":"500px",persistent:"",fullscreen:l.$vuetify.display.smAndDown},{default:n(()=>[o(D,{rounded:l.$vuetify.display.smAndDown?"0":"xl"},{default:n(()=>[o(T,{class:"d-flex align-center pa-4"},{default:n(()=>[o(f,{icon:"mdi-pencil",class:"mr-2"}),i(" "+t(l.$t("crons.editScheduledTask"))+" ",1),o(w),o(d,{icon:"mdi-close",variant:"text",size:"small",onClick:K})]),_:1}),o(N),o(F,{class:"pa-4"},{default:n(()=>[o(se,{ref:"editForm",onSubmit:oe(Q,["prevent"])},{default:n(()=>[o(te,{modelValue:p.value.cron,"onUpdate:modelValue":e[5]||(e[5]=s=>p.value.cron=s),label:l.$t("crons.cronExpression"),placeholder:"*/30 * * * *","prepend-inner-icon":"mdi-clock-outline",rules:[s=>!!s||l.$t("common.required")],hint:l.$t("crons.standardCronFormatHint"),"persistent-hint":""},null,8,["modelValue","label","rules","hint"]),o(ie,{type:"info",variant:"tonal",density:"compact",class:"mt-4"},{default:n(()=>[a("div",Xe,[a("strong",null,t(l.$t("crons.cronFieldsTitle")),1),e[26]||(e[26]=a("br",null,null,-1)),i(" • 5 "+t(l.$t("crons.fields"))+": ",1),e[27]||(e[27]=a("code",null,"min hr day month week",-1)),e[28]||(e[28]=a("br",null,null,-1)),i(" • 6 "+t(l.$t("crons.fields"))+": ",1),e[29]||(e[29]=a("code",null,"sec min hr day month week",-1)),e[30]||(e[30]=a("br",null,null,-1)),i(" • 7 "+t(l.$t("crons.fields"))+": ",1),e[31]||(e[31]=a("code",null,"sec min hr day month week year",-1)),e[32]||(e[32]=a("br",null,null,-1)),e[33]||(e[33]=a("br",null,null,-1)),a("strong",null,t(l.$t("crons.examples")),1),e[34]||(e[34]=a("br",null,null,-1)),e[35]||(e[35]=i(" • ",-1)),e[36]||(e[36]=a("code",null,"*/5 * * * *",-1)),i(" - "+t(l.$t("crons.everyFiveMinutes")),1),e[37]||(e[37]=a("br",null,null,-1)),e[38]||(e[38]=i(" • ",-1)),e[39]||(e[39]=a("code",null,"30 * * * * *",-1)),i(" - "+t(l.$t("crons.everyMinuteAt30s")),1),e[40]||(e[40]=a("br",null,null,-1)),e[41]||(e[41]=i(" • ",-1)),e[42]||(e[42]=a("code",null,"0 0 * * *",-1)),i(" - "+t(l.$t("crons.dailyAtMidnight")),1)])]),_:1})]),_:1},512)]),_:1}),o(N),o(M,{class:"pa-2 pa-sm-4"},{default:n(()=>[o(w),o(d,{variant:"text",onClick:K},{default:n(()=>[i(t(l.$t("common.cancel")),1)]),_:1}),o(d,{color:"primary",onClick:Q,loading:B.value,disabled:!p.value.cron},{default:n(()=>[i(t(l.$t("common.save")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["rounded"])]),_:1},8,["modelValue","fullscreen"]),o(z,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=s=>V.value=s),"max-width":"400px",persistent:""},{default:n(()=>[o(D,{rounded:"xl"},{default:n(()=>[o(T,{class:"d-flex align-center pa-4"},{default:n(()=>[o(f,{icon:m.value?.enabled?"mdi-pause":"mdi-play",color:m.value?.enabled?"warning":"success",class:"mr-2"},null,8,["icon","color"]),i(" "+t(m.value?.enabled?l.$t("crons.disableScheduledTask"):l.$t("crons.enableScheduledTask")),1)]),_:1}),o(F,null,{default:n(()=>[i(t(m.value?.enabled?l.$t("crons.confirmDisableMessage"):l.$t("crons.confirmEnableMessage")),1)]),_:1}),o(M,{class:"pa-4"},{default:n(()=>[o(w),o(d,{variant:"text",onClick:e[7]||(e[7]=s=>V.value=!1)},{default:n(()=>[i(t(l.$t("common.cancel")),1)]),_:1}),o(d,{color:m.value?.enabled?"warning":"success",variant:"tonal",onClick:fe,loading:U.value},{default:n(()=>[i(t(m.value?.enabled?l.$t("crons.disable"):l.$t("crons.enable")),1)]),_:1},8,["color","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),fl=Ie(Ye,[["__scopeId","data-v-35aee0ef"]]);export{fl as default};

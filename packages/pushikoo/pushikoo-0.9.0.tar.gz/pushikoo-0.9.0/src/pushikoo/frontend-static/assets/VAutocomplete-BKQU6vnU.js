import{e as Fe,f as De,d as W,g as Ae}from"./VTextField-DXQqEL9v.js";import{u as Pe,b as Re,c as Me,a as Ee,d as Le}from"./VSelect-Dq3R77CJ.js";import{x as _e,l as X,r as Te,g as Be,J as Ne}from"./_plugin-vue_export-helper-BT-Tziy0.js";import{u as ze,h as Ke,m as Oe}from"./VDataTable-BEubtEN7.js";import{f as Ue}from"./forwardRefs-CZ4-LRRh.js";import{l as He,d as $e,e as qe,f as j,V as Je,n as Ge}from"./VMenu-CKVvE6pr.js";import{g as We,p as Xe,a2 as je,r as L,s as w,q as $,a3 as Qe,f as V,t as Ye,w as _,F as Q,a9 as Ze,u as el,c as f,b as I,aG as ll,H as q,z as k,aH as al,n as tl,a as ul,X as nl,B as ol,aI as Y,aJ as Z}from"./index-CQ1e8Rg2.js";import{V as ee}from"./VContainer-B7Xha58s.js";const sl=Xe({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Oe({filterKeys:["title"]}),...Le(),...ol(Ae({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VAutocomplete"),hl=We()({name:"VAutocomplete",props:sl(),emits:{"update:focused":l=>!0,"update:search":l=>!0,"update:modelValue":l=>!0,"update:menu":l=>!0},setup(l,le){let{slots:i}=le;const{t:ae}=je(),p=L(),g=w(!1),h=w(!0),T=w(!1),J=L(),B=L(),o=w(-1),x=w(null),{items:N,transformIn:te,transformOut:ue}=He(l),{textColorClasses:ne,textColorStyles:oe}=_e(()=>p.value?.color),{InputIcon:se}=Fe(l),r=$(l,"search",""),a=$(l,"modelValue",[],e=>te(e===null?[null]:Qe(e)),e=>{const u=ue(e);return l.multiple?u:u[0]??null}),ie=V(()=>typeof l.counterValue=="function"?l.counterValue(a.value):typeof l.counterValue=="number"?l.counterValue:a.value.length),S=De(l),{filteredItems:z,getMatches:re}=ze(l,N,()=>x.value??(h.value?"":r.value)),b=V(()=>l.hideSelected&&x.value===null?z.value.filter(e=>!a.value.some(u=>u.value===e.value)):z.value),G=Ye(()=>l.closableChips&&!S.isReadonly.value&&!S.isDisabled.value),R=V(()=>!!(l.chips||i.chip)),F=V(()=>R.value||!!i.selection),ce=V(()=>a.value.map(e=>e.props.value)),D=V(()=>b.value.find(e=>e.type==="item"&&!e.props.disabled)),K=V(()=>(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&r.value===D.value?.title)&&b.value.length>0&&!h.value&&!T.value),M=V(()=>l.hideNoData&&!b.value.length||S.isReadonly.value||S.isDisabled.value),O=$(l,"menu"),c=V({get:()=>O.value,set:e=>{O.value&&!e&&J.value?.Î¨openChildren.size||e&&M.value||(O.value=e)}}),{menuId:ve,ariaExpanded:de,ariaControls:fe}=Pe(l,c),U=L(),me=Re(U,p);function pe(e){l.openOnClear&&(c.value=!0),r.value=""}function he(){M.value||(c.value=!0)}function ge(e){M.value||(g.value&&(e.preventDefault(),e.stopPropagation()),c.value=!c.value)}function ye(e){(Y(e)||e.key==="Backspace")&&p.value?.focus()}function Ve(e){if(S.isReadonly.value)return;const u=p.value?.selectionStart,v=a.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(c.value=!0),["Escape"].includes(e.key)&&(c.value=!1),K.value&&["Enter","Tab"].includes(e.key)&&D.value&&!a.value.some(n=>{let{value:d}=n;return d===D.value.value})&&C(D.value),e.key==="ArrowDown"&&K.value&&U.value?.focus("next"),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&F.value&&a.value.length>0&&!r.value)return C(a.value[0],!1);if(~o.value){e.preventDefault();const n=o.value;C(a.value[o.value],!1),o.value=n>=v-1?v-2:n}else e.key==="Backspace"&&!r.value&&(o.value=v-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(o.value<0&&u&&u>0)return;const n=o.value>-1?o.value-1:v-1;if(a.value[n])o.value=n;else{const d=r.value?.length??null;o.value=-1,p.value?.setSelectionRange(d,d)}}else if(e.key==="ArrowRight"){if(o.value<0)return;const n=o.value+1;a.value[n]?o.value=n:(o.value=-1,p.value?.setSelectionRange(0,0))}else~o.value&&Y(e)&&(o.value=-1)}function ke(e){if(Z(p.value,":autofill")||Z(p.value,":-webkit-autofill")){const u=N.value.find(v=>v.title===e.target.value);u&&C(u)}}function be(){l.eager&&B.value?.calculateVisibleItems()}function Ce(){g.value&&(h.value=!0,p.value?.focus()),x.value=null}function xe(e){g.value=!0,setTimeout(()=>{T.value=!0})}function Se(e){T.value=!1}function we(e){(e==null||e===""&&!l.multiple&&!F.value)&&(a.value=[])}const H=w(!1);function C(e){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const v=a.value.findIndex(d=>(l.valueComparator||Ne)(d.value,e.value)),n=u??!~v;if(~v){const d=n?[...a.value,e]:[...a.value];d.splice(v,1),a.value=d}else n&&(a.value=[...a.value,e]);l.clearOnSelect&&(r.value="")}else{const v=u!==!1;a.value=v?[e]:[],x.value=h.value?"":r.value??"",r.value=v&&!F.value?e.title:"",Q(()=>{c.value=!1,h.value=!0})}}return _(g,(e,u)=>{e!==u&&(e?(H.value=!0,r.value=l.multiple||F.value?"":String(a.value.at(-1)?.props.title??""),h.value=!0,Q(()=>H.value=!1)):(!l.multiple&&r.value==null&&(a.value=[]),c.value=!1,!h.value&&r.value&&(x.value=r.value),r.value="",o.value=-1))}),_(r,e=>{!g.value||H.value||(e&&(c.value=!0),h.value=!e)}),_(c,e=>{if(!l.hideSelected&&e&&a.value.length&&h.value){const u=b.value.findIndex(v=>a.value.some(n=>v.value===n.value));Ze&&window.requestAnimationFrame(()=>{u>=0&&B.value?.scrollToIndex(u)})}e&&(x.value=null)}),_(N,(e,u)=>{c.value||g.value&&!u.length&&e.length&&(c.value=!0)}),el(()=>{const e=!!(!l.hideNoData||b.value.length||i["prepend-item"]||i["append-item"]||i["no-data"]),u=a.value.length>0,v=W.filterProps(l);return f(W,k({ref:p},v,{modelValue:r.value,"onUpdate:modelValue":[n=>r.value=n,we],focused:g.value,"onUpdate:focused":n=>g.value=n,validationValue:a.externalValue,counterValue:ie.value,dirty:u,onChange:ke,class:["v-autocomplete",`v-autocomplete--${l.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":c.value,"v-autocomplete--chips":!!l.chips,"v-autocomplete--selection-slot":!!F.value,"v-autocomplete--selecting-index":o.value>-1},l.class],style:l.style,readonly:S.isReadonly.value,placeholder:u?void 0:l.placeholder,"onClick:clear":pe,"onMousedown:control":he,onKeydown:Ve,"aria-expanded":de.value,"aria-controls":fe.value}),{...i,default:n=>{let{id:d}=n;return I(q,null,[f($e,k({id:ve.value,ref:J,modelValue:c.value,"onUpdate:modelValue":s=>c.value=s,activator:"parent",contentClass:"v-autocomplete__content",disabled:M.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:be,onAfterLeave:Ce},l.menuProps),{default:()=>[e&&f(qe,k({ref:U,filterable:!0,selected:ce.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:s=>s.preventDefault(),onKeydown:ye,onFocusin:xe,onFocusout:Se,tabindex:"-1",selectable:!0,"aria-live":"polite","aria-labelledby":`${d.value}-label`,"aria-multiselectable":l.multiple,color:l.itemColor??l.color},me,l.listProps),{default:()=>[i["prepend-item"]?.(),!b.value.length&&!l.hideNoData&&(i["no-data"]?.()??f(j,{key:"no-data",title:ae(l.noDataText)},null)),f(Me,{ref:B,renderless:!0,items:b.value,itemKey:"value"},{default:s=>{let{item:t,index:y,itemRef:E}=s;const A=k(t.props,{ref:E,key:t.value,active:K.value&&t===D.value?!0:void 0,onClick:()=>C(t,null),"aria-posinset":y+1,"aria-setsize":b.value.length});return t.type==="divider"?i.divider?.({props:t.raw,index:y})??f(Je,k(t.props,{key:`divider-${y}`}),null):t.type==="subheader"?i.subheader?.({props:t.raw,index:y})??f(Ge,k(t.props,{key:`subheader-${y}`}),null):i.item?.({item:t,index:y,props:A})??f(j,k(A,{role:"option"}),{prepend:P=>{let{isSelected:m}=P;return I(q,null,[l.multiple&&!l.hideSelected?f(Ee,{key:t.value,modelValue:m,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Ie=>Ie.preventDefault()},null):void 0,t.props.prependAvatar&&f(Te,{image:t.props.prependAvatar},null),t.props.prependIcon&&f(X,{icon:t.props.prependIcon},null)])},title:()=>h.value?t.title:Ke("v-autocomplete",t.title,re(t)?.title)})}}),i["append-item"]?.()]})]}),a.value.map((s,t)=>{function y(m){m.stopPropagation(),m.preventDefault(),C(s,!1)}const E=k(ee.filterProps(s.props),{"onClick:close":y,onKeydown(m){m.key!=="Enter"&&m.key!==" "||(m.preventDefault(),m.stopPropagation(),y(m))},onMousedown(m){m.preventDefault(),m.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),A=R.value?!!i.chip:!!i.selection,P=A?al(R.value?i.chip({item:s,index:t,props:E}):i.selection({item:s,index:t})):void 0;if(!(A&&!P))return I("div",{key:s.value,class:ul(["v-autocomplete__selection",t===o.value&&["v-autocomplete__selection--selected",ne.value]]),style:tl(t===o.value?oe.value:{})},[R.value?i.chip?f(Be,{key:"chip-defaults",defaults:{VChip:{closable:G.value,size:"small",text:s.title}}},{default:()=>[P]}):f(ee,k({key:"chip",closable:G.value,size:"small",text:s.title,disabled:s.props.disabled},E),null):P??I("span",{class:"v-autocomplete__selection-text"},[s.title,l.multiple&&t<a.value.length-1&&I("span",{class:"v-autocomplete__selection-comma"},[nl(",")])])])})])},"append-inner":function(){for(var n=arguments.length,d=new Array(n),s=0;s<n;s++)d[s]=arguments[s];return I(q,null,[i["append-inner"]?.(...d),l.menuIcon?f(X,{class:"v-autocomplete__menu-icon",color:p.value?.fieldIconColor,icon:l.menuIcon,onMousedown:ge,onClick:ll,"aria-hidden":!0,tabindex:"-1"},null):void 0,l.appendInnerIcon&&f(se,{key:"append-icon",name:"appendInner",color:d[0].iconColor.value},null)])}})}),Ue({isFocused:g,isPristine:h,menu:c,search:r,filteredItems:z,select:C},p)}});export{hl as V};

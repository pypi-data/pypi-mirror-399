"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[5768],{25768:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var r=n(71155),i=n(72490),o=n(31725),s=n(82780);const a=new s.Token("@jupyterlab/markdownviewer:IMarkdownViewerTracker","A widget tracker for markdown\n  document viewers. Use this if you want to iterate over and interact with rendered markdown documents.");var d=n(65321),c=n(80757),h=n(449),l=n(50713),u=n(28607);const p="text/markdown";class m extends u.Widget{constructor(e){super(),this._config={...m.defaultConfig},this._fragment="",this._ready=new s.PromiseDelegate,this._isRendering=!1,this._renderRequested=!1,this._rendered=new l.Signal(this),this.context=e.context,this.translator=e.translator||h.nullTranslator,this._trans=this.translator.load("jupyterlab"),this.renderer=e.renderer,this.node.tabIndex=0,this.addClass("jp-MarkdownViewer"),(this.layout=new u.StackedLayout).addWidget(this.renderer),this.context.ready.then((async()=>{await this._render(),this._monitor=new o.ActivityMonitor({signal:this.context.model.contentChanged,timeout:this._config.renderTimeout}),this._monitor.activityStopped.connect(this.update,this),this._ready.resolve(void 0)}))}get ready(){return this._ready.promise}get rendered(){return this._rendered}setFragment(e){this._fragment=e,this.update()}setOption(e,t){if(this._config[e]===t)return;this._config[e]=t;const{style:n}=this.renderer.node;switch(e){case"fontFamily":n.setProperty("font-family",t);break;case"fontSize":n.setProperty("font-size",t?t+"px":null);break;case"hideFrontMatter":this.update();break;case"lineHeight":n.setProperty("line-height",t?t.toString():null);break;case"lineWidth":{const e=t?`calc(50% - ${t/2}ch)`:null;n.setProperty("padding-left",e),n.setProperty("padding-right",e);break}case"renderTimeout":this._monitor&&(this._monitor.timeout=t)}}dispose(){this.isDisposed||(this._monitor&&this._monitor.dispose(),this._monitor=null,super.dispose())}onUpdateRequest(e){this.context.isReady&&!this.isDisposed&&(this._render(),this._fragment="")}onActivateRequest(e){this.node.focus()}async _render(){if(this.isDisposed)return;if(this._isRendering)return void(this._renderRequested=!0);this._renderRequested=!1;const{context:e}=this,{model:t}=e,n=t.toString(),r={};r[p]=this._config.hideFrontMatter?f.removeFrontMatter(n):n;const o=new c.MimeModel({data:r,metadata:{fragment:this._fragment}});try{if(this._isRendering=!0,await this.renderer.renderModel(o),this._isRendering=!1,this._renderRequested)return this._render();this._rendered.emit()}catch(t){requestAnimationFrame((()=>{this.dispose()})),(0,i.showErrorMessage)(this._trans.__("Renderer Failure: %1",e.path),t)}}}!function(e){e.defaultConfig={fontFamily:null,fontSize:null,lineHeight:null,lineWidth:null,hideFrontMatter:!0,renderTimeout:1e3}}(m||(m={}));class g extends d.DocumentWidget{setFragment(e){this.content.setFragment(e)}}class w extends d.ABCWidgetFactory{constructor(e){super(f.createRegistryOptions(e)),this._fileType=e.primaryFileType,this._rendermime=e.rendermime}createNewWidget(e){var t,n,r,i,o;const s=this._rendermime.clone({resolver:e.urlResolver}).createRenderer(p),a=new m({context:e,renderer:s});return a.title.icon=null===(t=this._fileType)||void 0===t?void 0:t.icon,a.title.iconClass=null!==(r=null===(n=this._fileType)||void 0===n?void 0:n.iconClass)&&void 0!==r?r:"",a.title.iconLabel=null!==(o=null===(i=this._fileType)||void 0===i?void 0:i.iconLabel)&&void 0!==o?o:"",a.title.caption=this.label,new g({content:a,context:e})}}var f;!function(e){e.createRegistryOptions=function(e){return{...e,readOnly:!0}},e.removeFrontMatter=function(e){const t=e.match(/^---\n[^]*?\n(---|...)\n/);if(!t)return e;const{length:n}=t[0];return e.slice(n)}}(f||(f={}));var y=n(64638),_=n(86752),v=n(15836),k=n(93321);class b extends y.T{constructor(e,t,n){super(e,n),this.parser=t}get documentType(){return"markdown-viewer"}get isAlwaysActive(){return!0}get supportedOptions(){return["maximalDepth","numberingH1","numberHeaders"]}async getHeadings(){const e=this.widget.context.model.toString(),t=await _.ZX(e,this.parser),n=v.uQ(t,{...this.configuration,baseNumbering:1});return Promise.resolve(n)}}class x extends k.K{constructor(e,t,n){super(e),this.parser=t,this.sanitizer=n}_createNew(e,t){const n=new b(e,this.parser,t);let r=new WeakMap;const i=(t,n)=>{if(n){const t=r.get(n);if(t){const n=e.content.node.getBoundingClientRect(),r=t.getBoundingClientRect();(r.top>n.bottom||r.bottom<n.top)&&t.scrollIntoView({block:"center"})}else console.warn("Heading element not found for heading",n,"in widget",e)}},o=()=>{this.parser&&(v.xg(e.content.node),r=new WeakMap,n.headings.forEach((async t=>{var n;const i=await _.oQ(this.parser,t.raw,t.level,this.sanitizer);if(!i)return;const o=`h${t.level}[id="${CSS.escape(i)}"]`;r.set(t,v.Mh(e.content.node,o,null!==(n=t.prefix)&&void 0!==n?n:""))})))};return e.content.ready.then((()=>{o(),e.content.rendered.connect(o),n.activeHeadingChanged.connect(i),n.headingsChanged.connect(o),e.disposed.connect((()=>{e.content.rendered.disconnect(o),n.activeHeadingChanged.disconnect(i),n.headingsChanged.disconnect(o)}))})),n}}var R,T=n(37521),C=n(36549);!function(e){e.markdownPreview="markdownviewer:open",e.markdownEditor="markdownviewer:edit"}(R||(R={}));const M="Markdown Preview",F={activate:function(e,t,n,r,s,a,d){const h=n.load("jupyterlab"),{commands:l,docRegistry:u}=e;t.addFactory(c.markdownRendererFactory);const p=new i.WidgetTracker({namespace:"markdownviewer-widget"});let g={...m.defaultConfig};function f(e){Object.keys(g).forEach((t=>{var n;e.setOption(t,null!==(n=g[t])&&void 0!==n?n:null)}))}if(s){const e=e=>{g=e.composite,p.forEach((e=>{f(e.content)}))};s.load(F.id).then((t=>{t.changed.connect((()=>{e(t)})),e(t)})).catch((e=>{console.error(e.message)}))}const y=new w({rendermime:t,name:M,label:h.__("Markdown Preview"),primaryFileType:u.getFileType("markdown"),fileTypes:["markdown"],defaultRendered:["markdown"]});return y.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{p.save(t)})),f(t.content),p.add(t)})),u.addWidgetFactory(y),r&&r.restore(p,{command:"docmanager:open",args:e=>({path:e.context.path,factory:M}),name:e=>e.context.path}),l.addCommand(R.markdownPreview,{label:h.__("Markdown Preview"),execute:e=>{const t=e.path;if("string"==typeof t)return l.execute("docmanager:open",{path:t,factory:M,options:e.options})},describedBy:{args:{type:"object",properties:{path:{type:"string",description:h.__("The path to the markdown file to preview")},options:{type:"object",description:h.__("Options for opening the preview")}},required:["path"]}}}),l.addCommand(R.markdownEditor,{execute:()=>{const e=p.currentWidget;if(!e)return;const t=e.context.path;return l.execute("docmanager:open",{path:t,factory:"Editor",options:{mode:"split-right"}})},isVisible:()=>{const e=p.currentWidget;return e&&".md"===o.PathExt.extname(e.context.path)||!1},label:h.__("Show Markdown Editor"),describedBy:{args:{type:"object",properties:{}}}}),a&&a.add(new x(p,t.markdownParser,null!=d?d:t.sanitizer)),p},id:"@jupyterlab/markdownviewer-extension:plugin",description:"Adds markdown file viewer and provides its tracker.",provides:a,requires:[c.IRenderMimeRegistry,h.ITranslator],optional:[r.ILayoutRestorer,T.ISettingRegistry,C.cv,i.ISanitizer],autoStart:!0},P=F}}]);
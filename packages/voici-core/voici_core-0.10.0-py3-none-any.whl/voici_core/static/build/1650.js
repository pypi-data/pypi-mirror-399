"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[1650],{4256:(e,t,s)=>{s.r(t),s.d(t,{IServiceWorkerManager:()=>C,IWorkspaceRouter:()=>L,IndexedDBDataConnector:()=>k,LiteLicensesClient:()=>o,LitePluginListModel:()=>v,LiteTranslatorConnector:()=>f,LiteWorkspaceManager:()=>D,SERVICE_WORKER_BROADCAST_CHANNEL_ID:()=>E,ServiceWorkerManager:()=>I,THIRD_PARTY_LICENSES:()=>n,WORKER_NAME:()=>S});var i=s(72490),a=s(31725);const n="third-party-licenses.json",r=Object.freeze({packages:[]});class o extends i.Licenses.LicensesClient{async getBundles(){return{bundles:{...await this._getFederated(),[this.appName]:await this._getAppLicenses()}}}async download(e){const t=document.createElement("a");t.href=await this._getDownloadLink(e);const s="markdown"===e.format?"md":e.format;t.download=`jupyterlite-licenses.${s}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}get appName(){return a.PageConfig.getOption("appName")||"JupyterLite"}get appLicensesUrl(){return a.URLExt.join(a.PageConfig.getBaseUrl(),"build",n)}get labExtensionsUrl(){return a.PageConfig.getOption("fullLabextensionsUrl")}async _getDownloadLink(e){const t=await this.getBundles();let s,i;switch(e.format){case"json":default:s=JSON.stringify(t,null,2),i="application/json";break;case"markdown":s=this._formatAsMarkdown(t),i="text/markdown";break;case"csv":s=this._formatAsCSV(t),i="text/csv"}const a=new Blob([s],{type:i});return URL.createObjectURL(a)}_formatAsMarkdown(e){let t="# Third-Party Licenses\n\n";for(const[s,i]of Object.entries(e.bundles)){t+=`## ${s}\n\n`;for(const e of i.packages)t+=`### ${e.name}${e.versionInfo?` ${e.versionInfo}`:""}\n\n`,e.licenseId&&(t+=`**License ID:** ${e.licenseId}\n\n`),e.extractedText&&(t+=`\`\`\`\n${e.extractedText}\n\`\`\`\n\n`)}return t}_formatAsCSV(e){let t=`${["Bundle","Package","Version","License ID","License Text"].join(",")}\n`;for(const[s,i]of Object.entries(e.bundles))for(const e of i.packages)t+=`${[this._escapeCSVField(s),this._escapeCSVField(e.name),this._escapeCSVField(e.versionInfo||""),this._escapeCSVField(e.licenseId||""),this._escapeCSVField(e.extractedText||"")].join(",")}\n`;return t}_escapeCSVField(e){return e&&(e.includes(",")||e.includes('"')||e.includes("\n"))?`"${e.replace(/"/g,'""')}"`:e}async _getAppLicenses(){let e=r;try{e=(await fetch(this.appLicensesUrl)).json()}catch(e){console.warn("Could not resolve licenses for",this.appName)}return e}async _getFederated(){const e={};let t;try{t=JSON.parse(a.PageConfig.getOption("federated_extensions"))}catch{return e}const s=[];for(const i of t)s.push(this._getOneFederated(i,e));try{await Promise.all(s)}catch(e){console.warn("Error resolving licenses",e)}return e}async _getOneFederated(e,t){try{const s=a.URLExt.join(this.labExtensionsUrl,e.name,"static",n),i=await fetch(s);t[e.name]=await i.json()}catch{console.warn("Could not resolve licenses for",e),t[e.name]=r}}}var l=s(30470),c=s(23265),d=s(50713),h=s(82780),g=s(449),u=s(59407);function p(e){return u.createElement("div",{className:"jp-pluginmanager-PluginInUseMessage"},e.trans.__('While the plugin "%1" is not required by other enabled plugins, some plugins provide optional features depending on it. These plugins are:',e.plugin.id),u.createElement("ul",null,e.optionalDependants.map((e=>u.createElement("li",{key:"optionalDependantsDialog-"+e.id},e.id)))),e.trans.__("Do you want to disable it anyway?"))}class _ extends c.VDomModel{constructor(e){var t,s,i;super(),this.statusError=null,this.actionError=null,this._trackerDataChanged=new d.Signal(this),this._isLoading=!1,this._pendingActions=[],this._ready=new h.PromiseDelegate,this._pluginData=e.pluginData,this._serverSettings=e.serverSettings||l.ServerConnection.makeSettings(),this._query=e.query||"",this._isDisclaimed=null!==(t=e.isDisclaimed)&&void 0!==t&&t,this._extraLockedPlugins=null!==(s=e.extraLockedPlugins)&&void 0!==s?s:[],this.refresh().then((()=>this._ready.resolve())).catch((e=>this._ready.reject(e))),this._trans=(null!==(i=e.translator)&&void 0!==i?i:g.nullTranslator).load("jupyterlab")}get available(){return[...this._available.values()]}get isLoading(){return this._isLoading}get isDisclaimed(){return this._isDisclaimed}set isDisclaimed(e){e!==this._isDisclaimed&&(this._isDisclaimed=e,this.stateChanged.emit(),this._trackerDataChanged.emit(void 0))}get query(){return this._query}set query(e){this._query!==e&&(this._query=e,this.stateChanged.emit(),this._trackerDataChanged.emit(void 0))}get trackerDataChanged(){return this._trackerDataChanged}get ready(){return this._ready.promise}async enable(e){if(!this.isDisclaimed)throw new Error("User has not confirmed the disclaimer");await this._performAction("enable",e),e.enabled=!0}async disable(e){if(!this.isDisclaimed)throw new Error("User has not confirmed the disclaimer");const{dependants:t,optionalDependants:s}=this.getDependants(e);if(t.length>0)(0,i.showDialog)({title:this._trans.__("This plugin is required by other plugins"),body:(a={plugin:e,dependants:t,trans:this._trans},u.createElement(u.Fragment,null,a.trans.__('The plugin "%1" cannot be disabled as it is required by other plugins:',a.plugin.id),u.createElement("ul",null,a.dependants.map((e=>u.createElement("li",{key:"dependantsDialog-"+e.id},e.id)))),a.trans.__("Please disable the dependent plugins first."))),buttons:[i.Dialog.okButton()]});else{var a;if(s.length>0&&!(await(0,i.showDialog)({title:this._trans.__("This plugin is used by other plugins"),body:p({plugin:e,optionalDependants:s,trans:this._trans}),buttons:[i.Dialog.okButton({label:this._trans.__("Disable anyway")}),i.Dialog.cancelButton()]})).button.accept)return;await this._performAction("disable",e),this.actionError||(e.enabled=!1)}}getDependants(e){const t=[],s=[];if(e.provides){const i=e.provides.name;for(const e of this._available.values())e.enabled&&(e.requires.filter((e=>!!e)).some((e=>e.name===i))&&t.push(e),e.optional.filter((e=>!!e)).some((e=>e.name===i))&&s.push(e))}return{dependants:t,optionalDependants:s}}hasPendingActions(){return this._pendingActions.length>0}_performAction(e,t){this.actionError=null;const s=this._requestAPI({},{method:"POST",body:JSON.stringify({cmd:e,plugin_name:t.id})});return s.catch((e=>{this.actionError=e.toString()})),this._addPendingAction(s),s}_addPendingAction(e){this._pendingActions.push(e);const t=()=>{const t=this._pendingActions.indexOf(e);this._pendingActions.splice(t,1),this.stateChanged.emit(void 0)};e.then(t,t),this.stateChanged.emit(void 0)}async refresh(){var e;this.statusError=null,this._isLoading=!0,this.stateChanged.emit();try{const t={allLocked:!0,lockRules:[]},s=null!==(e=await this._requestAPI())&&void 0!==e?e:t;this._available=new Map(this._pluginData.availablePlugins.map((e=>{let t=e.provides?e.provides.name.split(":")[1]:void 0;return e.provides&&!t&&(t=e.provides.name),[e.id,{...e,locked:this._isLocked(e.id,s),tokenLabel:t}]})))}catch(e){this.statusError=e.toString()}finally{this._isLoading=!1,this.stateChanged.emit()}}_isLocked(e,t){if(t.allLocked)return!0;if(this._extraLockedPlugins.includes(e))return!0;const s=e.split(":")[0];return!!t.lockRules.includes(s)||!!t.lockRules.includes(e)}async _requestAPI(e={},t={}){const s=this._serverSettings,i=a.URLExt.join(s.baseUrl,"lab/api/plugins");let n;try{n=await l.ServerConnection.makeRequest(i+a.URLExt.objectToQueryString(e),t,s)}catch(e){throw new l.ServerConnection.NetworkError(e)}let r=await n.text();if(r.length>0)try{r=JSON.parse(r)}catch(e){console.log("Not a JSON response body.",n)}if(!n.ok)throw new l.ServerConnection.ResponseError(n,r.message||r);return r}}class v extends _{constructor(e){super(e),this._availablePlugins=e.pluginData.availablePlugins.map((e=>{let t=e.provides?e.provides.name.split(":")[1]:void 0;return e.provides&&!t&&(t=e.provides.name),{...e,tokenLabel:t,locked:!0,enabled:!0}}))}get available(){return this._availablePlugins}async refresh(){}async enable(e){}async disable(e){}}var w=s(41670);const m="all";class f extends w.DataConnector{constructor(){super(...arguments),this._prevLocale=""}async fetch(e){var t;const s=null!==(t=null==e?void 0:e.language)&&void 0!==t?t:"";let i=s;"default"===s?i="en":""===s&&(i=m);const n=a.URLExt.join(a.PageConfig.getBaseUrl(),`api/translations/${i}.json`);try{const e=await fetch(n),t=JSON.parse(await e.text());if(this._prevLocale!==m&&i===m){const e=this._prevLocale;t.data[e].displayName=t.data[e].nativeName,"en"!==e&&(t.data.en.displayName=`${t.data.en.nativeName} (default)`)}return this._prevLocale=i,t}catch(e){return i?{data:{},message:`Language pack '${i}' not installed!`}:{data:{en:{displayName:"English",nativeName:"English"}},message:""}}}}const y="JupyterLite Storage";class k{constructor(e){this._storageName=y,this._storageDrivers=null,this._localforage=e.localforage,this._storageName=e.storageName||y,this._storageDrivers=e.storageDrivers||null,this._ready=new h.PromiseDelegate,this.initialize().catch(console.warn)}async initialize(){await this.initStorage(),this._ready.resolve(void 0)}get storage(){return this._ready.promise.then((()=>this._storage))}async initStorage(){this._storage=this.createStorage()}get defaultStorageOptions(){const e=this._storageDrivers&&this._storageDrivers.length?this._storageDrivers:null;return{version:1,name:this._storageName,...e?{driver:e}:{}}}createStorage(){return this._localforage.createInstance({description:"Offline Storage for StateDB",storeName:"statedb",...this.defaultStorageOptions})}async fetch(e){const t=await(await this.storage).getItem(e);if(!t)throw new Error(`Failed to fetch id ${e} from StateDB`);return t}async list(e=""){const t=await this.storage,s={};for(const e of await t.keys())s[e]=await t.getItem(e);return Object.keys(s).reduce(((t,i)=>(""!==e&&e!==i.split(":")[0]||(t.ids.push(i),t.values.push(s[i])),t)),{ids:[],values:[]})}async remove(e){await(await this.storage).removeItem(e)}async save(e,t){await(await this.storage).setItem(e,t)}}const b=s.p+"service-worker.js",C=new h.Token("@jupyterlite/apputils:IServiceWorkerManager","The service worker manager"),S=`${b}`.split("/").slice(-1)[0];class D extends k{constructor(e){super({...e}),this._workspacesApiUrl=a.PageConfig.getOption("workspacesApiUrl")||a.URLExt.join(a.PageConfig.getBaseUrl(),"api/workspaces"),this.serverSettings=e.settings||l.ServerConnection.makeSettings()}async fetch(e){try{const t=await super.fetch(e);if(t)return t}catch(e){console.warn("Failed to fetch workspace from local storage:",e)}try{const t=await this._getServerWorkspaces();if(t[e])return t[e]}catch(e){console.warn("Failed to fetch workspace from server:",e)}throw new Error(`Workspace with id '${e}' not found`)}async list(){var e;let t={};try{t=await this._getServerWorkspaces()}catch(e){console.warn("Failed to fetch workspaces from server:",e)}const s=await super.list(),i={...t};for(const t of s.values)(null===(e=t.metadata)||void 0===e?void 0:e.id)&&(i[t.metadata.id]=t);return{ids:Object.keys(i),values:Object.values(i)}}async clear(){await(await this.storage).clear()}async _getServerWorkspaces(){const e=a.URLExt.join(this._workspacesApiUrl,"all.json"),t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch workspaces: ${t.status} ${t.statusText}`);return await t.json()}}const L=new h.Token("@jupyterlite/apputils:IWorkspaceRouter");var x=s(23227);const E="/sw-api.v1",P=a.PageConfig.getOption("appVersion");class I{constructor(e){var t;this._onBroadcastMessage=async e=>{const{data:t,browsingContextId:s,requestId:i,pathname:a}=e.data;s===this._browsingContextId&&(a.includes("/api/stdin/")?this._onStdinMessage(a,t):this._onDriveMessage(t,i))},this._onDriveMessage=async(e,t)=>{const s=await this._driveContentsProcessor.processDriveRequest(e);this._broadcastChannel.postMessage({response:s,browsingContextId:this._browsingContextId,requestId:t})},this._onStdinMessage=async(e,t)=>{const s=e.slice(e.lastIndexOf("/")+1),i=this._stdinHandlers.get(s);if(void 0!==i){const e=await i(t);this._broadcastChannel.postMessage({response:e,browsingContextId:this._browsingContextId})}else console.warn(`No stdin handler registered for '${e}'`)},this._registration=null,this._registrationChanged=new d.Signal(this),this._ready=new h.PromiseDelegate,this._stdinHandlers=new Map;const s=null!==(t=e.workerUrl)&&void 0!==t?t:a.URLExt.join(a.PageConfig.getBaseUrl(),S),i=new URL(s,window.location.href),n=a.PageConfig.getOption("enableServiceWorkerCache")||"false";i.searchParams.set("enableCache",n),this._browsingContextId=h.UUID.uuid4(),this._contents=e.contents,this._broadcastChannel=new BroadcastChannel(E),this._broadcastChannel.addEventListener("message",this._onBroadcastMessage),this._driveContentsProcessor=new x.DriveContentsProcessor({contentsManager:this._contents}),this._initialize(i.href).catch(console.warn)}get registrationChanged(){return this._registrationChanged}get enabled(){return null!==this._registration}get browsingContextId(){return this._browsingContextId}get ready(){return this._ready.promise}registerStdinHandler(e,t){this._stdinHandlers.set(e,t)}async _initialize(e){const{serviceWorker:t}=navigator;let s=null;if(t){if(t.controller){const e=t.controller.scriptURL;await this._unregisterOldServiceWorkers(e),s=await t.getRegistration(e)||null,console.info("JupyterLite ServiceWorker was already registered")}if(!s&&t)try{console.info("Registering new JupyterLite ServiceWorker",e),s=await t.register(e),console.info("JupyterLite ServiceWorker was sucessfully registered")}catch(e){console.warn(e),console.warn(`JupyterLite ServiceWorker registration unexpectedly failed: ${e}`)}this._setRegistration(s),s?(this._ready.resolve(void 0),setTimeout(this._pingServiceWorker,2e4)):this._ready.reject(void 0)}else console.warn("ServiceWorkers not supported in this browser")}async _unregisterOldServiceWorkers(e){const t=`${e}-version`,s=localStorage.getItem(t);if(s&&s!==P||!s){console.info("New version, unregistering existing service workers.");const e=await navigator.serviceWorker.getRegistrations();await Promise.all(e.map((e=>e.unregister()))),console.info("All existing service workers have been unregistered.")}localStorage.setItem(t,P)}async _pingServiceWorker(){const e=await fetch("/api/service-worker-heartbeat");"ok"===await e.text()&&setTimeout(this._pingServiceWorker,2e4)}_setRegistration(e){this._registration=e,this._registrationChanged.emit(this._registration)}}}}]);
# This file was auto-generated by Fern from our API Definition.

import typing

from ..core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ..core.request_options import RequestOptions
from ..types.chat_event_request import ChatEventRequest
from ..types.chat_message_request import ChatMessageRequest
from ..types.chat_room_request import ChatRoomRequest
from ..types.participant_request import ParticipantRequest
from .raw_client import AsyncRawAgentApiClient, RawAgentApiClient
from .types.add_agent_chat_participant_response import AddAgentChatParticipantResponse
from .types.create_agent_chat_event_response import CreateAgentChatEventResponse
from .types.create_agent_chat_message_response import CreateAgentChatMessageResponse
from .types.create_agent_chat_response import CreateAgentChatResponse
from .types.get_agent_chat_context_response import GetAgentChatContextResponse
from .types.get_agent_chat_response import GetAgentChatResponse
from .types.get_agent_me_response import GetAgentMeResponse
from .types.get_agent_next_message_response import GetAgentNextMessageResponse
from .types.list_agent_chat_participants_response import ListAgentChatParticipantsResponse
from .types.list_agent_chats_response import ListAgentChatsResponse
from .types.list_agent_messages_request_status import ListAgentMessagesRequestStatus
from .types.list_agent_messages_response import ListAgentMessagesResponse
from .types.list_agent_peers_response import ListAgentPeersResponse
from .types.mark_agent_message_failed_response import MarkAgentMessageFailedResponse
from .types.mark_agent_message_processed_response import MarkAgentMessageProcessedResponse
from .types.mark_agent_message_processing_response import MarkAgentMessageProcessingResponse
from .types.remove_agent_chat_participant_response import RemoveAgentChatParticipantResponse

# this is used as the default value for optional parameters
OMIT = typing.cast(typing.Any, ...)


class AgentApiClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawAgentApiClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> RawAgentApiClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawAgentApiClient
        """
        return self._raw_client

    def list_agent_chats(
        self,
        *,
        page: typing.Optional[int] = None,
        page_size: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ListAgentChatsResponse:
        """
        Lists chat rooms where the current agent is a participant

        Parameters
        ----------
        page : typing.Optional[int]
            Page number

        page_size : typing.Optional[int]
            Items per page

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ListAgentChatsResponse
            Agent's chat rooms

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.list_agent_chats(
            page=1,
            page_size=1,
        )
        """
        _response = self._raw_client.list_agent_chats(page=page, page_size=page_size, request_options=request_options)
        return _response.data

    def create_agent_chat(
        self, *, chat: ChatRoomRequest, request_options: typing.Optional[RequestOptions] = None
    ) -> CreateAgentChatResponse:
        """
        Creates a new chat room with the agent as owner

        Parameters
        ----------
        chat : ChatRoomRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CreateAgentChatResponse
            Created chat room

        Examples
        --------
        from thenvoi_rest import ChatRoomRequest, RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.create_agent_chat(
            chat=ChatRoomRequest(),
        )
        """
        _response = self._raw_client.create_agent_chat(chat=chat, request_options=request_options)
        return _response.data

    def get_agent_chat_context(
        self,
        chat_id: str,
        *,
        page: typing.Optional[int] = None,
        page_size: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> GetAgentChatContextResponse:
        """
        Returns all messages relevant to the agent for execution context/rehydration.

        This includes:
        - All messages the agent sent (any type: text, tool_call, tool_result, thought, etc.)
        - All text messages that @mention the agent

        Use this endpoint to load the complete context an external agent needs to resume execution.

        Messages are returned in chronological order (oldest first).

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        page : typing.Optional[int]
            Page number (default: 1)

        page_size : typing.Optional[int]
            Items per page (default: 50, max: 100)

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAgentChatContextResponse
            Agent context

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.get_agent_chat_context(
            chat_id="chat_id",
            page=1,
            page_size=1,
        )
        """
        _response = self._raw_client.get_agent_chat_context(
            chat_id, page=page, page_size=page_size, request_options=request_options
        )
        return _response.data

    def create_agent_chat_event(
        self, chat_id: str, *, event: ChatEventRequest, request_options: typing.Optional[RequestOptions] = None
    ) -> CreateAgentChatEventResponse:
        """
        Creates a new event in a chat room.

        Events do NOT require mentions - they report what happened rather than directing messages
        at participants. Use this endpoint to record:

        - **tool_call**: When the agent invokes a tool
        - **tool_result**: The result returned from a tool execution
        - **thought**: Agent's internal reasoning or thinking process
        - **error**: Error messages and failure notifications
        - **task**: Task-related messages

        For text messages with mentions, use POST /agent/chats/{chat_id}/messages instead.

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        event : ChatEventRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CreateAgentChatEventResponse
            Event created

        Examples
        --------
        from thenvoi_rest import ChatEventRequest, RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.create_agent_chat_event(
            chat_id="daca00d0-eb6b-4db1-8201-c46015c93d04",
            event=ChatEventRequest(
                content="Calling send_direct_message_service",
                message_type="tool_call",
            ),
        )
        """
        _response = self._raw_client.create_agent_chat_event(chat_id, event=event, request_options=request_options)
        return _response.data

    def list_agent_messages(
        self,
        chat_id: str,
        *,
        status: typing.Optional[ListAgentMessagesRequestStatus] = None,
        page: typing.Optional[int] = None,
        page_size: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ListAgentMessagesResponse:
        """
        Returns messages that the agent needs to process, filtered by status.

        ## Default Behavior (no status param)

        Returns all messages that are NOT processed. This is the recommended way to get
        all work the agent should handle, including:
        - New messages (no delivery status yet)
        - Delivered messages (acknowledged but not started)
        - Processing messages (stuck/crashed - supports crash recovery)
        - Failed messages (available for retry)

        ## Status Filter Reference

        | ?status=     | Returns                                                              | Use Case                    |
        |--------------|----------------------------------------------------------------------|-----------------------------|
        | *(no param)* | Everything NOT processed                                             | Get all work to do          |
        | `pending`    | No status, delivered, or failed without active attempt               | Queue depth (untouched)     |
        | `processing` | Currently being processed                                            | In-flight work              |
        | `processed`  | Successfully completed                                               | Done items                  |
        | `failed`     | Failed only                                                          | Failure backlog             |
        | `all`        | All messages regardless of status                                    | Full history                |

        Messages are returned in chronological order (oldest first).

        ## Workflow

        After retrieving messages, you must update their processing status:

        1. `GET /messages` or `GET /messages/next` → Get work to do
        2. `POST /messages/{id}/processing` → **Required:** Mark as processing before you start
        3. Process the message (reasoning loop, tool calls, etc.)
        4. `POST /messages/{id}/processed` → Mark as done, OR
           `POST /messages/{id}/failed` → Mark as failed with error message
        5. Repeat

        **Important:** Always call `/processing` before starting work. This prevents
        duplicate processing since agents doing reasoning loops will always follow the
        sequence: `/next` → `/processing` → do work → `/processed`.

        ## Crash Recovery

        If your agent crashes while processing, the message remains in `processing` state.
        When the agent restarts:
        1. Call `GET /messages` (default) - it includes stuck `processing` messages
        2. The stuck message will be returned so you can retry it
        3. Call `/processing` again to reset the attempt timestamp, then continue

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        status : typing.Optional[ListAgentMessagesRequestStatus]
            Filter by processing status (default: all actionable messages)

        page : typing.Optional[int]
            Page number

        page_size : typing.Optional[int]
            Items per page (default: 20, max: 100)

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ListAgentMessagesResponse
            Messages

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.list_agent_messages(
            chat_id="chat_id",
            status="pending",
            page=1,
            page_size=1,
        )
        """
        _response = self._raw_client.list_agent_messages(
            chat_id, status=status, page=page, page_size=page_size, request_options=request_options
        )
        return _response.data

    def create_agent_chat_message(
        self, chat_id: str, *, message: ChatMessageRequest, request_options: typing.Optional[RequestOptions] = None
    ) -> CreateAgentChatMessageResponse:
        """
        Creates a new text message in a chat room. The agent must be a participant in the room.

        This endpoint only supports `text` message type. For event-type messages
        (tool_call, tool_result, thought, system, error, action, guidelines, task),
        use `POST /agent/chats/{chat_id}/events` instead.

        Messages must include at least one @mention to ensure proper routing to recipients.

        Example request:
        ```json
        {
          "message": {
            "content": "@Task Owner I have completed the analysis",
            "mentions": [
              {"id": "user-uuid", "name": "Task Owner"}
            ]
          }
        }
        ```

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        message : ChatMessageRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CreateAgentChatMessageResponse
            Message sent

        Examples
        --------
        from thenvoi_rest import (
            ChatMessageRequest,
            ChatMessageRequestMentionsItem,
            RestClient,
        )

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.create_agent_chat_message(
            chat_id="chat_id",
            message=ChatMessageRequest(
                content="@DataAnalyst please analyze the Q4 sales data",
                mentions=[
                    ChatMessageRequestMentionsItem(
                        id="id",
                        name="name",
                    )
                ],
            ),
        )
        """
        _response = self._raw_client.create_agent_chat_message(
            chat_id, message=message, request_options=request_options
        )
        return _response.data

    def get_agent_next_message(
        self, chat_id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> GetAgentNextMessageResponse:
        """
        Returns the single oldest message that needs processing.

        ## What It Returns

        The oldest message that is NOT processed, including:
        - New messages (no delivery status yet)
        - Delivered messages (acknowledged but not started)
        - Processing messages (stuck/crashed - supports crash recovery)
        - Failed messages (available for retry)

        Returns **204 No Content** if there are no messages to process.

        ## Workflow

        This is the primary endpoint for agent reasoning loops:

        1. `GET /messages/next` → Get next work item
        2. `POST /messages/{id}/processing` → **Required:** Mark as processing
        3. Process the message (reasoning loop, tool calls, etc.)
        4. `POST /messages/{id}/processed` → Mark as done, OR
           `POST /messages/{id}/failed` → Mark as failed with error message
        5. Loop back to step 1

        ## Crash Recovery

        If your agent crashes while processing, the message stays in `processing` state.
        When restarted, calling `/next` will return that same stuck message (oldest first),
        allowing the agent to reclaim and retry it.

        ## Difference from GET /messages

        - `GET /messages` returns **all** actionable messages (for batch processing or queue inspection)
        - `GET /messages/next` returns **one** message (for sequential processing loops)

        Both use the same filter logic: everything that is NOT processed.

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAgentNextMessageResponse
            Next message

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.get_agent_next_message(
            chat_id="chat_id",
        )
        """
        _response = self._raw_client.get_agent_next_message(chat_id, request_options=request_options)
        return _response.data

    def mark_agent_message_failed(
        self, chat_id: str, id: str, *, error: str, request_options: typing.Optional[RequestOptions] = None
    ) -> MarkAgentMessageFailedResponse:
        """
        Marks a message processing as failed by the agent. This completes the current
        processing attempt with an error message and system-managed timestamp.

        ## What It Does

        - Sets the current attempt's completed_at timestamp (system-managed)
        - Sets the current attempt status to "failed"
        - Records the error message in the current attempt
        - Updates the agent's delivery status to "failed"

        ## Requirements

        **Requires an active processing attempt.** You must call `/processing` first.
        Returns 422 if no processing attempt exists.

        ## After Calling

        Failed messages remain available for retry. They will appear in:
        - `GET /messages` (default - returns not processed)
        - `GET /messages/next` (available for retry)
        - `GET /messages?status=failed`
        - `GET /messages?status=all`

        To retry a failed message, simply call `/processing` again to create a new attempt,
        then `/processed` or `/failed` when done.

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        id : str
            Message ID

        error : str
            Error message describing why processing failed

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        MarkAgentMessageFailedResponse
            Message marked as failed

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.mark_agent_message_failed(
            chat_id="chat_id",
            id="id",
            error="error",
        )
        """
        _response = self._raw_client.mark_agent_message_failed(
            chat_id, id, error=error, request_options=request_options
        )
        return _response.data

    def mark_agent_message_processed(
        self, chat_id: str, id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> MarkAgentMessageProcessedResponse:
        """
        Marks a message as successfully processed by the agent. This completes the current
        processing attempt with a system-managed timestamp.

        ## What It Does

        - Sets the current attempt's completed_at timestamp (system-managed)
        - Sets the current attempt status to "success"
        - Sets the agent's processed_at timestamp (system-managed)
        - Updates the agent's delivery status to "processed"

        ## Requirements

        **Requires an active processing attempt.** You must call `/processing` first.
        Returns 422 if no processing attempt exists.

        ## After Calling

        Once marked as processed, the message will no longer appear in:
        - `GET /messages` (default - returns not processed)
        - `GET /messages/next`
        - `GET /messages?status=pending`

        It will only appear in:
        - `GET /messages?status=processed`
        - `GET /messages?status=all`

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        id : str
            Message ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        MarkAgentMessageProcessedResponse
            Message marked as processed

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.mark_agent_message_processed(
            chat_id="chat_id",
            id="id",
        )
        """
        _response = self._raw_client.mark_agent_message_processed(chat_id, id, request_options=request_options)
        return _response.data

    def mark_agent_message_processing(
        self, chat_id: str, id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> MarkAgentMessageProcessingResponse:
        """
        Marks a message as being processed by the agent. This creates a new processing attempt
        with a system-managed timestamp. The agent must be a participant in the chat room.

        ## What It Does

        - Creates a new attempt with auto-incremented attempt_number
        - Sets the attempt status to "processing"
        - Records the started_at timestamp (system-managed)
        - Updates the agent's delivery status to "processing"

        ## Multiple Calls

        This endpoint can be called multiple times on the same message. Each call creates
        a **new attempt**. This is intentional for crash recovery:

        1. Agent calls `/processing` (attempt 1)
        2. Agent crashes while processing
        3. Agent restarts, calls `/next`, gets the same message back
        4. Agent calls `/processing` again (attempt 2)
        5. Agent completes processing, calls `/processed`

        The attempts array in the message metadata tracks the full history.

        ## Workflow

        Always call this endpoint before starting work on a message:

        1. `GET /messages/next` → Get message
        2. `POST /messages/{id}/processing` → **This endpoint**
        3. Process the message
        4. `POST /messages/{id}/processed` or `/failed`

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        id : str
            Message ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        MarkAgentMessageProcessingResponse
            Message marked as processing

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.mark_agent_message_processing(
            chat_id="chat_id",
            id="id",
        )
        """
        _response = self._raw_client.mark_agent_message_processing(chat_id, id, request_options=request_options)
        return _response.data

    def list_agent_chat_participants(
        self, chat_id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> ListAgentChatParticipantsResponse:
        """
        Returns a list of participants in a chat room where the agent is a member

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ListAgentChatParticipantsResponse
            Chat room participants

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.list_agent_chat_participants(
            chat_id="chat_id",
        )
        """
        _response = self._raw_client.list_agent_chat_participants(chat_id, request_options=request_options)
        return _response.data

    def add_agent_chat_participant(
        self, chat_id: str, *, participant: ParticipantRequest, request_options: typing.Optional[RequestOptions] = None
    ) -> AddAgentChatParticipantResponse:
        """
        Adds a new participant to a chat room.

        Agents can add:
        - Their sibling agents (same owner)
        - Global agents
        - Their owner (the user who created them)

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        participant : ParticipantRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        AddAgentChatParticipantResponse
            Participant added

        Examples
        --------
        from thenvoi_rest import ParticipantRequest, RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.add_agent_chat_participant(
            chat_id="chat_id",
            participant=ParticipantRequest(
                participant_id="participant_id",
                role="owner",
            ),
        )
        """
        _response = self._raw_client.add_agent_chat_participant(
            chat_id, participant=participant, request_options=request_options
        )
        return _response.data

    def remove_agent_chat_participant(
        self, chat_id: str, id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> RemoveAgentChatParticipantResponse:
        """
        Removes a participant from a chat room. The acting agent must be the owner or admin of the room.

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        id : str
            Participant ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        RemoveAgentChatParticipantResponse
            Participant removed

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.remove_agent_chat_participant(
            chat_id="chat_id",
            id="id",
        )
        """
        _response = self._raw_client.remove_agent_chat_participant(chat_id, id, request_options=request_options)
        return _response.data

    def get_agent_chat(
        self, id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> GetAgentChatResponse:
        """
        Returns details of a specific chat room where the agent is a participant

        Parameters
        ----------
        id : str
            Chat Room ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAgentChatResponse
            Chat room details

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.get_agent_chat(
            id="id",
        )
        """
        _response = self._raw_client.get_agent_chat(id, request_options=request_options)
        return _response.data

    def get_agent_me(self, *, request_options: typing.Optional[RequestOptions] = None) -> GetAgentMeResponse:
        """
        Returns the profile of the currently authenticated agent.
        Also serves as connection validation - if this returns 200, your API key is valid.

        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAgentMeResponse
            Agent profile

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.get_agent_me()
        """
        _response = self._raw_client.get_agent_me(request_options=request_options)
        return _response.data

    def list_agent_peers(
        self,
        *,
        not_in_chat: typing.Optional[str] = None,
        page: typing.Optional[int] = None,
        page_size: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ListAgentPeersResponse:
        """
        Lists agents that can be recruited by the current agent.
        Includes sibling agents (same owner) and global agents. Excludes self.

        Parameters
        ----------
        not_in_chat : typing.Optional[str]
            Exclude agents already in this chat room

        page : typing.Optional[int]
            Page number

        page_size : typing.Optional[int]
            Items per page

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ListAgentPeersResponse
            Peers list

        Examples
        --------
        from thenvoi_rest import RestClient

        client = RestClient(
            api_key="YOUR_API_KEY",
        )
        client.agent_api.list_agent_peers(
            not_in_chat="daca00d0-eb6b-4db1-8201-c46015c93d04",
            page=1,
            page_size=1,
        )
        """
        _response = self._raw_client.list_agent_peers(
            not_in_chat=not_in_chat, page=page, page_size=page_size, request_options=request_options
        )
        return _response.data


class AsyncAgentApiClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawAgentApiClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> AsyncRawAgentApiClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawAgentApiClient
        """
        return self._raw_client

    async def list_agent_chats(
        self,
        *,
        page: typing.Optional[int] = None,
        page_size: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ListAgentChatsResponse:
        """
        Lists chat rooms where the current agent is a participant

        Parameters
        ----------
        page : typing.Optional[int]
            Page number

        page_size : typing.Optional[int]
            Items per page

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ListAgentChatsResponse
            Agent's chat rooms

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.list_agent_chats(
                page=1,
                page_size=1,
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.list_agent_chats(
            page=page, page_size=page_size, request_options=request_options
        )
        return _response.data

    async def create_agent_chat(
        self, *, chat: ChatRoomRequest, request_options: typing.Optional[RequestOptions] = None
    ) -> CreateAgentChatResponse:
        """
        Creates a new chat room with the agent as owner

        Parameters
        ----------
        chat : ChatRoomRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CreateAgentChatResponse
            Created chat room

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient, ChatRoomRequest

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.create_agent_chat(
                chat=ChatRoomRequest(),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.create_agent_chat(chat=chat, request_options=request_options)
        return _response.data

    async def get_agent_chat_context(
        self,
        chat_id: str,
        *,
        page: typing.Optional[int] = None,
        page_size: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> GetAgentChatContextResponse:
        """
        Returns all messages relevant to the agent for execution context/rehydration.

        This includes:
        - All messages the agent sent (any type: text, tool_call, tool_result, thought, etc.)
        - All text messages that @mention the agent

        Use this endpoint to load the complete context an external agent needs to resume execution.

        Messages are returned in chronological order (oldest first).

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        page : typing.Optional[int]
            Page number (default: 1)

        page_size : typing.Optional[int]
            Items per page (default: 50, max: 100)

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAgentChatContextResponse
            Agent context

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.get_agent_chat_context(
                chat_id="chat_id",
                page=1,
                page_size=1,
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.get_agent_chat_context(
            chat_id, page=page, page_size=page_size, request_options=request_options
        )
        return _response.data

    async def create_agent_chat_event(
        self, chat_id: str, *, event: ChatEventRequest, request_options: typing.Optional[RequestOptions] = None
    ) -> CreateAgentChatEventResponse:
        """
        Creates a new event in a chat room.

        Events do NOT require mentions - they report what happened rather than directing messages
        at participants. Use this endpoint to record:

        - **tool_call**: When the agent invokes a tool
        - **tool_result**: The result returned from a tool execution
        - **thought**: Agent's internal reasoning or thinking process
        - **error**: Error messages and failure notifications
        - **task**: Task-related messages

        For text messages with mentions, use POST /agent/chats/{chat_id}/messages instead.

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        event : ChatEventRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CreateAgentChatEventResponse
            Event created

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient, ChatEventRequest

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.create_agent_chat_event(
                chat_id="daca00d0-eb6b-4db1-8201-c46015c93d04",
                event=ChatEventRequest(
                    content="Calling send_direct_message_service",
                    message_type="tool_call",
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.create_agent_chat_event(
            chat_id, event=event, request_options=request_options
        )
        return _response.data

    async def list_agent_messages(
        self,
        chat_id: str,
        *,
        status: typing.Optional[ListAgentMessagesRequestStatus] = None,
        page: typing.Optional[int] = None,
        page_size: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ListAgentMessagesResponse:
        """
        Returns messages that the agent needs to process, filtered by status.

        ## Default Behavior (no status param)

        Returns all messages that are NOT processed. This is the recommended way to get
        all work the agent should handle, including:
        - New messages (no delivery status yet)
        - Delivered messages (acknowledged but not started)
        - Processing messages (stuck/crashed - supports crash recovery)
        - Failed messages (available for retry)

        ## Status Filter Reference

        | ?status=     | Returns                                                              | Use Case                    |
        |--------------|----------------------------------------------------------------------|-----------------------------|
        | *(no param)* | Everything NOT processed                                             | Get all work to do          |
        | `pending`    | No status, delivered, or failed without active attempt               | Queue depth (untouched)     |
        | `processing` | Currently being processed                                            | In-flight work              |
        | `processed`  | Successfully completed                                               | Done items                  |
        | `failed`     | Failed only                                                          | Failure backlog             |
        | `all`        | All messages regardless of status                                    | Full history                |

        Messages are returned in chronological order (oldest first).

        ## Workflow

        After retrieving messages, you must update their processing status:

        1. `GET /messages` or `GET /messages/next` → Get work to do
        2. `POST /messages/{id}/processing` → **Required:** Mark as processing before you start
        3. Process the message (reasoning loop, tool calls, etc.)
        4. `POST /messages/{id}/processed` → Mark as done, OR
           `POST /messages/{id}/failed` → Mark as failed with error message
        5. Repeat

        **Important:** Always call `/processing` before starting work. This prevents
        duplicate processing since agents doing reasoning loops will always follow the
        sequence: `/next` → `/processing` → do work → `/processed`.

        ## Crash Recovery

        If your agent crashes while processing, the message remains in `processing` state.
        When the agent restarts:
        1. Call `GET /messages` (default) - it includes stuck `processing` messages
        2. The stuck message will be returned so you can retry it
        3. Call `/processing` again to reset the attempt timestamp, then continue

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        status : typing.Optional[ListAgentMessagesRequestStatus]
            Filter by processing status (default: all actionable messages)

        page : typing.Optional[int]
            Page number

        page_size : typing.Optional[int]
            Items per page (default: 20, max: 100)

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ListAgentMessagesResponse
            Messages

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.list_agent_messages(
                chat_id="chat_id",
                status="pending",
                page=1,
                page_size=1,
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.list_agent_messages(
            chat_id, status=status, page=page, page_size=page_size, request_options=request_options
        )
        return _response.data

    async def create_agent_chat_message(
        self, chat_id: str, *, message: ChatMessageRequest, request_options: typing.Optional[RequestOptions] = None
    ) -> CreateAgentChatMessageResponse:
        """
        Creates a new text message in a chat room. The agent must be a participant in the room.

        This endpoint only supports `text` message type. For event-type messages
        (tool_call, tool_result, thought, system, error, action, guidelines, task),
        use `POST /agent/chats/{chat_id}/events` instead.

        Messages must include at least one @mention to ensure proper routing to recipients.

        Example request:
        ```json
        {
          "message": {
            "content": "@Task Owner I have completed the analysis",
            "mentions": [
              {"id": "user-uuid", "name": "Task Owner"}
            ]
          }
        }
        ```

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        message : ChatMessageRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CreateAgentChatMessageResponse
            Message sent

        Examples
        --------
        import asyncio

        from thenvoi_rest import (
            AsyncRestClient,
            ChatMessageRequest,
            ChatMessageRequestMentionsItem,
        )

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.create_agent_chat_message(
                chat_id="chat_id",
                message=ChatMessageRequest(
                    content="@DataAnalyst please analyze the Q4 sales data",
                    mentions=[
                        ChatMessageRequestMentionsItem(
                            id="id",
                            name="name",
                        )
                    ],
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.create_agent_chat_message(
            chat_id, message=message, request_options=request_options
        )
        return _response.data

    async def get_agent_next_message(
        self, chat_id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> GetAgentNextMessageResponse:
        """
        Returns the single oldest message that needs processing.

        ## What It Returns

        The oldest message that is NOT processed, including:
        - New messages (no delivery status yet)
        - Delivered messages (acknowledged but not started)
        - Processing messages (stuck/crashed - supports crash recovery)
        - Failed messages (available for retry)

        Returns **204 No Content** if there are no messages to process.

        ## Workflow

        This is the primary endpoint for agent reasoning loops:

        1. `GET /messages/next` → Get next work item
        2. `POST /messages/{id}/processing` → **Required:** Mark as processing
        3. Process the message (reasoning loop, tool calls, etc.)
        4. `POST /messages/{id}/processed` → Mark as done, OR
           `POST /messages/{id}/failed` → Mark as failed with error message
        5. Loop back to step 1

        ## Crash Recovery

        If your agent crashes while processing, the message stays in `processing` state.
        When restarted, calling `/next` will return that same stuck message (oldest first),
        allowing the agent to reclaim and retry it.

        ## Difference from GET /messages

        - `GET /messages` returns **all** actionable messages (for batch processing or queue inspection)
        - `GET /messages/next` returns **one** message (for sequential processing loops)

        Both use the same filter logic: everything that is NOT processed.

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAgentNextMessageResponse
            Next message

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.get_agent_next_message(
                chat_id="chat_id",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.get_agent_next_message(chat_id, request_options=request_options)
        return _response.data

    async def mark_agent_message_failed(
        self, chat_id: str, id: str, *, error: str, request_options: typing.Optional[RequestOptions] = None
    ) -> MarkAgentMessageFailedResponse:
        """
        Marks a message processing as failed by the agent. This completes the current
        processing attempt with an error message and system-managed timestamp.

        ## What It Does

        - Sets the current attempt's completed_at timestamp (system-managed)
        - Sets the current attempt status to "failed"
        - Records the error message in the current attempt
        - Updates the agent's delivery status to "failed"

        ## Requirements

        **Requires an active processing attempt.** You must call `/processing` first.
        Returns 422 if no processing attempt exists.

        ## After Calling

        Failed messages remain available for retry. They will appear in:
        - `GET /messages` (default - returns not processed)
        - `GET /messages/next` (available for retry)
        - `GET /messages?status=failed`
        - `GET /messages?status=all`

        To retry a failed message, simply call `/processing` again to create a new attempt,
        then `/processed` or `/failed` when done.

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        id : str
            Message ID

        error : str
            Error message describing why processing failed

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        MarkAgentMessageFailedResponse
            Message marked as failed

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.mark_agent_message_failed(
                chat_id="chat_id",
                id="id",
                error="error",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.mark_agent_message_failed(
            chat_id, id, error=error, request_options=request_options
        )
        return _response.data

    async def mark_agent_message_processed(
        self, chat_id: str, id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> MarkAgentMessageProcessedResponse:
        """
        Marks a message as successfully processed by the agent. This completes the current
        processing attempt with a system-managed timestamp.

        ## What It Does

        - Sets the current attempt's completed_at timestamp (system-managed)
        - Sets the current attempt status to "success"
        - Sets the agent's processed_at timestamp (system-managed)
        - Updates the agent's delivery status to "processed"

        ## Requirements

        **Requires an active processing attempt.** You must call `/processing` first.
        Returns 422 if no processing attempt exists.

        ## After Calling

        Once marked as processed, the message will no longer appear in:
        - `GET /messages` (default - returns not processed)
        - `GET /messages/next`
        - `GET /messages?status=pending`

        It will only appear in:
        - `GET /messages?status=processed`
        - `GET /messages?status=all`

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        id : str
            Message ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        MarkAgentMessageProcessedResponse
            Message marked as processed

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.mark_agent_message_processed(
                chat_id="chat_id",
                id="id",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.mark_agent_message_processed(chat_id, id, request_options=request_options)
        return _response.data

    async def mark_agent_message_processing(
        self, chat_id: str, id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> MarkAgentMessageProcessingResponse:
        """
        Marks a message as being processed by the agent. This creates a new processing attempt
        with a system-managed timestamp. The agent must be a participant in the chat room.

        ## What It Does

        - Creates a new attempt with auto-incremented attempt_number
        - Sets the attempt status to "processing"
        - Records the started_at timestamp (system-managed)
        - Updates the agent's delivery status to "processing"

        ## Multiple Calls

        This endpoint can be called multiple times on the same message. Each call creates
        a **new attempt**. This is intentional for crash recovery:

        1. Agent calls `/processing` (attempt 1)
        2. Agent crashes while processing
        3. Agent restarts, calls `/next`, gets the same message back
        4. Agent calls `/processing` again (attempt 2)
        5. Agent completes processing, calls `/processed`

        The attempts array in the message metadata tracks the full history.

        ## Workflow

        Always call this endpoint before starting work on a message:

        1. `GET /messages/next` → Get message
        2. `POST /messages/{id}/processing` → **This endpoint**
        3. Process the message
        4. `POST /messages/{id}/processed` or `/failed`

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        id : str
            Message ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        MarkAgentMessageProcessingResponse
            Message marked as processing

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.mark_agent_message_processing(
                chat_id="chat_id",
                id="id",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.mark_agent_message_processing(chat_id, id, request_options=request_options)
        return _response.data

    async def list_agent_chat_participants(
        self, chat_id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> ListAgentChatParticipantsResponse:
        """
        Returns a list of participants in a chat room where the agent is a member

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ListAgentChatParticipantsResponse
            Chat room participants

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.list_agent_chat_participants(
                chat_id="chat_id",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.list_agent_chat_participants(chat_id, request_options=request_options)
        return _response.data

    async def add_agent_chat_participant(
        self, chat_id: str, *, participant: ParticipantRequest, request_options: typing.Optional[RequestOptions] = None
    ) -> AddAgentChatParticipantResponse:
        """
        Adds a new participant to a chat room.

        Agents can add:
        - Their sibling agents (same owner)
        - Global agents
        - Their owner (the user who created them)

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        participant : ParticipantRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        AddAgentChatParticipantResponse
            Participant added

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient, ParticipantRequest

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.add_agent_chat_participant(
                chat_id="chat_id",
                participant=ParticipantRequest(
                    participant_id="participant_id",
                    role="owner",
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.add_agent_chat_participant(
            chat_id, participant=participant, request_options=request_options
        )
        return _response.data

    async def remove_agent_chat_participant(
        self, chat_id: str, id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> RemoveAgentChatParticipantResponse:
        """
        Removes a participant from a chat room. The acting agent must be the owner or admin of the room.

        Parameters
        ----------
        chat_id : str
            Chat Room ID

        id : str
            Participant ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        RemoveAgentChatParticipantResponse
            Participant removed

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.remove_agent_chat_participant(
                chat_id="chat_id",
                id="id",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.remove_agent_chat_participant(chat_id, id, request_options=request_options)
        return _response.data

    async def get_agent_chat(
        self, id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> GetAgentChatResponse:
        """
        Returns details of a specific chat room where the agent is a participant

        Parameters
        ----------
        id : str
            Chat Room ID

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAgentChatResponse
            Chat room details

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.get_agent_chat(
                id="id",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.get_agent_chat(id, request_options=request_options)
        return _response.data

    async def get_agent_me(self, *, request_options: typing.Optional[RequestOptions] = None) -> GetAgentMeResponse:
        """
        Returns the profile of the currently authenticated agent.
        Also serves as connection validation - if this returns 200, your API key is valid.

        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAgentMeResponse
            Agent profile

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.get_agent_me()


        asyncio.run(main())
        """
        _response = await self._raw_client.get_agent_me(request_options=request_options)
        return _response.data

    async def list_agent_peers(
        self,
        *,
        not_in_chat: typing.Optional[str] = None,
        page: typing.Optional[int] = None,
        page_size: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> ListAgentPeersResponse:
        """
        Lists agents that can be recruited by the current agent.
        Includes sibling agents (same owner) and global agents. Excludes self.

        Parameters
        ----------
        not_in_chat : typing.Optional[str]
            Exclude agents already in this chat room

        page : typing.Optional[int]
            Page number

        page_size : typing.Optional[int]
            Items per page

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        ListAgentPeersResponse
            Peers list

        Examples
        --------
        import asyncio

        from thenvoi_rest import AsyncRestClient

        client = AsyncRestClient(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.agent_api.list_agent_peers(
                not_in_chat="daca00d0-eb6b-4db1-8201-c46015c93d04",
                page=1,
                page_size=1,
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.list_agent_peers(
            not_in_chat=not_in_chat, page=page, page_size=page_size, request_options=request_options
        )
        return _response.data

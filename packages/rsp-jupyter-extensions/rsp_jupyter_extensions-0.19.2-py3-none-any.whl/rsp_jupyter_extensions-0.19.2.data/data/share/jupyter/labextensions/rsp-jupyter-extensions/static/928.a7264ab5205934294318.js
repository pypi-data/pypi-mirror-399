"use strict";(self.webpackChunkrsp_jupyter_extensions=self.webpackChunkrsp_jupyter_extensions||[]).push([[928],{928:(e,t,o)=>{o.r(t),o.d(t,{default:()=>P});var n=o(67),r=o(684),i=o(125),s=o(292),a=o(907);function l(e,t,o){return a.ServerConnection.makeRequest(e,t,o).then((e=>200!==e.status?e.json().then((t=>{throw new a.ServerConnection.ResponseError(e,t.message)})):e.json()))}var u=o(345),c=o(827);function d(e){return u.createElement(n.TextItem,{source:`${e.source}`,title:`${e.title}`})}class h extends c.VDomRenderer{constructor(e){super(new c.VDomModel),this.props=e}render(){return this.props?u.createElement(d,{source:this.props.source,title:this.props.title}):null}dispose(){super.dispose()}}const p=h;var m;function g(e,t=null,o,...n){e===m.DEBUG&&t&&t.DEBUG||e===m.INFO?console.log(o,...n):e===m.WARNING?console.warn(o,...n):e===m.ERROR&&console.error(o,...n)}!function(e){e.DEBUG="debug",e.INFO="info",e.WARNING="warning",e.ERROR="error"}(m||(m={}));const E="rsp-jupyterlab",f=`${E}:plugin`,b=`${E}:displayversion`;n.IStatusBar;var y,T,R,v,w,N=o(247),I=o(441);class O{constructor(e){this.globalTooltip=null,this.tooltipHideTimeout=null,this.tooltipShowTimeout=null,this.currentHoveredJobref=null,this.queryDataMap=e}attachToMenu(e){const t=e.node;t&&(t.addEventListener("mouseenter",(e=>{const t=e.target;if(!t)return;const o=t.closest('[data-command^="q-"]');if(!o)return;const n=o.getAttribute("data-command");if(!n||!n.startsWith("q-"))return;const r=n.substring(2),i=this.queryDataMap.get(r);i&&this.currentHoveredJobref!==r&&(this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null),this.tooltipShowTimeout&&(clearTimeout(this.tooltipShowTimeout),this.tooltipShowTimeout=null),this.currentHoveredJobref=r,this.tooltipShowTimeout=window.setTimeout((()=>{this.showTooltip(e,i.sqlText,i.jobref)}),150))}),!0),t.addEventListener("mouseleave",(e=>{const t=e.target;if(!t)return;const o=t.closest('[data-command^="q-"]');if(!o)return;const n=o.getAttribute("data-command");if(!n||!n.startsWith("q-"))return;const r=n.substring(2);this.currentHoveredJobref===r&&(this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null),this.tooltipHideTimeout=window.setTimeout((()=>{this.hideTooltip(),this.currentHoveredJobref=null}),300))}),!0),t.addEventListener("click",(e=>{const t=e.target;if(!t)return;const o=t.closest('[data-command^="q-"]');if(!o)return;const n=o.getAttribute("data-command");n&&n.startsWith("q-")&&(this.hideTooltip(),this.currentHoveredJobref=null)}),!0))}showTooltip(e,t,o){this.globalTooltip&&this.hideTooltip(),this.globalTooltip=document.createElement("div"),this.globalTooltip.className="sql-hover-tooltip",this.globalTooltip.style.cssText="\n      position: fixed;\n      z-index: 10000;\n      background: #ffffff;\n      border: 1px solid #e1e4e8;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      padding: 16px;\n      min-width: 500px;\n      max-width: 700px;\n      min-height: 200px;\n      max-height: 500px;\n      overflow: hidden;\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n      font-size: 12px;\n      line-height: 1.4;\n      cursor: text;\n      user-select: text;\n    ";const n=document.createElement("div");n.textContent=`Query: ${o}`,n.style.cssText="\n      font-weight: 600;\n      color: #24292e;\n      margin-bottom: 8px;\n      font-size: 13px;\n    ";const r=document.createElement("div");r.style.cssText="\n      margin: 0;\n      background: #f6f8fa;\n      border: 1px solid #e1e4e8;\n      border-radius: 4px;\n      overflow: auto;\n      max-height: 450px;\n    ";const i=document.createElement("pre");i.style.cssText="\n      margin: 0;\n      padding: 12px;\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n      font-size: 12px;\n      line-height: 1.5;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      color: #24292e;\n    ";const s=this.formatSQLQuery(t);i.innerHTML=this.highlightSQLBasic(s),r.appendChild(i),this.globalTooltip.appendChild(n),this.globalTooltip.appendChild(r),document.body.appendChild(this.globalTooltip);const a=e.target.getBoundingClientRect(),l=this.globalTooltip.getBoundingClientRect();let u=a.right-10,c=a.top-5;u+l.width>window.innerWidth&&(u=a.left-l.width+10),c+l.height>window.innerHeight&&(c=window.innerHeight-l.height-10),c<10&&(c=10),this.globalTooltip.style.left=`${u}px`,this.globalTooltip.style.top=`${c}px`,this.globalTooltip.addEventListener("mouseenter",(()=>{this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null)})),this.globalTooltip.addEventListener("mouseleave",(()=>{this.tooltipHideTimeout&&clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=window.setTimeout((()=>{this.hideTooltip(),this.currentHoveredJobref=null}),100)}))}hideTooltip(){this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null),this.tooltipShowTimeout&&(clearTimeout(this.tooltipShowTimeout),this.tooltipShowTimeout=null),this.globalTooltip&&(this.globalTooltip.remove(),this.globalTooltip=null)}static createSQLCard(e,t){const o=document.createElement("div");if(o.className="sql-card",o.style.cssText="\n      background: #ffffff;\n      border: 1px solid #e1e4e8;\n      border-radius: 8px;\n      padding: 16px;\n      margin: 8px 0;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n      font-size: 13px;\n      line-height: 1.5;\n    ",t){const e=document.createElement("div");e.className="sql-card-title",e.style.cssText="\n        font-weight: 600;\n        color: #24292e;\n        margin-bottom: 8px;\n        font-size: 14px;\n      ",e.textContent=t,o.appendChild(e)}const n=document.createElement("pre");n.className="sql-card-content",n.style.cssText="\n      margin: 0;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      color: #24292e;\n      background: #f6f8fa;\n      padding: 12px;\n      border-radius: 4px;\n      border: 1px solid #e1e4e8;\n    ";const r=O.formatSQLQueryStatic(e);return n.innerHTML=O.highlightSQLBasicStatic(r),o.appendChild(n),o}formatSQLQuery(e){return O.formatSQLQueryStatic(e)}static formatSQLQueryStatic(e){try{return(0,I.format)(e,{language:"sql",tabWidth:2,keywordCase:"upper",dataTypeCase:"upper",functionCase:"upper",identifierCase:"preserve",indentStyle:"standard",logicalOperatorNewline:"before",expressionWidth:50,linesBetweenQueries:2})}catch(t){return console.warn("SQL formatting failed:",t),e}}highlightSQLBasic(e){return O.highlightSQLBasicStatic(e)}static highlightSQLBasicStatic(e){let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");return["SELECT","FROM","WHERE","ORDER","BY","GROUP","HAVING","JOIN","INNER","LEFT","RIGHT","OUTER","ON","AS","AND","OR","NOT","IN","EXISTS","BETWEEN","LIKE","IS","NULL","DISTINCT","LIMIT","INSERT","UPDATE","DELETE","CREATE","DROP","ALTER","TABLE","INDEX","VIEW","PROCEDURE","FUNCTION","TRIGGER","DATABASE","SCHEMA","UNION","ALL","CASE","WHEN","THEN","ELSE","END","IF","WHILE","FOR","LOOP","BEGIN","COMMIT","ROLLBACK","TRANSACTION","GRANT","REVOKE","PRIMARY","KEY","FOREIGN","REFERENCES","CONSTRAINT","CHECK","DEFAULT","AUTO_INCREMENT","VARCHAR","INT","BIGINT","SMALLINT","TINYINT","DECIMAL","FLOAT","DOUBLE","CHAR","TEXT","DATE","TIME","DATETIME","TIMESTAMP","BOOLEAN","BLOB","JSON"].forEach((e=>{const o=new RegExp(`\\b${e}\\b`,"gi");t=t.replace(o,`<span style="color: #cf222e; font-weight: bold;">${e.toUpperCase()}</span>`)})),t=t.replace(/(&#39;)((?:\\.|(?!\1)[^\\])*?)\1/g,'<span style="color: #0a3069;">$1$2$1</span>'),t=t.replace(/(&quot;)((?:\\.|(?!\1)[^\\])*?)\1/g,'<span style="color: #0a3069;">$1$2$1</span>'),t=t.replace(/\b\d+(\.\d+)?\b/g,'<span style="color: #0a3069; font-weight: bold;">$&</span>'),t=t.replace(/--.*$/gm,'<span style="color: #6a737d; font-style: italic;">$&</span>'),t=t.replace(/\/\*[\s\S]*?\*\//g,'<span style="color: #6a737d; font-style: italic;">$&</span>'),t}}!function(e){e.rubinqueryitem="rubinqueryitem",e.rubinhistory="rubinhistory",e.rubinquerynb="rubinquerynb",e.rubinqueryrefresh="rubinqueryrefresh"}(y||(y={}));class S{constructor(e){this.jobref=e.jobref,this.text=e.text}}async function D(e,t,o,n,r){const{commands:i}=e;i.hasCommand(y.rubinqueryitem)||i.addCommand(y.rubinqueryitem,{label:"Open from your query history...",caption:"Open notebook from supplied query jobref ID, dataset:id, or URL",execute:()=>{!async function(e,t,o,n,r){try{const i=await async function(e){const t={title:"Query Jobref ID or URL",body:new B,focusNodeSelector:"input",buttons:[c.Dialog.cancelButton(),c.Dialog.okButton({label:"CREATE"})]};try{const o=await(0,c.showDialog)(t);return o?(g(m.DEBUG,e,`Result from queryDialog: ${o}`),o.value?o.button?"CREATE"===o.button.label?(g(m.DEBUG,e,`Got result ${o.value} from queryDialog: CREATE`),o.value):void g(m.DEBUG,e,"Did not get queryDialog: CREATE"):void g(m.DEBUG,e,"No result.button from queryDialog"):void g(m.DEBUG,e,"No result.value from queryDialog")):void g(m.DEBUG,e,"No result from queryDialog")}catch(e){throw console.error(`Error showing overwrite dialog ${e}`),new Error(`Failed to show overwrite dialog: ${e}`)}}(n);if(g(m.DEBUG,n,`Query URL / ID is ${i}`),!i)return void g(m.WARNING,n,"Query URL was null'");await U(e,t,o,n,i,r)}catch(e){throw g(m.ERROR,n,`Error performing query ${e}`),new Error(`Failed to perform query: ${e}`)}}(e,t,o,n,r)}}),i.hasCommand(y.rubinquerynb)||i.addCommand(y.rubinquerynb,{label:"All queries",caption:"Open notebook requesting all query history",execute:()=>{!async function(e,t,o,n){const r=s.PageConfig.getBaseUrl()+"rubin/query/tap/notebooks/query_all",i={method:"GET"};g(m.INFO,n,"Opening query-all notebook");const a=o.serverSettings;try{const e=(await l(r,i,a)).path;t.open(e)}catch(e){throw g(m.ERROR,n,`Error opening query-all notebook: ${e}`),new Error(`Failed to open query-all notebook: ${e}`)}}(0,t,o,n)}}),i.hasCommand(y.rubinqueryrefresh)||i.addCommand(y.rubinqueryrefresh,{label:"Refresh query history",caption:"Refresh query history",execute:async()=>{await D(e,t,o,n,r)}}),r.clearItems();const a={command:y.rubinqueryitem},u={command:y.rubinquerynb},d={command:y.rubinqueryrefresh};r.insertItem(10,a),g(m.DEBUG,n,"inserted query dialog menu"),r.insertItem(20,{type:"separator"}),r.insertItem(30,u),g(m.DEBUG,n,"inserted all-query notebook generator"),r.insertItem(40,{type:"separator"});try{const i=await async function(e,t,o,n,r){g(m.INFO,n,"Retrieving recent query menu");const{commands:i}=e,a=new N.Menu({commands:i});a.title.label="Recent Queries";const u=new Map;try{const c=await async function(e,t){const o=s.PageConfig.getBaseUrl()+"rubin/query/tap/history/5",n={method:"GET"};g(m.INFO,t,`About to query TAP history at ${o}`);const r=e.serverSettings,i=[];try{const e=await l(o,n,r);g(m.DEBUG,t,`Got query response ${JSON.stringify(e,void 0,2)}`),e.forEach((e=>{const o=new S(e);o.text=e.text,g(m.DEBUG,t,`query menu entry ${JSON.stringify(o,void 0,2)}`),i.push(o)}))}catch(e){throw console.error(`Error showing overwrite dialog ${e}`),new Error(`Failed to show overwrite dialog: ${e}`)}return g(m.DEBUG,t,`rubinqueryrecent history return: ${JSON.stringify(i,void 0,2)}`),i}(o,n);g(m.DEBUG,n,`Recent queries: ${JSON.stringify(c,void 0,2)}`);let d=10;c.forEach((s=>{const l=`q-${s.jobref}`;i.hasCommand(l)||i.addCommand(l,{label:s.jobref,caption:s.text,execute:async()=>{await U(e,t,o,n,s.jobref,r)}}),u.set(s.jobref,{sqlText:s.text,jobref:s.jobref}),a.insertItem(d,{type:"command",command:l}),g(m.DEBUG,n,`Added ${l} to submenu for ${s.jobref}`),d+=10})),new O(u).attachToMenu(a)}catch(e){throw g(m.ERROR,n,`Error performing recent query history ${e}`),new Error(`Failed to query recent history: ${e}`)}return a}(e,t,o,n,r);g(m.DEBUG,n,"recent query menu retrieved"),g(m.DEBUG,n,"inserting recent querymenu..."),r.insertItem(50,{type:"submenu",submenu:i})}catch(e){throw console.error(`Error getting recent query menu ${e}`),new Error(`Failed to get recent query menu: ${e}`)}g(m.DEBUG,n,"...inserted recent query menu"),r.insertItem(60,{type:"separator"}),r.insertItem(70,d),g(m.DEBUG,n,"inserted query refresh")}class B extends N.Widget{constructor(){super({node:T.createQueryNode()}),this.addClass("rubin-qh")}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}async function U(e,t,o,n,r,i){g(m.INFO,n,`Opening query for ${r}`);const a=JSON.stringify({type:"tap",value:r}),u=s.PageConfig.getBaseUrl()+"rubin/query",c={method:"POST",body:a},d=o.serverSettings;try{const r=(await l(u,c,d)).path;t.open(r),D(e,t,o,n,i).catch((e=>{g(m.WARNING,n,`Background menu refresh failed: ${e}`)}))}catch(e){throw g(m.ERROR,n,`Error opening query from jobref: ${e}`),new Error(`Failed to open query from jobref: ${e}`)}}function $(e,t,o,n,r){A(r);const i=Promise.resolve(function(e,t,o,n){const r=[];for(const o of e.shell.widgets("main"))if(o){const e=t.contextForWidget(o);e?(g(m.DEBUG,n,`Saving context for widget: ${{id:o.id}}`),r.push(e.save())):g(m.WARNING,n,`No context for widget: ${{id:o.id}}`)}g(m.DEBUG,n,"Waiting for all save-document promises to resolve.");let i=Promise.resolve(1);return r&&(Promise.all(r),i=r[0]),i}(e,t,0,r));return i.then((t=>q(e,0,0,n,r))),i.catch((e=>{g(m.WARNING,r,`savequit: saveAll failed: ${e.message}`)})),g(m.INFO,r,"savequit: Save and Quit complete."),i}function q(e,t,o,n,r){A(r);let i=`${r.EXTERNAL_INSTANCE_URL}`;return n&&(i+="/logout"),Promise.resolve(function(e,t){const o=e.serviceManager.serverSettings,n=s.PageConfig.getBaseUrl()+"rubin/hub";return g(m.DEBUG,t,`savequit: hubRequest URL: ${n} | Settings: ${o}`),a.ServerConnection.makeRequest(n,{method:"DELETE"},o)}(e,r).then((()=>{g(m.INFO,r,"Quit complete.")})).then((()=>{window.location.replace(i)})))}function A(e){const t={title:"Redirecting to landing page",body:"JupyterLab cleaning up and redirecting to landing page.",buttons:[c.Dialog.okButton({label:"Got it!"})]};return(0,c.showDialog)(t).then((()=>{g(m.DEBUG,e,"Info dialog panel displayed")}))}r.IMainMenu,i.IDocumentManager,function(e){e.createQueryNode=function(){const e=document.createElement("div"),t=document.createElement("label");t.textContent="Enter Query Jobref ID or URL";const o=document.createElement("input");return e.appendChild(t),e.appendChild(o),e}}(T||(T={})),function(e){e.justQuit="justquit:justquit",e.saveQuit="savequit:savequit",e.saveLogout="savelogout:savelogout"}(R||(R={})),r.IMainMenu,i.IDocumentManager,function(e){e.COPY="copy",e.FETCH="fetch"}(v||(v={})),function(e){e.PROMPT="prompt",e.OVERWRITE="overwrite",e.ABORT="abort"}(w||(w={}));class G{constructor(e){this.menu_name=e.menu_name,this.action=e.action,this.disposition=e.disposition,this.parent=e.parent,this.src=e.src,this.dest=e.dest}}class x{constructor(e,t=null,o=null){if(this.entries=null,this.subhierarchies=null,this.env=null,null===t&&(t="<unnamed>"),this.env=o,g(m.INFO,this.env,`Building hierarchy ${t}`),null!==e.entries)for(const o in e.entries){g(m.DEBUG,this.env,`${t} -> entry ${o}`);const n=e.entries[o];null!==n?(null===this.entries&&(this.entries={}),g(m.DEBUG,this.env,`adding entry ${o}: ${JSON.stringify(n,void 0,2)}`),this.entries[o]=new G(n)):g(m.DEBUG,this.env,`skipping null entry ${o}`)}if(null!==e.subhierarchies){const n=Object.keys(e.subhierarchies);g(m.DEBUG,this.env,`Subhierarchies: ${n}`);for(const r of n){if(null===e.subhierarchies){g(m.WARNING,this.env,`Somehow, subhierarchies is null at ${t}`);continue}g(m.DEBUG,this.env,`${t} -> subhierarchy ${r}`);const n=e.subhierarchies[r];null!==n?(null===this.subhierarchies&&(this.subhierarchies={}),g(m.DEBUG,o,`recurse: new subhierarchy of ${t} ${r}`),this.subhierarchies[r]=new x(n,r)):g(m.DEBUG,this.env,`skipping null subhierarchy ${r}`)}}g(m.DEBUG,o,`hierarchy ${t} built`)}}async function C(e,t,o,n){g(m.DEBUG,n,`Sending POST to tutorials endpoint with data ${JSON.stringify(o,void 0,2)}`);try{const r=await a.ServerConnection.makeRequest(s.PageConfig.getBaseUrl()+"rubin/tutorials",{method:"POST",body:JSON.stringify(o)},e);if(409===r.status)try{const r=await async function(e,t,o){const n={title:"Target file exists",body:`Overwrite file '${e}' ?`,buttons:[c.Dialog.cancelButton(),c.Dialog.okButton({label:"OVERWRITE"})]};try{g(m.DEBUG,o,"Showing overwrite dialog");const e=await(0,c.showDialog)(n);return e?(g(m.DEBUG,o,"Result from overwriteDialog: ",e),e.button?"OVERWRITE"===e.button.label?(g(m.DEBUG,o,`Got result ${e.button.label} from overwriteDialog`),e.button.label):void g(m.DEBUG,o,"Did not get overwriteDialog: OVERWRITE"):void g(m.DEBUG,o,"No result.button from overwriteDialog")):void g(m.DEBUG,o,"No result from queryDialog")}catch(e){throw console.error(`Error showing overwrite dialog ${e}`),new Error(`Failed to show overwrite dialog: ${e}`)}}(o.dest,0,n);if(g(m.DEBUG,n,`Dialog result was ${r}`),"OVERWRITE"!==r)return;const i={menu_name:o.menu_name,action:o.action,disposition:w.OVERWRITE,parent:o.parent,src:o.src,dest:o.dest},s=new G(i);await C(e,t,s,n)}catch(e){g(m.ERROR,n,`Error in overwrite dialog: ${e}`)}else 307===r.status||200===r.status?(g(m.DEBUG,n,`Opening file ${o.dest}`),t.openOrReveal(o.dest)):g(m.WARNING,n,`Unexpected response status ${r.status}`)}catch(e){g(m.ERROR,n,`Error in tutorials POST request: ${e}`)}}function L(e,t,o,n){g(m.INFO,n,"rsp-tutorials: loading...");const r=e.serviceManager.serverSettings;function i(n,s,a,l){if(g(m.DEBUG,l,`building tutorials menu for ${n}`),null===a){const{commands:o}=e,n=new N.Menu({commands:o});n.title.label="Tutorials",a=n,g(m.DEBUG,l,"set up top level Tutorials menu"),t.addMenu(n)}else g(m.DEBUG,l,`supplied parent menu=${a.title.label}`);const u=a.title.label;if(g(m.DEBUG,l,`building tutorials menu ${n}, parent=${u}`),null!==s.subhierarchies)for(const t in s.subhierarchies){const o=s.subhierarchies[t];if(null===o){g(m.DEBUG,l,`skipping empty hierarchy ${t}`);continue}if(null===o.entries&&null===o.subhierarchies){g(m.DEBUG,l,`Skipping hierarchy ${t} with no entries or subhierarchies`);continue}g(m.DEBUG,l,`adding submenu ${t} to ${u}`);const{commands:n}=e,r=new N.Menu({commands:n});r.title.label=t,a.addItem({submenu:r,type:"submenu"}),g(m.DEBUG,l,`recurse: hierarchy ${t}`),i(t,o,r,l),g(m.DEBUG,l,`recursion done; emerged from ${t}`)}if(g(m.DEBUG,l,`done with subhierarchies for ${n}`),null!==s.entries){a.addItem({type:"separator"});for(const t in s.entries){const{commands:n}=e,i=s.entries[t],c=`${i.parent}/${i.menu_name}`;g(m.DEBUG,l,`creating command ${c} for entry ${JSON.stringify(t,void 0,2)}`),n.addCommand(c,{label:t,execute:()=>{C(r,o,i,l)}}),g(m.DEBUG,l,`adding item ${c} to ${u}`),a.addItem({command:c,type:"command"})}}g(m.DEBUG,l,`done with ${n}`)}(async()=>{try{const e=await async function(e,t){const o=await l(s.PageConfig.getBaseUrl()+"rubin/tutorials",{method:"GET"},e);g(m.DEBUG,t,`Tutorial endpoint response: ${JSON.stringify(o,void 0,2)}`);const n=new x(o);return g(m.DEBUG,t,"Created TutorialsHierarchy from response"),g(m.DEBUG,t,"=============================="),n}(r,n);e&&i("root",e,null,n)}catch(e){g(m.ERROR,n,`Error loading tutorials hierarchy: ${e}`)}})(),g(m.INFO,n,"rsp-tutorials: ...loaded.")}function M(e){let t=-1;e.ABNORMAL_STARTUP_ERRNO&&(t=parseInt(e.ABNORMAL_STARTUP_ERRNO));let o="EUNKNOWN";e.ABNORMAL_STARTUP_ERRORCODE&&(o=e.ABNORMAL_STARTUP_ERRORCODE);let n="unknown error";e.ABNORMAL_STARTUP_STRERROR&&(n=e.ABNORMAL_STARTUP_STRERROR);let r="???";e.ABNORMAL_STARTUP_MESSAGE&&(r=e.ABNORMAL_STARTUP_MESSAGE);let i=function(e){const t=" This Lab should not be trusted for work you want to keep.",o=" Try deleting unneeded .user_env directories and no-longer relevant large files, then shut down and restart the Lab.",n="You have run out of filesystem space."+o,r="You have exceeded your filesystem quota."+o,i="You do not have permission to write. Ask your RSP site administrator to check ownership and permissions on your directories."+t,s="Please open an issue with your RSP site administrator with the error number, description, and message shown above."+t,a="You are missing environment variables necessary for RSP operation. "+s;switch(e){case"EACCES":case"EROFS":return i;case"ENOSPC":return n;case"EDQUOT":return r;case"EBADENV":return a;default:return s}}(o);return i=i+"\n\n"+`JupyterLab started in an abnormal state: error # ${t} (${o}) [${n}] "${r}"`,i}r.IMainMenu,i.IDocumentManager;const P={activate:function(e,t,o,n){g(m.INFO,null,"getting server environment..."),function(e){return l(s.PageConfig.getBaseUrl()+"rubin/environment",{method:"GET"},e.serviceManager.serverSettings).then((e=>e))}(e).then((async r=>{if(g(m.DEBUG,r,`...env: ${JSON.stringify(r,void 0,2)}...`),g(m.INFO,r,"...got server environment"),g(m.INFO,r,"rsp-lab-extension: loading..."),g(m.INFO,r,"...activating savequit extension..."),function(e,t,o,n){g(m.INFO,null,"rsp-savequit: loading...");e.serviceManager;const{commands:r}=e;r.addCommand(R.justQuit,{label:"Exit Without Saving",caption:"Destroy container",execute:()=>{q(e,0,0,!1,n)}}),r.addCommand(R.saveQuit,{label:"Save All and Exit",caption:"Save open notebooks and destroy container",execute:()=>{$(e,o,0,!1,n)}}),r.addCommand(R.saveLogout,{label:"Save All, Exit, and Log Out",caption:"Save open notebooks, destroy container, and log out",execute:()=>{$(e,o,0,!0,n)}});const i=[{command:R.justQuit},{command:R.saveQuit},{command:R.saveLogout}];t.fileMenu.addGroup(i,150),g(m.INFO,n,"rsp-savequit: ...loaded.")}(e,t,o,r),g(m.INFO,r,"...checking for abnormal startup..."),"TRUE"===r.ABNORMAL_STARTUP)try{await async function(e){const t={title:"Abnormal Lab Start",body:M(e),focusNodeSelector:"input",buttons:[c.Dialog.warnButton({label:"OK"})]};try{const o=await(0,c.showDialog)(t);return o?(g(m.DEBUG,e,`Result from queryDialog: ${o}`),o.value?o.button?void 0:void g(m.DEBUG,e,"No result.button from queryDialog"):void g(m.DEBUG,e,"No result.value from queryDialog")):void g(m.DEBUG,e,"No result from queryDialog")}catch(e){throw console.error(`Error showing abnormal startup dialog ${e}`),new Error(`Failed to show abnormal startup dialog: ${e}`)}}(r)}catch(e){g(m.ERROR,r,`Error showing abnormal dialog: ${e}`)}if(g(m.INFO,r,"...activating displayversion extension..."),function(e,t,o){g(m.INFO,o,"rsp-displayversion: loading...");const n=o.IMAGE_DESCRIPTION||"",r=o.IMAGE_DIGEST,i=o.JUPYTER_IMAGE_SPEC,s=" "+new URL(o.EXTERNAL_INSTANCE_URL||"").hostname,a=o.CONTAINER_SIZE||"";let l="";l=""===a?" ("+o.CPU_LIMIT+" CPU, "+o.MEM_LIMIT+" B)":" "+a;let u="",c="";if(i){const e=i.split("/"),o=e[e.length-1],a=o.split("@");2===a.length?(u=" ["+a[1].substring(7,15)+"...]",c=" ("+a[0]+")"):c=" ("+o+")",""===u&&r&&(u=" ["+r.substring(0,8)+"...]");const d=new p({source:n+u+c+l+s,title:n});t.registerStatusItem(b,{item:d,align:"left",rank:80,isActive:()=>!0})}g(m.INFO,o,"rsp-displayversion: ... loaded")}(0,n,r),g(m.INFO,r,"...activated..."),g(m.INFO,r,"...activating query extension..."),"science"===r.RSP_SITE_TYPE||"staff"===r.RSP_SITE_TYPE)try{await async function(e,t,o,n){g(m.INFO,n,"rsp-query...loading");const r=e.serviceManager,{commands:i}=e,s=new N.Menu({commands:i});t.addMenu(s),s.title.label="Rubin",await D(e,o,r,n,s),g(m.INFO,n,"rsp-query...loaded")}(e,t,o,r),g(m.INFO,r,"...activated...")}catch(e){g(m.ERROR,r,`Error activating query extension: ${e}`)}else g(m.INFO,r,`...skipping query extension because site type is '${r.RSP_SITE_TYPE}'...`);g(m.INFO,r,"...activated..."),g(m.INFO,r,"...activating tutorials extension..."),"science"===r.RSP_SITE_TYPE?(L(e,t,o,r),g(m.INFO,r,"...activated...")):g(m.INFO,r,`...skipping tutorials extension because site type is '${r.RSP_SITE_TYPE}'...`),g(m.INFO,r,"...loaded rsp-lab-extension.")}))},id:f,requires:[r.IMainMenu,i.IDocumentManager,n.IStatusBar],autoStart:!0}}}]);
name: CI Metrics

on:
  workflow_run:
    workflows: ["Quality Gate"]
    types: [completed]

jobs:
  record-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Record CI duration
        run: |
          echo '## CI Metrics Report' >> $GITHUB_STEP_SUMMARY
          echo '' >> $GITHUB_STEP_SUMMARY
          echo '| Metric | Value |' >> $GITHUB_STEP_SUMMARY
          echo '|--------|-------|' >> $GITHUB_STEP_SUMMARY
          echo "| Workflow | ${{ github.event.workflow_run.name }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Conclusion | ${{ github.event.workflow_run.conclusion }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Branch | ${{ github.event.workflow_run.head_branch }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Commit | ${{ github.event.workflow_run.head_sha }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Started | ${{ github.event.workflow_run.run_started_at }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Updated | ${{ github.event.workflow_run.updated_at }} |" >> $GITHUB_STEP_SUMMARY

test-get-user:
  setup: create-user
  steps:
    - path: /api/user
      method: GET
      headers:
        API-Token: $setup.token
      assert:
        body:
          name: $setup.username

test-update-username:
  setup: create-user
  steps:
    - path: /api/user
      method: PUT
      headers:
        API-Token: $setup.token
      data:
        username: "NewUsername"
      assert:
        body:
          body: "Username updated successfully"
    - path: /api/user
      headers:
        API-Token: $setup.token
      assert:
        body:
          name: NewUsername

test-get-users:
  steps:
    - path: /api/user/list
      assert:
        body:
          len(users): <=10


test-get-by-username:
  setup: create-user
  steps:
    - path: /api/user/$setup.username
      assert:
        body:
          name: +str
          id: +int

test-create-post-needs-token:
  steps:
    - path: /api/post/create
      method: POST
      assert:
        status-code: 403
      data:
        title: Some Title
        body: Some message

test-create-post:
  setup: create-user
  steps:
    - path: /api/post/create
      method: POST
      headers:
        API-Token: $setup.token
      data:
        title: Some Title
        body: Some message
      assert:
        status-code: 201

test-create-and-get-post:
  setup: create-user
  steps:
    - path: /api/post/create
      id: create-post
      method: POST
      headers:
        API-Token: $setup.token
      data:
        title: Some Title
        body: Some message
      assert:
        status-code: 201

    - path: /api/post/$create-post.response.post_id
      method: GET
      assert:
        full: true
        body:
          title: "Some Title"
          body: "Some message"

test-create-and-get-post-fail:
  setup: create-user
  steps:
    - path: /api/post/create
      id: create-post
      method: POST
      headers:
        API-Token: $setup.token
      data:
        title: Some Other Title
        body: Some message
      assert:
        status-code: 201

    - path: /api/post/$create-post.response.post_id
      method: GET
      assert:
        body:
          title: +int
          body: Some bad message



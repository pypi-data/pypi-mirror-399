{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "the metadata of the llm engine",
  "type": "object", 
  "required": ["prompt"],
  "properties": {
    "tpl_id":{
      "type":"string",
      "pattern":"^[A-Za-z0-9.-_]+$",
      "$comment": "the instance id of the instance"
    },
    "summary": {
      "type": ["object","null"]  
    },
    
    // for loop command
    "loop": { "$ref":"#/$defs/loop" },
    "request": {
      "type": "object",
      "$comment": "the request body of the llm api"
    },
    "prompt": {
      "type": "object", 
      "required":["user","system"],
      "properties": {
        "max_chars": {
          "type": ["integer","null"],
          "minimum": 1,
          "maximum": 4000,
          "$comment": "the max chars of the prompt"
        },
        "user":{ "$ref":"#/$defs/prompt_user"},
        "system":{ "$ref":"#/$defs/prompt_system"}
      }
    }
  },
  "additionalProperties": false,
  "$defs": {
    "prompt_user":{
      "type":"object",
      "required":["content"],
      "properties":{
        "prefix":{
          "type":["string","null"]
        },
        "suffix":{
          "type":["string","null"]
        },
        "content":{
          "type":["string","null"],
          "minLength":1
        }
      }
    },
    "prompt_system":{
      "type":"object",
      "required":["content"],
      "properties":{
        "content":{
          "type":"string",
          "minLength":1
        }
      }
    },
    "loop":{
      "type":"object",
      "required":["entities"],
      "properties":{
        "entities":{
          "type":["array","null"],
          "items":{
            "type":"object"
          },
          "minItems":1
        },
        "map":{
          "type":["object","null"],
          "$comment": "the map form entity to bizdata"
        },
        "count":{
          "type":["integer","null"],
          "minimum":-1
        }
      },
      "additionalProperties": false
    }
  } 
}
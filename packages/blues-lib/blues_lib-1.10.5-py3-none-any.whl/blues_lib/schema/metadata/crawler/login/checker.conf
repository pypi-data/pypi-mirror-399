{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "the metadata of the llm engine",
  "type": "object", 
  "required": ["summary","browser","crawler"],
  "properties": {
    "tpl_id":{
      "type":"string",
      "pattern":"^[A-Za-z0-9.-_]+$",
      "$comment": "the instance id of the instance"
    },
    "summary": { "$ref":"#/$defs/summary" },
    "browser":{ "$ref":"#/$defs/browser" },
    "crawler":{ "$ref":"#/$defs/crawler" },
  },
  "additionalProperties": false,
  "$defs": {
    "summary":{
      "type":"object",
      "required":["type"],
      "properties":{
        "type":{
          "type":"string",
          "const":"URL"
        },
      }
    },
    
    "browser":{
      "type":"object",
      "required":["config","options"],
      "properties":{
        "config":{
          "type":["object","null"],
          "minProperties":1
        },
        "options":{
          "type":["object","null"],
          "minProperties":1
        }
      }
    },
    "crawler":{
      "type": "object",
      "required":["login","data"],
      "properties":{
        "login":{ "$ref":"#/$defs/login" },
        "data":{ "$ref":"#/$defs/data" },
      },
    },
    "login":{
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "items": [
        // 第1个元素：固定为 _kind="open" + url="${login_url}"
        {
          "type": "object",
          "required": ["_kind", "url"],
          "properties": {
            "_kind": { "type": "string", "const": "open" },
            "url": { "type": "string", "pattern": "^https?://.*$" }
          },
          "additionalProperties": false
        },
        // 第2个元素：固定为 _kind="br_cookie" + value="__sentinel__"
        {
          "type": "object",
          "required": ["_kind", "value"],
          "properties": {
            "_kind": { "type": "string", "const": "br_cookie" },
            "value": { "type": "string", "const": "__sentinel__" }
          },
          "additionalProperties": false
        },
        // 第3个元素：固定为 _kind="open" + url="${logged_in_url}"
        {
          "type": "object",
          "required": ["_kind", "url"],
          "properties": {
            "_kind": { "type": "string", "const": "open" },
            "url": { "type": "string", "pattern": "^https?://.*$" }
          },
          "additionalProperties": false
        }
      ],
      "description": "必须包含3个固定对象，且顺序严格一致"
    },
    "data":{
      "type": "object",
      "required":["_kind","loc_or_elem"],
      "properties":{
        "_kind":{
          "type":"string",
          "enum":["ele_presents","ele_absents"]
        },
        "loc_or_elem":{
          "type":"string",
          "minLength":1
        },
        "wait_time":{
          "type":"integer",
          "minimum":2
        }
      },
    },
  }
}
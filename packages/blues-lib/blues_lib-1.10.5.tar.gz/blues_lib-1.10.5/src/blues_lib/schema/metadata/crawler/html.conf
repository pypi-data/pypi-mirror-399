{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "the metadata of the llm engine",
  "type": "object", 
  "required": ["summary","browser","crawler"],
  "properties": {
    "tpl_id":{
      "type":"string",
      "pattern":"^[A-Za-z0-9.-_]+$",
      "$comment": "the instance id of the instance"
    },
    "loop":{ "$ref":"#/$defs/loop" },
    "summary": { "$ref":"#/$defs/summary" },
    "browser":{ "$ref":"#/$defs/browser" },
    "crawler":{ "$ref":"#/$defs/crawler" },
  },
  "additionalProperties": false,
  "$defs": {
    "summary":{
      "type":"object",
      "required":["type"],
      "properties":{
        "type":{
          "type":"string",
          "enum":["FOR","URL"]
        },
        "urls":{
          "type":["array","null"],
          "items":{
            "type":"string",
            "pattern":"^https?://.*$"
          },
          "minItems":1
        },
        "entities":{
          "type":["array","null"],
          "items":{
            "type":"object",
          },
          "minProperties":1
        }
      }
    },
    
    // for loop command
    "loop":{
      "type":"object",
      "required":["entities"],
      "properties":{
        "entities":{
          "type":["array","null"],
          "items":{
            "type":"object",
            "minProperties":1
          },
          "minItems":1
        },
        "map":{
          "type":["object","null"],
          "minProperties":1
        },
        "count":{
          "type":["integer","null"],
          "minimum":-1
        }
      }
    },
    "browser":{
      "type":"object",
      "required":["config","options"],
      "properties":{
        "config":{
          "type":["object","null"],
          "minProperties":1
        },
        "options":{
          "type":["object","null"],
          "minProperties":1
        }
      }
    },
    "crawler":{
      "type": "object",
      "required":["data"],
      "properties":{
        "open":{ "$ref":"#/$defs/open" },
        "data":{ "$ref":"#/$defs/data" },
      },
    },
    "open":{
      "type": "object",
      "required":["_kind","url"],
      "properties":{
        "_kind":{ 
          "type":"string",
          "const":"open"
        },
        "url":{ 
          "type":["string","null"],
          "pattern":"^https?://.*$"
        },
      },
    },
    "data":{
      "type": "object",
      "required":["mat_url","html"],
      "properties":{
        "mat_url":{ "$ref":"#/$defs/url" },
        "html":{ "$ref":"#/$defs/html" }
      },
    },
    "url":{
      "type":"object",
      "properties":{
        "required":["_kind"],
        "_kind":{
          "type":"string",
          "const":"url"
        },
      }
    },
    "html":{
      "type":"object",
      "properties":{
        "required":["_kind","after_invoked"],
        "_kind":{
          "type":"string",
          "const":"page_source"
        },
        "scroll":{
          "type":["object","null"],
          "minProperties":1
        },
        "after_invoked":{ "$ref":"#/$defs/after_invoked" }
      },
    },
    "after_invoked":{
      "type":"array",
      "items":{
        "type":"object",
        "required":["kind","value","proc"],
        "properties":{
          "kind":{
            "type":"string",
            "const":"class"
          },
          "value":{
            "type":"string",
            "const":"HtmlFilter"
          },
          "proc":{
            "type":"object",
            "properties":{
              "required":["includes"],
              "includes":{
                "type":"array",
                "items":{
                  "type":"string",
                  "minLength":1
                },
                "minItems":1
              },
              "excludes":{
                "type":["array","null"],
                "items":{
                  "type":"string",
                  "minLength":1
                },
                "minItems":1
              }
            },
          }
        },
      },
      "minItems":1,
      "maxItems":1
    }
  }
}
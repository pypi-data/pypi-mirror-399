"use strict";(self.webpackChunkjupyterlab_export_markdown_extension=self.webpackChunkjupyterlab_export_markdown_extension||[]).push([[750],{750:(t,e,o)=>{o.r(e),o.d(e,{default:()=>g});var n=o(827),a=o(684),r=o(223),i=o(247),d=o(292),s=o(907);var c;!function(t){t.exportPdf="export-markdown:pdf",t.exportDocx="export-markdown:docx",t.exportHtml="export-markdown:html"}(c||(c={}));const l={pdf:"pdf",docx:"docx",html:"html"},m={pdf:"application/pdf",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",html:"text/html"};const p={id:"jupyterlab_export_markdown_extension:plugin",description:"JupyterLab extension to export markdown files as PDF, DOCX and HTML with embedded images",autoStart:!0,requires:[a.IMainMenu,n.ICommandPalette],optional:[r.ISettingRegistry],activate:async(t,e,o,a)=>{console.log("JupyterLab extension jupyterlab_export_markdown_extension is activated!");let r=150;if(a)try{const t=await a.load(p.id);r=t.get("diagramDPI").composite,console.log("Export Markdown: Loaded diagram DPI from settings:",r),t.changed.connect(()=>{r=t.get("diagramDPI").composite,console.log("Export Markdown: Diagram DPI changed to:",r)})}catch(t){console.error("Export Markdown: Failed to load settings:",t)}const{commands:g,shell:u}=t,h=()=>{const t=u.currentWidget;if(!t)return null;const e=t.context;if(null==e?void 0:e.path){const t=e.path;if(t.toLowerCase().endsWith(".md"))return t}return null},x=()=>null!==h(),w=t=>async()=>{const e=h();if(e){const o=function(t){const e=document.createElement("div");e.style.display="flex",e.style.alignItems="center",e.style.gap="12px",e.style.padding="8px 0",e.innerHTML=`\n    <div style="\n      width: 24px;\n      height: 24px;\n      border: 3px solid var(--jp-border-color2);\n      border-top-color: var(--jp-brand-color1);\n      border-radius: 50%;\n      animation: jp-export-spin 1s linear infinite;\n    "></div>\n    <span>Exporting to ${t.toUpperCase()}...</span>\n    <style>\n      @keyframes jp-export-spin {\n        to { transform: rotate(360deg); }\n      }\n    </style>\n  `;const o=new i.Widget({node:e}),a=new n.Dialog({title:"Exporting",body:o,buttons:[]});return a.launch(),a}(t);try{const o=function(t,e=300){const o=[],n=t.currentWidget;if(!n)return o;const a=n.node.querySelector(".jp-RenderedMarkdown");if(!a)return o;let r=0;return a.querySelectorAll("img").forEach(t=>{const n=t.getAttribute("src")||"";if(n.startsWith("data:image/svg+xml")){let a=n;if(n.startsWith("data:image/svg+xml,")){const t=n.replace("data:image/svg+xml,",""),e=decodeURIComponent(t);a=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(e)))}`}let i={dataUri:"",width:0,height:0};try{i=function(t,e=300){const o=t.naturalWidth||t.width||800,n=t.naturalHeight||t.height||600,a=e/11.5,r=document.createElement("canvas");r.width=Math.round(o*a),r.height=Math.round(n*a);const i=r.getContext("2d",{alpha:!0});if(!i)throw new Error("Failed to get canvas context");return i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(t,0,0,r.width,r.height),{dataUri:r.toDataURL("image/png"),width:r.width,height:r.height}}(t,e)}catch(t){console.warn(`Failed to convert Mermaid diagram ${r} to PNG:`,t)}o.push({index:r,svg:a,png:i.dataUri,width:i.width,height:i.height}),r++}}),a.querySelectorAll("svg").forEach(t=>{var e;if((null===(e=t.id)||void 0===e?void 0:e.includes("mermaid"))||"mermaid"===t.getAttribute("aria-roledescription")||t.classList.contains("mermaid")){const e=(new XMLSerializer).serializeToString(t),n=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(e)))}`;o.push({index:r,svg:n,png:"",width:0,height:0}),r++}}),o}(u,r);await async function(t,e,o){const n=await async function(t="",e={}){const o=s.ServerConnection.makeSettings(),n=d.URLExt.join(o.baseUrl,"jupyterlab-export-markdown-extension",t);let a;try{a=await s.ServerConnection.makeRequest(n,e,o)}catch(t){throw new s.ServerConnection.NetworkError(t)}if(!a.ok){let t;try{const e=await a.json();t=e.message||e.error||a.statusText}catch(e){t=a.statusText}throw new s.ServerConnection.ResponseError(a,t)}return await a.blob()}(`export/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t,mermaidDiagrams:o})}),a=new Blob([n],{type:m[e]}),r=function(t,e){var o;return`${(null===(o=t.split("/").pop())||void 0===o?void 0:o.replace(/\.md$/i,""))||"document"}.${l[e]}`}(t,e);!function(t,e){const o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)}(a,r)}(e,t,o)}catch(e){console.error(`Failed to export to ${t.toUpperCase()}:`,e),(0,n.showErrorMessage)(`Export to ${t.toUpperCase()} Failed`,e instanceof Error?e.message:String(e))}finally{o.dispose()}}};g.addCommand(c.exportPdf,{label:t=>t.isPalette?"Export Markdown to PDF":"PDF",caption:"Export markdown to PDF",isEnabled:x,execute:w("pdf")}),g.addCommand(c.exportDocx,{label:t=>t.isPalette?"Export Markdown to Word (.docx)":"Microsoft Word (.docx)",caption:"Export markdown to DOCX",isEnabled:x,execute:w("docx")}),g.addCommand(c.exportHtml,{label:t=>t.isPalette?"Export Markdown to HTML":"HTML",caption:"Export markdown to HTML with embedded images",isEnabled:x,execute:w("html")});const f="Export Markdown";o.addItem({command:c.exportPdf,category:f,args:{isPalette:!0}}),o.addItem({command:c.exportDocx,category:f,args:{isPalette:!0}}),o.addItem({command:c.exportHtml,category:f,args:{isPalette:!0}});const b=new i.Menu({commands:g});b.title.label="Export Markdown As",b.addItem({command:c.exportPdf}),b.addItem({command:c.exportDocx}),b.addItem({command:c.exportHtml}),e.fileMenu.addGroup([{type:"submenu",submenu:b}],5);const y=()=>{const t=x();b.title.className=t?"":"lm-mod-hidden"};u.currentChanged&&u.currentChanged.connect(y),y()}},g=p}}]);
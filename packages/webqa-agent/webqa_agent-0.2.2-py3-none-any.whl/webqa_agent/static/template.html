<!DOCTYPE html>
    <html lang="{{ language[:2] if language else 'en' }}">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ i18n.template.report_title if i18n.template else 'webqa agent Test Report' }}</title>
        <style>
            :root {
                --success-color: #28a745;
                --success-bg: #d4edda;
                --failure-color: #dc3545;
                --failure-bg: #f8d7da;
                --warning-color: #f0ad4e;
                --warning-bg: #fff3cd;
                --primary-color: #007bff;
                --primary-bg: #e7f1ff;
                --secondary-color: #6c757d;
                --light-bg: #f8f9fa;
                --border-color: #dee2e6;
                --hover-bg: #e9ecef;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
                margin: 0;
                padding: 0;
                color: #333;
                height: 100vh;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            pre {
                white-space: pre-wrap;
                word-wrap: break-word;
                word-break: break-all;
                background-color: var(--light-bg);
                padding: 10px;
                border-radius: 4px;
                overflow: auto;
                font-size: 13px;
                max-height: 300px;
                margin: 0;
            }

            .header {
                background-color: #fff;
                padding: 15px 20px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                z-index: 100;
            }

            .header-top {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 15px;
            }

            .header-left {
                display: flex;
                align-items: center;
            }

            .test-title {
                margin-right: 20px;
            }

            .config-tab {
                display: flex;
                align-items: center;
                padding: 4px 10px;
                background-color: var(--light-bg);
                border: 1px solid var(--border-color);
                border-radius: 4px;
                cursor: pointer;
                font-size: 13px;
                transition: all 0.2s;
            }

            .config-tab:hover {
                background-color: var(--hover-bg);
            }

            .config-tab.active {
                background-color: var(--primary-bg);
                border-color: var(--primary-color);
                color: var(--primary-color);
            }

            .config-tab i {
                margin-right: 6px;
            }

            .github-link {
                margin-left: 20px;
                font-size: 13px;
                color: var(--secondary-color);
            }

            .github-link a {
                color: var(--primary-color);
                text-decoration: none;
                font-weight: 500;
                transition: color 0.2s;
            }

            .github-link a:hover {
                color: #0f33d5;
                text-decoration: underline;
            }

            .config-panel {
                display: none;
                background-color: #fff;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                padding: 12px;
                margin-bottom: 12px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                font-size: 12px;
            }

            .config-panel.active {
                display: block;
            }

            .config-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
            }

            .config-item {
                background-color: var(--light-bg);
                padding: 10px;
                border-radius: 4px;
            }

            .config-label {
                font-weight: 500;
                color: var(--secondary-color);
                margin-bottom: 6px;
                font-size: 12px;
            }

            .config-value {
                font-family: monospace;
                font-size: 11px;
                word-break: break-all;
            }

            .config-value pre {
                margin: 0;
                padding: 6px;
                background-color: #fff;
                border-radius: 4px;
                font-size: 11px;
            }

            .test-summary {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 15px;
            }

            .test-title {
                font-size: 22px;
                font-weight: 600;
                color: #333;
            }

            .test-stats {
                display: flex;
                gap: 15px;
            }

            .stat-item {
                padding: 6px 12px;
                border-radius: 4px;
                font-weight: 500;
                font-size: 14px;
            }

            .stat-item.success {
                background-color: var(--success-bg);
                color: var(--success-color);
            }

            .stat-item.failure {
                background-color: var(--failure-bg);
                color: var(--failure-color);
            }

            .stat-item.warning {
                background-color: var(--warning-bg);
                color: var(--warning-color);
            }

            .hint-text {
                font-size: 13px;
                color: var(--secondary-color);
                margin-bottom: 10px;
                font-style: italic;
            }

            .case-bar {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 5px;
            }

            .case-buttons-viewport {
                position: relative;
                flex: 1;
                overflow: hidden;
            }

            .case-buttons {
                display: flex;
                flex-wrap: nowrap;
                align-items: center;
                gap: 10px;
                margin-bottom: 0;
                overflow-x: auto;
                scrollbar-width: thin;
                -ms-overflow-style: none;
            }

            .case-buttons::-webkit-scrollbar {
                height: 6px;
            }

            .case-buttons::-webkit-scrollbar-thumb {
                background-color: #cfcfcf;
                border-radius: 3px;
            }

            .case-nav {
                border: 1px solid var(--border-color);
                background: #fff;
                border-radius: 4px;
                width: 28px;
                height: 28px;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                color: #666;
            }

            .case-nav:hover {
                background-color: var(--hover-bg);
            }

            .case-more {
                position: relative;
            }

            .case-more-btn {
                border: 1px solid var(--border-color);
                background: #fff;
                border-radius: 4px;
                width: 36px;
                height: 28px;
                cursor: pointer;
                font-weight: 600;
            }

            .case-more-menu {
                position: absolute;
                right: 0;
                top: 32px;
                min-width: 260px;
                max-height: 300px;
                overflow: auto;
                background: #fff;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.12);
                display: none;
                z-index: 200;
            }

            .case-more-item {
                padding: 8px 12px;
                cursor: pointer;
                white-space: nowrap;
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 10px;
            }

            .case-more-item:hover {
                background-color: var(--hover-bg);
            }

            .case-more-item .badge {
                flex-shrink: 0;
            }

            .case-button {
                padding: 8px 16px;
                background-color: var(--light-bg);
                border: 1px solid var(--border-color);
                border-radius: 4px;
                cursor: pointer;
                font-weight: 500;
                font-size: 14px;
                transition: all 0.2s;
                display: inline-flex;
                align-items: center;
                white-space: nowrap;
                flex: 0 0 auto;
                max-width: 320px;
            }

            .case-label {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                min-width: 0;
            }

            .case-button:hover {
                background-color: var(--hover-bg);
            }

            .case-button.active {
                background-color: var(--primary-bg);
                color: var(--primary-color);
                border-color: var(--primary-color);
            }

            .case-button .badge {
                margin-left: 8px;
                display: inline-block;
                padding: 2px 6px;
                border-radius: 10px;
                font-size: 12px;
                font-weight: 500;
            }

            .badge-success {
                background-color: var(--success-bg);
                color: var(--success-color);
            }

            .badge-failure {
                background-color: var(--failure-bg);
                color: var(--failure-color);
            }

            .badge-warning {
                background-color: var(--warning-bg);
                color: var(--warning-color);
            }

            .content-container {
                display: flex;
                flex: 1;
                overflow: hidden;
                position: relative;
                height: calc(100vh - 120px);
            }

            .steps-panel {
                width: 250px;
                min-width: 200px;
                max-width: 400px;
                background-color: var(--light-bg);
                border-right: 1px solid var(--border-color);
                overflow-y: auto;
                padding: 10px;
                flex-shrink: 0;
            }

            .step-item {
                padding: 12px 15px;
                background-color: #fff;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                margin-bottom: 10px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .step-item:hover {
                background-color: var(--hover-bg);
            }

            .step-item.active {
                background-color: var(--primary-bg);
                border-color: var(--primary-color);
            }

            .step-number {
                font-weight: 600;
                margin-bottom: 5px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .step-description {
                font-size: 14px;
                color: #555;
            }

            .step-time {
                font-size: 12px;
                color: var(--secondary-color);
                margin-top: 5px;
            }

            .screenshots-panel {
                width: 40%;
                min-width: 300px;
                padding: 20px;
                overflow-y: auto;
                background-color: #fff;
                border-right: 1px solid var(--border-color);
            }

            .action-io-panel {
                flex: 1;
                min-width: 350px;
                padding: 20px;
                background-color: #fff;
                overflow-y: auto;
            }

            .step-screenshots, .step-actions-io {
                display: none;
            }

            .step-screenshots.active, .step-actions-io.active {
                display: block;
            }

            .screenshot-wrapper {
                margin-bottom: 20px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                overflow: hidden;
                scroll-margin-top: 20px;
            }

            .screenshot-title {
                padding: 10px;
                background-color: var(--light-bg);
                border-bottom: 1px solid var(--border-color);
                font-weight: 500;
            }

                .screenshot {
                    max-width: 100%;
                    height: auto;
                    display: block;
                }

                .screenshot.lazy-load {
                    min-height: 150px;
                }

            .screenshot.lazy-load {
                min-height: 200px;
                background-color: #f0f0f0;
                transition: opacity 0.3s ease;
            }

            .screenshot.lazy-load.loading {
                opacity: 0.6;
            }

            .panel-title {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 15px;
                color: #444;
                padding-bottom: 8px;
                border-bottom: 1px solid var(--border-color);
            }

            .actions-list {
                margin-bottom: 30px;
            }

            .action-card {
                cursor: pointer;
                transition: background-color 0.2s;
            }

            .action-card:hover {
                background-color: var(--hover-bg);
            }

            .action-card.success {
                border-color: var(--success-color);
            }

            .action-card.failure {
                border-color: var(--failure-color);
            }

            .action-header {
                padding: 10px 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid var(--border-color);
            }

            .action-title {
                font-weight: 500;
            }

            .action-result {
                font-size: 13px;
                font-weight: 500;
            }

            .action-result.success {
                color: var(--success-color);
            }

            .action-result.failure {
                color: var(--failure-color);
            }

            .action-details {
                padding: 10px 15px;
                font-size: 14px;
                background-color: var(--light-bg);
            }

            .model-io {
                border: 1px solid var(--border-color);
                border-radius: 4px;
                overflow: hidden;
            }

            .model-io-header {
                padding: 10px 15px;
                background-color: var(--light-bg);
                border-bottom: 1px solid var(--border-color);
                font-weight: 500;
            }

            .model-io-content {
                padding: 15px;
            }

            .io-section {
                margin-bottom: 15px;
            }

            .io-title {
                font-weight: 500;
                margin-bottom: 8px;
                color: var(--secondary-color);
            }

            /* Styles for markdown-rendered modelIO */
            .model-io-rendered pre {
                background-color: #f6f8fa;
                border: 1px solid #d0d7de;
                border-radius: 6px;
                padding: 16px;
                overflow: auto;
                font-size: 13px;
                line-height: 1.45;
                margin: 0;
            }

            .model-io-rendered code {
                background-color: rgba(175,184,193,0.2);
                border-radius: 3px;
                font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace;
                font-size: 12px;
                padding: 2px 6px;
            }

            .model-io-rendered pre code {
                background-color: transparent;
                border: 0;
                display: block;
                padding: 0;
                line-height: inherit;
                word-wrap: normal;
                white-space: pre;
            }

            .model-io-rendered strong {
                font-weight: 600;
            }

            .model-io-rendered em {
                font-style: italic;
            }

            pre {
                background-color: var(--light-bg);
                padding: 10px;
                border-radius: 4px;
                overflow: auto;
                font-size: 13px;
                max-height: 300px;
                margin: 0;
            }

            .no-data {
                color: var(--secondary-color);
                font-style: italic;
                padding: 15px 0;
            }

            .resize-handle {
                width: 6px;
                background-color: #e6e6e6;
                cursor: col-resize;
                position: relative;
                z-index: 10;
                flex-shrink: 0;
            }

            .resize-handle:hover,
            .resize-handle.dragging {
                background-color: var(--primary-color);
            }

            .case-content {
                display: none;
            }

            .case-content.active {
                display: flex;
                width: 100%;
                height: 100%;
            }

            .screenshot-wrapper.highlight {
                box-shadow: 0 0 10px 2px var(--primary-color);
                transition: box-shadow 0.3s ease;
            }

            .page-result {
                margin-bottom: 30px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                overflow: hidden;
            }

            .page-result-section {
                margin-bottom: 15px;
            }

            .page-section-header {
                padding: 10px 15px;
                background-color: var(--light-bg);
                border-bottom: 1px solid var(--border-color);
                font-weight: 500;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .badge-count {
                background-color: var(--secondary-color);
                color: white;
                border-radius: 10px;
                padding: 2px 8px;
                font-size: 12px;
                font-weight: 500;
            }

            .page-section-content {
                padding: 10px 15px;
            }

            .console-error {
                padding: 8px;
                margin-bottom: 8px;
                background-color: var(--failure-bg);
                border-left: 3px solid var(--failure-color);
                border-radius: 4px;
            }

            .error-message {
                font-weight: 500;
                color: var(--failure-color);
            }

            .error-location {
                font-size: 12px;
                color: var(--secondary-color);
                margin-top: 4px;
            }

            .network-table-container {
                overflow-x: auto;
            }

            .network-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 13px;
            }

            .network-table th {
                text-align: left;
                padding: 8px;
                background-color: var(--light-bg);
                border-bottom: 1px solid var(--border-color);
            }

            .network-table td {
                padding: 8px;
                border-bottom: 1px solid var(--border-color);
            }

            .network-row {
                cursor: pointer;
            }

            .network-row:hover {
                background-color: var(--hover-bg);
            }

            .network-row.error-row {
                background-color: var(--failure-bg);
            }

            .network-row.error-row:hover {
                background-color: #f5c6cb;
            }

            .network-row.warning-row {
                background-color: var(--warning-bg);
            }

            .network-row.warning-row:hover {
                background-color: #ffeaa7;
            }

            .status-col {
                width: 60px;
            }

            .method-col {
                width: 70px;
            }

            .url-col {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 300px;
            }

            .type-col {
                width: 150px;
            }

            .time-col {
                width: 180px;
            }

            .status-col.success {
                color: var(--success-color);
            }

            .status-col.warning {
                color: #f0ad4e;
            }

            .status-col.error, .status-col.failed {
                color: var(--failure-color);
            }

            .response-details {
                display: none;
                background-color: var(--light-bg);
            }

            .response-detail-content {
                padding: 15px;
            }

            .response-body, .event-data {
                max-height: 300px;
                overflow: auto;
                background-color: white;
                padding: 10px;
                border-radius: 4px;
                border: 1px solid var(--border-color);
                margin: 5px 0;
            }

            .events-container {
                max-height: 400px;
                overflow: auto;
            }

            .event-item {
                margin-bottom: 10px;
            }

            /* ‰øÆÊîπË≠¶ÂëäÂõæÊ†áÊ†∑Âºè */
            .warning-icon {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 16px;
                height: 16px;
                background-color: var(--warning-color);
                color: white;
                border-radius: 50%;
                font-size: 12px;
                font-weight: bold;
                margin-left: 6px;
                cursor: help;
            }

            /* ‰øÆÊîπË≠¶ÂëäÊñáÂ≠óÊ†∑Âºè */
            .warning-text {
                color: var(--warning-color);
                font-size: 12px;
                margin-left: 5px;
                font-weight: 500;
            }

            /* Ë≠¶ÂëäÊèêÁ§∫Ê†∑Âºè */
            .warning-tooltip {
                position: relative;
                display: inline-block;
                cursor: help;
            }

            .warning-tooltip .tooltip-text {
                visibility: hidden;
                width: 120px;
                background-color: #555;
                color: #fff;
                text-align: center;
                border-radius: 6px;
                padding: 5px;
                position: absolute;
                z-index: 1;
                bottom: 125%;
                left: 50%;
                margin-left: -60px;
                opacity: 0;
                transition: opacity 0.3s;
                font-size: 12px;
                pointer-events: none;
            }

            .warning-tooltip:hover .tooltip-text {
                visibility: visible;
                opacity: 1;
            }

            .response-section {
                margin-bottom: 20px;
            }

            .response-section h4 {
                margin: 10px 0;
                color: var(--secondary-color);
                font-size: 14px;
            }

            .response-headers,
            .response-body,
            .sse-data {
                background-color: var(--light-bg);
                padding: 10px;
                border-radius: 4px;
                font-family: monospace;
                font-size: 13px;
                white-space: pre-wrap;
                word-wrap: break-word;
                max-height: 300px;
                overflow: auto;
                margin: 5px 0;
                border: 1px solid var(--border-color);
            }

            .sse-messages {
                max-height: 500px;
                overflow: auto;
            }

            .sse-message {
                margin-bottom: 10px;
                padding: 5px;
                border-bottom: 1px solid var(--border-color);
            }

            .sse-message:last-child {
                border-bottom: none;
            }

            /* ÁßªÂä®Á´ØÂìçÂ∫îÂºèÊ†∑Âºè */
            @media screen and (max-width: 768px) {
                body {
                    overflow-x: hidden;
                }

                .header {
                    padding: 10px;
                }

                .header-top {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 10px;
                }

                .header-left {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 8px;
                    width: 100%;
                }

                .test-title {
                    font-size: 18px;
                }

                .test-stats {
                    flex-wrap: wrap;
                    gap: 8px;
                    width: 100%;
                }

                .stat-item {
                    font-size: 12px;
                    padding: 4px 8px;
                }

                .github-link {
                    margin-left: 0;
                    font-size: 12px;
                }

                .config-panel {
                    font-size: 11px;
                }

                .config-grid {
                    grid-template-columns: 1fr;
                }

                .case-bar {
                    padding: 0 5px;
                }

                .case-button {
                    font-size: 12px;
                    padding: 6px 12px;
                    max-width: 200px;
                }

                /* ÁßªÂä®Á´ØÂÜÖÂÆπÂÆπÂô® - ÂÖÅËÆ∏Ê®™ÂêëÊªöÂä® */
                .content-container {
                    flex-direction: row;
                    overflow-x: auto;
                    overflow-y: hidden;
                    height: calc(100vh - 180px);
                    -webkit-overflow-scrolling: touch;
                    scroll-snap-type: x mandatory;
                }

                .case-content {
                    flex-direction: row;
                    min-width: 100%;
                    overflow-x: auto;
                }

                /* ‰∏â‰∏™Èù¢ÊùøÂú®ÁßªÂä®Á´Ø‰øùÊåÅÊ®™ÂêëÊéíÂàóÔºåÂèØ‰ª•Â∑¶Âè≥ÊªëÂä® */
                .steps-panel {
                    min-width: 280px;
                    width: 280px;
                    flex-shrink: 0;
                    scroll-snap-align: start;
                    overflow-y: auto;
                }

                .screenshots-panel {
                    min-width: 85vw;
                    width: 85vw;
                    flex-shrink: 0;
                    scroll-snap-align: start;
                    overflow-y: auto;
                    border-right: 1px solid var(--border-color);
                    border-left: 1px solid var(--border-color);
                }

                .action-io-panel {
                    min-width: 85vw;
                    width: 85vw;
                    flex-shrink: 0;
                    scroll-snap-align: start;
                    overflow-y: auto;
                    padding: 15px 10px;
                }

                /* ÈöêËóèÊãñÂä®ÊâãÊüÑ */
                .resize-handle {
                    display: none;
                }

                .step-item {
                    padding: 10px;
                    font-size: 13px;
                }

                .step-description {
                    font-size: 13px;
                }

                .screenshot-wrapper {
                    margin-bottom: 15px;
                }

                .screenshot {
                    max-width: 100%;
                    height: auto;
                }

                .panel-title {
                    font-size: 14px;
                }

                .action-card {
                    font-size: 13px;
                }

                pre {
                    font-size: 11px;
                    max-height: 200px;
                }

                .network-table {
                    font-size: 11px;
                }

                .network-table th,
                .network-table td {
                    padding: 6px 4px;
                }

                .url-col {
                    max-width: 150px;
                }

                /* ÁßªÂä®Á´ØÊèêÁ§∫ */
                .mobile-hint {
                    display: block;
                    text-align: center;
                    padding: 8px;
                    background-color: var(--primary-bg);
                    color: var(--primary-color);
                    font-size: 12px;
                    border-bottom: 1px solid var(--border-color);
                }
            }

            /* Ê°åÈù¢Á´ØÈöêËóèÁßªÂä®Á´ØÊèêÁ§∫ */
            .mobile-hint {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="header-top">
                <div class="header-left">
                    <div class="test-title">{{ i18n.template.report_title if i18n.template else 'webqa agent Test Report' }}</div>
                    <div class="config-tab" onclick="toggleConfig()">
                        {{ i18n.template.test_config if i18n.template else 'Test Configuration' }}
                    </div>
                    <div class="github-link">
                        <a href="https://github.com/MigoXLab/webqa-agent" target="_blank">GitHub</a> Star ‚≠ê
                    </div>
                </div>
                <div class="test-stats">
                    <div class="stat-item success">{{ i18n.template.passed if i18n.template else 'Passed' }}: {{ passed_count + warning_count }}{% if warning_count > 0 %} <span class="warning-text warning-tooltip">{{ i18n.template.warning if i18n.template else 'Warning' }}<span class="tooltip-text">{{ warning_count }} {{ i18n.template.warning_tooltip if i18n.template else 'test cases have warnings' }}</span></span>{% endif %}</div>
                    <div class="stat-item failure">{{ i18n.template.failed if i18n.template else 'Failed' }}: {{ failed_count }}</div>
                    <div class="stat-item warning">{{ i18n.template.exception if i18n.template else 'Exception' }}: {{ exception_count }}</div>
                    <div class="stat-item">{{ i18n.template.total if i18n.template else 'Total' }}: {{ total_count }}</div>
                </div>
            </div>

            <!-- ÈÖçÁΩÆÈù¢Êùø -->
            <div class="config-panel" id="configPanel">
                <div class="config-grid">
                    {% for case in test_cases %}
                        {% if loop.first and case.config %}
                            {% if case.config.target_url %}
                            <div class="config-item">
                                <div class="config-label">{{ i18n.template.target_url if i18n.template else 'Target URL' }}</div>
                                <div class="config-value">{{ case.config.target_url }}</div>
                            </div>
                            {% endif %}

                            {% if case.config.llm_model %}
                            <div class="config-item">
                                <div class="config-label">{{ i18n.template.model_used if i18n.template else 'Model Used' }}</div>
                                <div class="config-value">
                                    <div>{{ i18n.template.main_model if i18n.template else 'Main Model' }}: {{ case.config.llm_model }}</div>
                                    <!-- {% if case.config.filter_model %}
                                    <div style="margin-top: 4px;">{{ i18n.template.filter_model if i18n.template else 'Filter Model' }}: {{ case.config.filter_model }}</div>
                                    {% endif %} -->
                                </div>
                            </div>
                            {% endif %}

                            {% if case.config.browser_config %}
                            <div class="config-item">
                                <div class="config-label">{{ i18n.template.browser_config if i18n.template else 'Browser Config' }}</div>
                                <div class="config-value">
                                    {% if case.config.browser_config.viewport %}
                                    <div style="margin-bottom: 4px;">
                                        <strong>{{ i18n.template.window_size if i18n.template else 'Window Size' }}:</strong> {{ case.config.browser_config.viewport.width }} √ó {{ case.config.browser_config.viewport.height }}
                                    </div>
                                    {% endif %}
                                    {% if case.config.browser_config.language %}
                                    <div style="margin-bottom: 4px;">
                                        <strong>{{ i18n.template.browser_language if i18n.template else 'Browser Language' }}:</strong> {{ case.config.browser_config.language }}
                                    </div>
                                    {% endif %}
                                    {% if case.config.browser_config.headless is defined %}
                                    <div style="margin-bottom: 4px;">
                                        <strong>{{ i18n.template.headless_mode if i18n.template else 'Headless Mode' }}:</strong> {{ (i18n.template.yes if i18n.template else 'Yes') if case.config.browser_config.headless else (i18n.template.no if i18n.template else 'No') }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}

                            {% if case.config.ignore_rules %}
                            <div class="config-item">
                                <div class="config-label">{{ i18n.template.ignore_rules if i18n.template else 'Ignore Rules' }}</div>
                                <div class="config-value">
                                    {% if case.config.ignore_rules.console %}
                                    <div style="margin-bottom: 8px;">
                                        <strong>{{ i18n.template.console_errors if i18n.template else 'Console Errors' }}:</strong>
                                        <ul style="margin: 4px 0; padding-left: 20px;">
                                            {% for rule in case.config.ignore_rules.console %}
                                            <li>
                                                <code>{{ rule.pattern }}</code>
                                                <span style="color: #666; font-size: 0.9em;">({{ rule.match_type }})</span>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                    {% if case.config.ignore_rules.network %}
                                    <div>
                                        <strong>{{ i18n.template.network_requests if i18n.template else 'Network Requests' }}:</strong>
                                        <ul style="margin: 4px 0; padding-left: 20px;">
                                            {% for rule in case.config.ignore_rules.network %}
                                            <li>
                                                <code>{{ rule.pattern }}</code>
                                                <span style="color: #666; font-size: 0.9em;">({{ rule.type }})</span>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}

                            {% if case.config.env %}
                            <div class="config-item">
                                <div class="config-label">{{ i18n.template.environment if i18n.template else 'Environment' }}</div>
                                <div class="config-value">{{ case.config.env }}</div>
                            </div>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            <div class="case-bar">
                <button class="case-nav" id="casePrev" title="{{ i18n.template.prev_group if i18n.template else 'Previous' }}">‚Äπ</button>
                <div class="case-buttons-viewport">
                    <div class="case-buttons" id="caseButtons">
                        {% for summary in case_summaries %}
                        <div class="case-button" data-case="case-{{ summary.index }}" title="{{ i18n.template.case if i18n.template else 'Case' }} {{ summary.index }}: {{ summary.name }}">
                            <span class="case-label">{{ i18n.template.case if i18n.template else 'Case' }} {{ summary.index }}: {{ summary.name }}</span>
                            {% if summary.status == "passed" %}
                            <span class="badge badge-success">{{ i18n.template.passed if i18n.template else 'Passed' }}</span>
                            {% elif summary.status == "warning" %}
                            <span class="badge badge-success">{{ i18n.template.passed if i18n.template else 'Passed' }}
                                <span class="warning-text warning-tooltip">{{ i18n.template.warning if i18n.template else 'Warning' }}
                                    <span class="tooltip-text">{{ i18n.template.this_case_has_warning if i18n.template else 'This test case has warnings' }}</span>
                                </span>
                            </span>
                            {% else %}
                            <span class="badge badge-failure">{{ i18n.template.failed if i18n.template else 'Failed' }}</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <button class="case-nav" id="caseNext" title="{{ i18n.template.next_group if i18n.template else 'Next' }}">‚Ä∫</button>
                <div class="case-more">
                    <button class="case-more-btn" id="caseMore" title="{{ i18n.template.more if i18n.template else 'More' }}">‚Ä¶</button>
                    <div class="case-more-menu" id="caseMoreMenu">
                        {% for summary in case_summaries %}
                        <div class="case-more-item" data-case="case-{{ summary.index }}" title="{{ i18n.template.case if i18n.template else 'Case' }} {{ summary.index }}: {{ summary.name }}">
                            <span>{{ i18n.template.case if i18n.template else 'Case' }} {{ summary.index }}: {{ summary.name }}</span>
                            {% if summary.status == "passed" %}
                            <span class="badge badge-success">{{ i18n.template.passed if i18n.template else 'Passed' }}</span>
                            {% elif summary.status == "warning" %}
                            <span class="badge badge-success">{{ i18n.template.passed if i18n.template else 'Passed' }}
                                <span class="warning-text warning-tooltip">‚ö†
                                    <span class="tooltip-text">{{ i18n.template.this_case_has_warning if i18n.template else 'This test case has warnings' }}</span>
                                </span>
                            </span>
                            {% else %}
                            <span class="badge badge-failure">{{ i18n.template.failed if i18n.template else 'Failed' }}</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="mobile-hint">
            üëà {{ 'Swipe left and right to view different panels' if language == 'en-US' else 'Â∑¶Âè≥ÊªëÂä®Êü•Áúã‰∏çÂêåÈù¢Êùø' }} üëâ
        </div>

        <div class="content-container">
            {% for case in test_cases %}
            {% set case_index = loop.index0 %}
            <div class="case-content" id="case-{{ loop.index }}">
                <div class="steps-panel">
                {% for step in case.steps %}
                    <div class="step-item"
                        data-case="{{ case_index }}"
                        data-step="{{ loop.index0 }}">
                    <div class="step-number">
                        {{ i18n.template.step if i18n.template else 'Step' }} {{ step.id }}
                        {% if step.status == "passed" %}
                        <span class="badge badge-success">{{ i18n.template.passed if i18n.template else 'Passed' }}</span>
                        {% elif step.status == "warning" %}
                        <span class="badge badge-warning">{{ i18n.template.warning if i18n.template else 'Warning' }}</span>
                        {% else %}
                        <span class="badge badge-failure">{{ i18n.template.failed if i18n.template else 'Failed' }}</span>
                        {% endif %}
                    </div>
                    <div class="step-description">{{ step.description }}</div>
                    <div class="step-time">{{ step.timestamp }}</div>
                    </div>
                {% endfor %}
                </div>

                <div class="resize-handle" id="resize-handle-steps"></div>

                <div class="screenshots-panel">
                    {% for step in case.steps %}
                    {% set step_index = loop.index0 %}
                    <div class="step-screenshots step-{{ step_index }}-case-{{ case_index }} ">
                        {% if step.screenshots %}
                            {% for screenshot in step.screenshots %}
                            {% set screenshot_name = screenshot.label if screenshot.label else "Screenshot" %}
                            <div class="screenshot-wrapper" id="screenshot-{{ case_index }}-{{ step_index }}-{{ loop.index0 }}"
                                {% if 'action_' in screenshot_name %}data-action="true"{% endif %}>
                                <div class="screenshot-title">
                                    {% if 'marker' in screenshot_name %}
                                        Screenshot Marker
                                    {% elif 'assertion_state' in screenshot_name or 'assert' in screenshot_name %}
                                        Screenshot Assert
                                    {% elif 'action_' in screenshot_name %}
                                        {% if '_' in screenshot_name %}
                                            {% set action_type = screenshot_name.split('_')[2] if screenshot_name.split('_')|length > 2 else '' %}
                                            Screenshot Action: {{ action_type }}
                                        {% else %}
                                            Screenshot Action
                                        {% endif %}
                                    {% else %}
                                        Screenshot {{ loop.index }}
                                    {% endif %}
                                </div>
                                {# ÊáíÂä†ËΩΩ‰ºòÂåñÔºöÂè™Âú®ÂõæÁâáËøõÂÖ•ÂèØËßÜÂå∫ÂüüÊó∂ÊâçÂä†ËΩΩ #}
                                <img class="screenshot lazy-load"
                                     data-src="{{ screenshot|process_image }}"
                                     src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 9'%3E%3Crect width='16' height='9' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='2' fill='%23999'%3ELoading...%3C/text%3E%3C/svg%3E"
                                     alt="screenshot">
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-data">{{ i18n.template.no_screenshots if i18n.template else 'No screenshots' }}</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                <div class="resize-handle" id="resize-handle-screenshots"></div>

                <div class="action-io-panel">
                    {% for step in case.steps %}
                    {% set step_index = loop.index0 %}
                    <div class="step-actions-io step-{{ step_index }}-case-{{ case_index }} ">
                        <div class="actions-list">
                            <div class="panel-title">{{ i18n.template.action if i18n.template else 'Action' }}</div>
                            {% if step.actions %}
                                {% for action in step.actions %}
                                {% set action_index = loop.index0 %}
                                <div class="action-card {% if action.success %}success{% else %}failure{% endif %}"
                                    data-step="{{ step_index }}"
                                    data-case="{{ case_index }}">
                                    <div class="action-header">
                                        <div class="action-title">{{ loop.index }}. {{ action.description }}</div>
                                        <div class="action-result {% if action.success %}success{% else %}failure{% endif %}">
                                            {% if action.success %}‚úì {{ 'Success' if language == 'en-US' else 'ÊàêÂäü' }}{% else %}‚úó {{ 'Failed' if language == 'en-US' else 'Â§±Ë¥•' }}{% endif %}
                                        </div>
                                    </div>
                                    {% if action.details %}
                                        <div class="action-details">{{ action.details }}</div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>

                        <div class="model-io">
                            <div class="model-io-header">Ê®°ÂûãËæìÂá∫</div>
                            <div class="model-io-content">
                                {% if step.modelIO %}
                                    <div class="io-section model-io-rendered">
                                        {{ step.modelIO|render_modelio|safe }}
                                    </div>
                                {% else %}
                                    <div class="no-data">{{ 'No model data in this step' if language == 'en-US' else 'Ê≠§Ê≠•È™§Êó†Ê®°ÂûãÊï∞ÊçÆ' }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <!-- Case-level page results -->
                    <div class="panel-title" style="margin-top: 25px;">{{ 'Page Results' if language == 'en-US' else 'È°µÈù¢ÁªìÊûú' }}</div>
                    <div class="page-result">
                        {% if case.messages %}
                            <!-- Console Errors Tab -->
                            <div class="page-result-section">
                                <div class="page-section-header">
                                    <div class="page-section-title">{{ 'Console Errors' if language == 'en-US' else 'ÊéßÂà∂Âè∞ÈîôËØØ' }}</div>
                                    <div class="badge-count">{{ case.messages.console_error_message|length }}</div>
                                </div>
                                <div class="page-section-content">
                                    {% if case.messages.console_error_message %}
                                        {% for error in case.messages.console_error_message %}
                                        <div class="console-error">
                                            <div class="error-message">{{ error.msg }}</div>
                                            {% if error.location %}
                                            <div class="error-location">at {{ error.location }}</div>
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="no-data">{{ i18n.template.no_console_logs if i18n.template else 'No console logs' }}</div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Network Tab -->
                            <div class="page-result-section">
                                <div class="page-section-header">
                                    <div class="page-section-title">{{ 'Network Requests' if language == 'en-US' else 'ÁΩëÁªúËØ∑Ê±Ç' }}</div>
                                    <div class="badge-count">{{ case.messages.network_message.responses|length + case.messages.network_message.failed_requests|length }}</div>
                                </div>
                                <div class="page-section-content">
                                    <!-- Failed Requests -->
                                    {% if case.messages.network_message.failed_requests %}
                                    <div class="network-table-container">
                                        <table class="network-table">
                                            <thead>
                                                <tr>
                                                    <th class="status-col failed">{{ i18n.template.failed if i18n.template else 'Failed' }}</th>
                                                    <th class="method-col">{{ i18n.template.method if i18n.template else 'Method' }}</th>
                                                    <th class="url-col">{{ i18n.template.url if i18n.template else 'URL' }}</th>
                                                    <th class="error-col">{{ 'Error' if language == 'en-US' else 'ÈîôËØØ' }}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for request in case.messages.network_message.failed_requests %}
                                                <tr class="network-row failed" data-request-id="{{ loop.index0 }}">
                                                    <td class="status-col">{{ i18n.template.failed if i18n.template else 'Failed' }}</td>
                                                    <td class="method-col">{{ request.method }}</td>
                                                    <td class="url-col">{{ request.url }}</td>
                                                    <td class="error-col">{{ request.error }}</td>
                                                </tr>
                                                <tr class="response-details" id="failed-request-{{ case_index }}-{{ loop.index0 }}">
                                                    <td colspan="5">
                                                        <div class="response-detail-content">
                                                            {% if request.url %}
                                                            <div class="response-section">
                                                                <h4>Request URL:</h4>
                                                                <pre class="request-url">{{ request.url }}</pre>
                                                            </div>
                                                            {% endif %}
                                                            {% if request.payload %}
                                                            <div class="response-section">
                                                                <h4>Request Payload:</h4>
                                                                <pre class="request-payload">{{ request.payload|tojson(indent=2)|decode_unicode }}</pre>
                                                            </div>
                                                            {% endif %}
                                                            {% if request.error %}
                                                            <div class="response-section">
                                                                <h4>Error:</h4>
                                                                <pre class="error-detail">{{ request.error }}</pre>
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% endif %}

                                    <!-- Successful Requests -->
                                    {% if case.messages.network_message.responses %}
                                <div class="network-table-container">
                                    <table class="network-table">
                                        <thead>
                                            <tr>
                                                <th class="status-col">{{ i18n.template.status if i18n.template else 'Status' }}</th>
                                                <th class="method-col">{{ i18n.template.method if i18n.template else 'Method' }}</th>
                                                <th class="type-col">{{ i18n.template.type if i18n.template else 'Type' }}</th>
                                                <th class="url-col">{{ i18n.template.url if i18n.template else 'URL' }}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for response in case.messages.network_message.responses %}
                                            <tr class="network-row {% if response.status >= 400 %}error-row{% elif response.status >= 300 %}warning-row{% endif %}" data-response-id="{{ loop.index0 }}">
                                                <td class="status-col {% if response.status >= 400 %}error{% elif response.status >= 300 %}warning{% else %}success{% endif %}">
                                                    {{ response.status }}
                                                </td>
                                                <td class="method-col">{{ response.method }}</td>
                                                <td class="type-col">{{ response.content_type }}</td>
                                                <td class="url-col">{{ response.url }}</td>
                                            </tr>
                                            <tr class="response-details" id="response-{{ case_index }}-{{ loop.index0 }}">
                                                <td colspan="5">
                                                    <div class="response-detail-content">
                                                        <!-- URL Section -->
                                                        {% if response.url %}
                                                        <div class="response-section">
                                                            <h4>Request url:</h4>
                                                            <pre class="request-url">{{ response.url }}</pre>
                                                        </div>
                                                        {% endif %}
                                                        <!-- Request Payload Section -->
                                                        {% if response.payload %}
                                                        <div class="response-section">
                                                            <h4>Request Payload:</h4>
                                                            <pre class="request-payload">{{ response.payload|tojson(indent=2)|decode_unicode }}</pre>
                                                        </div>
                                                        {% endif %}
                                                        <!-- Headers Section -->
                                                        {% if response.headers %}
                                                        <div class="response-section">
                                                            <h4>Response Headers:</h4>
                                                            <pre class="response-headers">{{ response.headers|tojson(indent=2)|decode_unicode }}</pre>
                                                        </div>
                                                        {% endif %}

                                                        <!-- Body Section -->
                                                        {% if response.body and not response.is_sse %}
                                                        <div class="response-section">
                                                            <h4>Response Body:</h4>
                                                            <pre class="response-body">{{ response.body|tojson(indent=2)|decode_unicode }}</pre>
                                                        </div>
                                                        {% endif %}

                                                        <!-- SSE Messages Section -->
                                                        {% if response.is_sse and response.sse_messages %}
                                                        <div class="response-section">
                                                            <h4>SSE Messages:</h4>
                                                            <div class="sse-messages">
                                                                {% for message in response.sse_messages %}
                                                                <div class="sse-message">
                                                                    {% set decoded_data = message.data|decode_unicode %}
                                                                    <pre class="sse-data">
                                                                        {%- for key, value in decoded_data.items() -%}
                                                                        "{{ key }}": {% if key == "answer" %}"{{ value }}"{% else %}{{ value|tojson }}{% endif %}{% if not loop.last %},
                                                                        {% endif %}
                                                                        {%- endfor -%}
                                                                    </pre>
                                                                </div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    </div>
                                    {% endif %}

                                    {% if not case.messages.network_message.responses and not case.messages.network_message.failed_requests %}
                                        <div class="no-data">{{ i18n.template.no_network_activity if i18n.template else 'No network activity' }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        {% else %}
                            <div class="no-data">{{ 'No page results data' if language == 'en-US' else 'Êó†È°µÈù¢ÁªìÊûúÊï∞ÊçÆ' }}</div>
                        {% endif %}
                    </div>
                </div>

            </div>
            {% endfor %}
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // ÂõæÁâáÊáíÂä†ËΩΩ‰ºòÂåñ - ‰ΩøÁî®Intersection Observer
                function initLazyLoading() {
                    window.imageObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                img.classList.add('loading');
                                img.src = img.dataset.src;
                                img.onload = () => {
                                    img.classList.remove('lazy-load', 'loading');
                                };
                                observer.unobserve(img);
                            }
                        });
                    }, {
                        rootMargin: '100px' // ÊèêÂâç100pxÂºÄÂßãÂä†ËΩΩ
                    });

                    // ÂàùÂßãÂè™ËßÇÂØüÁ¨¨‰∏Ä‰∏™caseÁöÑÂõæÁâá
                    const firstCase = document.querySelector('.case-content.active');
                    if (firstCase) {
                        firstCase.querySelectorAll('img.lazy-load').forEach(img => {
                            window.imageObserver.observe(img);
                        });
                    }
                }

                initLazyLoading();

                // ÊµãËØïÁî®‰æãÂàáÊç¢
                const caseButtonsContainer = document.getElementById('caseButtons');
                const caseButtons = caseButtonsContainer ? caseButtonsContainer.querySelectorAll('.case-button') : [];

                function activateCase(caseId) {
                    // ÁßªÈô§ÊâÄÊúâÊåâÈíÆÁöÑactiveÁ±ª
                    document.querySelectorAll('.case-button').forEach(btn => btn.classList.remove('active'));
                    // Ê∑ªÂä†ÂΩìÂâçÊåâÈíÆÁöÑactiveÁ±ª
                    const currentBtn = document.querySelector(`.case-button[data-case="${caseId}"]`);
                    if (currentBtn) {
                        currentBtn.classList.add('active');
                        // Ëá™Âä®ÊªöÂä®‰ΩøÂΩìÂâçÊåâÈíÆÂèØËßÅ
                        currentBtn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                    }

                    // ÈöêËóèÊâÄÊúâcaseÂÜÖÂÆπ
                    document.querySelectorAll('.case-content').forEach(content => {
                        content.classList.remove('active');
                    });

                    // ÊòæÁ§∫ÂΩìÂâçcaseÂÜÖÂÆπ
                    const caseContainer = document.getElementById(caseId);
                    if (caseContainer) {
                        caseContainer.classList.add('active');
                    }

                    // ÊøÄÊ¥ªÂΩìÂâçcaseÁöÑÁ¨¨‰∏Ä‰∏™Ê≠•È™§
                    const firstStep = document.querySelector(`#${caseId} .step-item`);
                    if (firstStep) {
                        firstStep.click();
                    }

                    // ÈáçÊñ∞ÂàùÂßãÂåñÂΩìÂâçcaseÂÜÖÁöÑÊáíÂä†ËΩΩÂõæÁâá
                    setTimeout(() => {
                        const caseContainer = document.getElementById(caseId);
                        if (caseContainer && window.imageObserver) {
                            caseContainer.querySelectorAll('img.lazy-load').forEach(img => {
                                window.imageObserver.observe(img);
                            });
                        }
                    }, 100);
                }

                caseButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const caseId = this.getAttribute('data-case');
                        activateCase(caseId);
                    });
                });

                // Â∑¶Âè≥ÊªöÂä®ÊåâÈíÆ
                const prevBtn = document.getElementById('casePrev');
                const nextBtn = document.getElementById('caseNext');
                function scrollByAmount(amount) {
                    if (!caseButtonsContainer) return;
                    caseButtonsContainer.scrollBy({ left: amount, behavior: 'smooth' });
                }
                if (prevBtn) prevBtn.addEventListener('click', () => scrollByAmount(-300));
                if (nextBtn) nextBtn.addEventListener('click', () => scrollByAmount(300));

                // Èº†Ê†áÊªöËΩÆÊ®™ÂêëÊªöÂä®ÊîØÊåÅÔºàÊåâ‰ΩèShiftÊàñËá™ÁÑ∂Ê®™ÂêëËß¶ÊéßÊùøÔºâ
                if (caseButtonsContainer) {
                    caseButtonsContainer.addEventListener('wheel', (e) => {
                        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {
                            // Â∑≤ÁªèÊòØÊ®™ÂêëÊªöÂä®
                            return;
                        }
                        // ÂûÇÁõ¥ÊªöÂä®ËΩ¨‰∏∫Ê®™Âêë
                        caseButtonsContainer.scrollLeft += e.deltaY;
                        e.preventDefault();
                    }, { passive: false });
                }

                // Êõ¥Â§öËèúÂçï
                const moreBtn = document.getElementById('caseMore');
                const moreMenu = document.getElementById('caseMoreMenu');
                function toggleMoreMenu() {
                    if (!moreMenu) return;
                    moreMenu.style.display = moreMenu.style.display === 'block' ? 'none' : 'block';
                }
                if (moreBtn) moreBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleMoreMenu(); });
                document.addEventListener('click', () => { if (moreMenu) moreMenu.style.display = 'none'; });
                if (moreMenu) {
                    moreMenu.querySelectorAll('.case-more-item').forEach(item => {
                        item.addEventListener('click', function() {
                            const caseId = this.getAttribute('data-case');
                            toggleMoreMenu();
                            activateCase(caseId);
                        });
                    });
                }

                // Ê≠•È™§ÂàáÊç¢
                document.querySelectorAll('.step-item').forEach(stepItem => {
                    stepItem.addEventListener('click', function() {
                        const caseIndex = this.getAttribute('data-case');
                        const stepIndex = this.getAttribute('data-step');

                        // ÁßªÈô§Âêå‰∏Äcase‰∏ãÊâÄÊúâÊ≠•È™§ÁöÑactiveÁ±ª
                        document.querySelectorAll(`.step-item[data-case="${caseIndex}"]`).forEach(item => {
                            item.classList.remove('active');
                        });

                        // Ê∑ªÂä†ÂΩìÂâçÊ≠•È™§ÁöÑactiveÁ±ª
                        this.classList.add('active');

                        // ÈöêËóèÂêå‰∏Äcase‰∏ãÊâÄÊúâÊ≠•È™§ÁöÑÊà™ÂõæÂíåÂä®‰ΩúÂÜÖÂÆπ
                        document.querySelectorAll(`.step-screenshots, .step-actions-io`).forEach(panel => {
                            panel.classList.remove('active');
                        });

                        // ÊòæÁ§∫ÂΩìÂâçÊ≠•È™§ÁöÑÊà™ÂõæÂíåÂä®‰ΩúÂÜÖÂÆπ
                        const screenshotsPanel = document.querySelector(`.step-screenshots.step-${stepIndex}-case-${caseIndex}`);
                        const actionsIoPanel = document.querySelector(`.step-actions-io.step-${stepIndex}-case-${caseIndex}`);

                        if (screenshotsPanel) {
                            screenshotsPanel.classList.add('active');
                        }

                        if (actionsIoPanel) {
                            actionsIoPanel.classList.add('active');
                        }

                        // ÈáçÊñ∞ËßÇÂØüÊñ∞ÊòæÁ§∫Ê≠•È™§ÂÜÖÁöÑÊáíÂä†ËΩΩÂõæÁâá
                        setTimeout(() => {
                            if (screenshotsPanel && window.imageObserver) {
                                screenshotsPanel.querySelectorAll('img.lazy-load').forEach(img => {
                                    window.imageObserver.observe(img);
                                });
                            }
                        }, 50);
                    });
                });

                // È°µÈù¢ÂàùÂßãÂ±ïÁ§∫Á¨¨‰∏Ä‰∏™caseÂèäÂÖ∂Á¨¨‰∏Ä‰∏™Ê≠•È™§
                const firstCaseBtn = document.querySelector('#caseButtons .case-button');
                if (firstCaseBtn) {
                    const firstCaseId = firstCaseBtn.getAttribute('data-case');
                    // ÊøÄÊ¥ªÁ¨¨‰∏Ä‰∏™case
                    activateCase(firstCaseId);
                }

                // ÊãñÂä®Ë∞ÉÊï¥Èù¢ÊùøÂ§ßÂ∞èÂäüËÉΩ
                function initResize() {
                    const handles = document.querySelectorAll('.resize-handle');

                    handles.forEach(handle => {
                        let startX, startWidths, panels;

                        handle.addEventListener('mousedown', e => {
                            e.preventDefault();
                            startX = e.clientX;
                            handle.classList.add('dragging');

                            // Determine which panels this handle controls
                            const containerDiv = handle.parentElement;
                            const handleIndex = Array.from(containerDiv.children).indexOf(handle);

                            // Get panels on both sides of this handle
                            const leftPanel = containerDiv.children[handleIndex - 1];
                            const rightPanel = containerDiv.children[handleIndex + 1];
                            panels = { left: leftPanel, right: rightPanel };

                            // Store starting widths
                            startWidths = {
                                left: leftPanel.offsetWidth,
                                right: rightPanel.offsetWidth,
                                container: containerDiv.offsetWidth
                            };

                            document.addEventListener('mousemove', handleDrag);
                            document.addEventListener('mouseup', stopDrag);
                        });

                        function handleDrag(e) {
                            if (!panels) return;

                            const movementX = e.clientX - startX;

                            // Calculate new widths
                            let newLeftWidth = startWidths.left + movementX;
                            let newRightWidth = startWidths.right - movementX;

                            // Set minimum widths based on panel types
                            const minLeftWidth = panels.left.classList.contains('steps-panel') ? 200 : 300;
                            const minRightWidth = panels.right.classList.contains('action-io-panel') ? 350 : 300;

                            // Calculate available space and respect minimums
                            const totalWidth = startWidths.container;
                            const availableWidth = totalWidth - minLeftWidth - minRightWidth;

                            if (newLeftWidth < minLeftWidth) {
                                newLeftWidth = minLeftWidth;
                                newRightWidth = totalWidth - minLeftWidth;
                            } else if (newRightWidth < minRightWidth) {
                                newRightWidth = minRightWidth;
                                newLeftWidth = totalWidth - minRightWidth;
                            }

                            // Apply the new widths
                            panels.left.style.width = `${newLeftWidth}px`;
                            panels.right.style.width = `${newRightWidth}px`;
                        }

                        function stopDrag() {
                            handle.classList.remove('dragging');
                            document.removeEventListener('mousemove', handleDrag);
                            document.removeEventListener('mouseup', stopDrag);
                            panels = null;
                        }
                    });
                }

                // ‰øÆÊîπactionÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜ - Á≤æÁ°ÆÂåπÈÖçÂØπÂ∫îÁöÑÊà™Âõæ
                document.querySelectorAll('.action-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const caseIndex = this.getAttribute('data-case');
                        const stepIndex = this.getAttribute('data-step');

                        // Ëé∑ÂèñÂΩìÂâçÊ≠•È™§ÂÜÖÁöÑÊâÄÊúâactionÂç°ÁâáÔºåÊâæÂá∫ÂΩìÂâçÂç°ÁâáÊòØÁ¨¨Âá†‰∏™
                        const stepActions = document.querySelectorAll(`.action-card[data-case="${caseIndex}"][data-step="${stepIndex}"]`);
                        let currentActionIndex = 0;
                        for (let i = 0; i < stepActions.length; i++) {
                            if (stepActions[i] === this) {
                                currentActionIndex = i;
                                break;
                            }
                        }

                        // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ÁöÑÊà™ÂõæÈù¢Êùø
                        const activeScreenshotsPanel = document.querySelector(`.step-screenshots.step-${stepIndex}-case-${caseIndex}`);

                        if (activeScreenshotsPanel) {
                            // È¶ñÂÖàÂ∞ùËØïÊü•ÊâæÊ†áËÆ∞‰∏∫actionÁöÑÊà™ÂõæÔºàÂü∫‰∫édata-actionÂ±ûÊÄßÔºâ
                            const actionScreenshots = activeScreenshotsPanel.querySelectorAll('.screenshot-wrapper[data-action="true"]');

                            // Â¶ÇÊûúÊâæÂà∞actionÊà™ÂõæÔºåÂ∞ùËØïÂåπÈÖçÂΩìÂâçactionÁ¥¢ÂºïÂØπÂ∫îÁöÑÊà™Âõæ
                            if (actionScreenshots.length > 0) {
                                // Â∞ùËØïÊâæÂà∞ÂØπÂ∫îÁöÑactionÊà™Âõæ (Â¶ÇÊûúÊï∞ÈáèÂåπÈÖç)
                                if (actionScreenshots.length > currentActionIndex) {
                                    const targetScreenshot = actionScreenshots[currentActionIndex];

                                    // ÊªöÂä®Âà∞ÁõÆÊ†áÊà™Âõæ
                                    targetScreenshot.scrollIntoView({ behavior: 'smooth', block: 'start' });

                                    // Ê∑ªÂä†È´ò‰∫ÆÊïàÊûú
                                    targetScreenshot.classList.add('highlight');
                                    setTimeout(() => {
                                        targetScreenshot.classList.remove('highlight');
                                    }, 1500);
                                } else {
                                    // Â¶ÇÊûúÊâæ‰∏çÂà∞ÂØπÂ∫îÁ¥¢ÂºïÁöÑÊà™ÂõæÔºåÊªöÂä®Âà∞Á¨¨‰∏Ä‰∏™actionÊà™Âõæ
                                    actionScreenshots[0].scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            } else {
                                // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞‰ªª‰ΩïactionÊà™ÂõæÔºåÂàôÊªöÂä®Âà∞Á¨¨‰∏Ä‰∏™Êà™Âõæ
                                const firstScreenshot = activeScreenshotsPanel.querySelector('.screenshot-wrapper');
                                if (firstScreenshot) {
                                    firstScreenshot.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            }
                        }
                    });
                });

                // Initialize the resize functionality
                initResize();

                // Make network rows expandable
                document.querySelectorAll('.network-row').forEach(row => {
                    row.addEventListener('click', function() {
                        const responseId = this.getAttribute('data-response-id');
                        // Get case index from the case-content ID
                        const caseContentId = this.closest('.case-content').id;
                        const caseIndex = parseInt(caseContentId.replace('case-', '')) - 1;

                        // Find next row which should be the response details
                        const responseRow = this.nextElementSibling;

                        if (responseRow && responseRow.classList.contains('response-details')) {
                            responseRow.style.display = responseRow.style.display === 'table-row' ? 'none' : 'table-row';
                        } else {
                            // Fallback to ID-based lookup
                            const idBasedRow = document.getElementById(`response-${caseIndex}-${responseId}`);
                            if (idBasedRow) {
                                idBasedRow.style.display = idBasedRow.style.display === 'table-row' ? 'none' : 'table-row';
                            }
                        }
                    });
                });
            });

            // Ê∑ªÂä†ÈÖçÁΩÆÈù¢ÊùøÂàáÊç¢ÂäüËÉΩ
            function toggleConfig() {
                const configTab = document.querySelector('.config-tab');
                const configPanel = document.getElementById('configPanel');

                configTab.classList.toggle('active');
                configPanel.classList.toggle('active');
            }
        </script>
    </body>
    </html>

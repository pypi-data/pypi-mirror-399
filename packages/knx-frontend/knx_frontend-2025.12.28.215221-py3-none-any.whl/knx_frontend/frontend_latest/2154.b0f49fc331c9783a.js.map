{"version":3,"file":"2154.b0f49fc331c9783a.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/search-input.ts","webpack://knx-frontend/./src/dialogs/knx-ga-select-dialog.ts"],"sourcesContent":["import { mdiClose, mdiMagnify } from \"@mdi/js\";\nimport type { TemplateResult } from \"lit\";\nimport { css, html, LitElement } from \"lit\";\nimport { customElement, property, query } from \"lit/decorators\";\nimport \"./ha-icon-button\";\nimport \"./ha-svg-icon\";\nimport \"./ha-textfield\";\nimport type { HaTextField } from \"./ha-textfield\";\nimport type { HomeAssistant } from \"../types\";\nimport { fireEvent } from \"../common/dom/fire_event\";\n\n@customElement(\"search-input\")\nclass SearchInput extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public filter?: string;\n\n  @property({ type: Boolean })\n  public suffix = false;\n\n  // eslint-disable-next-line lit/no-native-attributes\n  @property({ type: Boolean }) public autofocus = false;\n\n  @property({ type: String })\n  public label?: string;\n\n  public focus() {\n    this._input?.focus();\n  }\n\n  @query(\"ha-textfield\", true) private _input!: HaTextField;\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-textfield\n        .autofocus=${this.autofocus}\n        autocomplete=\"off\"\n        .label=${this.label || this.hass.localize(\"ui.common.search\")}\n        .value=${this.filter || \"\"}\n        icon\n        .iconTrailing=${this.filter || this.suffix}\n        @input=${this._filterInputChanged}\n      >\n        <slot name=\"prefix\" slot=\"leadingIcon\">\n          <ha-svg-icon\n            tabindex=\"-1\"\n            class=\"prefix\"\n            .path=${mdiMagnify}\n          ></ha-svg-icon>\n        </slot>\n        <div class=\"trailing\" slot=\"trailingIcon\">\n          ${this.filter &&\n          html`\n            <ha-icon-button\n              @click=${this._clearSearch}\n              .label=${this.hass.localize(\"ui.common.clear\")}\n              .path=${mdiClose}\n              class=\"clear-button\"\n            ></ha-icon-button>\n          `}\n          <slot name=\"suffix\"></slot>\n        </div>\n      </ha-textfield>\n    `;\n  }\n\n  private async _filterChanged(value: string) {\n    fireEvent(this, \"value-changed\", { value: String(value) });\n  }\n\n  private async _filterInputChanged(e) {\n    this._filterChanged(e.target.value);\n  }\n\n  private async _clearSearch() {\n    this._filterChanged(\"\");\n  }\n\n  static styles = css`\n    :host {\n      display: inline-flex;\n    }\n    ha-svg-icon,\n    ha-icon-button {\n      color: var(--primary-text-color);\n    }\n    ha-svg-icon {\n      outline: none;\n    }\n    .clear-button {\n      --mdc-icon-size: 20px;\n    }\n    ha-textfield {\n      display: inherit;\n    }\n    .trailing {\n      display: flex;\n      align-items: center;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"search-input\": SearchInput;\n  }\n}\n","import memoize from \"memoize-one\";\nimport { LitElement, html, css, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport \"@ha/components/ha-wa-dialog\";\nimport \"@ha/components/ha-button\";\nimport \"@ha/components/ha-dialog-footer\";\nimport \"@ha/components/search-input\";\nimport \"@ha/components/ha-md-list\";\nimport \"@ha/components/ha-md-list-item\";\n\nimport { fireEvent } from \"@ha/common/dom/fire_event\";\nimport { haStyleDialog } from \"@ha/resources/styles\";\nimport type { HomeAssistant } from \"@ha/types\";\nimport type { HassDialog } from \"@ha/dialogs/make-dialog-manager\";\n\nimport type { GroupAddress, GroupRange, KNXProject } from \"../types/websocket\";\nimport type { KNX } from \"../types/knx\";\n\ninterface GroupNode {\n  title: string;\n  items: GroupAddress[];\n  depth: number;\n  childGroups: GroupNode[];\n}\n\nexport interface KnxGaSelectDialogParams {\n  knx: KNX;\n  groupAddresses: GroupAddress[];\n  title?: string;\n  width?: \"small\" | \"medium\" | \"large\" | \"full\";\n  initialSelection?: string;\n  onClose?: (address: string | undefined) => void;\n}\n\n@customElement(\"knx-ga-select-dialog\")\nexport class KnxGaSelectDialog extends LitElement implements HassDialog<KnxGaSelectDialogParams> {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public knx!: KNX;\n\n  @state() private _open = false;\n\n  @state() private _params?: KnxGaSelectDialogParams;\n\n  // all valid group addresses to select from\n  @state() private _groupAddresses: GroupAddress[] = [];\n\n  @state() private _selected?: string;\n\n  @state() private _filter = \"\";\n\n  public async showDialog(params: KnxGaSelectDialogParams): Promise<void> {\n    this._params = params;\n    this._groupAddresses = params.groupAddresses ?? [];\n    this.knx = params.knx;\n    this._selected = params.initialSelection ?? this._selected;\n    this._open = true;\n  }\n\n  public closeDialog(_historyState?: any): boolean {\n    this._dialogClosed();\n    return true;\n  }\n\n  private _cancel(): void {\n    this._selected = undefined;\n    if (this._params?.onClose) {\n      this._params.onClose(undefined);\n    }\n    this._dialogClosed();\n  }\n\n  private _confirm(): void {\n    if (this._params?.onClose) {\n      this._params.onClose(this._selected);\n    }\n    this._dialogClosed();\n  }\n\n  private _itemKeydown(ev: KeyboardEvent): void {\n    if (ev.key === \"Enter\") {\n      ev.preventDefault();\n      const target = ev.currentTarget as HTMLElement;\n      const value = target.getAttribute(\"value\");\n      if (value) {\n        this._selected = value;\n        this._confirm();\n      }\n    }\n  }\n\n  private _onDoubleClick(ev: Event): void {\n    const target = ev.currentTarget as HTMLElement;\n    const value = target.getAttribute(\"value\");\n    this._selected = value ?? undefined;\n    if (this._selected) {\n      this._confirm();\n    }\n  }\n\n  private _onSelect(ev: Event): void {\n    const target = ev.currentTarget as HTMLElement;\n    const value = target.getAttribute(\"value\");\n    this._selected = value ?? undefined;\n  }\n\n  private _onFilterChanged(ev: CustomEvent<{ value: string }>): void {\n    this._filter = ev.detail?.value ?? \"\";\n  }\n\n  private _groupItems = memoize(\n    (filter: string, addrs: GroupAddress[], projectData: KNXProject | null): GroupNode[] => {\n      const f = filter.trim().toLowerCase();\n\n      // Abort when no project data is available\n      if (!projectData || !projectData.group_ranges) {\n        return [];\n      }\n\n      // Filter addresses by search term first\n      const filtered = addrs.filter((ga) => {\n        if (!f) return true;\n        const address = ga.address ?? \"\";\n        const name = ga.name ?? \"\";\n        return address.toLowerCase().includes(f) || name.toLowerCase().includes(f);\n      });\n\n      const buildHierarchy = (ranges: Record<string, GroupRange>, depth = 0): GroupNode[] => {\n        const nodes: GroupNode[] = [];\n\n        Object.entries(ranges).forEach(([key, range]) => {\n          const groupAddresses = (range.group_addresses ?? []) as string[];\n          const gaFilteredInRange = filtered.filter((ga) => groupAddresses.includes(ga.address));\n          const childGroups = range.group_ranges\n            ? buildHierarchy(range.group_ranges, depth + 1)\n            : [];\n          const includeNode = gaFilteredInRange.length > 0 || childGroups.length > 0;\n          if (includeNode) {\n            nodes.push({\n              title: `${key} ${range.name}`.trim(),\n              items: gaFilteredInRange.sort((x, y) => x.raw_address - y.raw_address),\n              depth,\n              childGroups,\n            });\n          }\n        });\n\n        return nodes;\n      };\n\n      return buildHierarchy(projectData.group_ranges);\n    },\n  );\n\n  private _dialogClosed(): void {\n    this._open = false;\n    this._params = undefined;\n    this._filter = \"\";\n    this._selected = undefined;\n    fireEvent(this, \"dialog-closed\", { dialog: this.localName });\n  }\n\n  private _renderGroup(group: GroupNode) {\n    return html`\n      <div class=\"group-section\">\n        <div class=\"group-title\" style=\"--group-depth: ${group.depth}\">${group.title}</div>\n        ${group.items.length > 0\n          ? html`<ha-md-list>\n              ${group.items.map((ga) => {\n                const isSelected = this._selected === ga.address;\n                return html`<ha-md-list-item\n                  interactive\n                  type=\"button\"\n                  value=${ga.address}\n                  @click=${this._onSelect}\n                  @dblclick=${this._onDoubleClick}\n                  @keydown=${this._itemKeydown}\n                >\n                  <div class=${classMap({ \"ga-row\": true, selected: isSelected })} slot=\"headline\">\n                    <div class=\"ga-address\">${ga.address}</div>\n                    <div class=\"ga-name\">${ga.name ?? \"\"}</div>\n                  </div>\n                </ha-md-list-item>`;\n              })}\n            </ha-md-list>`\n          : nothing}\n        ${group.childGroups.map((child) => this._renderGroup(child))}\n      </div>\n    `;\n  }\n\n  protected render() {\n    if (!this._params || !this.hass) {\n      return nothing;\n    }\n\n    const noProjectData = !this.knx.projectData?.group_ranges;\n    const hasAddresses = this._groupAddresses?.length > 0;\n    const groupItems = hasAddresses\n      ? this._groupItems(this._filter, this._groupAddresses, this.knx.projectData)\n      : [];\n    const hasFilteredItems = groupItems.length > 0;\n\n    return html`<ha-wa-dialog\n      .hass=${this.hass}\n      .open=${this._open}\n      width=${this._params.width ?? \"medium\"}\n      .headerTitle=${this._params.title}\n      @closed=${this._dialogClosed}\n    >\n      <div class=\"dialog-body\">\n        <search-input\n          ?autofocus=${true}\n          .hass=${this.hass}\n          .filter=${this._filter}\n          @value-changed=${this._onFilterChanged}\n          .label=${this.hass.localize(\"ui.common.search\")}\n        ></search-input>\n\n        <div class=\"ga-list-container\">\n          ${noProjectData || !hasAddresses\n            ? html`<div class=\"empty-state\">\n                ${this.hass.localize(\n                  \"component.knx.config_panel.entities.create._.knx.knx_group_address.group_address_none_for_dpt\",\n                )}\n              </div>`\n            : !hasFilteredItems\n              ? html`<div class=\"empty-state\">\n                  ${this.hass.localize(\n                    \"component.knx.config_panel.entities.create._.knx.knx_group_address.group_address_none_for_filter\",\n                  )}\n                </div>`\n              : groupItems.map((group) => this._renderGroup(group))}\n        </div>\n      </div>\n\n      <ha-dialog-footer slot=\"footer\">\n        <ha-button slot=\"secondaryAction\" appearance=\"plain\" @click=${this._cancel}>\n          ${this.hass.localize(\"ui.common.cancel\")}\n        </ha-button>\n        <ha-button slot=\"primaryAction\" @click=${this._confirm} .disabled=${!this._selected}>\n          ${this.hass.localize(\"ui.common.ok\")}\n        </ha-button>\n      </ha-dialog-footer>\n    </ha-wa-dialog>`;\n  }\n\n  static get styles() {\n    return [\n      haStyleDialog,\n      css`\n        @media all and (min-width: 600px) {\n          ha-wa-dialog {\n            --mdc-dialog-min-width: 360px;\n          }\n        }\n\n        .dialog-body {\n          display: flex;\n          flex-direction: column;\n          gap: var(--ha-space-2, 8px);\n          height: 100%;\n          min-height: 0;\n        }\n\n        search-input {\n          display: block;\n          width: 100%;\n        }\n\n        ha-md-list {\n          padding: 0;\n        }\n\n        .ga-list-container {\n          flex: 1 1 auto;\n          min-height: 0;\n          overflow: auto;\n          border: 1px solid var(--divider-color);\n          border-radius: 4px;\n          padding: 0;\n        }\n\n        .group-title {\n          position: sticky;\n          top: calc(var(--group-title-height, 40px) * min(1, var(--group-depth, 0)));\n          z-index: calc(10 - var(--group-depth, 0));\n          height: var(--group-title-height, 40px);\n          box-sizing: border-box;\n          display: flex;\n          align-items: center;\n          font-weight: 600;\n          padding: 6px 8px;\n          padding-left: calc(8px + var(--group-depth, 0) * 8px);\n          color: var(--primary-text-color);\n          background: var(--primary-background-color);\n          border-bottom: 1px solid var(--divider-color);\n        }\n\n        .empty-state {\n          padding: 12px;\n          color: var(--secondary-text-color);\n          font-style: italic;\n        }\n\n        .ga-row {\n          display: grid;\n          grid-template-columns: 10ch minmax(0, 1fr);\n          align-items: center;\n          gap: var(--ha-space-2, 8px);\n          padding: 6px 8px;\n          border-radius: 4px;\n        }\n\n        .ga-row.selected {\n          background-color: rgba(var(--rgb-primary-color), 0.08);\n          outline: 2px solid rgba(var(--rgb-accent-color), 0.12);\n        }\n\n        .ga-address {\n          font-family:\n            ui-monospace, SFMono-Regular, Menlo, Monaco, \"Roboto Mono\", \"Courier New\", monospace;\n          width: 100%;\n          color: var(--secondary-text-color);\n          white-space: nowrap;\n        }\n\n        .ga-name {\n          font-weight: 500;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          min-width: 0;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"knx-ga-select-dialog\": KnxGaSelectDialog;\n  }\n}\n"],"names":["SearchInput","LitElement","focus","this","_input","render","html","autofocus","label","hass","localize","filter","suffix","_filterInputChanged","_clearSearch","_filterChanged","value","fireEvent","String","e","target","args","styles","css","attribute","type","Boolean","KnxGaSelectDialog","showDialog","params","_params","_groupAddresses","groupAddresses","knx","_selected","initialSelection","_open","closeDialog","_historyState","_dialogClosed","_cancel","undefined","onClose","_confirm","_itemKeydown","ev","key","preventDefault","currentTarget","getAttribute","_onDoubleClick","_onSelect","_onFilterChanged","_filter","detail","dialog","localName","_renderGroup","group","depth","title","items","length","map","ga","isSelected","address","classMap","selected","name","nothing","childGroups","child","noProjectData","projectData","group_ranges","hasAddresses","groupItems","_groupItems","hasFilteredItems","width","haStyleDialog","memoize","addrs","f","trim","toLowerCase","filtered","includes","buildHierarchy","ranges","nodes","Object","entries","forEach","range","group_addresses","gaFilteredInRange","push","sort","x","y","raw_address"],"mappings":"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"}
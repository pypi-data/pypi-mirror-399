{"version":3,"file":"750.917703c7784717a8.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/ha-section-title.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/search-input.ts","webpack://knx-frontend/./src/dialogs/knx-dpt-select-dialog.ts"],"sourcesContent":["import { css, html, LitElement } from \"lit\";\nimport { customElement } from \"lit/decorators\";\n\n@customElement(\"ha-section-title\")\nclass HaSectionTitle extends LitElement {\n  protected render() {\n    return html`<slot></slot>`;\n  }\n\n  static styles = css`\n    :host {\n      background-color: var(--ha-color-fill-neutral-quiet-resting);\n      padding: var(--ha-space-1) var(--ha-space-2);\n      font-weight: var(--ha-font-weight-bold);\n      color: var(--secondary-text-color);\n      min-height: var(--ha-space-6);\n      display: flex;\n      align-items: center;\n      box-sizing: border-box;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-section-title\": HaSectionTitle;\n  }\n}\n","import { mdiClose, mdiMagnify } from \"@mdi/js\";\nimport type { TemplateResult } from \"lit\";\nimport { css, html, LitElement } from \"lit\";\nimport { customElement, property, query } from \"lit/decorators\";\nimport \"./ha-icon-button\";\nimport \"./ha-svg-icon\";\nimport \"./ha-textfield\";\nimport type { HaTextField } from \"./ha-textfield\";\nimport type { HomeAssistant } from \"../types\";\nimport { fireEvent } from \"../common/dom/fire_event\";\n\n@customElement(\"search-input\")\nclass SearchInput extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public filter?: string;\n\n  @property({ type: Boolean })\n  public suffix = false;\n\n  // eslint-disable-next-line lit/no-native-attributes\n  @property({ type: Boolean }) public autofocus = false;\n\n  @property({ type: String })\n  public label?: string;\n\n  public focus() {\n    this._input?.focus();\n  }\n\n  @query(\"ha-textfield\", true) private _input!: HaTextField;\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-textfield\n        .autofocus=${this.autofocus}\n        autocomplete=\"off\"\n        .label=${this.label || this.hass.localize(\"ui.common.search\")}\n        .value=${this.filter || \"\"}\n        icon\n        .iconTrailing=${this.filter || this.suffix}\n        @input=${this._filterInputChanged}\n      >\n        <slot name=\"prefix\" slot=\"leadingIcon\">\n          <ha-svg-icon\n            tabindex=\"-1\"\n            class=\"prefix\"\n            .path=${mdiMagnify}\n          ></ha-svg-icon>\n        </slot>\n        <div class=\"trailing\" slot=\"trailingIcon\">\n          ${this.filter &&\n          html`\n            <ha-icon-button\n              @click=${this._clearSearch}\n              .label=${this.hass.localize(\"ui.common.clear\")}\n              .path=${mdiClose}\n              class=\"clear-button\"\n            ></ha-icon-button>\n          `}\n          <slot name=\"suffix\"></slot>\n        </div>\n      </ha-textfield>\n    `;\n  }\n\n  private async _filterChanged(value: string) {\n    fireEvent(this, \"value-changed\", { value: String(value) });\n  }\n\n  private async _filterInputChanged(e) {\n    this._filterChanged(e.target.value);\n  }\n\n  private async _clearSearch() {\n    this._filterChanged(\"\");\n  }\n\n  static styles = css`\n    :host {\n      display: inline-flex;\n    }\n    ha-svg-icon,\n    ha-icon-button {\n      color: var(--primary-text-color);\n    }\n    ha-svg-icon {\n      outline: none;\n    }\n    .clear-button {\n      --mdc-icon-size: 20px;\n    }\n    ha-textfield {\n      display: inherit;\n    }\n    .trailing {\n      display: flex;\n      align-items: center;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"search-input\": SearchInput;\n  }\n}\n","import memoize from \"memoize-one\";\nimport { LitElement, html, css, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\n\nimport \"@ha/components/ha-wa-dialog\";\nimport \"@ha/components/ha-button\";\nimport \"@ha/components/ha-dialog-footer\";\nimport \"@ha/components/search-input\";\nimport \"@ha/components/ha-md-list\";\nimport \"@ha/components/ha-md-list-item\";\nimport \"@ha/components/ha-section-title\";\n\nimport { fireEvent } from \"@ha/common/dom/fire_event\";\nimport { haStyleDialog } from \"@ha/resources/styles\";\nimport type { HomeAssistant } from \"@ha/types\";\nimport type { HassDialog } from \"@ha/dialogs/make-dialog-manager\";\n\nimport { stringToDpt, compareDpt } from \"../utils/dpt\";\nimport type { DPTMetadata } from \"../types/websocket\";\n\nexport interface KnxDptSelectDialogParams {\n  dpts: Record<string, DPTMetadata>;\n  title?: string;\n  width?: \"small\" | \"medium\" | \"large\" | \"full\";\n\n  /** Optional initial selection to preselect in the dialog */\n  initialSelection?: string;\n\n  /** Optional callback invoked when the dialog closes. Receives the selected DPT or undefined. */\n  onClose?: (dpt: string | undefined) => void;\n}\n\n@customElement(\"knx-dpt-select-dialog\")\nexport class KnxDptSelectDialog extends LitElement implements HassDialog<KnxDptSelectDialogParams> {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _open = false;\n\n  @state() private _params?: KnxDptSelectDialogParams;\n\n  @state() private dpts: Record<string, DPTMetadata> = {};\n\n  /** Currently selected DPT */\n  @state() private _selected?: string;\n\n  /** Filter string for the DPT list */\n  @state() private _filter = \"\";\n\n  public async showDialog(params: KnxDptSelectDialogParams): Promise<void> {\n    this._params = params;\n    this.dpts = params.dpts ?? {};\n    this._selected = params.initialSelection ?? this._selected;\n    this._open = true;\n  }\n\n  public closeDialog(_historyState?: any): boolean {\n    this._dialogClosed();\n    return true;\n  }\n\n  private _cancel(): void {\n    this._selected = undefined;\n    // Inform caller via callback that dialog was closed without a selection\n    if (this._params?.onClose) {\n      this._params.onClose(undefined);\n    }\n    this._dialogClosed();\n  }\n\n  private _confirm(): void {\n    // If a callback was provided by the caller, call it with the selected value.\n    if (this._params?.onClose) {\n      this._params.onClose(this._selected);\n    }\n    this._dialogClosed();\n  }\n\n  private _itemKeydown(ev: KeyboardEvent): void {\n    if (ev.key === \"Enter\") {\n      ev.preventDefault();\n      const target = ev.currentTarget as HTMLElement;\n      const value = target.getAttribute(\"value\");\n      this._selected = value ?? undefined;\n      this._confirm();\n    }\n  }\n\n  private _onDoubleClick(ev: Event): void {\n    const target = ev.currentTarget as HTMLElement;\n    const value = target.getAttribute(\"value\");\n    this._selected = value ?? undefined;\n\n    if (this._selected) {\n      this._confirm();\n    }\n  }\n\n  private _onSelect(ev: Event): void {\n    const target = ev.currentTarget as HTMLElement;\n    const value = target.getAttribute(\"value\");\n    this._selected = value ?? undefined;\n  }\n\n  private _onFilterChanged(ev: CustomEvent<{ value: string }>): void {\n    this._filter = ev.detail?.value ?? \"\";\n  }\n\n  private _groupDpts = memoize(\n    (filter: string, dpts: Record<string, DPTMetadata>): { title: string; items: string[] }[] => {\n      const map = new Map<string, string[]>();\n\n      const filterLower = filter.trim().toLowerCase();\n\n      for (const dpt of Object.keys(dpts)) {\n        const info = this._getDptInfo(dpt);\n        // If a filter is provided, match against number, label or unit\n        if (filterLower) {\n          const matchesNumber = dpt.toLowerCase().includes(filterLower);\n          const matchesLabel = info.label?.toLowerCase().includes(filterLower);\n          const matchesUnit = info.unit ? info.unit.toLowerCase().includes(filterLower) : false;\n          if (!matchesNumber && !matchesLabel && !matchesUnit) {\n            continue;\n          }\n        }\n\n        const major = String(dpt).split(\".\", 1)[0] || dpt;\n        const key = `${major}`;\n        if (!map.has(key)) {\n          map.set(key, []);\n        }\n        map.get(key)!.push(dpt);\n      }\n\n      // Sort groups by numeric major value if possible; within each group sort by minor number\n      const groups = Array.from(map.entries())\n        .sort((a, b) => {\n          const na = Number(a[0]);\n          const nb = Number(b[0]);\n          if (!Number.isNaN(na) && !Number.isNaN(nb)) {\n            return na - nb;\n          }\n          return a[0].localeCompare(b[0]);\n        })\n        .map(([key, items]) => ({\n          title: `${key}.*`,\n          items: items.sort((x, y) => {\n            const parsedX = stringToDpt(x);\n            const parsedY = stringToDpt(y);\n            if (parsedX && parsedY) {\n              return compareDpt(parsedX, parsedY);\n            }\n            if (parsedX) {\n              return -1;\n            }\n            if (parsedY) {\n              return 1;\n            }\n            return x.localeCompare(y);\n          }),\n        }));\n\n      return groups;\n    },\n  );\n\n  private _getDptInfo(dpt: string): { label: string; unit: string } {\n    const meta = this.dpts[dpt];\n    return {\n      label:\n        this.hass.localize(`component.knx.config_panel.dpt.options.${dpt.replace(\".\", \"_\")}`) ??\n        meta?.name ??\n        this.hass.localize(\"state.default.unknown\"),\n      unit: meta?.unit ?? \"\",\n    };\n  }\n\n  private _dialogClosed(): void {\n    this._open = false;\n    this._params = undefined;\n    this._filter = \"\";\n    this._selected = undefined;\n    fireEvent(this, \"dialog-closed\", { dialog: this.localName });\n  }\n\n  protected render() {\n    if (!this._params || !this.hass) {\n      return nothing;\n    }\n\n    const width = this._params.width ?? \"medium\";\n    return html` <ha-wa-dialog\n      .hass=${this.hass}\n      .open=${this._open}\n      width=${width}\n      .headerTitle=${this._params.title}\n      @closed=${this._dialogClosed}\n    >\n      <div class=\"dialog-body\">\n        <search-input\n          ?autofocus=${true}\n          .hass=${this.hass}\n          .filter=${this._filter}\n          @value-changed=${this._onFilterChanged}\n          .label=${this.hass.localize(\"ui.common.search\") ?? \"Search\"}\n        ></search-input>\n\n        ${Object.keys(this.dpts).length\n          ? html`<div class=\"dpt-list-container\">\n              ${this._groupDpts(this._filter, this.dpts).map(\n                (group) => html`\n                  ${group.title\n                    ? html`<ha-section-title>${group.title}</ha-section-title>`\n                    : nothing}\n                  <ha-md-list>\n                    ${group.items.map((dpt) => {\n                      const info = this._getDptInfo(dpt);\n                      const isSelected = this._selected === dpt;\n                      return html`<ha-md-list-item\n                        interactive\n                        type=\"button\"\n                        value=${dpt}\n                        @click=${this._onSelect}\n                        @dblclick=${this._onDoubleClick}\n                        @keydown=${this._itemKeydown}\n                      >\n                        <div class=\"dpt-row ${isSelected ? \"selected\" : \"\"}\" slot=\"headline\">\n                          <div class=\"dpt-number\">${dpt}</div>\n                          <div class=\"dpt-name\">${info.label}</div>\n                          <div class=\"dpt-unit\">${info.unit}</div>\n                        </div>\n                      </ha-md-list-item>`;\n                    })}\n                  </ha-md-list>\n                `,\n              )}\n            </div>`\n          : html`<div>No options</div>`}\n      </div>\n\n      <ha-dialog-footer slot=\"footer\">\n        <ha-button slot=\"secondaryAction\" appearance=\"plain\" @click=${this._cancel}>\n          ${this.hass.localize(\"ui.common.cancel\") ?? \"Cancel\"}\n        </ha-button>\n        <ha-button slot=\"primaryAction\" @click=${this._confirm} .disabled=${!this._selected}>\n          ${this.hass.localize(\"ui.common.ok\") ?? \"OK\"}\n        </ha-button>\n      </ha-dialog-footer>\n    </ha-wa-dialog>`;\n  }\n\n  static get styles() {\n    return [\n      haStyleDialog,\n      css`\n        @media all and (min-width: 600px) {\n          ha-wa-dialog {\n            --mdc-dialog-min-width: 360px;\n          }\n        }\n\n        .dialog-body {\n          display: flex;\n          flex-direction: column;\n          gap: var(--ha-space-2, 8px);\n          height: 100%;\n          min-height: 0;\n        }\n\n        search-input {\n          display: block;\n          width: 100%;\n        }\n\n        .dpt-list-container {\n          flex: 1 1 auto;\n          min-height: 0;\n          overflow: auto;\n          border: 1px solid var(--divider-color);\n          border-radius: 4px;\n        }\n\n        .dpt-row {\n          display: grid;\n          grid-template-columns: 8ch minmax(0, 1fr) auto;\n          align-items: center;\n          gap: var(--ha-space-2, 8px);\n          padding: 6px 8px;\n          border-radius: 4px;\n        }\n\n        .dpt-row.selected {\n          background-color: rgba(var(--rgb-primary-color), 0.08);\n          outline: 2px solid rgba(var(--rgb-accent-color), 0.12);\n        }\n\n        .dpt-number {\n          font-family:\n            ui-monospace, SFMono-Regular, Menlo, Monaco, \"Roboto Mono\", \"Courier New\", monospace;\n          width: 100%;\n          color: var(--secondary-text-color);\n          white-space: nowrap;\n        }\n\n        .dpt-name {\n          font-weight: 500;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          min-width: 0;\n        }\n\n        .dpt-unit {\n          text-align: right;\n          color: var(--secondary-text-color);\n          white-space: nowrap;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"knx-dpt-select-dialog\": KnxDptSelectDialog;\n  }\n}\n"],"names":["HaSectionTitle","LitElement","render","html","styles","css","SearchInput","focus","this","_input","autofocus","label","hass","localize","filter","suffix","_filterInputChanged","_clearSearch","_filterChanged","value","fireEvent","String","e","target","args","attribute","type","Boolean","KnxDptSelectDialog","showDialog","params","_params","dpts","_selected","initialSelection","_open","closeDialog","_historyState","_dialogClosed","_cancel","undefined","onClose","_confirm","_itemKeydown","ev","key","preventDefault","currentTarget","getAttribute","_onDoubleClick","_onSelect","_onFilterChanged","_filter","detail","_getDptInfo","dpt","meta","replace","name","unit","dialog","localName","nothing","width","title","Object","keys","length","_groupDpts","map","group","items","info","isSelected","haStyleDialog","memoize","Map","filterLower","trim","toLowerCase","matchesNumber","includes","matchesLabel","matchesUnit","split","has","set","get","push","Array","from","entries","sort","a","b","na","Number","nb","isNaN","localeCompare","x","y","parsedX","stringToDpt","parsedY","compareDpt"],"mappings":"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"}
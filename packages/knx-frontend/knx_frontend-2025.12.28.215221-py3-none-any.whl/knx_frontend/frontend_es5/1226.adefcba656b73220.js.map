{"version":3,"file":"1226.adefcba656b73220.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/entity/ha-entity-attribute-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-attribute.ts"],"sourcesContent":["import type { PropertyValues } from \"lit\";\nimport { LitElement, html, nothing } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { ensureArray } from \"../../common/array/ensure-array\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type { HomeAssistant, ValueChangedEvent } from \"../../types\";\nimport \"../ha-combo-box\";\nimport type { HaComboBox } from \"../ha-combo-box\";\n\ninterface AttributeOption {\n  value: string;\n  label: string;\n}\n\n@customElement(\"ha-entity-attribute-picker\")\nclass HaEntityAttributePicker extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public entityId?: string | string[];\n\n  /**\n   * List of attributes to be hidden.\n   * @type {Array}\n   * @attr hide-attributes\n   */\n  @property({ type: Array, attribute: \"hide-attributes\" })\n  public hideAttributes?: string[];\n\n  // eslint-disable-next-line lit/no-native-attributes\n  @property({ type: Boolean }) public autofocus = false;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @property({ type: Boolean, attribute: \"allow-custom-value\" })\n  public allowCustomValue;\n\n  @property() public label?: string;\n\n  @property() public value?: string;\n\n  @property() public helper?: string;\n\n  @state() private _opened = false;\n\n  @query(\"ha-combo-box\", true) private _comboBox!: HaComboBox;\n\n  protected shouldUpdate(changedProps: PropertyValues) {\n    return !(!changedProps.has(\"_opened\") && this._opened);\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    if (\n      (changedProps.has(\"_opened\") && this._opened) ||\n      changedProps.has(\"entityId\") ||\n      changedProps.has(\"attribute\")\n    ) {\n      const entityIds = this.entityId ? ensureArray(this.entityId) : [];\n      const entitiesOptions = entityIds.map<AttributeOption[]>((entityId) => {\n        const stateObj = this.hass.states[entityId];\n        if (!stateObj) {\n          return [];\n        }\n\n        const attributes = Object.keys(stateObj.attributes).filter(\n          (a) => !this.hideAttributes?.includes(a)\n        );\n\n        return attributes.map((a) => ({\n          value: a,\n          label: this.hass.formatEntityAttributeName(stateObj, a),\n        }));\n      });\n\n      const options: AttributeOption[] = [];\n      const optionsSet = new Set<string>();\n      for (const entityOptions of entitiesOptions) {\n        for (const option of entityOptions) {\n          if (!optionsSet.has(option.value)) {\n            optionsSet.add(option.value);\n            options.push(option);\n          }\n        }\n      }\n\n      (this._comboBox as any).filteredItems = options;\n    }\n  }\n\n  protected render() {\n    if (!this.hass) {\n      return nothing;\n    }\n\n    return html`\n      <ha-combo-box\n        .hass=${this.hass}\n        .value=${this.value}\n        .autofocus=${this.autofocus}\n        .label=${this.label ??\n        this.hass.localize(\n          \"ui.components.entity.entity-attribute-picker.attribute\"\n        )}\n        .disabled=${this.disabled || !this.entityId}\n        .required=${this.required}\n        .helper=${this.helper}\n        .allowCustomValue=${this.allowCustomValue}\n        item-id-path=\"value\"\n        item-value-path=\"value\"\n        item-label-path=\"label\"\n        @opened-changed=${this._openedChanged}\n        @value-changed=${this._valueChanged}\n      >\n      </ha-combo-box>\n    `;\n  }\n\n  private get _value() {\n    return this.value || \"\";\n  }\n\n  private _openedChanged(ev: ValueChangedEvent<boolean>) {\n    this._opened = ev.detail.value;\n  }\n\n  private _valueChanged(ev: ValueChangedEvent<string>) {\n    ev.stopPropagation();\n    const newValue = ev.detail.value;\n    if (newValue !== this._value) {\n      this._setValue(newValue);\n    }\n  }\n\n  private _setValue(value: string) {\n    this.value = value;\n    setTimeout(() => {\n      fireEvent(this, \"value-changed\", { value });\n      fireEvent(this, \"change\");\n    }, 0);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-entity-attribute-picker\": HaEntityAttributePicker;\n  }\n}\n","import type { PropertyValues } from \"lit\";\nimport { html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type { AttributeSelector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../entity/ha-entity-attribute-picker\";\nimport { ensureArray } from \"../../common/array/ensure-array\";\n\n@customElement(\"ha-selector-attribute\")\nexport class HaSelectorAttribute extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: AttributeSelector;\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  @property({ attribute: false }) public context?: {\n    filter_entity?: string | string[];\n  };\n\n  protected render() {\n    return html`\n      <ha-entity-attribute-picker\n        .hass=${this.hass}\n        .entityId=${this.selector.attribute?.entity_id ||\n        this.context?.filter_entity}\n        .hideAttributes=${this.selector.attribute?.hide_attributes}\n        .value=${this.value}\n        .label=${this.label}\n        .helper=${this.helper}\n        .disabled=${this.disabled}\n        .required=${this.required}\n        allow-custom-value\n      ></ha-entity-attribute-picker>\n    `;\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    super.updated(changedProps);\n    if (\n      // No need to filter value if no value\n      !this.value ||\n      // Only adjust value if we used the context\n      this.selector.attribute?.entity_id ||\n      // Only check if context has changed\n      !changedProps.has(\"context\")\n    ) {\n      return;\n    }\n\n    const oldContext = changedProps.get(\"context\") as this[\"context\"];\n\n    if (\n      !this.context ||\n      !oldContext ||\n      oldContext.filter_entity === this.context.filter_entity\n    ) {\n      return;\n    }\n\n    // Validate that that the attribute is still valid for this entity, else unselect.\n    let invalid = false;\n    if (this.context.filter_entity) {\n      const entityIds = ensureArray(this.context.filter_entity);\n\n      invalid = !entityIds.some((entityId) => {\n        const stateObj = this.hass.states[entityId];\n        return (\n          stateObj &&\n          this.value in stateObj.attributes &&\n          stateObj.attributes[this.value] !== undefined\n        );\n      });\n    } else {\n      invalid = this.value !== undefined;\n    }\n\n    if (invalid) {\n      fireEvent(this, \"value-changed\", {\n        value: undefined,\n      });\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-attribute\": HaSelectorAttribute;\n  }\n}\n"],"names":["HaEntityAttributePicker","_LitElement","_this","_callSuper","concat","args","autofocus","disabled","required","_opened","changedProps","has","key","value","_step","entitiesOptions","entityId","ensureArray","map","stateObj","hass","states","Object","keys","attributes","filter","a","_this$hideAttributes","hideAttributes","includes","label","formatEntityAttributeName","options","optionsSet","Set","_iterator","_createForOfIteratorHelper","s","n","done","_step2","entityOptions","_iterator2","option","add","push","err","e","f","this","_comboBox","filteredItems","_this$label","html","_t","_","localize","helper","allowCustomValue","_openedChanged","_valueChanged","nothing","get","ev","detail","stopPropagation","newValue","_value","_setValue","setTimeout","fireEvent","LitElement","attribute","type","Array","Boolean","HaSelectorAttribute","_this$selector$attrib","_this$context","_this$selector$attrib2","selector","entity_id","context","filter_entity","hide_attributes","_this$selector$attrib3","_superPropGet","oldContext","invalid","some","undefined"],"mappings":"8eAcAA,EAAA,SAAAC,G,2GAesC,OAftCC,GAAAC,EAAAA,EAAAA,GAAA,KAAAH,EAAA,GAAAI,OAAAC,KAesCC,WAAA,EAAAJ,EAAAK,UAAA,EAAAL,EAAAM,UAAA,EAAAN,EAAAO,SAAA,EAAAP,C,yDAmB1B,SAAAQ,GACR,SAAAA,EAAAC,IAAA,iBAAAF,QACF,IAAAG,IAAA,UAAAC,MAEU,SAAAH,GACR,GAAAA,EAAAC,IAAA,iBAAAF,SAAAC,EAAAC,IAAA,aAAAD,EAAAC,IAAA,cAKE,IAmBAG,EAlBAC,GADA,KAAAC,UAAAC,EAAAA,EAAAA,GAAA,KAAAD,UAAA,IACAE,KAAAF,IACE,IAAAG,EAAA,KAAAC,KAAAC,OAAAL,GACA,OAAAG,EAIAG,OAAAC,KAAAJ,EAAAK,YAAAC,QAAAC,IAAA,IAAAC,EAAA,gBAAAA,EAAA,KAAAC,sBAAA,IAAAD,GAAAA,EAAAE,SAAAH,GAAA,IAIAR,KAAAQ,IAAA,CACEb,MAAAa,EACAI,MAAA,KAAAV,KAAAW,0BAAAZ,EAAAO,OATO,EAUN,IAGLM,EAAA,GACAC,EAAA,IAAAC,IAAAC,GAAAC,EAAAA,EAAAA,GACArB,GAAA,QAAAoB,EAAAE,MAAAvB,EAAAqB,EAAAG,KAAAC,MAAA,KACEC,EADFC,EAAA3B,EAAAD,MAAA6B,GAAAN,EAAAA,EAAAA,GACEK,GAAA,QAAAC,EAAAL,MAAAG,EAAAE,EAAAJ,KAAAC,MAAA,KAAAI,EAAAH,EAAA3B,MACEoB,EAAAtB,IAAAgC,EAAA9B,SACEoB,EAAAW,IAAAD,EAAA9B,OACAmB,EAAAa,KAAAF,GAEJ,QAAAG,GAAAJ,EAAAK,EAAAD,EAAA,SAAAJ,EAAAM,GAAA,CACF,QAAAF,GAAAX,EAAAY,EAAAD,EAAA,SAAAX,EAAAa,GAAA,CAECC,KAAAC,UAAAC,cAAAnB,CACH,CACF,IAAApB,IAAA,SAAAC,MAEU,eAAAuC,EACR,OAAKH,KAAL7B,MAIAiC,EAAAA,EAAAA,IAAAC,IAAAA,EAAAC,CAAA;;gBAAA;iBAAA;qBAAA;iBAAA;oBAAA;oBAAA;kBAAA;4BAAA;;;;0BAAA;yBAAA;;;OAEU,KAAAnC,KACC,KAAAP,MACI,KAAAP,UACJ,QADI8C,EACJ,KAAAtB,aAAA,IAAAsB,EAAAA,EAAA,KAAAhC,KAAAoC,SAAA,0DAIG,KAAAjD,WAAA,KAAAS,SACA,KAAAR,SACF,KAAAiD,OACU,KAAAC,iBAIF,KAAAC,eACD,KAAAC,eApBjBC,EAAAA,EAwBJ,IAAAjD,IAAA,SAAAkD,IAEA,WACE,OAAOb,KAAPpC,OAAA,EACF,IAAAD,IAAA,iBAAAC,MAEQ,SAAAkD,GACNd,KAAAxC,QAAAsD,EAAAC,OAAAnD,KACF,IAAAD,IAAA,gBAAAC,MAEQ,SAAAkD,GACNA,EAAAE,kBACA,IAAAC,EAAAH,EAAAC,OAAAnD,MACAqD,IAAA,KAAAC,QACElB,KAAAmB,UAAAF,EAEJ,IAAAtD,IAAA,YAAAC,MAEQ,SAAAA,GACNoC,KAAApC,MAAAA,EACAwD,YAAA,MACEC,EAAAA,EAAAA,GAAA,sBAAmCzD,WACnCyD,EAAAA,EAAAA,GAAA,iBACC,EACL,KA9HF,CAAAC,EAAAA,K,2BAEcC,WAAA,K,uDAEAA,WAAA,K,2DAOAC,KAAAC,MAAaF,UAAA,qB,iEAIbC,KAAAE,W,4DAEAF,KAAAE,W,2DAEAF,KAAAE,W,2DAEAF,KAAAE,QAAeH,UAAA,wB,wvBCzB7BI,EAAA,SAAA3E,G,2GAAO,OAAAC,GAAAC,EAAAA,EAAAA,GAAA,KAAAyE,EAAA,GAAAxE,OAAAC,KAAAE,UAAA,EAAAL,EAAAM,UAAA,EAAAN,C,mDAmBK,eAAA2E,EAAAC,EAAAC,EACR,OAAA1B,EAAAA,EAAAA,IAAAC,IAAAA,EAAAC,CAAA;;gBAAA;oBAAA;0BAAA;iBAAA;iBAAA;kBAAA;oBAAA;oBAAA;;;OAEU,KAAAnC,MACI,QAAAyD,EAAA,KAAAG,SAAAR,iBAAA,IAAAK,OAAA,EAAAA,EAAAI,aAAA,QAAAH,EAAA,KAAAI,eAAA,IAAAJ,OAAA,EAAAA,EAAAK,eAEM,QAFNJ,EAEM,KAAAC,SAAAR,iBAAA,IAAAO,OAAA,EAAAA,EAAAK,gBACT,KAAAvE,MACA,KAAAiB,MACC,KAAA2B,OACE,KAAAlD,SACA,KAAAC,SAIhB,IAAAI,IAAA,UAAAC,MAEU,SAAAH,GAAA,IAAA2E,EAER,IADAC,EAAAA,EAAAA,GAAAV,EAAA,iBAAAU,CAAA,CAAA5E,IAGGuC,KAADpC,QAEA,QAFAwE,EAEApC,KAAA+B,SAAAR,iBAAA,IAAAa,IAAAA,EAAAJ,YAEAvE,EAAAC,IAAA,WANF,CAWA,IAAA4E,EAAA7E,EAAAoD,IAAA,WAEA,QAAAoB,SAAAK,GAAAA,EAAAJ,gBAAA,KAAAD,QAAAC,cAAA,CASA,IAAAK,GAAA,EACA,GAAIvC,KAAJiC,QAAAC,cAGEK,IAFAvE,EAAAA,EAAAA,GAAA,KAAAiE,QAAAC,eAEAM,MAAAzE,IACE,IAAAG,EAAA,KAAAC,KAAAC,OAAAL,GACA,OAAAG,GAAA,KAAAN,SAAAM,EAAAK,iBAAAkE,IAAAvE,EAAAK,WAAA,KAAAX,MAAA,SAOF2E,OAAAE,IAAA,KAAA7E,MAGF2E,IACElB,EAAAA,EAAAA,GAAA,sBACEzD,WAAA6E,GArBJ,CAVA,CAkCF,KAjFF,CAAAnB,EAAAA,K,2BACcC,WAAA,K,uDAEAA,WAAA,K,0OAQAC,KAAAE,W,2DAEAF,KAAAE,W,2DAEAH,WAAA,K"}
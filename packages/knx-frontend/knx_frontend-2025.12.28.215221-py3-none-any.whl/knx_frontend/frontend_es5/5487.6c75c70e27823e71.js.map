{"version":3,"file":"5487.6c75c70e27823e71.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/ha-tts-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-tts.ts","webpack://knx-frontend/./homeassistant-frontend/src/data/tts.ts"],"sourcesContent":["import type { PropertyValues } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stopPropagation } from \"../common/dom/stop_propagation\";\nimport { computeStateName } from \"../common/entity/compute_state_name\";\nimport { debounce } from \"../common/util/debounce\";\nimport type { TTSEngine } from \"../data/tts\";\nimport { listTTSEngines } from \"../data/tts\";\nimport type { HomeAssistant } from \"../types\";\nimport \"./ha-list-item\";\nimport \"./ha-select\";\nimport type { HaSelect } from \"./ha-select\";\nimport { computeDomain } from \"../common/entity/compute_domain\";\n\nconst NONE = \"__NONE_OPTION__\";\n\n@customElement(\"ha-tts-picker\")\nexport class HaTTSPicker extends LitElement {\n  @property() public value?: string;\n\n  @property() public label?: string;\n\n  @property() public language?: string;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean, reflect: true }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @state() _engines?: TTSEngine[];\n\n  protected render() {\n    if (!this._engines) {\n      return nothing;\n    }\n\n    let value = this.value;\n    if (!value && this.required) {\n      for (const entity of Object.values(this.hass.entities)) {\n        if (\n          entity.platform === \"cloud\" &&\n          computeDomain(entity.entity_id) === \"tts\"\n        ) {\n          value = entity.entity_id;\n          break;\n        }\n      }\n\n      if (!value) {\n        for (const ttsEngine of this._engines) {\n          if (ttsEngine?.supported_languages?.length !== 0) {\n            value = ttsEngine.engine_id;\n            break;\n          }\n        }\n      }\n    }\n    if (!value) {\n      value = NONE;\n    }\n\n    return html`\n      <ha-select\n        .label=${this.label ||\n        this.hass!.localize(\"ui.components.tts-picker.tts\")}\n        .value=${value}\n        .required=${this.required}\n        .disabled=${this.disabled}\n        @selected=${this._changed}\n        @closed=${stopPropagation}\n        fixedMenuPosition\n        naturalMenuWidth\n      >\n        ${!this.required\n          ? html`<ha-list-item .value=${NONE}>\n              ${this.hass!.localize(\"ui.components.tts-picker.none\")}\n            </ha-list-item>`\n          : nothing}\n        ${this._engines.map((engine) => {\n          if (engine.deprecated && engine.engine_id !== value) {\n            return nothing;\n          }\n          let label: string;\n          if (engine.engine_id.includes(\".\")) {\n            const stateObj = this.hass!.states[engine.engine_id];\n            label = stateObj ? computeStateName(stateObj) : engine.engine_id;\n          } else {\n            label = engine.name || engine.engine_id;\n          }\n          return html`<ha-list-item\n            .value=${engine.engine_id}\n            .disabled=${engine.supported_languages?.length === 0}\n          >\n            ${label}\n          </ha-list-item>`;\n        })}\n      </ha-select>\n    `;\n  }\n\n  protected willUpdate(changedProperties: PropertyValues<this>): void {\n    super.willUpdate(changedProperties);\n    if (!this.hasUpdated) {\n      this._updateEngines();\n    } else if (changedProperties.has(\"language\")) {\n      this._debouncedUpdateEngines();\n    }\n  }\n\n  private _debouncedUpdateEngines = debounce(() => this._updateEngines(), 500);\n\n  private async _updateEngines() {\n    this._engines = (\n      await listTTSEngines(\n        this.hass,\n        this.language,\n        this.hass.config.country || undefined\n      )\n    ).providers;\n\n    if (!this.value) {\n      return;\n    }\n\n    const selectedEngine = this._engines.find(\n      (engine) => engine.engine_id === this.value\n    );\n\n    fireEvent(this, \"supported-languages-changed\", {\n      value: selectedEngine?.supported_languages,\n    });\n\n    if (!selectedEngine || selectedEngine.supported_languages?.length === 0) {\n      this.value = undefined;\n      fireEvent(this, \"value-changed\", { value: this.value });\n    }\n  }\n\n  static styles = css`\n    ha-select {\n      width: 100%;\n    }\n  `;\n\n  private _changed(ev): void {\n    const target = ev.target as HaSelect;\n    if (\n      !this.hass ||\n      target.value === \"\" ||\n      target.value === this.value ||\n      (this.value === undefined && target.value === NONE)\n    ) {\n      return;\n    }\n    this.value = target.value === NONE ? undefined : target.value;\n    fireEvent(this, \"value-changed\", { value: this.value });\n    fireEvent(this, \"supported-languages-changed\", {\n      value: this._engines!.find((engine) => engine.engine_id === this.value)\n        ?.supported_languages,\n    });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-tts-picker\": HaTTSPicker;\n  }\n}\n","import { css, html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport type { TTSSelector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-tts-picker\";\n\n@customElement(\"ha-selector-tts\")\nexport class HaTTSSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: TTSSelector;\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  @property({ attribute: false }) public context?: {\n    language?: string;\n  };\n\n  protected render() {\n    return html`<ha-tts-picker\n      .hass=${this.hass}\n      .value=${this.value}\n      .label=${this.label}\n      .helper=${this.helper}\n      .language=${this.selector.tts?.language || this.context?.language}\n      .disabled=${this.disabled}\n      .required=${this.required}\n    ></ha-tts-picker>`;\n  }\n\n  static styles = css`\n    ha-tts-picker {\n      width: 100%;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-tts\": HaTTSSelector;\n  }\n}\n","import type { HomeAssistant } from \"../types\";\n\nexport interface TTSEngine {\n  engine_id: string;\n  supported_languages?: string[];\n  name?: string;\n  deprecated: boolean;\n}\n\nexport interface TTSVoice {\n  voice_id: string;\n  name: string;\n}\n\nexport const convertTextToSpeech = (\n  hass: HomeAssistant,\n  data: {\n    platform: string;\n    message: string;\n    cache?: boolean;\n    language?: string;\n    options?: Record<string, unknown>;\n  }\n) => hass.callApi<{ url: string; path: string }>(\"POST\", \"tts_get_url\", data);\n\nconst TTS_MEDIA_SOURCE_PREFIX = \"media-source://tts/\";\n\nexport const isTTSMediaSource = (mediaContentId: string) =>\n  mediaContentId.startsWith(TTS_MEDIA_SOURCE_PREFIX);\n\nexport const getProviderFromTTSMediaSource = (mediaContentId: string) =>\n  mediaContentId.substring(TTS_MEDIA_SOURCE_PREFIX.length);\n\nexport const listTTSEngines = (\n  hass: HomeAssistant,\n  language?: string,\n  country?: string\n): Promise<{ providers: TTSEngine[] }> =>\n  hass.callWS({\n    type: \"tts/engine/list\",\n    language,\n    country,\n  });\n\nexport const getTTSEngine = (\n  hass: HomeAssistant,\n  engine_id: string\n): Promise<{ provider: TTSEngine }> =>\n  hass.callWS({\n    type: \"tts/engine/get\",\n    engine_id,\n  });\n\nexport const listTTSVoices = (\n  hass: HomeAssistant,\n  engine_id: string,\n  language: string\n): Promise<{ voices: TTSVoice[] | null }> =>\n  hass.callWS({\n    type: \"tts/engine/voices\",\n    engine_id,\n    language,\n  });\n"],"names":["NONE","HaTTSPicker","_LitElement","_this","_callSuper","concat","args","disabled","required","_debouncedUpdateEngines","debounce","_updateEngines","this","_engines","nothing","value","_i","_Object$values","Object","values","hass","entities","length","entity","platform","computeDomain","entity_id","_step","_iterator","_createForOfIteratorHelper","s","n","done","_ttsEngine$supported_","ttsEngine","supported_languages","engine_id","err","e","f","html","_t","_","label","localize","_changed","stopPropagation","_t2","map","engine","_engine$supported_lan","deprecated","includes","stateObj","states","computeStateName","name","_t3","key","changedProperties","_superPropGet","hasUpdated","has","_updateEngines2","_asyncToGenerator","_regenerator","m","_callee","_selectedEngine$suppo","selectedEngine","w","_context","listTTSEngines","language","config","country","undefined","v","providers","a","find","fireEvent","apply","arguments","ev","_this$_engines$find","target","LitElement","styles","css","_t4","attribute","type","Boolean","reflect","HaTTSSelector","_this$selector$tts","_this$context","helper","selector","tts","context","convertTextToSpeech","data","callApi","TTS_MEDIA_SOURCE_PREFIX","isTTSMediaSource","mediaContentId","startsWith","getProviderFromTTSMediaSource","substring","callWS","getTTSEngine","listTTSVoices"],"mappings":"8dAeAA,EAAA,kBAGAC,EAAA,SAAAC,G,2GAAO,OAAAC,GAAAC,EAAAA,EAAAA,GAAA,KAAAH,EAAA,GAAAI,OAAAC,KAAAC,UAAA,EAAAJ,EAAAK,UAAA,EAAAL,EAAAM,yBAAAC,EAAAA,EAAAA,IAAA,IAAAP,EAAAQ,kBAAA,KAAAR,C,mDAeK,WACR,IAAKS,KAALC,SACE,OAAAC,EAAAA,GAGF,IAAAC,EAAA,KAAAA,MACA,IAAAA,GAAA,KAAAP,SAAA,CACE,IAAK,IAALQ,EAAA,EAAAC,EAAAC,OAAAC,OAAA,KAAAC,KAAAC,UAAAL,EAAAC,EAAAK,OAAAN,IAAA,KAAAO,EAAAN,EAAAD,GACE,aAAAO,EAAAC,UAAA,SAAAC,EAAAA,EAAAA,GAAAF,EAAAG,WAAA,CAIEX,EAAAQ,EAAAG,UACA,KACF,CACF,CAEA,IAAAX,EAAA,KACEY,EADFC,GAAAC,EAAAA,EAAAA,GACE,KAAAhB,UAAA,QAAAe,EAAAE,MAAAH,EAAAC,EAAAG,KAAAC,MAAA,KAAAC,EAAAC,EAAAP,EAAAZ,MACE,QAAAmB,SAAA,QAAAD,EAAAC,EAAAC,2BAAA,IAAAF,OAAA,EAAAA,EAAAX,QAAA,CACEP,EAAAmB,EAAAE,UACA,KACF,CACF,QAAAC,GAAAT,EAAAU,EAAAD,EAAA,SAAAT,EAAAW,GAAA,CACF,CACF,CAKA,OAJAxB,IACEA,EAAAf,IAGFwC,EAAAA,EAAAA,IAAAC,IAAAA,EAAAC,CAAA;;iBAAA;iBAAA;oBAAA;oBAAA;oBAAA;kBAAA;;;;UAAA;UAAA;;OAEW,KAAAC,OAAA,KAAAvB,KAAAwB,SAAA,gCAEA7B,EACG,KAAAP,SACA,KAAAD,SACA,KAAAsC,SACFC,EAAAA,EAIR,KAAAtC,SAGmBM,EAAAA,IAHnB0B,EAAAA,EAAAA,IAAAO,IAAAA,EAAAL,CAAA;gBAAA;8BAAA1C,EAEM,KAAAoB,KAAAwB,SAAA,kCAGN,KAAA/B,SAAAmC,KAAAC,IAAA,IAAAC,EAIEP,EAHA,GAAAM,EAAAE,YAAAF,EAAAb,YAAArB,EACE,OAAAD,EAAAA,GAGF,GAAAmC,EAAAb,UAAAgB,SAAA,MACE,IAAAC,EAAA,KAAAjC,KAAAkC,OAAAL,EAAAb,WACAO,EAAAU,GAAAE,EAAAA,EAAAA,GAAAF,GAAAJ,EAAAb,SACF,MACEO,EAAAM,EAAAO,MAAAP,EAAAb,UAEF,OAAAI,EAAAA,EAAAA,IAAAiB,IAAAA,EAAAf,CAAA;qBAAA;wBAAA;;cAAA;4BACSO,EAAAb,UACG,aAAAc,EAAAD,EAAAd,2BAAA,IAAAe,OAAA,EAAAA,EAAA5B,QAEVqB,EAAA,IAKV,IAAAe,IAAA,aAAA3C,MAEU,SAAA4C,IACRC,EAAAA,EAAAA,GAAA3D,EAAA,oBAAA2D,CAAA,CAAAD,IACK/C,KAALiD,WAEAF,EAAAG,IAAA,aACElD,KAAAH,0BAFAG,KAAAD,gBAIJ,IAAA+C,IAAA,iBAAA3C,OAAAgD,GAAAC,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,GAIA,SAAAC,IAAA,IAAAC,EAAAC,EAAA,OAAAJ,EAAAA,EAAAA,KAAAK,GAAA,SAAAC,GAAA,cAAAA,EAAAxC,GAAA,cAAAwC,EAAAxC,EAAA,GACEyC,EAAAA,EAAAA,IAAA5D,KAAAQ,KAAAR,KAAA6D,SAAA7D,KAAAQ,KAAAsD,OAAAC,cAAAC,GAAA,UAAAhE,KAAAC,SAAA0D,EAAAM,EAAAC,UAQA,KAAA/D,MAAA,CAAAwD,EAAAxC,EAAA,eAAAwC,EAAAQ,EAAA,UAIAV,EAAA,KAAAxD,SAAAmE,MAAA/B,GAAAA,EAAAb,YAAA,KAAArB,SAIAkE,EAAAA,EAAAA,GAAA,oCACElE,MAAAsD,aAAA,EAAAA,EAAAlC,sBAGFkC,GAAA,aAAAD,EAAAC,EAAAlC,2BAAA,IAAAiC,OAAA,EAAAA,EAAA9C,UACEV,KAAAG,WAAA6D,GACAK,EAAAA,EAAAA,GAAA,sBAAmClE,MAAA,KAAAA,SACrC,cAAAwD,EAAAQ,EAAA,MAAAZ,EAAA,UACF,WAzBA,OAAAJ,EAAAmB,MAAA,KAAAC,UAAA,KAAAzB,IAAA,WAAA3C,MAiCQ,SAAAqE,GAAA,IAAAC,EACNC,EAAAF,EAAAE,QACA,KAAAlE,MAAA,KAAAkE,EAAAvE,OAAAuE,EAAAvE,QAAA,KAAAA,YAAA6D,IAAA,KAAA7D,OAAAuE,EAAAvE,QAAAf,IAQAY,KAAAG,MAAAuE,EAAAvE,QAAAf,OAAA4E,EAAAU,EAAAvE,OACAkE,EAAAA,EAAAA,GAAA,sBAAmClE,MAAA,KAAAA,SACnCkE,EAAAA,EAAAA,GAAA,oCACElE,MAAA,QAAAsE,EAAA,KAAAxE,SAAAmE,MAAA/B,GAAAA,EAAAb,YAAA,KAAArB,eAAA,IAAAsE,OAAA,EAAAA,EAAAlD,sBAGJ,KArDA,IAAA4B,CAqDA,CAhJF,CAAAwB,EAAAA,IAAatF,EAAAuF,QAAAC,EAAAA,EAAAA,IAAAC,IAAAA,EAAAhD,CAAA;;;;mNAOCiD,WAAA,K,uDAEAC,KAAAC,QAAeC,SAAA,K,2DAEfF,KAAAC,W,6JCtBdE,EAAA,SAAA7F,G,2GAAO,OAAAC,GAAAC,EAAAA,EAAAA,GAAA,KAAA2F,EAAA,GAAA1F,OAAAC,KAAAC,UAAA,EAAAJ,EAAAK,UAAA,EAAAL,C,mDAmBK,eAAA6F,EAAAC,EACR,OAAAzD,EAAAA,EAAAA,IAAAC,IAAAA,EAAAC,CAAA;cAAA;eAAA;eAAA;gBAAA;kBAAA;kBAAA;kBAAA;wBACQ,KAAAtB,KACC,KAAAL,MACA,KAAA4B,MACC,KAAAuD,QACE,QAAAF,EAAA,KAAAG,SAAAC,WAAA,IAAAJ,OAAA,EAAAA,EAAAvB,YAAA,QAAAwB,EAAA,KAAAI,eAAA,IAAAJ,OAAA,EAAAA,EAAAxB,UACA,KAAAlE,SACA,KAAAC,SAEd,KA7BF,CAAA+E,EAAAA,IAAaQ,EAAAP,QAAAC,EAAAA,EAAAA,IAAA1C,IAAAA,EAAAL,CAAA;;;;kCACCiD,WAAA,K,uDAEAA,WAAA,K,0OAQAC,KAAAC,W,2DAEAD,KAAAC,W,2DAEAF,WAAA,K,kQCRP,IAAPW,EAAAA,CAAAlF,EAAAmF,IAAAnF,EAAAoF,QAAA,qBAAAD,GAWAE,EAAA,sBAEAC,EAAAC,GAAAA,EAAAC,WAAAH,GAGAI,EAAAF,GAAAA,EAAAG,UAAAL,IAGAjC,EAAAA,CAAApD,EAAAqD,EAAAE,IAAAvD,EAAA2F,OAAA,CAMInB,KAAA,kBACAnB,WACAE,YAGJqC,EAAAA,CAAA5F,EAAAgB,IAAAhB,EAAA2F,OAAA,CAKInB,KAAA,iBACAxD,cAGJ6E,EAAAA,CAAA7F,EAAAgB,EAAAqC,IAAArD,EAAA2F,OAAA,CAMInB,KAAA,oBACAxD,YACAqC,Y"}
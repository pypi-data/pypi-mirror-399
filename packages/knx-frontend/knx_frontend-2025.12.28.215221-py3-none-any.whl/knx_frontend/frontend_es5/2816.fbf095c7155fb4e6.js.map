{"version":3,"file":"2816.fbf095c7155fb4e6.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/device/ha-device-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/device/ha-devices-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-device.ts","webpack://knx-frontend/./homeassistant-frontend/src/common/util/time-cache-function-promise.ts","webpack://knx-frontend/./homeassistant-frontend/src/data/entity_sources.ts","webpack://knx-frontend/./homeassistant-frontend/src/util/brands-url.ts"],"sourcesContent":["import type { ComboBoxLitRenderer } from \"@vaadin/combo-box/lit\";\nimport type { HassEntity } from \"home-assistant-js-websocket\";\nimport { html, LitElement, nothing, type PropertyValues } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { computeAreaName } from \"../../common/entity/compute_area_name\";\nimport { computeDeviceName } from \"../../common/entity/compute_device_name\";\nimport { getDeviceContext } from \"../../common/entity/context/get_device_context\";\nimport { getConfigEntries, type ConfigEntry } from \"../../data/config_entries\";\nimport {\n  getDevices,\n  type DevicePickerItem,\n  type DeviceRegistryEntry,\n} from \"../../data/device_registry\";\nimport type { HomeAssistant } from \"../../types\";\nimport { brandsUrl } from \"../../util/brands-url\";\nimport \"../ha-generic-picker\";\nimport type { HaGenericPicker } from \"../ha-generic-picker\";\n\nexport type HaDevicePickerDeviceFilterFunc = (\n  device: DeviceRegistryEntry\n) => boolean;\n\nexport type HaDevicePickerEntityFilterFunc = (entity: HassEntity) => boolean;\n\n@customElement(\"ha-device-picker\")\nexport class HaDevicePicker extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  // eslint-disable-next-line lit/no-native-attributes\n  @property({ type: Boolean }) public autofocus = false;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @property() public label?: string;\n\n  @property() public value?: string;\n\n  @property() public helper?: string;\n\n  @property() public placeholder?: string;\n\n  @property({ type: String, attribute: \"search-label\" })\n  public searchLabel?: string;\n\n  @property({ attribute: false, type: Array }) public createDomains?: string[];\n\n  /**\n   * Show only devices with entities from specific domains.\n   * @type {Array}\n   * @attr include-domains\n   */\n  @property({ type: Array, attribute: \"include-domains\" })\n  public includeDomains?: string[];\n\n  /**\n   * Show no devices with entities of these domains.\n   * @type {Array}\n   * @attr exclude-domains\n   */\n  @property({ type: Array, attribute: \"exclude-domains\" })\n  public excludeDomains?: string[];\n\n  /**\n   * Show only devices with entities of these device classes.\n   * @type {Array}\n   * @attr include-device-classes\n   */\n  @property({ type: Array, attribute: \"include-device-classes\" })\n  public includeDeviceClasses?: string[];\n\n  /**\n   * List of devices to be excluded.\n   * @type {Array}\n   * @attr exclude-devices\n   */\n  @property({ type: Array, attribute: \"exclude-devices\" })\n  public excludeDevices?: string[];\n\n  @property({ attribute: false })\n  public deviceFilter?: HaDevicePickerDeviceFilterFunc;\n\n  @property({ attribute: false })\n  public entityFilter?: HaDevicePickerEntityFilterFunc;\n\n  @property({ attribute: \"hide-clear-icon\", type: Boolean })\n  public hideClearIcon = false;\n\n  @query(\"ha-generic-picker\") private _picker?: HaGenericPicker;\n\n  @state() private _configEntryLookup: Record<string, ConfigEntry> = {};\n\n  private _getDevicesMemoized = memoizeOne(getDevices);\n\n  protected firstUpdated(_changedProperties: PropertyValues): void {\n    super.firstUpdated(_changedProperties);\n    this._loadConfigEntries();\n  }\n\n  private async _loadConfigEntries() {\n    const configEntries = await getConfigEntries(this.hass);\n    this._configEntryLookup = Object.fromEntries(\n      configEntries.map((entry) => [entry.entry_id, entry])\n    );\n  }\n\n  private _getItems = () =>\n    this._getDevicesMemoized(\n      this.hass,\n      this._configEntryLookup,\n      this.includeDomains,\n      this.excludeDomains,\n      this.includeDeviceClasses,\n      this.deviceFilter,\n      this.entityFilter,\n      this.excludeDevices,\n      this.value\n    );\n\n  private _valueRenderer = memoizeOne(\n    (configEntriesLookup: Record<string, ConfigEntry>) => (value: string) => {\n      const deviceId = value;\n      const device = this.hass.devices[deviceId];\n\n      if (!device) {\n        return html`<span slot=\"headline\">${deviceId}</span>`;\n      }\n\n      const { area } = getDeviceContext(device, this.hass);\n\n      const deviceName = device ? computeDeviceName(device) : undefined;\n      const areaName = area ? computeAreaName(area) : undefined;\n\n      const primary = deviceName;\n      const secondary = areaName;\n\n      const configEntry = device.primary_config_entry\n        ? configEntriesLookup[device.primary_config_entry]\n        : undefined;\n\n      return html`\n        ${configEntry\n          ? html`<img\n              slot=\"start\"\n              alt=\"\"\n              crossorigin=\"anonymous\"\n              referrerpolicy=\"no-referrer\"\n              src=${brandsUrl({\n                domain: configEntry.domain,\n                type: \"icon\",\n                darkOptimized: this.hass.themes?.darkMode,\n              })}\n            />`\n          : nothing}\n        <span slot=\"headline\">${primary}</span>\n        <span slot=\"supporting-text\">${secondary}</span>\n      `;\n    }\n  );\n\n  private _rowRenderer: ComboBoxLitRenderer<DevicePickerItem> = (item) => html`\n    <ha-combo-box-item type=\"button\">\n      ${item.domain\n        ? html`\n            <img\n              slot=\"start\"\n              alt=\"\"\n              crossorigin=\"anonymous\"\n              referrerpolicy=\"no-referrer\"\n              src=${brandsUrl({\n                domain: item.domain,\n                type: \"icon\",\n                darkOptimized: this.hass.themes.darkMode,\n              })}\n            />\n          `\n        : nothing}\n\n      <span slot=\"headline\">${item.primary}</span>\n      ${item.secondary\n        ? html`<span slot=\"supporting-text\">${item.secondary}</span>`\n        : nothing}\n      ${item.domain_name\n        ? html`\n            <div slot=\"trailing-supporting-text\" class=\"domain\">\n              ${item.domain_name}\n            </div>\n          `\n        : nothing}\n    </ha-combo-box-item>\n  `;\n\n  protected render() {\n    const placeholder =\n      this.placeholder ??\n      this.hass.localize(\"ui.components.device-picker.placeholder\");\n\n    const valueRenderer = this._valueRenderer(this._configEntryLookup);\n\n    return html`\n      <ha-generic-picker\n        .hass=${this.hass}\n        .autofocus=${this.autofocus}\n        .label=${this.label}\n        .searchLabel=${this.searchLabel}\n        .notFoundLabel=${this._notFoundLabel}\n        .emptyLabel=${this.hass.localize(\n          \"ui.components.device-picker.no_devices\"\n        )}\n        .placeholder=${placeholder}\n        .value=${this.value}\n        .rowRenderer=${this._rowRenderer}\n        .getItems=${this._getItems}\n        .hideClearIcon=${this.hideClearIcon}\n        .valueRenderer=${valueRenderer}\n        @value-changed=${this._valueChanged}\n      >\n      </ha-generic-picker>\n    `;\n  }\n\n  public async open() {\n    await this.updateComplete;\n    await this._picker?.open();\n  }\n\n  private _valueChanged(ev) {\n    ev.stopPropagation();\n    const value = ev.detail.value;\n    this.value = value;\n    fireEvent(this, \"value-changed\", { value });\n  }\n\n  private _notFoundLabel = (search: string) =>\n    this.hass.localize(\"ui.components.device-picker.no_match\", {\n      term: html`<b>‘${search}’</b>`,\n    });\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-device-picker\": HaDevicePicker;\n  }\n}\n","import { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type { HomeAssistant, ValueChangedEvent } from \"../../types\";\nimport \"./ha-device-picker\";\nimport type {\n  HaDevicePickerDeviceFilterFunc,\n  HaDevicePickerEntityFilterFunc,\n} from \"./ha-device-picker\";\n\n@customElement(\"ha-devices-picker\")\nclass HaDevicesPicker extends LitElement {\n  @property({ attribute: false }) public hass?: HomeAssistant;\n\n  @property({ type: Array }) public value?: string[];\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  /**\n   * Show entities from specific domains.\n   * @type {string}\n   * @attr include-domains\n   */\n  @property({ type: Array, attribute: \"include-domains\" })\n  public includeDomains?: string[];\n\n  /**\n   * Show no entities of these domains.\n   * @type {Array}\n   * @attr exclude-domains\n   */\n  @property({ type: Array, attribute: \"exclude-domains\" })\n  public excludeDomains?: string[];\n\n  @property({ type: Array, attribute: \"include-device-classes\" })\n  public includeDeviceClasses?: string[];\n\n  @property({ attribute: \"picked-device-label\" })\n  public pickedDeviceLabel?: string;\n\n  @property({ attribute: \"pick-device-label\" }) public pickDeviceLabel?: string;\n\n  @property({ attribute: false })\n  public deviceFilter?: HaDevicePickerDeviceFilterFunc;\n\n  @property({ attribute: false })\n  public entityFilter?: HaDevicePickerEntityFilterFunc;\n\n  protected render() {\n    if (!this.hass) {\n      return nothing;\n    }\n\n    const currentDevices = this._currentDevices;\n    return html`\n      ${currentDevices.map(\n        (entityId) => html`\n          <div>\n            <ha-device-picker\n              allow-custom-entity\n              .curValue=${entityId}\n              .hass=${this.hass}\n              .deviceFilter=${this.deviceFilter}\n              .entityFilter=${this.entityFilter}\n              .includeDomains=${this.includeDomains}\n              .excludeDomains=${this.excludeDomains}\n              .includeDeviceClasses=${this.includeDeviceClasses}\n              .value=${entityId}\n              .label=${this.pickedDeviceLabel}\n              .disabled=${this.disabled}\n              @value-changed=${this._deviceChanged}\n            ></ha-device-picker>\n          </div>\n        `\n      )}\n      <div>\n        <ha-device-picker\n          allow-custom-entity\n          .hass=${this.hass}\n          .helper=${this.helper}\n          .deviceFilter=${this.deviceFilter}\n          .entityFilter=${this.entityFilter}\n          .includeDomains=${this.includeDomains}\n          .excludeDomains=${this.excludeDomains}\n          .excludeDevices=${currentDevices}\n          .includeDeviceClasses=${this.includeDeviceClasses}\n          .label=${this.pickDeviceLabel}\n          .disabled=${this.disabled}\n          .required=${this.required && !currentDevices.length}\n          @value-changed=${this._addDevice}\n        ></ha-device-picker>\n      </div>\n    `;\n  }\n\n  private get _currentDevices() {\n    return this.value || [];\n  }\n\n  private async _updateDevices(devices) {\n    fireEvent(this, \"value-changed\", {\n      value: devices,\n    });\n\n    this.value = devices;\n  }\n\n  private _deviceChanged(event: ValueChangedEvent<string>) {\n    event.stopPropagation();\n    const curValue = (event.currentTarget as any).curValue;\n    const newValue = event.detail.value;\n    if (newValue === curValue) {\n      return;\n    }\n    if (newValue === undefined) {\n      this._updateDevices(\n        this._currentDevices.filter((dev) => dev !== curValue)\n      );\n    } else {\n      this._updateDevices(\n        this._currentDevices.map((dev) => (dev === curValue ? newValue : dev))\n      );\n    }\n  }\n\n  private async _addDevice(event: ValueChangedEvent<string>) {\n    event.stopPropagation();\n    const toAdd = event.detail.value;\n    (event.currentTarget as any).value = \"\";\n    if (!toAdd) {\n      return;\n    }\n    const currentDevices = this._currentDevices;\n    if (currentDevices.includes(toAdd)) {\n      return;\n    }\n\n    this._updateDevices([...currentDevices, toAdd]);\n  }\n\n  static override styles = css`\n    div {\n      margin-top: 8px;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-devices-picker\": HaDevicesPicker;\n  }\n}\n","import type { HassEntity } from \"home-assistant-js-websocket\";\nimport type { PropertyValues } from \"lit\";\nimport { html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { ensureArray } from \"../../common/array/ensure-array\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type { DeviceRegistryEntry } from \"../../data/device_registry\";\nimport { getDeviceIntegrationLookup } from \"../../data/device_registry\";\nimport type { EntitySources } from \"../../data/entity_sources\";\nimport { fetchEntitySourcesWithCache } from \"../../data/entity_sources\";\nimport type { DeviceSelector } from \"../../data/selector\";\nimport type { ConfigEntry } from \"../../data/config_entries\";\nimport { getConfigEntries } from \"../../data/config_entries\";\nimport {\n  filterSelectorDevices,\n  filterSelectorEntities,\n} from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../device/ha-device-picker\";\nimport \"../device/ha-devices-picker\";\n\n@customElement(\"ha-selector-device\")\nexport class HaDeviceSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: DeviceSelector;\n\n  @state() private _entitySources?: EntitySources;\n\n  @state() private _configEntries?: ConfigEntry[];\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property() public placeholder?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  private _deviceIntegrationLookup = memoizeOne(getDeviceIntegrationLookup);\n\n  private _hasIntegration(selector: DeviceSelector) {\n    return (\n      (selector.device?.filter &&\n        ensureArray(selector.device.filter).some(\n          (filter) => filter.integration\n        )) ||\n      (selector.device?.entity &&\n        ensureArray(selector.device.entity).some(\n          (device) => device.integration\n        ))\n    );\n  }\n\n  protected willUpdate(changedProperties: PropertyValues): void {\n    if (changedProperties.get(\"selector\") && this.value !== undefined) {\n      if (this.selector.device?.multiple && !Array.isArray(this.value)) {\n        this.value = [this.value];\n        fireEvent(this, \"value-changed\", { value: this.value });\n      } else if (!this.selector.device?.multiple && Array.isArray(this.value)) {\n        this.value = this.value[0];\n        fireEvent(this, \"value-changed\", { value: this.value });\n      }\n    }\n  }\n\n  protected updated(changedProperties: PropertyValues): void {\n    super.updated(changedProperties);\n    if (\n      changedProperties.has(\"selector\") &&\n      this._hasIntegration(this.selector) &&\n      !this._entitySources\n    ) {\n      fetchEntitySourcesWithCache(this.hass).then((sources) => {\n        this._entitySources = sources;\n      });\n    }\n    if (!this._configEntries && this._hasIntegration(this.selector)) {\n      this._configEntries = [];\n      getConfigEntries(this.hass).then((entries) => {\n        this._configEntries = entries;\n      });\n    }\n  }\n\n  protected render() {\n    if (this._hasIntegration(this.selector) && !this._entitySources) {\n      return nothing;\n    }\n\n    if (!this.selector.device?.multiple) {\n      return html`\n        <ha-device-picker\n          .hass=${this.hass}\n          .value=${this.value}\n          .label=${this.label}\n          .helper=${this.helper}\n          .deviceFilter=${this._filterDevices}\n          .entityFilter=${this.selector.device?.entity\n            ? this._filterEntities\n            : undefined}\n          .placeholder=${this.placeholder}\n          .disabled=${this.disabled}\n          .required=${this.required}\n          allow-custom-entity\n        ></ha-device-picker>\n      `;\n    }\n\n    return html`\n      ${this.label ? html`<label>${this.label}</label>` : \"\"}\n      <ha-devices-picker\n        .hass=${this.hass}\n        .value=${this.value}\n        .helper=${this.helper}\n        .deviceFilter=${this._filterDevices}\n        .entityFilter=${this.selector.device?.entity\n          ? this._filterEntities\n          : undefined}\n        .disabled=${this.disabled}\n        .required=${this.required}\n      ></ha-devices-picker>\n    `;\n  }\n\n  private _filterDevices = (device: DeviceRegistryEntry): boolean => {\n    if (!this.selector.device?.filter) {\n      return true;\n    }\n    const deviceIntegrations = this._entitySources\n      ? this._deviceIntegrationLookup(\n          this._entitySources,\n          Object.values(this.hass.entities),\n          Object.values(this.hass.devices),\n          this._configEntries\n        )\n      : undefined;\n\n    return ensureArray(this.selector.device.filter).some((filter) =>\n      filterSelectorDevices(filter, device, deviceIntegrations)\n    );\n  };\n\n  private _filterEntities = (entity: HassEntity): boolean =>\n    ensureArray(this.selector.device!.entity).some((filter) =>\n      filterSelectorEntities(filter, entity, this._entitySources)\n    );\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-device\": HaDeviceSelector;\n  }\n}\n","import type { HomeAssistant } from \"../../types\";\n\ninterface CacheResult<T> {\n  result: T;\n  cacheKey: any;\n}\n\n/**\n * Caches a result of a promise for X time. Allows optional extra validation\n * check to invalidate the cache.\n * @param cacheKey the key to store the cache\n * @param cacheTime the time to cache the result\n * @param func the function to fetch the data\n * @param generateCacheKey optional function to generate a cache key based on current hass + cached result. Cache is invalid if generates a different cache key.\n * @param hass Home Assistant object\n * @param args extra arguments to pass to the function to fetch the data\n * @returns\n */\nexport const timeCachePromiseFunc = async <T>(\n  cacheKey: string,\n  cacheTime: number,\n  func: (hass: HomeAssistant, ...args: any[]) => Promise<T>,\n  generateCacheKey:\n    | ((hass: HomeAssistant, lastResult: T) => unknown)\n    | undefined,\n  hass: HomeAssistant,\n  ...args: any[]\n): Promise<T> => {\n  const anyHass = hass as any;\n  const lastResult: Promise<CacheResult<T>> | CacheResult<T> | undefined =\n    anyHass[cacheKey];\n\n  const checkCachedResult = (result: CacheResult<T>): T | Promise<T> => {\n    if (\n      !generateCacheKey ||\n      generateCacheKey(hass, result.result) === result.cacheKey\n    ) {\n      return result.result;\n    }\n\n    anyHass[cacheKey] = undefined;\n    return timeCachePromiseFunc(\n      cacheKey,\n      cacheTime,\n      func,\n      generateCacheKey,\n      hass,\n      ...args\n    );\n  };\n\n  // If we have a cached result, return it if it's still valid\n  if (lastResult) {\n    return lastResult instanceof Promise\n      ? lastResult.then(checkCachedResult)\n      : checkCachedResult(lastResult);\n  }\n\n  const resultPromise = func(hass, ...args);\n  anyHass[cacheKey] = resultPromise;\n\n  resultPromise.then(\n    // When successful, set timer to clear cache\n    (result) => {\n      anyHass[cacheKey] = {\n        result,\n        cacheKey: generateCacheKey?.(hass, result),\n      };\n      setTimeout(() => {\n        anyHass[cacheKey] = undefined;\n      }, cacheTime);\n    },\n    // On failure, clear cache right away\n    () => {\n      anyHass[cacheKey] = undefined;\n    }\n  );\n\n  return resultPromise;\n};\n","import { timeCachePromiseFunc } from \"../common/util/time-cache-function-promise\";\nimport type { HomeAssistant } from \"../types\";\n\ninterface EntitySource {\n  domain: string;\n}\n\nexport type EntitySources = Record<string, EntitySource>;\n\nconst fetchEntitySources = (hass: HomeAssistant): Promise<EntitySources> =>\n  hass.callWS({ type: \"entity/source\" });\n\nexport const fetchEntitySourcesWithCache = (\n  hass: HomeAssistant\n): Promise<EntitySources> =>\n  timeCachePromiseFunc(\n    \"_entitySources\",\n    // cache for 30 seconds\n    30000,\n    fetchEntitySources,\n    // We base the cache on number of states. If number of states\n    // changes we force a refresh\n    (hass2) => Object.keys(hass2.states).length,\n    hass\n  );\n","export interface BrandsOptions {\n  domain: string;\n  type: \"icon\" | \"logo\" | \"icon@2x\" | \"logo@2x\";\n  useFallback?: boolean;\n  darkOptimized?: boolean;\n  brand?: boolean;\n}\n\nexport interface HardwareBrandsOptions {\n  category: string;\n  model?: string;\n  manufacturer: string;\n  darkOptimized?: boolean;\n}\n\nexport const brandsUrl = (options: BrandsOptions): string =>\n  `https://brands.home-assistant.io/${options.brand ? \"brands/\" : \"\"}${\n    options.useFallback ? \"_/\" : \"\"\n  }${options.domain}/${options.darkOptimized ? \"dark_\" : \"\"}${\n    options.type\n  }.png`;\n\nexport const hardwareBrandsUrl = (options: HardwareBrandsOptions): string =>\n  `https://brands.home-assistant.io/hardware/${options.category}/${\n    options.darkOptimized ? \"dark_\" : \"\"\n  }${options.manufacturer}${options.model ? `_${options.model}` : \"\"}.png`;\n\nexport const extractDomainFromBrandUrl = (url: string) => url.split(\"/\")[4];\n\nexport const isBrandUrl = (thumbnail: string | \"\"): boolean =>\n  thumbnail.startsWith(\"https://brands.home-assistant.io/\");\n"],"names":["HaDevicePicker","_LitElement","_this","_callSuper","concat","args","autofocus","disabled","required","hideClearIcon","_configEntryLookup","_getDevicesMemoized","memoizeOne","getDevices","_getItems","hass","includeDomains","excludeDomains","includeDeviceClasses","deviceFilter","entityFilter","excludeDevices","value","_valueRenderer","configEntriesLookup","_this$hass$themes","deviceId","device","devices","html","_t","_","area","getDeviceContext","primary","computeDeviceName","undefined","secondary","computeAreaName","configEntry","primary_config_entry","_t2","_t3","brandsUrl","domain","type","darkOptimized","themes","darkMode","nothing","_rowRenderer","item","_t4","_t5","_t6","domain_name","_t7","_notFoundLabel","search","localize","term","_t8","_changedProperties","_superPropGet","this","_loadConfigEntries","key","_loadConfigEntries2","_asyncToGenerator","_regenerator","m","_callee","configEntries","w","_context","n","getConfigEntries","v","Object","fromEntries","map","entry","entry_id","a","apply","arguments","_this$placeholder","placeholder","valueRenderer","_t9","label","searchLabel","_valueChanged","_open","_callee2","_this$_picker","_context2","updateComplete","_picker","open","ev","stopPropagation","detail","fireEvent","LitElement","attribute","Boolean","String","Array","HaDevicesPicker","currentDevices","_currentDevices","entityId","pickedDeviceLabel","_deviceChanged","helper","pickDeviceLabel","length","_addDevice","get","_updateDevices2","_x","event","curValue","currentTarget","newValue","_updateDevices","filter","dev","_addDevice2","toAdd","includes","_toConsumableArray","_x2","styles","css","HaDeviceSelector","_deviceIntegrationLookup","getDeviceIntegrationLookup","_filterDevices","_this$selector$device","selector","deviceIntegrations","_entitySources","values","entities","_configEntries","ensureArray","some","filterSelectorDevices","_filterEntities","entity","filterSelectorEntities","_selector$device","_selector$device2","integration","changedProperties","_this$selector$device2","_this$selector$device3","multiple","isArray","has","_hasIntegration","fetchEntitySourcesWithCache","then","sources","entries","_this$selector$device4","_this$selector$device6","_this$selector$device5","timeCachePromiseFunc","_ref","cacheKey","cacheTime","func","generateCacheKey","_len","_key","anyHass","lastResult","checkCachedResult","resultPromise","_args","result","Promise","setTimeout","_x3","_x4","_x5","fetchEntitySources","callWS","hass2","keys","states","options","brand","useFallback","extractDomainFromBrandUrl","url","split","isBrandUrl","thumbnail","startsWith"],"mappings":"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"}
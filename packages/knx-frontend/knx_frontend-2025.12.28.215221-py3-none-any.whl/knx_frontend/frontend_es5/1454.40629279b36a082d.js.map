{"version":3,"file":"1454.40629279b36a082d.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/ha-form/ha-form-optional_actions.ts"],"sourcesContent":["import { mdiPlus } from \"@mdi/js\";\nimport type { PropertyValues, TemplateResult } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { stopPropagation } from \"../../common/dom/stop_propagation\";\nimport type { LocalizeFunc } from \"../../common/translations/localize\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-button\";\nimport \"../ha-list-item\";\nimport \"../ha-svg-icon\";\nimport \"./ha-form\";\nimport type {\n  HaFormDataContainer,\n  HaFormElement,\n  HaFormOptionalActionsSchema,\n  HaFormSchema,\n} from \"./types\";\n\nconst NO_ACTIONS = [];\n\n@customElement(\"ha-form-optional_actions\")\nexport class HaFormOptionalActions extends LitElement implements HaFormElement {\n  @property({ attribute: false }) public localize?: LocalizeFunc;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public data!: HaFormDataContainer;\n\n  @property({ attribute: false }) public schema!: HaFormOptionalActionsSchema;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ attribute: false }) public computeLabel?: (\n    schema: HaFormSchema,\n    data?: HaFormDataContainer\n  ) => string;\n\n  @property({ attribute: false }) public computeHelper?: (\n    schema: HaFormSchema\n  ) => string;\n\n  @property({ attribute: false }) public localizeValue?: (\n    key: string\n  ) => string;\n\n  @state() private _displayActions?: string[];\n\n  public async focus() {\n    await this.updateComplete;\n    this.renderRoot.querySelector(\"ha-form\")?.focus();\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    super.updated(changedProps);\n    if (changedProps.has(\"data\")) {\n      const displayActions = this._displayActions ?? NO_ACTIONS;\n      const hiddenActions = this._hiddenActions(\n        this.schema.schema,\n        displayActions\n      );\n      this._displayActions = [\n        ...displayActions,\n        ...hiddenActions.filter((name) => name in this.data),\n      ];\n    }\n  }\n\n  private _hiddenActions = memoizeOne(\n    (schema: readonly HaFormSchema[], displayActions: string[]): string[] =>\n      schema\n        .map((item) => item.name)\n        .filter((name) => !displayActions.includes(name))\n  );\n\n  private _displaySchema = memoizeOne(\n    (\n      schema: readonly HaFormSchema[],\n      displayActions: string[]\n    ): HaFormSchema[] =>\n      schema.filter((item) => displayActions.includes(item.name))\n  );\n\n  public render(): TemplateResult {\n    const displayActions = this._displayActions ?? NO_ACTIONS;\n\n    const schema = this._displaySchema(\n      this.schema.schema,\n      this._displayActions ?? []\n    );\n\n    const hiddenActions = this._hiddenActions(\n      this.schema.schema,\n      displayActions\n    );\n\n    const schemaMap = new Map<string, HaFormSchema>(\n      this.computeLabel\n        ? this.schema.schema.map((item) => [item.name, item])\n        : []\n    );\n\n    return html`\n      ${schema.length > 0\n        ? html`\n            <ha-form\n              .hass=${this.hass}\n              .data=${this.data}\n              .schema=${schema}\n              .disabled=${this.disabled}\n              .computeLabel=${this.computeLabel}\n              .computeHelper=${this.computeHelper}\n              .localizeValue=${this.localizeValue}\n            ></ha-form>\n          `\n        : nothing}\n      ${hiddenActions.length > 0\n        ? html`\n            <ha-button-menu\n              @action=${this._handleAddAction}\n              fixed\n              @closed=${stopPropagation}\n            >\n              <ha-button slot=\"trigger\" appearance=\"filled\" size=\"small\">\n                <ha-svg-icon .path=${mdiPlus} slot=\"start\"></ha-svg-icon>\n                ${this.localize?.(\"ui.components.form-optional-actions.add\") ||\n                \"Add interaction\"}\n              </ha-button>\n              ${hiddenActions.map((action) => {\n                const actionSchema = schemaMap.get(action);\n                return html`\n                  <ha-list-item>\n                    ${this.computeLabel && actionSchema\n                      ? this.computeLabel(actionSchema)\n                      : action}\n                  </ha-list-item>\n                `;\n              })}\n            </ha-button-menu>\n          `\n        : nothing}\n    `;\n  }\n\n  private _handleAddAction(ev: CustomEvent) {\n    const hiddenActions = this._hiddenActions(\n      this.schema.schema,\n      this._displayActions ?? NO_ACTIONS\n    );\n    const index = ev.detail.index;\n    const action = hiddenActions[index];\n    this._displayActions = [...(this._displayActions ?? []), action];\n  }\n\n  static styles = css`\n    :host {\n      display: flex !important;\n      flex-direction: column;\n      gap: var(--ha-space-6);\n    }\n    :host ha-form {\n      display: block;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-form-optional_actions\": HaFormOptionalActions;\n  }\n}\n"],"names":["NO_ACTIONS","HaFormOptionalActions","_LitElement","_this","_callSuper","concat","args","disabled","_hiddenActions","memoizeOne","schema","displayActions","map","item","name","filter","includes","_displaySchema","_callee","_this$renderRoot$quer","_regenerator","w","_context","n","updateComplete","this","renderRoot","querySelector","focus","a","_focus","apply","arguments","key","value","changedProps","_superPropGet","has","_this$_displayActions","_displayActions","hiddenActions","_toConsumableArray","data","_this$_displayActions2","_this$_displayActions3","_this$localize","schemaMap","Map","computeLabel","html","_t","_","length","_t2","hass","computeHelper","localizeValue","nothing","_t3","_handleAddAction","stopPropagation","localize","call","action","actionSchema","get","_t4","ev","_this$_displayActions4","_this$_displayActions5","detail","index","LitElement","styles","css","_t5","attribute","type","Boolean"],"mappings":"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"}
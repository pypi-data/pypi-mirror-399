{"version":3,"file":"1656.a400d82f076dd491.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/data/supervisor/mounts.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-mount-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-backup-location.ts"],"sourcesContent":["import type { HomeAssistant } from \"../../types\";\n\nexport enum SupervisorMountType {\n  BIND = \"bind\",\n  CIFS = \"cifs\",\n  NFS = \"nfs\",\n}\n\nexport enum SupervisorMountUsage {\n  BACKUP = \"backup\",\n  MEDIA = \"media\",\n  SHARE = \"share\",\n}\n\nexport enum SupervisorMountState {\n  ACTIVE = \"active\",\n  FAILED = \"failed\",\n  UNKNOWN = \"unknown\",\n}\n\ninterface MountOptions {\n  default_backup_mount?: string | null;\n}\n\nexport type CIFSVersion = \"auto\" | \"1.0\" | \"2.0\";\n\ninterface SupervisorMountBase {\n  name: string;\n  usage: SupervisorMountUsage;\n  type: SupervisorMountType;\n  server: string;\n  port: number;\n}\n\nexport interface SupervisorMountResponse extends SupervisorMountBase {\n  state: SupervisorMountState | null;\n}\n\nexport interface SupervisorNFSMount extends SupervisorMountResponse {\n  type: SupervisorMountType.NFS;\n  path: string;\n}\n\nexport interface SupervisorCIFSMount extends SupervisorMountResponse {\n  type: SupervisorMountType.CIFS;\n  share: string;\n  version?: CIFSVersion;\n}\n\nexport type SupervisorMount = SupervisorNFSMount | SupervisorCIFSMount;\n\nexport type SupervisorNFSMountRequestParams = SupervisorNFSMount;\n\nexport interface SupervisorCIFSMountRequestParams extends SupervisorCIFSMount {\n  username?: string;\n  password?: string;\n  version?: CIFSVersion;\n}\n\nexport type SupervisorMountRequestParams =\n  | SupervisorNFSMountRequestParams\n  | SupervisorCIFSMountRequestParams;\n\nexport interface SupervisorMounts {\n  default_backup_mount: string | null;\n  mounts: SupervisorMount[];\n}\n\nexport const fetchSupervisorMounts = async (\n  hass: HomeAssistant\n): Promise<SupervisorMounts> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts`,\n    method: \"get\",\n    timeout: null,\n  });\n\nexport const createSupervisorMount = async (\n  hass: HomeAssistant,\n  data: SupervisorMountRequestParams\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts`,\n    method: \"post\",\n    timeout: null,\n    data,\n  });\n\nexport const updateSupervisorMount = async (\n  hass: HomeAssistant,\n  data: Partial<SupervisorMountRequestParams>\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts/${data.name}`,\n    method: \"put\",\n    timeout: null,\n    data,\n  });\n\nexport const removeSupervisorMount = async (\n  hass: HomeAssistant,\n  name: string\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts/${name}`,\n    method: \"delete\",\n    timeout: null,\n  });\n\nexport const reloadSupervisorMount = async (\n  hass: HomeAssistant,\n  data: SupervisorMount\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts/${data.name}/reload`,\n    method: \"post\",\n    timeout: null,\n  });\n\nexport const changeMountOptions = async (\n  hass: HomeAssistant,\n  data: MountOptions\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts/options`,\n    method: \"post\",\n    timeout: null,\n    data,\n  });\n","import { mdiBackupRestore, mdiFolder, mdiHarddisk, mdiPlayBox } from \"@mdi/js\";\nimport type { CSSResultGroup } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { isComponentLoaded } from \"../common/config/is_component_loaded\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stopPropagation } from \"../common/dom/stop_propagation\";\nimport { caseInsensitiveStringCompare } from \"../common/string/compare\";\nimport type { SupervisorMounts } from \"../data/supervisor/mounts\";\nimport {\n  fetchSupervisorMounts,\n  SupervisorMountType,\n  SupervisorMountUsage,\n} from \"../data/supervisor/mounts\";\nimport type { HomeAssistant } from \"../types\";\nimport \"./ha-alert\";\nimport \"./ha-list-item\";\nimport \"./ha-select\";\nimport type { HaSelect } from \"./ha-select\";\n\nconst _BACKUP_DATA_DISK_ = \"/backup\";\n\n@customElement(\"ha-mount-picker\")\nclass HaMountPicker extends LitElement {\n  public hass!: HomeAssistant;\n\n  @property() public label?: string;\n\n  @property() public value?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @property() public usage?: SupervisorMountUsage;\n\n  @state() private _mounts?: SupervisorMounts;\n\n  @state() private _error?: string;\n\n  protected firstUpdated() {\n    this._getMounts();\n  }\n\n  protected render() {\n    if (this._error) {\n      return html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`;\n    }\n    if (!this._mounts) {\n      return nothing;\n    }\n    const dataDiskOption = html`<ha-list-item\n      graphic=\"icon\"\n      .value=${_BACKUP_DATA_DISK_}\n    >\n      <span>\n        ${this.hass.localize(\"ui.components.mount-picker.use_datadisk\") ||\n        \"Use data disk for backup\"}\n      </span>\n      <ha-svg-icon slot=\"graphic\" .path=${mdiHarddisk}></ha-svg-icon>\n    </ha-list-item>`;\n    return html`\n      <ha-select\n        .label=${this.label === undefined && this.hass\n          ? this.hass.localize(\"ui.components.mount-picker.mount\")\n          : this.label}\n        .value=${this._value}\n        .required=${this.required}\n        .disabled=${this.disabled}\n        .helper=${this.helper}\n        @selected=${this._mountChanged}\n        @closed=${stopPropagation}\n        fixedMenuPosition\n        naturalMenuWidth\n      >\n        ${this.usage === SupervisorMountUsage.BACKUP &&\n        (!this._mounts.default_backup_mount ||\n          this._mounts.default_backup_mount === _BACKUP_DATA_DISK_)\n          ? dataDiskOption\n          : nothing}\n        ${this._filterMounts(this._mounts, this.usage).map(\n          (mount) =>\n            html`<ha-list-item twoline graphic=\"icon\" .value=${mount.name}>\n              <span>${mount.name}</span>\n              <span slot=\"secondary\"\n                >${mount.server}${mount.port\n                  ? `:${mount.port}`\n                  : nothing}${mount.type === SupervisorMountType.NFS\n                  ? mount.path\n                  : `:${mount.share}`}</span\n              >\n              <ha-svg-icon\n                slot=\"graphic\"\n                .path=${mount.usage === SupervisorMountUsage.MEDIA\n                  ? mdiPlayBox\n                  : mount.usage === SupervisorMountUsage.SHARE\n                    ? mdiFolder\n                    : mdiBackupRestore}\n              ></ha-svg-icon>\n            </ha-list-item>`\n        )}\n        ${this.usage === SupervisorMountUsage.BACKUP &&\n        this._mounts.default_backup_mount\n          ? dataDiskOption\n          : nothing}\n      </ha-select>\n    `;\n  }\n\n  private _filterMounts = memoizeOne(\n    (mounts: SupervisorMounts, usage: this[\"usage\"]) => {\n      let filteredMounts = mounts.mounts.filter((mount) =>\n        [SupervisorMountType.CIFS, SupervisorMountType.NFS].includes(mount.type)\n      );\n      if (usage) {\n        filteredMounts = mounts.mounts.filter((mount) => mount.usage === usage);\n      }\n      return filteredMounts.sort((mountA, mountB) => {\n        if (mountA.name === mounts.default_backup_mount) {\n          return -1;\n        }\n        if (mountB.name === mounts.default_backup_mount) {\n          return 1;\n        }\n        return caseInsensitiveStringCompare(\n          mountA.name,\n          mountB.name,\n          this.hass.locale.language\n        );\n      });\n    }\n  );\n\n  private async _getMounts() {\n    try {\n      if (isComponentLoaded(this.hass, \"hassio\")) {\n        this._mounts = await fetchSupervisorMounts(this.hass);\n        if (this.usage === SupervisorMountUsage.BACKUP && !this.value) {\n          this.value = this._mounts.default_backup_mount || _BACKUP_DATA_DISK_;\n        }\n      } else {\n        this._error = this.hass.localize(\n          \"ui.components.mount-picker.error.no_supervisor\"\n        );\n      }\n    } catch (_err: any) {\n      this._error = this.hass.localize(\n        \"ui.components.mount-picker.error.fetch_mounts\"\n      );\n    }\n  }\n\n  private get _value() {\n    return this.value || \"\";\n  }\n\n  private _mountChanged(ev: Event) {\n    ev.stopPropagation();\n    const target = ev.target as HaSelect;\n    const newValue = target.value;\n\n    if (newValue !== this._value) {\n      this._setValue(newValue);\n    }\n  }\n\n  private _setValue(value: string) {\n    this.value = value;\n    setTimeout(() => {\n      fireEvent(this, \"value-changed\", { value });\n      fireEvent(this, \"change\");\n    }, 0);\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      css`\n        ha-select {\n          width: 100%;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-mount-picker\": HaMountPicker;\n  }\n}\n","import { css, html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport type { BackupLocationSelector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-mount-picker\";\n\n@customElement(\"ha-selector-backup_location\")\nexport class HaBackupLocationSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: BackupLocationSelector;\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  protected render() {\n    return html`<ha-mount-picker\n      .hass=${this.hass}\n      .value=${this.value}\n      .label=${this.label}\n      .helper=${this.helper}\n      .disabled=${this.disabled}\n      .required=${this.required}\n      usage=\"backup\"\n    ></ha-mount-picker>`;\n  }\n\n  static styles = css`\n    ha-mount-picker {\n      width: 100%;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-backup_location\": HaBackupLocationSelector;\n  }\n}\n"],"names":["SupervisorMountType","SupervisorMountUsage","fetchSupervisorMounts","_ref","_asyncToGenerator","_regenerator","m","_callee","hass","w","_context","n","a","callWS","type","endpoint","method","timeout","_x","apply","arguments","_BACKUP_DATA_DISK_","HaMountPicker","_LitElement","_this","_callSuper","concat","args","disabled","required","_filterMounts","memoizeOne","mounts","usage","filteredMounts","filter","mount","includes","sort","mountA","mountB","name","default_backup_mount","caseInsensitiveStringCompare","locale","language","this","_getMounts","key","value","_error","html","_t","_","_mounts","nothing","dataDiskOption","_t2","localize","_t3","undefined","label","_value","helper","_mountChanged","stopPropagation","map","_t4","server","port","path","share","_getMounts2","p","isComponentLoaded","v","get","ev","newValue","target","_setValue","setTimeout","fireEvent","css","_t6","LitElement","Boolean","HaBackupLocationSelector","styles","attribute"],"mappings":"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"}
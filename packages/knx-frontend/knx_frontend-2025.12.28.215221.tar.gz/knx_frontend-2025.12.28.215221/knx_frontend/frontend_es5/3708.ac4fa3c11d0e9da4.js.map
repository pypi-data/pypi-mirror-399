{"version":3,"file":"3708.ac4fa3c11d0e9da4.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-tts-voice.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-tts-voice-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/data/tts.ts"],"sourcesContent":["import { css, html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport type { TTSVoiceSelector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-tts-voice-picker\";\n\n@customElement(\"ha-selector-tts_voice\")\nexport class HaTTSVoiceSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: TTSVoiceSelector;\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  @property({ attribute: false }) public context?: {\n    language?: string;\n    engineId?: string;\n  };\n\n  protected render() {\n    return html`<ha-tts-voice-picker\n      .hass=${this.hass}\n      .value=${this.value}\n      .label=${this.label}\n      .helper=${this.helper}\n      .language=${this.selector.tts_voice?.language || this.context?.language}\n      .engineId=${this.selector.tts_voice?.engineId || this.context?.engineId}\n      .disabled=${this.disabled}\n      .required=${this.required}\n    ></ha-tts-voice-picker>`;\n  }\n\n  static styles = css`\n    ha-tts-picker {\n      width: 100%;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-tts_voice\": HaTTSVoiceSelector;\n  }\n}\n","import type { PropertyValues } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stopPropagation } from \"../common/dom/stop_propagation\";\nimport { debounce } from \"../common/util/debounce\";\nimport type { TTSVoice } from \"../data/tts\";\nimport { listTTSVoices } from \"../data/tts\";\nimport type { HomeAssistant } from \"../types\";\nimport \"./ha-list-item\";\nimport \"./ha-select\";\nimport type { HaSelect } from \"./ha-select\";\n\nconst NONE = \"__NONE_OPTION__\";\n\n@customElement(\"ha-tts-voice-picker\")\nexport class HaTTSVoicePicker extends LitElement {\n  @property() public value?: string;\n\n  @property() public label?: string;\n\n  @property({ attribute: false }) public engineId?: string;\n\n  @property() public language?: string;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean, reflect: true }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @state() _voices?: TTSVoice[] | null;\n\n  @query(\"ha-select\") private _select?: HaSelect;\n\n  protected render() {\n    if (!this._voices) {\n      return nothing;\n    }\n    const value =\n      this.value ?? (this.required ? this._voices[0]?.voice_id : NONE);\n    return html`\n      <ha-select\n        .label=${this.label ||\n        this.hass!.localize(\"ui.components.tts-voice-picker.voice\")}\n        .value=${value}\n        .required=${this.required}\n        .disabled=${this.disabled}\n        @selected=${this._changed}\n        @closed=${stopPropagation}\n        fixedMenuPosition\n        naturalMenuWidth\n      >\n        ${!this.required\n          ? html`<ha-list-item .value=${NONE}>\n              ${this.hass!.localize(\"ui.components.tts-voice-picker.none\")}\n            </ha-list-item>`\n          : nothing}\n        ${this._voices.map(\n          (voice) =>\n            html`<ha-list-item .value=${voice.voice_id}>\n              ${voice.name}\n            </ha-list-item>`\n        )}\n      </ha-select>\n    `;\n  }\n\n  protected willUpdate(changedProperties: PropertyValues<this>): void {\n    super.willUpdate(changedProperties);\n    if (!this.hasUpdated) {\n      this._updateVoices();\n    } else if (\n      changedProperties.has(\"language\") ||\n      changedProperties.has(\"engineId\")\n    ) {\n      this._debouncedUpdateVoices();\n    }\n  }\n\n  private _debouncedUpdateVoices = debounce(() => this._updateVoices(), 500);\n\n  private async _updateVoices() {\n    if (!this.engineId || !this.language) {\n      this._voices = undefined;\n      return;\n    }\n    this._voices = (\n      await listTTSVoices(this.hass, this.engineId, this.language)\n    ).voices;\n\n    if (!this.value) {\n      return;\n    }\n\n    if (\n      !this._voices ||\n      !this._voices.find((voice) => voice.voice_id === this.value)\n    ) {\n      this.value = undefined;\n      fireEvent(this, \"value-changed\", { value: this.value });\n    }\n  }\n\n  protected updated(changedProperties: PropertyValues<this>) {\n    super.updated(changedProperties);\n    if (\n      changedProperties.has(\"_voices\") &&\n      this._select?.value !== this.value\n    ) {\n      this._select?.layoutOptions();\n      fireEvent(this, \"value-changed\", { value: this._select?.value });\n    }\n  }\n\n  static styles = css`\n    ha-select {\n      width: 100%;\n    }\n  `;\n\n  private _changed(ev): void {\n    const target = ev.target as HaSelect;\n    if (\n      !this.hass ||\n      target.value === \"\" ||\n      target.value === this.value ||\n      (this.value === undefined && target.value === NONE)\n    ) {\n      return;\n    }\n    this.value = target.value === NONE ? undefined : target.value;\n    fireEvent(this, \"value-changed\", { value: this.value });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-tts-voice-picker\": HaTTSVoicePicker;\n  }\n}\n","import type { HomeAssistant } from \"../types\";\n\nexport interface TTSEngine {\n  engine_id: string;\n  supported_languages?: string[];\n  name?: string;\n  deprecated: boolean;\n}\n\nexport interface TTSVoice {\n  voice_id: string;\n  name: string;\n}\n\nexport const convertTextToSpeech = (\n  hass: HomeAssistant,\n  data: {\n    platform: string;\n    message: string;\n    cache?: boolean;\n    language?: string;\n    options?: Record<string, unknown>;\n  }\n) => hass.callApi<{ url: string; path: string }>(\"POST\", \"tts_get_url\", data);\n\nconst TTS_MEDIA_SOURCE_PREFIX = \"media-source://tts/\";\n\nexport const isTTSMediaSource = (mediaContentId: string) =>\n  mediaContentId.startsWith(TTS_MEDIA_SOURCE_PREFIX);\n\nexport const getProviderFromTTSMediaSource = (mediaContentId: string) =>\n  mediaContentId.substring(TTS_MEDIA_SOURCE_PREFIX.length);\n\nexport const listTTSEngines = (\n  hass: HomeAssistant,\n  language?: string,\n  country?: string\n): Promise<{ providers: TTSEngine[] }> =>\n  hass.callWS({\n    type: \"tts/engine/list\",\n    language,\n    country,\n  });\n\nexport const getTTSEngine = (\n  hass: HomeAssistant,\n  engine_id: string\n): Promise<{ provider: TTSEngine }> =>\n  hass.callWS({\n    type: \"tts/engine/get\",\n    engine_id,\n  });\n\nexport const listTTSVoices = (\n  hass: HomeAssistant,\n  engine_id: string,\n  language: string\n): Promise<{ voices: TTSVoice[] | null }> =>\n  hass.callWS({\n    type: \"tts/engine/voices\",\n    engine_id,\n    language,\n  });\n"],"names":["HaTTSVoiceSelector","_LitElement","_this","_callSuper","concat","args","disabled","required","_this$selector$tts_vo","_this$context","_this$selector$tts_vo2","_this$context2","html","_t","_","hass","value","label","helper","selector","tts_voice","language","context","engineId","LitElement","styles","css","_t2","attribute","type","Boolean","NONE","HaTTSVoicePicker","_debouncedUpdateVoices","debounce","_updateVoices","_this$value","_this$_voices$","this","_voices","nothing","voice_id","localize","_changed","stopPropagation","map","voice","_t3","name","key","changedProperties","_superPropGet","hasUpdated","has","_updateVoices2","_asyncToGenerator","_regenerator","m","_callee","w","_context","n","undefined","a","listTTSVoices","v","voices","find","fireEvent","apply","arguments","_this$_select","_this$_select2","_this$_select3","_select","layoutOptions","ev","target","_t4","reflect","convertTextToSpeech","data","callApi","TTS_MEDIA_SOURCE_PREFIX","isTTSMediaSource","mediaContentId","startsWith","getProviderFromTTSMediaSource","substring","listTTSEngines","country","callWS","getTTSEngine","engine_id"],"mappings":"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"}
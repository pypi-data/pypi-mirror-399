{"version":3,"file":"2816.d98ac974d1fa79d7.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/device/ha-device-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/device/ha-devices-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-device.ts","webpack://knx-frontend/./homeassistant-frontend/src/common/util/time-cache-function-promise.ts","webpack://knx-frontend/./homeassistant-frontend/src/data/entity_sources.ts","webpack://knx-frontend/./homeassistant-frontend/src/util/brands-url.ts"],"sourcesContent":["import type { ComboBoxLitRenderer } from \"@vaadin/combo-box/lit\";\nimport type { HassEntity } from \"home-assistant-js-websocket\";\nimport { html, LitElement, nothing, type PropertyValues } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport { computeAreaName } from \"../../common/entity/compute_area_name\";\nimport { computeDeviceName } from \"../../common/entity/compute_device_name\";\nimport { getDeviceContext } from \"../../common/entity/context/get_device_context\";\nimport { getConfigEntries, type ConfigEntry } from \"../../data/config_entries\";\nimport {\n  getDevices,\n  type DevicePickerItem,\n  type DeviceRegistryEntry,\n} from \"../../data/device_registry\";\nimport type { HomeAssistant } from \"../../types\";\nimport { brandsUrl } from \"../../util/brands-url\";\nimport \"../ha-generic-picker\";\nimport type { HaGenericPicker } from \"../ha-generic-picker\";\n\nexport type HaDevicePickerDeviceFilterFunc = (\n  device: DeviceRegistryEntry\n) => boolean;\n\nexport type HaDevicePickerEntityFilterFunc = (entity: HassEntity) => boolean;\n\n@customElement(\"ha-device-picker\")\nexport class HaDevicePicker extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  // eslint-disable-next-line lit/no-native-attributes\n  @property({ type: Boolean }) public autofocus = false;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @property() public label?: string;\n\n  @property() public value?: string;\n\n  @property() public helper?: string;\n\n  @property() public placeholder?: string;\n\n  @property({ type: String, attribute: \"search-label\" })\n  public searchLabel?: string;\n\n  @property({ attribute: false, type: Array }) public createDomains?: string[];\n\n  /**\n   * Show only devices with entities from specific domains.\n   * @type {Array}\n   * @attr include-domains\n   */\n  @property({ type: Array, attribute: \"include-domains\" })\n  public includeDomains?: string[];\n\n  /**\n   * Show no devices with entities of these domains.\n   * @type {Array}\n   * @attr exclude-domains\n   */\n  @property({ type: Array, attribute: \"exclude-domains\" })\n  public excludeDomains?: string[];\n\n  /**\n   * Show only devices with entities of these device classes.\n   * @type {Array}\n   * @attr include-device-classes\n   */\n  @property({ type: Array, attribute: \"include-device-classes\" })\n  public includeDeviceClasses?: string[];\n\n  /**\n   * List of devices to be excluded.\n   * @type {Array}\n   * @attr exclude-devices\n   */\n  @property({ type: Array, attribute: \"exclude-devices\" })\n  public excludeDevices?: string[];\n\n  @property({ attribute: false })\n  public deviceFilter?: HaDevicePickerDeviceFilterFunc;\n\n  @property({ attribute: false })\n  public entityFilter?: HaDevicePickerEntityFilterFunc;\n\n  @property({ attribute: \"hide-clear-icon\", type: Boolean })\n  public hideClearIcon = false;\n\n  @query(\"ha-generic-picker\") private _picker?: HaGenericPicker;\n\n  @state() private _configEntryLookup: Record<string, ConfigEntry> = {};\n\n  private _getDevicesMemoized = memoizeOne(getDevices);\n\n  protected firstUpdated(_changedProperties: PropertyValues): void {\n    super.firstUpdated(_changedProperties);\n    this._loadConfigEntries();\n  }\n\n  private async _loadConfigEntries() {\n    const configEntries = await getConfigEntries(this.hass);\n    this._configEntryLookup = Object.fromEntries(\n      configEntries.map((entry) => [entry.entry_id, entry])\n    );\n  }\n\n  private _getItems = () =>\n    this._getDevicesMemoized(\n      this.hass,\n      this._configEntryLookup,\n      this.includeDomains,\n      this.excludeDomains,\n      this.includeDeviceClasses,\n      this.deviceFilter,\n      this.entityFilter,\n      this.excludeDevices,\n      this.value\n    );\n\n  private _valueRenderer = memoizeOne(\n    (configEntriesLookup: Record<string, ConfigEntry>) => (value: string) => {\n      const deviceId = value;\n      const device = this.hass.devices[deviceId];\n\n      if (!device) {\n        return html`<span slot=\"headline\">${deviceId}</span>`;\n      }\n\n      const { area } = getDeviceContext(device, this.hass);\n\n      const deviceName = device ? computeDeviceName(device) : undefined;\n      const areaName = area ? computeAreaName(area) : undefined;\n\n      const primary = deviceName;\n      const secondary = areaName;\n\n      const configEntry = device.primary_config_entry\n        ? configEntriesLookup[device.primary_config_entry]\n        : undefined;\n\n      return html`\n        ${configEntry\n          ? html`<img\n              slot=\"start\"\n              alt=\"\"\n              crossorigin=\"anonymous\"\n              referrerpolicy=\"no-referrer\"\n              src=${brandsUrl({\n                domain: configEntry.domain,\n                type: \"icon\",\n                darkOptimized: this.hass.themes?.darkMode,\n              })}\n            />`\n          : nothing}\n        <span slot=\"headline\">${primary}</span>\n        <span slot=\"supporting-text\">${secondary}</span>\n      `;\n    }\n  );\n\n  private _rowRenderer: ComboBoxLitRenderer<DevicePickerItem> = (item) => html`\n    <ha-combo-box-item type=\"button\">\n      ${item.domain\n        ? html`\n            <img\n              slot=\"start\"\n              alt=\"\"\n              crossorigin=\"anonymous\"\n              referrerpolicy=\"no-referrer\"\n              src=${brandsUrl({\n                domain: item.domain,\n                type: \"icon\",\n                darkOptimized: this.hass.themes.darkMode,\n              })}\n            />\n          `\n        : nothing}\n\n      <span slot=\"headline\">${item.primary}</span>\n      ${item.secondary\n        ? html`<span slot=\"supporting-text\">${item.secondary}</span>`\n        : nothing}\n      ${item.domain_name\n        ? html`\n            <div slot=\"trailing-supporting-text\" class=\"domain\">\n              ${item.domain_name}\n            </div>\n          `\n        : nothing}\n    </ha-combo-box-item>\n  `;\n\n  protected render() {\n    const placeholder =\n      this.placeholder ??\n      this.hass.localize(\"ui.components.device-picker.placeholder\");\n\n    const valueRenderer = this._valueRenderer(this._configEntryLookup);\n\n    return html`\n      <ha-generic-picker\n        .hass=${this.hass}\n        .autofocus=${this.autofocus}\n        .label=${this.label}\n        .searchLabel=${this.searchLabel}\n        .notFoundLabel=${this._notFoundLabel}\n        .emptyLabel=${this.hass.localize(\n          \"ui.components.device-picker.no_devices\"\n        )}\n        .placeholder=${placeholder}\n        .value=${this.value}\n        .rowRenderer=${this._rowRenderer}\n        .getItems=${this._getItems}\n        .hideClearIcon=${this.hideClearIcon}\n        .valueRenderer=${valueRenderer}\n        @value-changed=${this._valueChanged}\n      >\n      </ha-generic-picker>\n    `;\n  }\n\n  public async open() {\n    await this.updateComplete;\n    await this._picker?.open();\n  }\n\n  private _valueChanged(ev) {\n    ev.stopPropagation();\n    const value = ev.detail.value;\n    this.value = value;\n    fireEvent(this, \"value-changed\", { value });\n  }\n\n  private _notFoundLabel = (search: string) =>\n    this.hass.localize(\"ui.components.device-picker.no_match\", {\n      term: html`<b>‘${search}’</b>`,\n    });\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-device-picker\": HaDevicePicker;\n  }\n}\n","import { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type { HomeAssistant, ValueChangedEvent } from \"../../types\";\nimport \"./ha-device-picker\";\nimport type {\n  HaDevicePickerDeviceFilterFunc,\n  HaDevicePickerEntityFilterFunc,\n} from \"./ha-device-picker\";\n\n@customElement(\"ha-devices-picker\")\nclass HaDevicesPicker extends LitElement {\n  @property({ attribute: false }) public hass?: HomeAssistant;\n\n  @property({ type: Array }) public value?: string[];\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  /**\n   * Show entities from specific domains.\n   * @type {string}\n   * @attr include-domains\n   */\n  @property({ type: Array, attribute: \"include-domains\" })\n  public includeDomains?: string[];\n\n  /**\n   * Show no entities of these domains.\n   * @type {Array}\n   * @attr exclude-domains\n   */\n  @property({ type: Array, attribute: \"exclude-domains\" })\n  public excludeDomains?: string[];\n\n  @property({ type: Array, attribute: \"include-device-classes\" })\n  public includeDeviceClasses?: string[];\n\n  @property({ attribute: \"picked-device-label\" })\n  public pickedDeviceLabel?: string;\n\n  @property({ attribute: \"pick-device-label\" }) public pickDeviceLabel?: string;\n\n  @property({ attribute: false })\n  public deviceFilter?: HaDevicePickerDeviceFilterFunc;\n\n  @property({ attribute: false })\n  public entityFilter?: HaDevicePickerEntityFilterFunc;\n\n  protected render() {\n    if (!this.hass) {\n      return nothing;\n    }\n\n    const currentDevices = this._currentDevices;\n    return html`\n      ${currentDevices.map(\n        (entityId) => html`\n          <div>\n            <ha-device-picker\n              allow-custom-entity\n              .curValue=${entityId}\n              .hass=${this.hass}\n              .deviceFilter=${this.deviceFilter}\n              .entityFilter=${this.entityFilter}\n              .includeDomains=${this.includeDomains}\n              .excludeDomains=${this.excludeDomains}\n              .includeDeviceClasses=${this.includeDeviceClasses}\n              .value=${entityId}\n              .label=${this.pickedDeviceLabel}\n              .disabled=${this.disabled}\n              @value-changed=${this._deviceChanged}\n            ></ha-device-picker>\n          </div>\n        `\n      )}\n      <div>\n        <ha-device-picker\n          allow-custom-entity\n          .hass=${this.hass}\n          .helper=${this.helper}\n          .deviceFilter=${this.deviceFilter}\n          .entityFilter=${this.entityFilter}\n          .includeDomains=${this.includeDomains}\n          .excludeDomains=${this.excludeDomains}\n          .excludeDevices=${currentDevices}\n          .includeDeviceClasses=${this.includeDeviceClasses}\n          .label=${this.pickDeviceLabel}\n          .disabled=${this.disabled}\n          .required=${this.required && !currentDevices.length}\n          @value-changed=${this._addDevice}\n        ></ha-device-picker>\n      </div>\n    `;\n  }\n\n  private get _currentDevices() {\n    return this.value || [];\n  }\n\n  private async _updateDevices(devices) {\n    fireEvent(this, \"value-changed\", {\n      value: devices,\n    });\n\n    this.value = devices;\n  }\n\n  private _deviceChanged(event: ValueChangedEvent<string>) {\n    event.stopPropagation();\n    const curValue = (event.currentTarget as any).curValue;\n    const newValue = event.detail.value;\n    if (newValue === curValue) {\n      return;\n    }\n    if (newValue === undefined) {\n      this._updateDevices(\n        this._currentDevices.filter((dev) => dev !== curValue)\n      );\n    } else {\n      this._updateDevices(\n        this._currentDevices.map((dev) => (dev === curValue ? newValue : dev))\n      );\n    }\n  }\n\n  private async _addDevice(event: ValueChangedEvent<string>) {\n    event.stopPropagation();\n    const toAdd = event.detail.value;\n    (event.currentTarget as any).value = \"\";\n    if (!toAdd) {\n      return;\n    }\n    const currentDevices = this._currentDevices;\n    if (currentDevices.includes(toAdd)) {\n      return;\n    }\n\n    this._updateDevices([...currentDevices, toAdd]);\n  }\n\n  static override styles = css`\n    div {\n      margin-top: 8px;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-devices-picker\": HaDevicesPicker;\n  }\n}\n","import type { HassEntity } from \"home-assistant-js-websocket\";\nimport type { PropertyValues } from \"lit\";\nimport { html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { ensureArray } from \"../../common/array/ensure-array\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type { DeviceRegistryEntry } from \"../../data/device_registry\";\nimport { getDeviceIntegrationLookup } from \"../../data/device_registry\";\nimport type { EntitySources } from \"../../data/entity_sources\";\nimport { fetchEntitySourcesWithCache } from \"../../data/entity_sources\";\nimport type { DeviceSelector } from \"../../data/selector\";\nimport type { ConfigEntry } from \"../../data/config_entries\";\nimport { getConfigEntries } from \"../../data/config_entries\";\nimport {\n  filterSelectorDevices,\n  filterSelectorEntities,\n} from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../device/ha-device-picker\";\nimport \"../device/ha-devices-picker\";\n\n@customElement(\"ha-selector-device\")\nexport class HaDeviceSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: DeviceSelector;\n\n  @state() private _entitySources?: EntitySources;\n\n  @state() private _configEntries?: ConfigEntry[];\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property() public placeholder?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  private _deviceIntegrationLookup = memoizeOne(getDeviceIntegrationLookup);\n\n  private _hasIntegration(selector: DeviceSelector) {\n    return (\n      (selector.device?.filter &&\n        ensureArray(selector.device.filter).some(\n          (filter) => filter.integration\n        )) ||\n      (selector.device?.entity &&\n        ensureArray(selector.device.entity).some(\n          (device) => device.integration\n        ))\n    );\n  }\n\n  protected willUpdate(changedProperties: PropertyValues): void {\n    if (changedProperties.get(\"selector\") && this.value !== undefined) {\n      if (this.selector.device?.multiple && !Array.isArray(this.value)) {\n        this.value = [this.value];\n        fireEvent(this, \"value-changed\", { value: this.value });\n      } else if (!this.selector.device?.multiple && Array.isArray(this.value)) {\n        this.value = this.value[0];\n        fireEvent(this, \"value-changed\", { value: this.value });\n      }\n    }\n  }\n\n  protected updated(changedProperties: PropertyValues): void {\n    super.updated(changedProperties);\n    if (\n      changedProperties.has(\"selector\") &&\n      this._hasIntegration(this.selector) &&\n      !this._entitySources\n    ) {\n      fetchEntitySourcesWithCache(this.hass).then((sources) => {\n        this._entitySources = sources;\n      });\n    }\n    if (!this._configEntries && this._hasIntegration(this.selector)) {\n      this._configEntries = [];\n      getConfigEntries(this.hass).then((entries) => {\n        this._configEntries = entries;\n      });\n    }\n  }\n\n  protected render() {\n    if (this._hasIntegration(this.selector) && !this._entitySources) {\n      return nothing;\n    }\n\n    if (!this.selector.device?.multiple) {\n      return html`\n        <ha-device-picker\n          .hass=${this.hass}\n          .value=${this.value}\n          .label=${this.label}\n          .helper=${this.helper}\n          .deviceFilter=${this._filterDevices}\n          .entityFilter=${this.selector.device?.entity\n            ? this._filterEntities\n            : undefined}\n          .placeholder=${this.placeholder}\n          .disabled=${this.disabled}\n          .required=${this.required}\n          allow-custom-entity\n        ></ha-device-picker>\n      `;\n    }\n\n    return html`\n      ${this.label ? html`<label>${this.label}</label>` : \"\"}\n      <ha-devices-picker\n        .hass=${this.hass}\n        .value=${this.value}\n        .helper=${this.helper}\n        .deviceFilter=${this._filterDevices}\n        .entityFilter=${this.selector.device?.entity\n          ? this._filterEntities\n          : undefined}\n        .disabled=${this.disabled}\n        .required=${this.required}\n      ></ha-devices-picker>\n    `;\n  }\n\n  private _filterDevices = (device: DeviceRegistryEntry): boolean => {\n    if (!this.selector.device?.filter) {\n      return true;\n    }\n    const deviceIntegrations = this._entitySources\n      ? this._deviceIntegrationLookup(\n          this._entitySources,\n          Object.values(this.hass.entities),\n          Object.values(this.hass.devices),\n          this._configEntries\n        )\n      : undefined;\n\n    return ensureArray(this.selector.device.filter).some((filter) =>\n      filterSelectorDevices(filter, device, deviceIntegrations)\n    );\n  };\n\n  private _filterEntities = (entity: HassEntity): boolean =>\n    ensureArray(this.selector.device!.entity).some((filter) =>\n      filterSelectorEntities(filter, entity, this._entitySources)\n    );\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-device\": HaDeviceSelector;\n  }\n}\n","import type { HomeAssistant } from \"../../types\";\n\ninterface CacheResult<T> {\n  result: T;\n  cacheKey: any;\n}\n\n/**\n * Caches a result of a promise for X time. Allows optional extra validation\n * check to invalidate the cache.\n * @param cacheKey the key to store the cache\n * @param cacheTime the time to cache the result\n * @param func the function to fetch the data\n * @param generateCacheKey optional function to generate a cache key based on current hass + cached result. Cache is invalid if generates a different cache key.\n * @param hass Home Assistant object\n * @param args extra arguments to pass to the function to fetch the data\n * @returns\n */\nexport const timeCachePromiseFunc = async <T>(\n  cacheKey: string,\n  cacheTime: number,\n  func: (hass: HomeAssistant, ...args: any[]) => Promise<T>,\n  generateCacheKey:\n    | ((hass: HomeAssistant, lastResult: T) => unknown)\n    | undefined,\n  hass: HomeAssistant,\n  ...args: any[]\n): Promise<T> => {\n  const anyHass = hass as any;\n  const lastResult: Promise<CacheResult<T>> | CacheResult<T> | undefined =\n    anyHass[cacheKey];\n\n  const checkCachedResult = (result: CacheResult<T>): T | Promise<T> => {\n    if (\n      !generateCacheKey ||\n      generateCacheKey(hass, result.result) === result.cacheKey\n    ) {\n      return result.result;\n    }\n\n    anyHass[cacheKey] = undefined;\n    return timeCachePromiseFunc(\n      cacheKey,\n      cacheTime,\n      func,\n      generateCacheKey,\n      hass,\n      ...args\n    );\n  };\n\n  // If we have a cached result, return it if it's still valid\n  if (lastResult) {\n    return lastResult instanceof Promise\n      ? lastResult.then(checkCachedResult)\n      : checkCachedResult(lastResult);\n  }\n\n  const resultPromise = func(hass, ...args);\n  anyHass[cacheKey] = resultPromise;\n\n  resultPromise.then(\n    // When successful, set timer to clear cache\n    (result) => {\n      anyHass[cacheKey] = {\n        result,\n        cacheKey: generateCacheKey?.(hass, result),\n      };\n      setTimeout(() => {\n        anyHass[cacheKey] = undefined;\n      }, cacheTime);\n    },\n    // On failure, clear cache right away\n    () => {\n      anyHass[cacheKey] = undefined;\n    }\n  );\n\n  return resultPromise;\n};\n","import { timeCachePromiseFunc } from \"../common/util/time-cache-function-promise\";\nimport type { HomeAssistant } from \"../types\";\n\ninterface EntitySource {\n  domain: string;\n}\n\nexport type EntitySources = Record<string, EntitySource>;\n\nconst fetchEntitySources = (hass: HomeAssistant): Promise<EntitySources> =>\n  hass.callWS({ type: \"entity/source\" });\n\nexport const fetchEntitySourcesWithCache = (\n  hass: HomeAssistant\n): Promise<EntitySources> =>\n  timeCachePromiseFunc(\n    \"_entitySources\",\n    // cache for 30 seconds\n    30000,\n    fetchEntitySources,\n    // We base the cache on number of states. If number of states\n    // changes we force a refresh\n    (hass2) => Object.keys(hass2.states).length,\n    hass\n  );\n","export interface BrandsOptions {\n  domain: string;\n  type: \"icon\" | \"logo\" | \"icon@2x\" | \"logo@2x\";\n  useFallback?: boolean;\n  darkOptimized?: boolean;\n  brand?: boolean;\n}\n\nexport interface HardwareBrandsOptions {\n  category: string;\n  model?: string;\n  manufacturer: string;\n  darkOptimized?: boolean;\n}\n\nexport const brandsUrl = (options: BrandsOptions): string =>\n  `https://brands.home-assistant.io/${options.brand ? \"brands/\" : \"\"}${\n    options.useFallback ? \"_/\" : \"\"\n  }${options.domain}/${options.darkOptimized ? \"dark_\" : \"\"}${\n    options.type\n  }.png`;\n\nexport const hardwareBrandsUrl = (options: HardwareBrandsOptions): string =>\n  `https://brands.home-assistant.io/hardware/${options.category}/${\n    options.darkOptimized ? \"dark_\" : \"\"\n  }${options.manufacturer}${options.model ? `_${options.model}` : \"\"}.png`;\n\nexport const extractDomainFromBrandUrl = (url: string) => url.split(\"/\")[4];\n\nexport const isBrandUrl = (thumbnail: string | \"\"): boolean =>\n  thumbnail.startsWith(\"https://brands.home-assistant.io/\");\n"],"names":["HaDevicePicker","LitElement","firstUpdated","_changedProperties","super","this","_loadConfigEntries","configEntries","getConfigEntries","hass","_configEntryLookup","Object","fromEntries","map","entry","entry_id","render","placeholder","localize","valueRenderer","_valueRenderer","html","autofocus","label","searchLabel","_notFoundLabel","value","_rowRenderer","_getItems","hideClearIcon","_valueChanged","open","updateComplete","_picker","ev","stopPropagation","detail","fireEvent","args","disabled","required","_getDevicesMemoized","memoizeOne","getDevices","includeDomains","excludeDomains","includeDeviceClasses","deviceFilter","entityFilter","excludeDevices","configEntriesLookup","deviceId","device","devices","area","getDeviceContext","primary","computeDeviceName","undefined","secondary","computeAreaName","configEntry","primary_config_entry","brandsUrl","domain","type","darkOptimized","themes","darkMode","nothing","item","domain_name","search","term","attribute","Boolean","String","Array","HaDevicesPicker","currentDevices","_currentDevices","entityId","pickedDeviceLabel","_deviceChanged","helper","pickDeviceLabel","length","_addDevice","_updateDevices","event","curValue","currentTarget","newValue","filter","dev","toAdd","includes","styles","css","HaDeviceSelector","_hasIntegration","selector","ensureArray","some","integration","entity","willUpdate","changedProperties","get","multiple","isArray","updated","has","_entitySources","fetchEntitySourcesWithCache","then","sources","_configEntries","entries","_filterDevices","_filterEntities","_deviceIntegrationLookup","getDeviceIntegrationLookup","deviceIntegrations","values","entities","filterSelectorDevices","filterSelectorEntities","timeCachePromiseFunc","cacheKey","cacheTime","func","generateCacheKey","anyHass","lastResult","checkCachedResult","result","Promise","resultPromise","setTimeout","fetchEntitySources","callWS","hass2","keys","states","options","brand","useFallback","extractDomainFromBrandUrl","url","split","isBrandUrl","thumbnail","startsWith"],"mappings":"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"}
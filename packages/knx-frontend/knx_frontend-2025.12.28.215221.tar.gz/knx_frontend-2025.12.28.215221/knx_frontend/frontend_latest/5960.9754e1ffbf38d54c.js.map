{"version":3,"file":"5960.9754e1ffbf38d54c.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/data/lovelace/config/types.ts","webpack://knx-frontend/./homeassistant-frontend/src/data/panel.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-navigation-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/common/string/title-case.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-navigation.ts"],"sourcesContent":["import type { Connection } from \"home-assistant-js-websocket\";\nimport type { HomeAssistant } from \"../../../types\";\nimport type { LovelaceResource } from \"../resource\";\nimport type { LovelaceStrategyConfig } from \"./strategy\";\nimport type { LovelaceViewRawConfig } from \"./view\";\n\nexport interface LovelaceDashboardBaseConfig {}\n\nexport interface LovelaceConfig extends LovelaceDashboardBaseConfig {\n  background?: string;\n  views: LovelaceViewRawConfig[];\n}\n\nexport interface LovelaceDashboardStrategyConfig\n  extends LovelaceDashboardBaseConfig {\n  strategy: LovelaceStrategyConfig;\n}\n\nexport interface LegacyLovelaceConfig extends LovelaceConfig {\n  resources?: LovelaceResource[];\n}\n\nexport type LovelaceRawConfig =\n  | LovelaceConfig\n  | LovelaceDashboardStrategyConfig;\n\nexport function isStrategyDashboard(\n  config: LovelaceRawConfig\n): config is LovelaceDashboardStrategyConfig {\n  return \"strategy\" in config;\n}\n\nexport const fetchConfig = (\n  conn: Connection,\n  urlPath: string | null,\n  force: boolean\n): Promise<LovelaceRawConfig> =>\n  conn.sendMessagePromise({\n    type: \"lovelace/config\",\n    url_path: urlPath,\n    force,\n  });\n\nexport const saveConfig = (\n  hass: HomeAssistant,\n  urlPath: string | null,\n  config: LovelaceRawConfig\n): Promise<void> =>\n  hass.callWS({\n    type: \"lovelace/config/save\",\n    url_path: urlPath,\n    config,\n  });\n\nexport const deleteConfig = (\n  hass: HomeAssistant,\n  urlPath: string | null\n): Promise<void> =>\n  hass.callWS({\n    type: \"lovelace/config/delete\",\n    url_path: urlPath,\n  });\n","import {\n  mdiAccount,\n  mdiCalendar,\n  mdiChartBox,\n  mdiClipboardList,\n  mdiFormatListBulletedType,\n  mdiHammer,\n  mdiLightningBolt,\n  mdiPlayBoxMultiple,\n  mdiTooltipAccount,\n  mdiViewDashboard,\n} from \"@mdi/js\";\nimport type { HomeAssistant, PanelInfo } from \"../types\";\n\n/** Panel to show when no panel is picked. */\nexport const DEFAULT_PANEL = \"lovelace\";\n\nexport const getLegacyDefaultPanelUrlPath = (): string | null => {\n  const defaultPanel = window.localStorage.getItem(\"defaultPanel\");\n  return defaultPanel ? JSON.parse(defaultPanel) : null;\n};\n\nexport const getDefaultPanelUrlPath = (hass: HomeAssistant): string =>\n  hass.userData?.default_panel ||\n  hass.systemData?.default_panel ||\n  getLegacyDefaultPanelUrlPath() ||\n  DEFAULT_PANEL;\n\nexport const getDefaultPanel = (hass: HomeAssistant): PanelInfo => {\n  const panel = getDefaultPanelUrlPath(hass);\n\n  return (panel ? hass.panels[panel] : undefined) ?? hass.panels[DEFAULT_PANEL];\n};\n\nexport const getPanelNameTranslationKey = (panel: PanelInfo) => {\n  if (panel.url_path === \"lovelace\") {\n    return \"panel.states\" as const;\n  }\n\n  if (panel.url_path === \"profile\") {\n    return \"panel.profile\" as const;\n  }\n\n  return `panel.${panel.title}` as const;\n};\n\nexport const getPanelTitle = (\n  hass: HomeAssistant,\n  panel: PanelInfo\n): string | undefined => {\n  const translationKey = getPanelNameTranslationKey(panel);\n\n  return hass.localize(translationKey) || panel.title || undefined;\n};\n\nexport const getPanelTitleFromUrlPath = (\n  hass: HomeAssistant,\n  urlPath: string\n): string | undefined => {\n  if (!hass.panels) {\n    return undefined;\n  }\n\n  const panel = Object.values(hass.panels).find(\n    (p: PanelInfo): boolean => p.url_path === urlPath\n  );\n\n  if (!panel) {\n    return undefined;\n  }\n\n  return getPanelTitle(hass, panel);\n};\n\nexport const getPanelIcon = (panel: PanelInfo): string | undefined => {\n  if (!panel.icon) {\n    switch (panel.component_name) {\n      case \"profile\":\n        return \"mdi:account\";\n      case \"lovelace\":\n        return \"mdi:view-dashboard\";\n    }\n  }\n\n  return panel.icon || undefined;\n};\n\nexport const PANEL_ICON_PATHS = {\n  calendar: mdiCalendar,\n  \"developer-tools\": mdiHammer,\n  energy: mdiLightningBolt,\n  history: mdiChartBox,\n  logbook: mdiFormatListBulletedType,\n  lovelace: mdiViewDashboard,\n  profile: mdiAccount,\n  map: mdiTooltipAccount,\n  \"media-browser\": mdiPlayBoxMultiple,\n  todo: mdiClipboardList,\n};\n\nexport const getPanelIconPath = (panel: PanelInfo): string | undefined =>\n  PANEL_ICON_PATHS[panel.url_path];\n\nexport const FIXED_PANELS = [\"profile\", \"config\"];\nexport const SHOW_AFTER_SPACER_PANELS = [\"developer-tools\"];\n","import type { ComboBoxLitRenderer } from \"@vaadin/combo-box/lit\";\nimport type { PropertyValues, TemplateResult } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { titleCase } from \"../common/string/title-case\";\nimport { fetchConfig } from \"../data/lovelace/config/types\";\nimport type { LovelaceViewRawConfig } from \"../data/lovelace/config/view\";\nimport { getPanelIcon, getPanelTitle } from \"../data/panel\";\nimport type { HomeAssistant, PanelInfo, ValueChangedEvent } from \"../types\";\nimport \"./ha-combo-box\";\nimport type { HaComboBox } from \"./ha-combo-box\";\nimport \"./ha-combo-box-item\";\nimport \"./ha-icon\";\n\ninterface NavigationItem {\n  path: string;\n  icon: string;\n  title: string;\n}\n\nconst DEFAULT_ITEMS: NavigationItem[] = [];\n\nconst rowRenderer: ComboBoxLitRenderer<NavigationItem> = (item) => html`\n  <ha-combo-box-item type=\"button\">\n    <ha-icon .icon=${item.icon} slot=\"start\"></ha-icon>\n    <span slot=\"headline\">${item.title || item.path}</span>\n    ${item.title\n      ? html`<span slot=\"supporting-text\">${item.path}</span>`\n      : nothing}\n  </ha-combo-box-item>\n`;\n\nconst createViewNavigationItem = (\n  prefix: string,\n  view: LovelaceViewRawConfig,\n  index: number\n) => ({\n  path: `/${prefix}/${view.path ?? index}`,\n  icon: view.icon ?? \"mdi:view-compact\",\n  title: view.title ?? (view.path ? titleCase(view.path) : `${index}`),\n});\n\nconst createPanelNavigationItem = (hass: HomeAssistant, panel: PanelInfo) => ({\n  path: `/${panel.url_path}`,\n  icon: getPanelIcon(panel) || \"mdi:view-dashboard\",\n  title: getPanelTitle(hass, panel) || \"\",\n});\n\n@customElement(\"ha-navigation-picker\")\nexport class HaNavigationPicker extends LitElement {\n  @property({ attribute: false }) public hass?: HomeAssistant;\n\n  @property() public label?: string;\n\n  @property() public value?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @state() private _opened = false;\n\n  private navigationItemsLoaded = false;\n\n  private navigationItems: NavigationItem[] = DEFAULT_ITEMS;\n\n  @query(\"ha-combo-box\", true) private comboBox!: HaComboBox;\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-combo-box\n        .hass=${this.hass}\n        item-value-path=\"path\"\n        item-label-path=\"path\"\n        .value=${this._value}\n        allow-custom-value\n        .filteredItems=${this.navigationItems}\n        .label=${this.label}\n        .helper=${this.helper}\n        .disabled=${this.disabled}\n        .required=${this.required}\n        .renderer=${rowRenderer}\n        @opened-changed=${this._openedChanged}\n        @value-changed=${this._valueChanged}\n        @filter-changed=${this._filterChanged}\n      >\n      </ha-combo-box>\n    `;\n  }\n\n  private async _openedChanged(ev: ValueChangedEvent<boolean>) {\n    this._opened = ev.detail.value;\n    if (this._opened && !this.navigationItemsLoaded) {\n      this._loadNavigationItems();\n    }\n  }\n\n  private async _loadNavigationItems() {\n    this.navigationItemsLoaded = true;\n\n    const panels = Object.entries(this.hass!.panels).map(([id, panel]) => ({\n      id,\n      ...panel,\n    }));\n    const lovelacePanels = panels.filter(\n      (panel) => panel.component_name === \"lovelace\"\n    );\n\n    const viewConfigs = await Promise.all(\n      lovelacePanels.map((panel) =>\n        fetchConfig(\n          this.hass!.connection,\n          // path should be null to fetch default lovelace panel\n          panel.url_path === \"lovelace\" ? null : panel.url_path,\n          true\n        )\n          .then((config) => [panel.id, config] as [string, typeof config])\n          .catch((_) => [panel.id, undefined] as [string, undefined])\n      )\n    );\n\n    const panelViewConfig = new Map(viewConfigs);\n\n    this.navigationItems = [];\n\n    for (const panel of panels) {\n      this.navigationItems.push(createPanelNavigationItem(this.hass!, panel));\n\n      const config = panelViewConfig.get(panel.id);\n\n      if (!config || !(\"views\" in config)) continue;\n\n      config.views.forEach((view, index) =>\n        this.navigationItems.push(\n          createViewNavigationItem(panel.url_path, view, index)\n        )\n      );\n    }\n\n    this.comboBox.filteredItems = this.navigationItems;\n  }\n\n  protected shouldUpdate(changedProps: PropertyValues) {\n    return !this._opened || changedProps.has(\"_opened\");\n  }\n\n  private _valueChanged(ev: ValueChangedEvent<string>) {\n    ev.stopPropagation();\n    this._setValue(ev.detail.value);\n  }\n\n  private _setValue(value: string) {\n    this.value = value;\n    fireEvent(\n      this,\n      \"value-changed\",\n      { value: this._value },\n      {\n        bubbles: false,\n        composed: false,\n      }\n    );\n  }\n\n  private _filterChanged(ev: CustomEvent): void {\n    const filterString = ev.detail.value.toLowerCase();\n    const characterCount = filterString.length;\n    if (characterCount >= 2) {\n      const filteredItems: NavigationItem[] = [];\n\n      this.navigationItems.forEach((item) => {\n        if (\n          item.path.toLowerCase().includes(filterString) ||\n          item.title.toLowerCase().includes(filterString)\n        ) {\n          filteredItems.push(item);\n        }\n      });\n\n      if (filteredItems.length > 0) {\n        this.comboBox.filteredItems = filteredItems;\n      } else {\n        this.comboBox.filteredItems = [];\n      }\n    } else {\n      this.comboBox.filteredItems = this.navigationItems;\n    }\n  }\n\n  private get _value() {\n    return this.value || \"\";\n  }\n\n  static styles = css`\n    ha-icon,\n    ha-svg-icon {\n      color: var(--primary-text-color);\n      position: relative;\n      bottom: 0px;\n    }\n    *[slot=\"prefix\"] {\n      margin-right: 8px;\n      margin-inline-end: 8px;\n      margin-inline-start: initial;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-navigation-picker\": HaNavigationPicker;\n  }\n}\n","export const titleCase = (s) =>\n  s.replace(/^_*(.)|_+(.)/g, (_s, c, d) =>\n    c ? c.toUpperCase() : \" \" + d.toUpperCase()\n  );\n","import { html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type { NavigationSelector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-navigation-picker\";\n\n@customElement(\"ha-selector-navigation\")\nexport class HaNavigationSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: NavigationSelector;\n\n  @property() public value?: string;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean, reflect: true }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  protected render() {\n    return html`\n      <ha-navigation-picker\n        .hass=${this.hass}\n        .label=${this.label}\n        .value=${this.value}\n        .required=${this.required}\n        .disabled=${this.disabled}\n        .helper=${this.helper}\n        @value-changed=${this._valueChanged}\n      ></ha-navigation-picker>\n    `;\n  }\n\n  private _valueChanged(ev: CustomEvent) {\n    fireEvent(this, \"value-changed\", { value: ev.detail.value });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-navigation\": HaNavigationSelector;\n  }\n}\n"],"names":["getPanelTitle","hass","panel","translationKey","url_path","title","getPanelNameTranslationKey","localize","undefined","getPanelIcon","icon","component_name","DEFAULT_ITEMS","rowRenderer","item","html","path","nothing","createViewNavigationItem","prefix","view","index","s","replace","_s","c","d","toUpperCase","createPanelNavigationItem","HaNavigationPicker","LitElement","render","_value","navigationItems","label","helper","disabled","required","_openedChanged","_valueChanged","_filterChanged","ev","this","_opened","detail","value","navigationItemsLoaded","_loadNavigationItems","panels","Object","entries","map","id","lovelacePanels","filter","viewConfigs","Promise","all","fetchConfig","conn","connection","urlPath","force","sendMessagePromise","type","then","config","catch","_","panelViewConfig","Map","push","get","views","forEach","comboBox","filteredItems","shouldUpdate","changedProps","has","stopPropagation","_setValue","fireEvent","bubbles","composed","filterString","toLowerCase","length","includes","args","styles","css","attribute","Boolean","HaNavigationSelector","reflect"],"mappings":"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"}
# ColorBridge 更新日志

## [2.1.18] - 2025-12-30
### 🎨 图标和快捷方式增强
- 🖼️ **图标系统集成**: 新增 `colorbridge/inc/` 目录存放应用程序图标
- 🚀 **Linux快捷方式自动创建**: 启动时自动创建应用菜单和桌面快捷方式
- 👥 **多用户支持**: 使用 `os.path.expanduser("~")` 确保不同用户名都能正常创建快捷方式
- 📦 **打包优化**: 更新 `MANIFEST.in` 和 `setup.py` 确保图标文件包含在wheel包中
- 🔧 **启动脚本**: 新增 `colorbridge_launcher.sh` 脚本自动处理串口权限检查

### 🔧 PyQt6兼容性修复和Linux帮助对话框优化
- 🐛 **PyQt6兼容性修复**: 修复`QSerialPort.setWriteBufferSize()`方法在某些PyQt6版本中不存在的问题，添加兼容性检查
- 🔧 **Linux帮助对话框优化**: 修复Linux帮助对话框不显示的问题，使用`exec()`代替`show()`确保对话框正确显示
- 🔧 **Lambda捕获问题修复**: 使用`functools.partial`代替lambda，确保窗口对象正确传递
- 🐛 **串口连接错误修复**: 解决`'QSerialPort' object has no attribute 'setWriteBufferSize'`错误
- 🐛 **龙芯架构CPU型号显示修复**: 修复彩蛋游戏中CPU型号在龙芯架构上不显示的问题，支持多种CPU架构（x86、ARM、龙芯等）
- 📝 **调试日志增强**: 添加Linux帮助对话框显示过程的详细调试日志
- ✅ **跨平台兼容性**: 确保在所有PyQt6版本和CPU架构上都能正常运行
- 📖 **文档更新**: 更新LINUX_TROUBLESHOOTING.md，添加串口连接失败的详细说明

### 🔒 Linux串口权限优化
- 🛡️ **权限自动检测**: 启动时自动检查用户是否在dialout组中
- ⚠️ **权限警告提示**: 如果用户不在dialout组，显示详细的警告信息和解决方案
- 💡 **解决方案提供**: 提供永久解决方案（`sudo usermod -a -G dialout $USER`）和临时解决方案
- 📱 **终端模式**: .desktop文件设置 `Terminal=true`，让用户可以在终端中查看权限提示
- 🔄 **环境检查增强**: 在环境检测后添加Linux串口权限检查，提供更友好的用户体验

### 📦 打包和安装改进
- 📁 **data_files配置**: 在setup.py中添加data_files参数，包含desktop文件和启动脚本
- 🔄 **安装后消息更新**: 更新安装后消息，添加Linux快捷方式创建说明
- 📦 **包发现优化**: 使用`find_packages()`自动发现所有包，确保包含所有必需模块
- ✅ **wheel包验证**: 验证图标文件和启动脚本正确包含在wheel包中

## [2.1.17] - 2025-12-21
### 🔧 Linux帮助对话框和版本统一更新
- 🔧 **Linux帮助对话框**: 添加LinuxHelpDialog类，提供可复制的命令帮助，改进Linux用户体验
- 🔧 **语法错误修复**: 修复send_command函数中的缩进错误，确保代码语法正确
- 🔧 **版本号统一**: 更新所有模块和文档版本号至v2.1.17
- 🔧 **依赖完整性**: 确保所有依赖项正确包含在pyproject.toml和requirements.txt中
- 🔧 **跨平台兼容性**: 改进Linux和Windows下的版本显示一致性
- 🛠️ **文档更新**: 更新所有相关文档中的版本信息和功能描述
- 📝 **代码质量**: 修复潜在语法问题，提升代码可靠性
- 📖 **用户体验**: 改进Linux用户首次启动时的帮助信息

## [2.1.16] - 2025-12-18
### 🔧 版本号统一更新和依赖修复
- 🔧 **版本号统一**: 更新项目中所有代码文件和文档的版本号和说明，统一为v2.1.16
- 🔧 **psutil依赖修复**: 修复pyproject.toml中缺失的psutil依赖，确保Linux安装后正常运行
- 🔧 **游戏模块修复**: 修复games模块缺少__init__.py文件导致的导入错误
- 🔧 **Linux串口权限检测改进**: 增强check_linux_serial_permissions()方法，采用三重检测机制（grp模块、/etc/group文件、id命令）
- 📦 **打包修复**: 更新setup.py添加install_requires参数，确保pip安装时自动安装所有依赖
- 🔄 **文档更新**: 更新ARCHITECTURE.md、README.md等文档中的版本信息和功能描述
- ✅ **功能完整性**: 所有修复遵循功能完整性优先原则，确保原有功能正常工作

## [2.1.15] - 2025-12-17
### 🔧 Linux串口权限自动检测和游戏模块加载修复
- 🔧 **Linux串口权限自动检测**: 在环境管理器中添加`check_linux_serial_permissions()`方法，仅在Linux系统下检测串口权限问题
- 🔧 **智能权限建议**: 检测用户是否在dialout组，检查串口设备文件权限，提供详细的解决方案建议
- 🐛 **游戏模块加载失败修复**: 修复游戏模块加载的错误处理，提供更友好的错误信息和解决方案
- 📦 **依赖修复**: 添加`psutil>=7.0.0`依赖到requirements.txt，修复Debian安装时缺少psutil的问题
- 🔄 **错误处理优化**: 在ImportError时显示详细建议和堆栈跟踪，便于调试
- ✅ **功能完整性**: 所有修复遵循功能完整性优先原则，不靠删减代码回避问题

## [2.1.14] - 2025-12-16
### 🔧 Linux串口连接修复和版本号统一更新
- 🔧 **Linux串口连接修复**: 修复Debian Linux下串口设备识别但连接不上的问题
- 🔧 **环境管理器改进**: 优化`colorbridge_environment_manager.py`中的Linux串口权限检查逻辑
- 🔧 **串口管理器增强**: 在`colorbridge_serial_manager.py`中添加Linux平台检测和错误处理
- 🛠️ **Linux脚本优化**: 更新`start_linux.sh`脚本，提供更好的权限检查和用户交互
- 📝 **新增测试工具**: 添加`test_linux_serial.py`脚本用于诊断Linux串口环境
- 📖 **故障排除指南**: 创建`LINUX_TROUBLESHOOTING.md`详细故障排除文档
- 🔄 **版本号统一**: 更新所有文件和文档中的版本号至v2.1.14
- ✅ **跨平台兼容性**: 确保Windows和Linux下的串口连接功能正常工作

## [2.1.13] - 2025-12-16
### 🔧 Linux兼容性修复和PyPI发布修复
- 🔧 **Linux兼容性修复**: 修复Linux环境下`install_linux.sh`和`start_linux.sh`脚本语法错误
- 🐛 **Bug修复**: 修复`core/__init__.py`第34行未终止字符串字面量语法错误
- 📦 **PyPI发布**: 成功上传v2.1.13到PyPI，解决版本号冲突问题
- 🔄 **脚本优化**: 优化Linux安装脚本，添加虚拟环境检测逻辑
- 🛠️ **兼容性改进**: 将bash特有的`[[ ]]`语法改为兼容的`[ ]`语法
- ✅ **跨平台验证**: 在Windows和Debian Linux上验证pip安装和运行正常

## [2.1.12] - 2025-12-16
### 🔧 Linux兼容性修复和类型注解完善
- 🔧 **Linux兼容性修复**: 修复Linux环境下`NameError: name 'Any' is not defined`错误
- 📝 **类型注解完善**: 在`colorbridge_message_processor.py`中添加`Any`类型导入
- 📦 **版本号更新**: 统一所有模块版本号为v2.1.12
- 🐛 **Bug修复**: 修复Python类型注解导入问题，确保跨平台兼容性
- ✅ **Linux测试**: 在Debian Linux上验证pipx安装和运行正常

## [2.1.11] - 2025-12-16
### 🔧 PyPI发布修复和启动异常修复
- 🔧 **启动异常修复**: 修复`ColorBridgeMainWindow.__init__() got an unexpected keyword argument 'logger_manager'`错误
- 📦 **PyPI发布**: 成功上传v2.1.11到PyPI
- 🔄 **版本一致性**: 统一所有模块版本号为v2.1.11
- ✅ **网络安装**: 支持 `pip install colorbridge` 从PyPI安装

## [2.1.10] - 2025-12-16
### 🔧 PyPI发布修复和版本号调整
- 🔧 **版本号调整**: 由于PyPI文件名重用问题，跳过v2.1.9直接发布v2.1.10
- 📦 **PyPI发布**: 成功上传到PyPI，解决文件名冲突问题
- 🔄 **版本一致性**: 统一所有模块版本号为v2.1.10
- ✅ **网络安装**: 支持 `pip install colorbridge` 从PyPI安装

## [2.1.9] - 2025-12-16 (内部版本，未发布到PyPI)
### 🔧 质量更新和版本修复
- 🔧 **版本修复**: 修复版本号显示不一致问题，统一所有模块版本号为v2.1.9
- 📦 **打包优化**: 改进pip打包配置，优化Windows PATH自动配置逻辑
- 🔄 **PyPI发布问题**: 由于PyPI文件名重用限制，此版本未成功发布
- ✅ **安装体验**: 改进安装后验证和用户指导信息

## [2.1.8] - 2025-12-16

### 🐛 Bug修复、着色优化和终端消息打印功能
- 🐛 **Bug修复**: 修复串口通信中的稳定性问题，优化错误处理和恢复机制
- 🎨 **着色优化**: 优化界面着色算法，提升视觉效果，改进颜色渐变和透明度处理
- 🖨️ **终端消息打印机打印功能**: 新增终端消息打印机打印功能，支持消息格式化和批量打印
- 🔧 **性能优化**: 改进内存管理和资源释放，优化消息缓冲和显示性能

## [2.1.7] - 2025-12-08

### 🎮 台球游戏彩蛋
- 🎯 **新增功能**: 添加2D模仿3D台球游戏作为隐蔽彩蛋功能
- 🎨 **视觉效果**: 实现2D模仿3D的台球桌和球体渲染
- ⚙️ **物理引擎**: 完整的台球碰撞检测和物理模拟
- 🎮 **控制方式**: 鼠标瞄准、空格键蓄力、W键击球
- 💪 **力量系统**: 300%力量上限，分段蓄力机制（200%以下正常，200-250%减半，250-300%再减半）
- 📊 **系统信息**: 游戏窗口右侧显示CPU、内存、存储占用等系统信息
- 🎉 **彩蛋机制**: 连续点击8次"💡 系统调试"菜单项启动游戏，不同点击次数显示不同通知

### 🐛 错误修复（全面修复已知和恶性错误）
#### 🔥 恶性错误修复
- ✅ **QSerialPort致命错误**: 彻底修复 `QSerialPort.setWriteTimeout()` 方法不存在的致命错误，恢复数据发送功能
- ✅ **无限递归崩溃**: 修复日志重定向导致的无限递归问题，添加递归保护机制
- ✅ **资源泄漏**: 修复线程停止机制，避免资源泄漏风险
- ✅ **内存泄漏**: 修复游戏窗口关闭后仍在后台运行的问题，确保资源正确释放

#### 🎨 UI/UX错误修复
- ✅ **串口设备UI**: 修复串口设备和波特率UI下拉列表鼠标悬停时文本变白的问题
- ✅ **样式表解析**: 修复样式表解析错误，消除控制台警告信息
- ✅ **窗口关闭**: 修复游戏窗口关闭无响应问题，确保窗口正确关闭
- ✅ **菜单项消失**: 修复连续点击彩蛋时菜单项"消失"问题，延长点击计时器到8秒

#### 🎮 游戏逻辑修复
- ✅ **母球重置**: 修复玩家球（母球）掉下袋后没有重新出现在台球桌上的问题
- ✅ **游戏启动**: 修复游戏启动一次后无法继续启动的问题
- ✅ **动画系统**: 修复球进袋动画逻辑，确保动画正确播放和完成
- ✅ **物理碰撞**: 优化碰撞检测算法，避免球卡在洞口的问题

#### ⚡ 性能优化修复
- ✅ **CPU信息显示**: 修复CPU名称和频率显示不准确的问题
- ✅ **存储检测**: 修复系统监控面板只检测系统盘的问题，支持所有磁盘检测
- ✅ **消息处理**: 优化消息缓冲区管理，避免消息丢失或重复
- ✅ **日志噪音**: 减少70%的调试日志噪音，提升程序运行效率

#### 🔧 功能完整性修复
- ✅ **设备信息管理**: 修复 `KeyError: 'mdu32'` 和 `KeyError: 'tfpu'` 问题
- ✅ **主题切换**: 修复主题切换时重复更新壁纸的问题
- ✅ **自动滚动**: 修复消息终端不自动滚动到底部的问题
- ✅ **命令回显**: 优化命令回显过滤逻辑，避免重复显示
- 🛡️ **恶性错误修复**: 修复多个已知的严重错误，确保程序稳定性
- 🔧 **代码质量**: 修复代码中的潜在问题和逻辑错误
- 📊 **内存泄漏**: 修复可能导致内存泄漏的资源管理问题
- 🚀 **性能瓶颈**: 优化关键路径的性能问题

### 🛠️ 技术改进
- 🎯 **瞄准系统**: 优化鼠标瞄准精度和响应速度
- 💾 **内存管理**: 改进游戏资源加载和释放机制
- 🔄 **动画系统**: 增强球进袋动画效果
- 📱 **窗口适配**: 根据显示分辨率动态调整游戏窗口大小

### 📚 文档更新
- 📖 **游戏说明**: 添加台球游戏功能说明和操作指南
- 🔧 **修复记录**: 更新所有Bug修复的详细说明
- 📋 **版本信息**: 同步更新所有文档中的版本号

## [2.1.6] - 2025-12-05

### 🔧 版本更新与清理
- ✅ **版本号统一**: 统一更新项目中所有版本号至 v2.1.6
- ✅ **项目清理**: 清理和优化项目结构，准备git提交
- ✅ **文件整理**: 清理不必要的日志文件和缓存文件
- ✅ **一致性检查**: 确保所有版本号和文档保持一致

### 🛠️ 维护改进
- 📁 **项目整理**: 整理项目结构，准备版本发布
- 🧹 **清理优化**: 清理临时文件和缓存，优化git提交
- ✅ **版本同步**: 同步所有模块的版本号信息

### 📋 更新验证
- ✅ **版本一致性**: 验证所有文件中的版本号已更新至2.1.6
- ✅ **功能完整性**: 确保所有功能在版本更新后正常工作
- ✅ **文档同步**: 验证文档与代码版本保持一致

---

## [2.1.4] - 2025-12-05

### 🐛 Bug修复
- ✅ **消息处理错误修复**: 解决 `KeyError: 'mdu32'` 问题，完善设备信息初始化
- ✅ **UI性能优化**: 修复主题切换时重复更新壁纸的问题，添加智能去重机制
- ✅ **自动滚动修复**: 修复消息终端不自动滚动到底部的问题，支持设置控制

### 🔧 功能完整性保证
- 🛡️ **不删减代码**: 所有修复都保持原有功能完整性
- 🔍 **深入分析**: 基于实际日志分析找到根本原因
- ✅ **验证修复**: 确保所有修复经过严格验证，无语法错误

### 📋 代码质量提升
- 📊 **深度代码审查**: 完成全面的代码审查分析，整体评分75/100
- 📝 **工作习惯建立**: 建立并遵循功能完整性优先的工作原则
- 🎯 **精确修复**: 针对具体问题实施精确修复，避免过度工程

### 🛠️ 技术改进
- 🔧 **设备信息管理**: 增强 `mdu32` 和 `tfpu` 字段初始化，避免KeyError
- 🎨 **主题管理**: 优化主题切换逻辑，添加状态跟踪避免重复更新
- 📜 **消息处理**: 增强异常处理，分类处理不同类型的KeyError
- 📜 **UI控制**: 实现条件化自动滚动，支持用户设置控制
- 📁 **自动日志目录**: 在系统初始化时自动创建logs目录，确保日志记录功能正常工作

### 📈 性能优化
- ⚡ **UI响应**: 减少主题切换时的重复渲染，提升响应速度
- 🔄 **消息处理**: 优化硬件测试字段缺失的处理逻辑
- 💾 **内存管理**: 改进设备信息解析的内存使用

### 📚 文档更新
- 📖 **深度分析报告**: 创建详细的代码审查分析报告
- 🔧 **工作习惯文档**: 建立个人工作习惯文档和IFLOW集成
- 📋 **修复验证**: 完成所有修复项的状态标记和验证

---

## [2.1.3] - 2025-12-05

### 🔄 模块重命名
- 📦 **统一命名**: 所有核心模块和UI模块统一使用"colorbridge_"前缀
- 🏗️ **架构优化**: 重构模块命名规范，提高代码可维护性
- 📝 **文档更新**: 更新技术架构文档，反映新的模块结构

### 🚀 启动器优化
- 📁 **文件重组**: 将所有批处理启动文件移动到ColorBridge程序目录
- 🛠️ **路径修复**: 修复批处理文件的路径切换问题
- 📋 **启动选项**: 提供3种不同的启动方式满足不同需求
- 🔧 **错误处理**: 改进启动脚本的环境检测和错误提示

### 📦 启动文件说明
- **启动ColorBridge.bat** - 标准启动器，6种启动模式
- **ColorBridge启动器.bat** - 增强启动器，英文界面，7种选项
- **快速启动ColorBridge.bat** - 简化启动器，直接运行

### 核心模块重命名
- `debug_logger.py` → `colorbridge_debug_logger.py`
- `device_info_manager.py` → `colorbridge_device_info_manager.py`
- `environment_manager.py` → `colorbridge_environment_manager.py`
- `error_recovery.py` → `colorbridge_error_recovery.py`
- `log_analyzer.py` → `colorbridge_log_analyzer.py`
- `log_protector.py` → `colorbridge_log_protector.py`
- `logger_manager.py` → `colorbridge_logger_manager.py`
- `message_processor.py` → `colorbridge_message_processor.py`
- `monitoring_system.py` → `colorbridge_monitoring_system.py`
- `serial_manager.py` → `colorbridge_serial_manager.py`

### UI模块重命名
- `enhanced_notification_manager.py` → `colorbridge_notification_manager.py`
- `pcl2_main_window.py` → `colorbridge_main_window.py`
- `settings_dialog.py` → `colorbridge_settings_dialog.py`
- `theme_manager.py` → `colorbridge_theme_manager.py`

### 类名更新
- `PCL2MainWindow` → `ColorBridgeMainWindow`
- `SerialManager` → `ColorBridgeSerialManager`
- `DeviceInfoManager` → `ColorBridgeDeviceInfoManager`
- `MessageProcessor` → `ColorBridgeMessageProcessor`
- `SettingsDialog` → `ColorBridgeSettingsDialog`
- `ThemeManager` → `ColorBridgeThemeManager`
- `EnhancedNotificationManager` → `ColorBridgeNotificationManager`

### 改进
- 🔧 **代码一致性**: 类名与文件名保持一致
- 📚 **可读性提升**: 更清晰的模块标识和命名规范
- 🛠️ **维护性**: 统一的命名规范便于代码维护

## [2.1.2] - 2025-12-05

### 清理和优化
- 🗑️ **代码清理**: 删除了不必要的备份文件和缓存目录
- 📦 **依赖优化**: 移除了未使用的依赖包 (requests, Pillow)
- 📁 **结构整理**: 清理了根目录的临时文档文件
- 🧹 **环境清理**: 移除了所有 __pycache__ 目录和 .pyc 文件

### 改进
- 📝 **文档更新**: 更新了 requirements.txt 和环境检查器
- 🏗️ **代码简化**: 项目代码量减少约 40%，提高可维护性
- ⚡ **性能提升**: 减少了不必要的模块加载和依赖检查

### 技术细节
- 删除了 347KB 的 message_processor_backup.py 备份文件
- 清理了所有 Python 缓存文件，减少启动时间
- 更新了环境管理器，移除对未使用包的检查
- 优化了依赖列表，只保留实际使用的包

## [2.1.1] - 2025-12-05

### 修复
- 🔧 **严重修复**: 修复了 QSerialPort.setWriteTimeout() 方法不存在的错误
- 📊 **性能优化**: 实现了日志级别控制系统，减少70%的日志噪音
- 🛡️ **稳定性改进**: 简化了线程停止机制，避免资源泄漏风险
- 🐛 **错误处理**: 优化了错误风暴机制，区分致命错误和可恢复错误

### 改进
- 🔍 **调试支持**: 添加了可配置的 DebugLogger 类
- ⚡ **响应速度**: 优化了串口读取等待时间策略
- 📝 **代码质量**: 标准化了错误处理接口

### 技术细节
- 移除了不存在的 `setWriteTimeout()` API 调用
- 使用 `waitForBytesWritten()` 替代处理写入超时
- 实现了 LogLevel 枚举和动态日志级别控制
- 简化了线程终止逻辑，使用单次等待策略

---

## [2.1.0] - 2025-12-04

### 新增
- 🎨 **UI重设计**: 实现了全新的PCL2风格界面
- 📱 **响应式布局**: 适配不同屏幕尺寸
- 🌙 **主题系统**: 支持明暗主题切换
- 🔔 **通知系统**: 增强的通知管理器

### 改进
- 🚀 **性能优化**: 优化了数据处理性能
- 💾 **内存管理**: 改进了缓冲区管理机制
- 🔄 **错误恢复**: 增强了自动错误恢复能力

---

## [2.0.0] - 2025-12-03

### 重大更新
- 🏗️ **架构重构**: 全面重构了核心架构
- 🔌 **串口管理**: 新的串口管理系统
- 📊 **监控系统**: 实时性能监控系统
- 🛠️ **配置系统**: 灵活的配置管理系统

### 新增功能
- 📈 **数据可视化**: 实时数据图表显示
- 🔍 **日志分析**: 智能日志分析工具
- 🎯 **设备检测**: 自动设备检测和识别
- 💡 **智能提示**: 上下文相关的操作提示

---

## [1.0.0] - 2025-11-30

### 初始版本
- 🎉 **首次发布**: ColorBridge 串口助手正式发布
- 🔌 **基础功能**: 串口连接、数据收发、基本显示
- ⚙️ **配置选项**: 基本的串口参数配置
- 📝 **日志记录**: 基础的日志记录功能

---

## 版本说明

### 版本号规则
- **主版本号**: 重大架构变更或不兼容更新
- **次版本号**: 新功能添加或重要改进
- **修订版本号**: Bug修复和小幅改进

### 更新类型标识
- 🔧 **修复**: Bug修复和错误纠正
- ✨ **新增**: 全新功能添加
- 🔄 **改进**: 现有功能优化
- 🛡️ **安全**: 安全性相关改进
- 📚 **文档**: 文档更新和改进
- 🎨 **界面**: UI/UX相关改进
- ⚡ **性能**: 性能优化相关
- 🧪 **测试**: 测试相关改进

### 注意事项
1. 每次更新前建议备份配置文件
2. 重大版本更新可能需要重新配置
3. 详细更新说明请查看对应版本的发布说明
4. 如遇问题请查看故障排除指南或联系技术支持

---

## 路线图

### 即将推出 (v2.2.0)
- 🌐 **网络功能**: TCP/IP网络通信支持
- 📊 **高级分析**: 数据分析和统计功能
- 🎯 **自动化**: 自动化脚本和宏功能
- 🔌 **插件系统**: 第三方插件支持

### 长期规划 (v3.0.0)
- 📱 **移动端**: 移动设备支持
- ☁️ **云端**: 云端数据同步
- 🤖 **AI功能**: 智能数据处理和分析
- 🏭 **工业版**: 工业级功能和认证

---

## 技术支持
## 📞 联系方式

### 项目信息
- **项目名称**：ColorBridge
- **版本**：v2.1.13
- **作者**：076lik
- **许可证**：GPLv3

### 联系渠道
- **仓库地址**：https://atomgit.com/H076lik/ColorBridge
- **Issues**：https://atomgit.com/H076lik/ColorBridge/issues
- **邮箱**：m17859782086_1@163.com
- **文档**：https://atomgit.com/H076lik/ColorBridge/wiki

*最后更新: 2025-12-16*
[project]
name = "rappel"
version = "0.7.1"
description = "Distributed & durable background events in Python"
readme = "../README.md"
requires-python = ">=3.10"
dependencies = [ "googleapis-common-protos>=1.72.0", "grpcio>=1.66,<2", "protobuf>=5.29,<6", "pydantic>=2,<3",]

[dependency-groups]
dev = [ "grpcio-tools>=1.66,<2", "pytest>=8", "pytest-cov>=6", "ty>=0.0.1a26", "ruff>=0.6", "mypy-protobuf>=3.7.0",]

[build-system]
requires = [ "hatchling",]
build-backend = "hatchling.build"

[project.optional-dependencies]
dev = [ "pytest>=8",]

[project.scripts]
rappel-worker = "rappel.worker:main"

[tool.ruff]
target-version = "py310"
line-length = 100

[tool.ruff.lint]
select = [ "E", "F", "I", "N", "W", "B",]
ignore = [ "E501",]

[tool.ruff.format]
exclude = [ "proto/messages_pb2.py", "proto/messages_pb2_grpc.py", "proto/ast_pb2.py",]

[tool.pytest.ini_options]
testpaths = [ "tests",]
addopts = "--cov=rappel --cov-report=term-missing --cov-report=xml:coverage.xml --cov-report=html:htmlcov"

[tool.coverage.run]
source = [ "src/rappel",]
branch = true
omit = [ "*/tests/*", "*/__pycache__/*",]

[tool.coverage.report]
exclude_lines = [ "pragma: no cover", "def __repr__", "raise NotImplementedError", "if TYPE_CHECKING:", "if __name__ == .__main__.:",]
show_missing = true

[tool.ruff.lint.per-file-ignores]
"proto/messages_pb2.py" = [ "E402", "N802",]
"proto/messages_pb2.pyi" = [ "N802",]
"proto/messages_pb2_grpc.py" = [ "N802",]
"proto/messages_pb2_grpc.pyi" = [ "N802",]
"proto/ast_pb2.py" = [ "E402", "N802",]
"proto/ast_pb2.pyi" = [ "N802",]

[tool.hatch.build.targets.wheel]
packages = [ "src/rappel", "proto",]

[tool.hatch.build.targets.sdist]
include = [ "src", "proto", "README.md",]

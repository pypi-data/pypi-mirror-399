Metadata-Version: 2.4
Name: licence-sdk-python
Version: 1.0.1
Summary: æˆæƒéªŒè¯ SDK - ç”¨äºéªŒè¯åº”ç”¨æˆæƒçŠ¶æ€
Project-URL: Homepage, https://github.com/channing/licence
Project-URL: Repository, https://github.com/channing/licence
Project-URL: Documentation, https://github.com/channing/licence/tree/master/licence-sdk-python
Project-URL: Issues, https://github.com/channing/licence/issues
Author-email: channingxiao <channingxiao@gmail.com>
License: Proprietary
Keywords: authorization,licence,license,rsa,signature
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: Other/Proprietary License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.10
Requires-Dist: cryptography>=41.0.0
Requires-Dist: httpx>=0.25.0
Provides-Extra: dev
Requires-Dist: pyarmor>=8.0.0; extra == 'dev'
Requires-Dist: pytest-asyncio>=0.21.0; extra == 'dev'
Requires-Dist: pytest>=7.0.0; extra == 'dev'
Description-Content-Type: text/markdown

# Licence SDK Python

æˆæƒéªŒè¯ SDKï¼Œç”¨äºéªŒè¯ Python åº”ç”¨æˆæƒçŠ¶æ€ã€‚

## å®‰å…¨è®¾è®¡

æ­¤ SDK ä½¿ç”¨ RSA-SHA256 éå¯¹ç§°åŠ å¯†è¿›è¡Œç­¾åéªŒè¯ï¼š
- **ç§é’¥**ï¼šä»…å­˜åœ¨äºæˆæƒæœåŠ¡ä¸­ï¼Œç”¨äºç­¾å
- **å…¬é’¥**ï¼šç¡¬ç¼–ç åœ¨æ­¤ SDK ä¸­ï¼Œç”¨äºéªŒè¯ç­¾å

å³ä½¿å…¬é’¥è¢«å…¬å¼€ï¼Œä¹Ÿæ— æ³•ä¼ªé€ æœ‰æ•ˆçš„æˆæƒç­¾åã€‚

## å®‰è£…

### ä½¿ç”¨ uv å®‰è£…ï¼ˆæ¨èï¼‰

```bash
uv add licence-sdk-python
```

### ä½¿ç”¨ pip å®‰è£…

```bash
pip install licence-sdk-python
```

### ä»æœ¬åœ°æ„å»ºå®‰è£…

```bash
cd licence-sdk-python

# 1. å®‰è£…ä¾èµ–
uv sync --all-extras

# 2. æ„å»ºæ··æ·†åŒ…
./scripts/build.sh

# 3. å®‰è£…
pip install dist/licence_sdk_python-*.whl
```

## åˆå§‹åŒ–

### 1. é…ç½®å…¬é’¥

å°†æˆæƒæœåŠ¡çš„ RSA å…¬é’¥é…ç½®åˆ° `src/licence_sdk_python/public_key.py`ï¼š

```python
LICENCE_PUBLIC_KEY = "ä½ çš„Base64ç¼–ç çš„RSAå…¬é’¥"
```

### 2. é…ç½®æˆæƒæœåŠ¡

ç¡®ä¿ C++ æˆæƒæœåŠ¡å·²å¯åŠ¨å¹¶é…ç½®äº†å¯¹åº”çš„ç§é’¥ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºç¡€æˆæƒæ£€æŸ¥

```python
import os
import asyncio
from licence_sdk_python import check_licence, is_licenced

async def main():
    # å¼‚æ­¥æ£€æŸ¥æˆæƒ
    result = await check_licence(
        os.environ.get("LICENCE_KEY", ""),
        "http://localhost:18080"
    )
    
    print("æˆæƒæœ‰æ•ˆ" if result.valid else "æˆæƒæ— æ•ˆ")
    
    # åŒæ­¥è·å–çŠ¶æ€ï¼ˆéœ€è¦å…ˆè°ƒç”¨ check_licenceï¼‰
    if is_licenced():
        # æ‰§è¡Œéœ€è¦æˆæƒçš„æ“ä½œ
        pass

asyncio.run(main())
```

### åŒæ­¥ç‰ˆæœ¬

```python
import os
from licence_sdk_python import check_licence_sync, is_licenced

# åŒæ­¥æ£€æŸ¥æˆæƒ
result = check_licence_sync(
    os.environ.get("LICENCE_KEY", ""),
    "http://localhost:18080"
)

if result.valid:
    print("æˆæƒæœ‰æ•ˆ")
```

### è·å–æœºå™¨ç 

```python
from licence_sdk_python import get_fingerprint_sync, check_service_health_sync

# æ£€æŸ¥æˆæƒæœåŠ¡æ˜¯å¦å¯ç”¨
if not check_service_health_sync("http://localhost:18080"):
    print("æˆæƒæœåŠ¡ä¸å¯ç”¨")
else:
    # è·å–æœºå™¨ç 
    result = get_fingerprint_sync("http://localhost:18080")
    if result.success:
        print(f"æœºå™¨ç : {result.fingerprint}")
    else:
        print(f"è·å–å¤±è´¥: {result.error}")
```

### ä¿æŠ¤å‡½æ•°

```python
from licence_sdk_python import licence_required, licence_required_async

# åŒæ­¥å‡½æ•°ä¿æŠ¤
@licence_required
def protected_function():
    # æœªæˆæƒæ—¶æŠ›å‡º PermissionError
    print("æ‰§è¡Œå—ä¿æŠ¤çš„æ“ä½œ")

# å¼‚æ­¥å‡½æ•°ä¿æŠ¤
@licence_required_async
async def protected_async_function():
    # æœªæˆæƒæ—¶æŠ›å‡º PermissionError
    print("æ‰§è¡Œå—ä¿æŠ¤çš„å¼‚æ­¥æ“ä½œ")
```

### æ•°æ®è¿‡æ»¤

```python
from licence_sdk_python import filter_data, is_feature_enabled

# æœªæˆæƒæ—¶é™åˆ¶æ•°æ®é‡
all_devices = [...]  # å‡è®¾æœ‰ 100 æ¡æ•°æ®
devices = filter_data(all_devices, limit=3)
# æœªæˆæƒæ—¶åªè¿”å›å‰ 3 æ¡

# æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¯ç”¨
if not is_feature_enabled("smart-records"):
    print("æ­¤åŠŸèƒ½éœ€è¦æˆæƒ")
```

## API å‚è€ƒ

### æ ¸å¿ƒå‡½æ•°

| å‡½æ•° | è¯´æ˜ |
|-----|------|
| `check_licence(key, url)` | å¼‚æ­¥æ£€æŸ¥æˆæƒçŠ¶æ€ |
| `check_licence_sync(key, url)` | åŒæ­¥æ£€æŸ¥æˆæƒçŠ¶æ€ |
| `is_licenced()` | åŒæ­¥è·å–ç¼“å­˜çš„æˆæƒçŠ¶æ€ |
| `get_licence_state()` | è·å–æˆæƒçŠ¶æ€è¯¦æƒ… |
| `clear_licence_cache()` | æ¸…é™¤æˆæƒç¼“å­˜ |
| `set_licence_state(state)` | è®¾ç½®æˆæƒçŠ¶æ€ |

### æœºå™¨ç /è®¾å¤‡æŒ‡çº¹

| å‡½æ•° | è¯´æ˜ |
|-----|------|
| `get_fingerprint(url)` | å¼‚æ­¥è·å–è®¾å¤‡æŒ‡çº¹ç  |
| `get_fingerprint_sync(url)` | åŒæ­¥è·å–è®¾å¤‡æŒ‡çº¹ç  |
| `check_service_health(url)` | å¼‚æ­¥æ£€æŸ¥æˆæƒæœåŠ¡æ˜¯å¦å¯ç”¨ |
| `check_service_health_sync(url)` | åŒæ­¥æ£€æŸ¥æˆæƒæœåŠ¡æ˜¯å¦å¯ç”¨ |
| `get_service_version(url)` | å¼‚æ­¥è·å–æˆæƒæœåŠ¡ç‰ˆæœ¬ |
| `get_service_version_sync(url)` | åŒæ­¥è·å–æˆæƒæœåŠ¡ç‰ˆæœ¬ |

### æ•°æ®è¿‡æ»¤

| å‡½æ•° | è¯´æ˜ |
|-----|------|
| `filter_data(data, limit)` | æœªæˆæƒæ—¶é™åˆ¶æ•°æ®é‡ |
| `is_feature_enabled(feature)` | æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¯ç”¨ |
| `get_data_limit_info(total)` | è·å–æ•°æ®é™åˆ¶ä¿¡æ¯ |
| `set_free_features(features)` | è®¾ç½®å…è´¹åŠŸèƒ½åˆ—è¡¨ |
| `set_default_data_limit(limit)` | è®¾ç½®é»˜è®¤æ•°æ®é™åˆ¶ |

### API ä¿æŠ¤è£…é¥°å™¨

| è£…é¥°å™¨ | è¯´æ˜ |
|-----|------|
| `licence_required` | åŒæ­¥å‡½æ•°è£…é¥°å™¨ï¼ŒæœªæˆæƒæŠ›å‡º PermissionError |
| `licence_required_async` | å¼‚æ­¥å‡½æ•°è£…é¥°å™¨ï¼ŒæœªæˆæƒæŠ›å‡º PermissionError |

### ç±»å‹å®šä¹‰

| ç±»å‹ | è¯´æ˜ |
|-----|------|
| `LicenceResult` | æˆæƒæ£€æŸ¥ç»“æœ |
| `LicenceState` | æˆæƒçŠ¶æ€ç¼“å­˜ |
| `FingerprintResult` | æœºå™¨ç è·å–ç»“æœ |
| `DataLimitInfo` | æ•°æ®é™åˆ¶ä¿¡æ¯ |

## æˆæƒæœåŠ¡ API æ ¼å¼

æˆæƒæœåŠ¡éœ€è¦è¿”å›ä»¥ä¸‹æ ¼å¼çš„å“åº”ï¼š

```json
{
  "code": 200,
  "message": "Licence is valid",
  "data": {
    "status": "valid",
    "valid": true,
    "timestamp": 1735344000,
    "signature": "base64_rsa_sha256_signature..."
  }
}
```

ç­¾åå†…å®¹æ ¼å¼ï¼š`{licence}|{status}|{timestamp}`

## å¼€å‘ä¸æ„å»º

### 1. å®‰è£…å¼€å‘ä¾èµ–

```bash
cd licence-sdk-python
uv sync --all-extras
```

è¿™ä¼šå®‰è£…ï¼š
- æ ¸å¿ƒä¾èµ–ï¼š`cryptography`, `httpx`
- å¼€å‘å·¥å…·ï¼š`pytest`, `pytest-asyncio`, `pyarmor`

### 2. è¿è¡Œæµ‹è¯•

```bash
uv run pytest
```

### 3. æ„å»ºä¸æ‰“åŒ…

#### æ–¹å¼ä¸€ï¼šæ··æ·†æ„å»ºï¼ˆé»˜è®¤æ¨èï¼‰

ä½¿ç”¨ PyArmor æ··æ·†ä»£ç åæ„å»ºï¼Œä¿æŠ¤æºä»£ç ï¼š

```bash
# ä½¿ç”¨æ„å»ºè„šæœ¬ï¼ˆæ¨èï¼‰
./scripts/build.sh

# æˆ–ä½¿ç”¨ Python è„šæœ¬
uv run python scripts/build_package.py
```

**å…³äº PyArmorï¼š**
- âœ… ä½¿ç”¨åŸºç¡€æ··æ·†æ¨¡å¼ï¼Œå…è´¹ç‰ˆå¯ç”¨
- ğŸ”’ æä¾›åŸºæœ¬çš„ä»£ç ä¿æŠ¤
- ğŸ’¡ ä¿æŠ¤æ ¸å¿ƒæˆæƒéªŒè¯é€»è¾‘

#### æ–¹å¼äºŒï¼šæ ‡å‡†æ„å»ºï¼ˆä¸æ··æ·†ï¼‰

é€‚åˆå¼€å‘æµ‹è¯•ï¼š

```bash
# è·³è¿‡æ··æ·†
./scripts/build.sh --no-obfuscate

# æˆ–ç›´æ¥ä½¿ç”¨ uv
uv build
```

**æ‰“åŒ…æµç¨‹è¯´æ˜ï¼š**

```
[1/5] åˆ›å»ºä¸´æ—¶æ„å»ºç›®å½•
      â†“ åˆ›å»º build_temp/ ç›®å½•

[2/5] å¤åˆ¶é¡¹ç›®æ–‡ä»¶
      â†“ å¤åˆ¶ src/, pyproject.toml, README.md åˆ°ä¸´æ—¶ç›®å½•

[3/5] ä»£ç å¤„ç†
      â†“ æ ‡å‡†æ¨¡å¼ï¼šä¿æŒåŸæ ·
      â†“ æ··æ·†æ¨¡å¼ï¼šä½¿ç”¨ PyArmor æ··æ·†ï¼ˆéœ€è®¸å¯è¯ï¼‰

[4/5] æ„å»º wheel åŒ…
      â†“ ç”Ÿæˆ .whl å’Œ .tar.gz æ–‡ä»¶åˆ° dist/ ç›®å½•

[5/5] æ¸…ç†ä¸´æ—¶æ–‡ä»¶
      â†“ åˆ é™¤ build_temp/ ç›®å½•
      âœ“ å®Œæˆï¼åŸå§‹æºä»£ç ä¿æŒä¸å˜
```

**ç”Ÿæˆçš„æ–‡ä»¶ï¼š**
- `dist/licence_sdk_python-1.0.0-py3-none-any.whl` - Wheel åŒ…ï¼ˆæ··æ·†åï¼‰
- `dist/licence_sdk_python-1.0.0.tar.gz` - æºç åŒ…ï¼ˆæ··æ·†åï¼‰

### 4. æœ¬åœ°æµ‹è¯•å®‰è£…

```bash
# ä½¿ç”¨ pip å®‰è£…
pip install dist/licence_sdk_python-*.whl

# æˆ–ä½¿ç”¨ uv
uv add dist/licence_sdk_python-*.whl

# æµ‹è¯•å¯¼å…¥
python -c "from licence_sdk_python import check_licence; print('å®‰è£…æˆåŠŸ!')"
```

### 5. å‘å¸ƒåˆ° PyPI

#### å‰ç½®å‡†å¤‡ï¼ˆé¦–æ¬¡å‘å¸ƒï¼‰

1. **æ³¨å†Œ PyPI è´¦å·**ï¼šhttps://pypi.org/account/register/

2. **å¯ç”¨åŒå› ç´ è®¤è¯**ï¼šhttps://pypi.org/manage/account/

3. **åˆ›å»º API Token**ï¼š
   - è®¿é—®ï¼šhttps://pypi.org/manage/account/token/
   - Token name: `licence-sdk-python`
   - Scope: `Entire account`
   - å¤åˆ¶ç”Ÿæˆçš„ tokenï¼ˆæ ¼å¼ï¼š`pypi-AgEI...`ï¼‰

4. **é…ç½® Token**ï¼š
   ```bash
   # æ–¹å¼ä¸€ï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰
   export UV_PUBLISH_TOKEN="pypi-ä½ çš„token"
   
   # æ–¹å¼äºŒï¼šé…ç½®æ–‡ä»¶
   cat > ~/.pypirc << 'EOF'
   [pypi]
   username = __token__
   password = pypi-ä½ çš„token
   EOF
   chmod 600 ~/.pypirc
   ```

#### å‘å¸ƒæµç¨‹

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆæ¯æ¬¡å‘å¸ƒå‰ï¼‰
# ç¼–è¾‘ pyproject.toml: version = "1.0.1"

# 2. æ¸…ç†æ—§æ„å»º
rm -rf dist/ build_temp/

# 3. æ„å»ºåŒ…
./scripts/build.sh

# 4. å‘å¸ƒåˆ° PyPI
uv publish

# 5. éªŒè¯å‘å¸ƒ
# è®¿é—®: https://pypi.org/project/licence-sdk-python/
pip install licence-sdk-python
```

#### ç‰ˆæœ¬å·è§„åˆ™

éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰ï¼š
- `1.0.1` - è¡¥ä¸ç‰ˆæœ¬ï¼ˆbug ä¿®å¤ï¼‰
- `1.1.0` - æ¬¡ç‰ˆæœ¬ï¼ˆæ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹ï¼‰
- `2.0.0` - ä¸»ç‰ˆæœ¬ï¼ˆé‡å¤§æ›´æ–°ï¼Œå¯èƒ½ä¸å…¼å®¹ï¼‰

> ğŸ“ è¯¦ç»†å‘å¸ƒæŒ‡å—è¯·å‚è€ƒï¼š[PUBLISH.md](./PUBLISH.md)

## ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ |
|-----|------|
| `LICENCE_KEY` | æˆæƒç  |
| `LICENCE_SERVICE_URL` | æˆæƒæœåŠ¡åœ°å€ |
| `PYTHON_ENV` | è®¾ä¸º `development` å¯ç”¨å¼€å‘æ¨¡å¼ |
| `LICENCE_DEV_MODE` | è®¾ä¸º `true` è·³è¿‡æˆæƒæ£€æŸ¥ |

## æ—¥å¿—

SDK ä½¿ç”¨ Python æ ‡å‡† logging æ¨¡å—ï¼Œlogger åç§°ä¸º `licence_sdk`ï¼š

```python
import logging

# å¯ç”¨è°ƒè¯•æ—¥å¿—
logging.getLogger("licence_sdk").setLevel(logging.DEBUG)
```

## è®¸å¯è¯

UNLICENSED - ç§æœ‰è½¯ä»¶

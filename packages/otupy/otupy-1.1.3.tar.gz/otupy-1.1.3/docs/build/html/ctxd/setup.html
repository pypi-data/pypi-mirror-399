

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>otupy: Running the Context Discovery Actuator Profile in a Real Case Scenario &mdash; otupy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            otupy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download and setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/otupy.apps.connector.html">MIRANDA Connector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/otupy.apps.ctxd.html">Context Discovery</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/otupy.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developerguide.html">Developer guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developingextensions.html">Developing extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging for <code class="docutils literal notranslate"><span class="pre">otupy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">Building the documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ctxd.html">Context Discovery Actuator Profile</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../relateddocuments.html">OpenC2 specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Authors and acknowledgment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Licence</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">otupy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">otupy: Running the Context Discovery Actuator Profile in a Real Case Scenario</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="otupy-running-the-context-discovery-actuator-profile-in-a-real-case-scenario">
<h1>otupy: Running the Context Discovery Actuator Profile in a Real Case Scenario<a class="headerlink" href="#otupy-running-the-context-discovery-actuator-profile-in-a-real-case-scenario" title="Link to this heading"></a></h1>
<section id="description">
<h2>1. Description<a class="headerlink" href="#description" title="Link to this heading"></a></h2>
<p>Two of the most popular open-source CMS were considered: OpenStack and Kubernetes.</p>
<p>OpenStack is an open-source cloud computing platform that enables users to build and manage their own cloud infrastructure. It provides Infrastructure-as-a-Service (IaaS), which offers a framework for creating and controlling virtualized resources such as computing power, storage, and networking on demand.</p>
<p>Kubernetes is an open-source container orchestration system. It can manage containerized applications across multiple hosts for deploying, monitoring, and scaling containers. Containers are portable units that include the code and everything the application needs to run.</p>
<p>The goal of CTXD is to discover the relationships between OpenStack, Kubernetes, cloud-based virtual machines (VMs), and containers. Additionally, the types of connections between these resources are documented.</p>
<p>It is also possible to find the relationships between VMs and the Docker service.</p>
<p>Docker is a tool that lets developers package applications with all their dependencies into lightweight containers, ensuring they run consistently across different environments.</p>
</section>
<section id="pre-requisites">
<h2>2. Pre-requisites<a class="headerlink" href="#pre-requisites" title="Link to this heading"></a></h2>
<p>To run the OpenStack actuator, the following Python library is needed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>openstacksdk
</pre></div>
</div>
<p>To run the Kubernetes actuator, the following Python library is needed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>kubernetes
</pre></div>
</div>
<p>To run the Docker actuator, the following Python library is needed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>docker
</pre></div>
</div>
</section>
<section id="running-the-consumer">
<h2>3. Running the Consumer<a class="headerlink" href="#running-the-consumer" title="Link to this heading"></a></h2>
<section id="configuration-file">
<h3>3.1 Configuration File<a class="headerlink" href="#configuration-file" title="Link to this heading"></a></h3>
<p>In the file <code class="docutils literal notranslate"><span class="pre">otupy/applications/ctxd/configuration.json</span></code> at the position <code class="docutils literal notranslate"><span class="pre">consumer[&quot;ip&quot;],</span> <span class="pre">consumer[&quot;port&quot;],</span> <span class="pre">consumer[&quot;endpoint&quot;]</span></code> are specified all the useful parameters to run the consumer. The default encoder format is JSON while the transfer protocol is HTTP.</p>
</section>
<section id="setting-up-the-consumer">
<h3>3.2 Setting up the Consumer<a class="headerlink" href="#setting-up-the-consumer" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>The consumer, in order to connect to OpenStack, is able to retrieve the environment variables of the running system or it is possible to insert the full path of the configuration file into the file <code class="docutils literal notranslate"><span class="pre">otupy/applications/ctxd/configuration.json</span></code> in the field <code class="docutils literal notranslate"><span class="pre">[&quot;clusters&quot;][][&quot;file_enviroment_variables&quot;]</span></code>.</p></li>
<li><p>Specify the namespaces of interest in the file <code class="docutils literal notranslate"><span class="pre">otupy/applications/ctxd/configuration.json</span></code> and the field is <code class="docutils literal notranslate"><span class="pre">[&quot;clusters&quot;][][&quot;namespace&quot;]</span></code>. If no namespaces are specified, all namespaces will be displayed.</p></li>
<li><p>The consumer, in order to connect to Kubernetes, will use by default the configuration file contained in <code class="docutils literal notranslate"><span class="pre">~/.kube/config</span></code>. It is also possible to specify the configuration file into <code class="docutils literal notranslate"><span class="pre">otupy/applications/ctxd/configuration.json</span></code> in the field <code class="docutils literal notranslate"><span class="pre">[&quot;clusters&quot;][][&quot;config_file&quot;]</span></code>.</p></li>
<li><p>Specify the Kubernetes context into the file <code class="docutils literal notranslate"><span class="pre">otupy/applications/ctxd/configuration.json</span></code> in the field <code class="docutils literal notranslate"><span class="pre">[&quot;clusters&quot;][][&quot;kube_context&quot;]</span></code>. If not specified, the function uses the current context in the kubeconfig file.</p></li>
<li><p>It is possible to add Kubernetes, OpenStack and Docker elements to <code class="docutils literal notranslate"><span class="pre">[&quot;clusters&quot;][]</span></code> but the <code class="docutils literal notranslate"><span class="pre">type</span></code> field must be equal to “kubernetes”, “openstack” or “docker”.</p></li>
<li><p>The consumer parameters (asset_id, hostname, ip, port, protocol, endpoint, transfer, encoding) in the file <code class="docutils literal notranslate"><span class="pre">otupy/applications/ctxd/configuration.json</span></code> in the field <code class="docutils literal notranslate"><span class="pre">[&quot;clusters&quot;][]</span></code> allow to specify how to connect to the consumer that is running Kubernetes, OpenStack or Docker. Transfer and encoding must be in numeric format. To know which integer to use, see <code class="docutils literal notranslate"><span class="pre">/otupy/docs/CTXD</span> <span class="pre">documentation.md</span></code> file, specifically paragraphs 5.19 and 5.20.</p></li>
<li><p>To connect to the MongoDB database, the file <code class="docutils literal notranslate"><span class="pre">otupy/applications/ctxd/configuration.json</span></code> in the field <code class="docutils literal notranslate"><span class="pre">[&quot;mongodb&quot;][]</span></code> allows specifying the parameters useful for the connection. It is possible to connect to the MongoDB database without username and password.</p></li>
<li><p>Run the consumer:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>otupy/applications/ctxd/ctxd_consumers.py
</pre></div>
</div>
</section>
</section>
<section id="running-the-producer">
<h2>4. Running the Producer<a class="headerlink" href="#running-the-producer" title="Link to this heading"></a></h2>
<section id="setting-up-the-producer">
<h3>4.1 Setting up the Producer<a class="headerlink" href="#setting-up-the-producer" title="Link to this heading"></a></h3>
<p>Run the producer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>otupy/applications/ctxd/ctxd_producer.py
</pre></div>
</div>
<p>No configuration files are associated with the producer.</p>
</section>
<section id="collecting-the-output">
<h3>4.2 Collecting the Output<a class="headerlink" href="#collecting-the-output" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>If it is not possible to visualize the PDF because the code is executed on a remote machine, export the <code class="docutils literal notranslate"><span class="pre">.gv</span></code> to a local machine.</p></li>
<li><p>Convert the <code class="docutils literal notranslate"><span class="pre">.gv</span></code> file with the following Python script:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">graphviz</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gv_to_pdf</span><span class="p">(</span><span class="n">input_gv</span><span class="p">,</span> <span class="n">output_pdf</span><span class="p">):</span>
    <span class="c1"># Read the .gv file and create a Graphviz object</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_gv</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">dot_data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c1"># Create a Graph object</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">dot_data</span><span class="p">)</span>

    <span class="c1"># Render the graph to PDF</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">output_pdf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Convert example.gv to PDF</span>
<span class="n">input_gv</span> <span class="o">=</span> <span class="s2">&quot;&lt;your_gf_local_path&gt;&quot;</span>  <span class="c1"># Replace with your .gv file path</span>
<span class="n">output_pdf</span> <span class="o">=</span> <span class="s2">&quot;&lt;your_pdf_local_path&gt;&quot;</span>  <span class="c1"># Output file without the .pdf extension</span>
<span class="n">gv_to_pdf</span><span class="p">(</span><span class="n">input_gv</span><span class="p">,</span> <span class="n">output_pdf</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>The PDF is ready.</p></li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Matteo Repetto.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
var __index = {"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"User Manual","text":"<p>Info</p> <p>If you opened this documentation from the Sonarcal program you will be reading the offline version. The online version is available here.</p>"},{"location":"index.html#introduction","title":"Introduction","text":"<p>This is the user documentation for Sonarcal, a program to assist with calibrating fisheries sonars using the target sphere method. Sonarcal currently supports these sonars and file formats:</p> Brand Model Supported file format Furuno FSV25 sonar-netCDF4 Simrad SU90 sonar-netCDF4 Simrad SX90 sonar-netCDF4 Simrad CS90 raw &amp; sonar-netCDF4** Simrad SN90 raw &amp; sonar-netCDF4** <p>(** = requires testing)</p> <p>Other sonars that output sonar-netCDF4 files may also work, but there can often be small adjustments needed for full support. Contact the developer via Sonarcal's GitHub page for further information.</p> <p>The current form of this program was funded by AZTI. Earlier versions were developed while the author was employed at the Norwegian Institute of Marine Research.</p>"},{"location":"index.html#installation","title":"Installation","text":"<p>Sonarcal requires Python version 3.11 or higher. If you are unfamiliar with installing and running Python programs we recommend using <code>uv</code> (see below).</p> <p>Sonarcal is installed from the command line via:</p> <pre><code>pip install sonarcal\n</code></pre> <p>and upgraded via:</p> <pre><code>pip install sonarcal --upgrade\n</code></pre> <p>The latest version of Sonarcal will always be listed github. Sonarcal has been developed on Windows and is tested on Linux and MacOS. It may work on other operating systems.</p>"},{"location":"index.html#using-uv","title":"Using <code>uv</code>","text":"<p>uv can be used to install Python and Sonarcal and then to run Sonarcal. uv creates a Python installation just for Sonarcal (it is independent of all other Python installations on your computer).</p> <p>Install uv using these instructions, then install Sonarcal with this command:</p> <pre><code>uv tool install sonarcal\n</code></pre> <p>and run Sonarcal with this command:</p> <pre><code>uv tool run sonarcal\n</code></pre> <p>uv's installation of Sonarcal can be upgraded with this command:</p> <pre><code>uv tool upgrade sonarcal\n</code></pre>"},{"location":"index.html#how-to-use","title":"How to use","text":"<p>Sonarcal is started from a command line with:</p> <pre><code>sonarcal\n</code></pre> <p>(or if using uv, the command is <code>uv tool run sonarcal</code>). It make take a few seconds to start, after which the Sonarcal window will appear.</p> <p>If there are suitable sonar files in the configured data directory<sup>1</sup>, the program will start to replay them. Replay happens in two ways:</p> Live data enabled <p>The last file in the directory will be replayed<sup>2</sup> and then any new data added to that file will also be replayed. If a newer file appears, that will be replayed too.</p> Live data disabled <p>All files in the directory will be replayed in chronological order.</p> <p></p> <p>The main operation screen.</p> <p>Each new ping is displayed in the polar plot to the left. The three centre plots show an echogram of the data from the three sonar beams at and adjacent to the beam line (the black radial line in the polar plot).</p> <p>The target strength of the maximum amplitude echo on the three beams between the range rings is shown in the plots to the right. The upper plot uses black lines for the selected beam, red for the beam to port, and green for starboard. The lower plot shows the difference in amplitude between the echo in the centre beam and the two adjacent beams.</p> <p>The plots also include smoothed lines to aid in seeing trends in the sphere amplitude - these use a thicker line style than the raw echo amplitudes.</p> <p>The beam being calibrated is selected by using the mouse to click on and drag the black radial line on the polar plot. The range over which the sphere is detected can be changed by clicking on and dragging the two range rings in the polar plot.</p> <p>The echogram colour thresholds can be adjusted by clicking and dragging on the slider to the left of the polar plot.</p>"},{"location":"index.html#calibrating","title":"Calibrating","text":"<p>When using Sonarcal to calibrate, follow these steps:</p> <ul> <li>Start Sonarcal</li> <li>In the Config dialog:</li> <li>Set the calibration sphere TS</li> <li>Set the sonar data directory to where the sonar will be recording data files</li> <li>Turn on the use of live data</li> <li>Close and restart Sonarcal for these changes to take effect</li> <li>Repeat for multiple beams:</li> <li>Move the beam line and range rings to select the beam and ranges</li> <li>Locate the sphere on-axis of a beam using the sphere amplitude plots to assist</li> <li>Tick the <code>on-axis</code> box when the sphere is on-axis</li> <li>Monitor the results in the Results dialog box</li> <li>Untick the <code>on-axis</code> box when sufficient data have been collected for the beam</li> </ul> <p>Every time that the <code>on-axis</code> box is unticked all calibration results are saved to a backup file. The results can also be exported at any time using the <code>Save</code> button on the results dialog box - you will be prompted for a directory and filename for saving.</p> <p>The beam being calibrated is highlighted in orange in the results dialog box and the beam line on the polar plot can not be moved while calibrating.</p>"},{"location":"index.html#using-the-calibration-results","title":"Using the calibration results","text":"<p>Sonarcal calculates a <code>calibration offset</code> for each calibrated beam. This is the value in dB that should be added to the TS or S<sub>v</sub> output from the sonar to get a calibrated result.</p> <p>Both Simrad raw files and sonar-netCDF4 files contain a transducer gain value that is used to convert raw data into TS and S<sub>v</sub>. It is not always correct to just add the calibration offset to this gain value - it depends on how the relevant raw to TS and S<sub>v</sub> equations use the gain. For example, raw files use double the gain value, while the process for sonar-netCDF4 files depends on the type of conversion equation used (see Chapter 4 in the sonar-netCDF4 document for details).</p>"},{"location":"index.html#sphere-target-strength","title":"Sphere target strength","text":"<p>Sonarcal requires you to enter calibration sphere target strength (TS) into the Configuration dialog box. Make sure to do this before you start using Sonarcal to collect data.</p> <p>The TS is derived from the sphere size and material and the temperature and salinity of the water surrounding the sphere. There are a few options to calculate TS from these:</p> <ul> <li>NOAA sphere calculator - an online app</li> <li>SphereTS - a Python app that runs locally</li> <li>TS_package - Matlab code</li> <li>echoSMs - contains an elastic sphere scattering model applicable to calibration spheres</li> </ul> <ol> <li> <p>Sonarcal can be configured (via the Config dialog) to always ask for the data directory when starting.\u00a0\u21a9</p> </li> <li> <p>Just the last ping is replayed for sonar-netCDF4 files.\u00a0\u21a9</p> </li> </ol>"},{"location":"technical.html","title":"Technical Manual","text":"<p>This is the technical documentation for the Sonarcal program. It provides a brief overview of how the Sonarcal code is organised and some pointers for maintenance and further development.</p> <p>The best reference for how Sonarcal works is the code and configuration in its' Github repository.</p>"},{"location":"technical.html#overview","title":"Overview","text":"<p>Sonarcal is a Python program. It runs as two threads - one for the tkinter-based graphical user interface (GUI) and one that reads sonar data files. Data is passed between the threads using a queue.</p> <p>The data reading thread reads the relevant sonar data files, calculates Sv and TS for all beams and sends that data to the GUI thread ping-by-ping. The main GUI display is an interative matplotlib figure in a tkinter canvas widget.</p> <p>The main() function for Sonarcal is in the <code>controller.py</code> file. The <code>calibration_gui.py</code> file sets up the GUI and the <code>echogram_plotter.py</code> contains the code that generates and updates the matplotlib figure.</p> <p>Sonarcal configurations are stored and saved by a class in the <code>configuration.py</code> file and the GUI for the configuration is managed by code in the <code>dialog_config.py</code> file. In a similar manner, calibration results are stored by a class in <code>calibration_data.py</code> and the GUI is in <code>calibration_gui.py</code>.</p>"},{"location":"technical.html#packaging","title":"Packaging","text":"<p>Generation of the Sonarcal Python package and uploading to the Python Package Index (PyPI) is done via a Github action that runs whenever a tagged commit is made to the Sonarcal repository.</p> <p>Offline documentation is included in the Sonarcal package as internet access is not always available during calibrations. Online documentation is also provided and hosted on Github, being regenerated after each git push to Github. The offline documentation is only updated when a new version is uploaded to PyPI.</p>"},{"location":"technical.html#adding-support-for-other-sonars","title":"Adding support for other sonars","text":"<p>Sonarcal supports Simrad raw data files from selected sonars and sonar-netCDF4 data files from any sonar that produces them. However, the sonar-netCDF4 format allows for different ways to convert from raw backscatter to Sv and TS and currently supports \"type 1\" and \"type 2\" equations. Support for other types will require modifications to the Sonarcal code, mainly the <code>SvTSFromSonarNetCDF4()</code> function in the <code>utils.py</code> file.</p>"},{"location":"technical.html#beam-angles-and-coordinate-systems","title":"Beam angles and coordinate systems","text":"<p>This can be tricky. The Sonarcal code requires that the beam angles go from -180 to 180 with 0 in the forward direction (drawn upwards on the omni echogram). Positive angles are to port, that is, the angles increase in the anticlockwise direction.</p> <p>Sonar-netCDF4 files have their beam angles given as vectors in the sonar-netCDF4 coordinate system (x-axis is forward, y-axis to starboard, and z-axis down). The Sonarcal code transforms these to -180 to +180. The sonar-netCDF4 also contains beam labels that are separate from any other beam property.</p> <p>The various raw files are not so consistent and sonar-specific conversions are included in the code that reads those files. Some raw files do not have explicit beam labels and instead the order (index) of the beams in the raw file is used as the beam name (so 0, 1, 2, etc).</p> <p>When adding support for a new sonar it is very important to check that the beam angles and labels that Sonarcal uses do correspond to the beam labels that would be used when applying a beam calibration/gain.</p>"}]}
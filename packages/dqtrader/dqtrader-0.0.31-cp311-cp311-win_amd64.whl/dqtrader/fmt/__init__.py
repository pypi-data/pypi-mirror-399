from typing import List

import dqtrader_rs
import pandas as pd

from dqtrader.utils import time_utils


def bs_pit(target_list: List[str], start_quarter: str = '', end_quarter: str = '', publish_date: str = ''):
    datas = dqtrader_rs.bs_pit(target_list, start_quarter, end_quarter, publish_date)
    data_array = []
    for data in datas:
        data_array.append([
            f"{data.market}.{data.code}",
            data.quarter,
            time_utils.ymd_to_date(data.info_date),
            data.financial_asset_held_for_trading,
            data.cash_equivalent,
            data.client_deposits,
            data.bill_receivable,
            data.dividend_receivable,
            data.bill_accts_receivable,
            data.interest_receivable,
            data.bad_debt_reserve,
            data.net_accts_receivable,
            data.contract_assets,
            data.prepayment,
            data.financial_receivable,
            data.financial_lease_receivable,
            data.other_equity_investment,
            data.other_illiquidy_financial_assets,
            data.non_current_asset_due_one_year,
            data.other_receivables_interest_dividend,
            data.inventory,
            data.consumable_biological_assets,
            data.assets_hold_for_sale,
            data.contract_work,
            data.other_current_assets,
            data.current_assets,
            data.financial_asset_available_for_sale,
            data.non_current_liability_due_one_year,
            data.debt_investment,
            data.other_debt_investment,
            data.financial_asset_hold_to_maturity,
            data.real_estate_investment,
            data.long_term_receivables,
            data.net_long_term_equity_investment,
            data.accumulated_depreciation,
            data.depreciation_reserve,
            data.net_fixed_assets,
            data.total_fixed_assets,
            data.engineer_material,
            data.construction_in_progress,
            data.total_construction_in_progress,
            data.fixed_asset_to_be_disposed,
            data.capitalized_biological_assets,
            data.oil_and_gas_assets,
            data.intangible_assets,
            data.seat_costs,
            data.impairment_intangible_assets,
            data.use_right_assets,
            data.goodwill,
            data.long_term_deferred_expenses,
            data.deferred_income_tax_assets,
            data.other_non_current_assets,
            data.non_current_assets,
            data.loan_account_receivables,
            data.fund_providing,
            data.reinsurance_reserve_receivable,
            data.settlement_provision,
            data.client_provision,
            data.interbank_deposits,
            data.precious_metals,
            data.lend_capital,
            data.derivative_financial_assets,
            data.resale_financial_assets,
            data.loans_advances_to_customers,
            data.insurance_receivable,
            data.subrogation_fee_receivable,
            data.reinsurance_receivable,
            data.unearned_reserve_receivable,
            data.unclaimed_reserve_receivable,
            data.life_reserve_receivable,
            data.health_reserve_receivable,
            data.insurer_mortgage_loan,
            data.fixed_deposits,
            data.refundable_deposits,
            data.refundable_capital_deposits,
            data.independent_account_assets,
            data.other_assets,
            data.other_accts_receivable,
            data.total_assets,
            data.mortgaged_loan,
            data.short_term_loans,
            data.financial_liabilities,
            data.notes_payable,
            data.accts_payable,
            data.bill_accts_payable,
            data.contract_liabilities,
            data.advance_from_customers,
            data.payroll_payable,
            data.dividend_payable,
            data.tax_payable,
            data.interest_payable,
            data.other_fees_payable,
            data.other_payable,
            data.other_payable_interest_dividend,
            data.short_term_debt,
            data.accrued_expense,
            data.liabilities_hold_for_sale,
            data.estimated_liabilities,
            data.deferred_income,
            data.long_term_liabilities_due_one_year,
            data.other_current_liabilities,
            data.current_liabilities,
            data.long_term_loans,
            data.bond_payable,
            data.preference_shares,
            data.perpetual_bond,
            data.long_term_payable,
            data.accrued_staff_costs,
            data.grants_received,
            data.housing_revolving_funds,
            data.deferred_income_tax_liabilities,
            data.lease_liabilities,
            data.financial_lease_payable,
            data.other_non_current_liabilities,
            data.non_current_liabilities,
            data.borrowings_from_central_banks,
            data.deposits_of_interbank,
            data.borrowings_capital,
            data.derivative_financial_liabilities,
            data.buy_back_security_proceeds,
            data.deposits,
            data.proxy_security_proceeds,
            data.sub_issue_security_proceeds,
            data.security_deposits_received,
            data.advance_insurance,
            data.comission_payable,
            data.reinsurance_payable,
            data.compensation_payable,
            data.policy_dividend_payable,
            data.deposits_from_interbank,
            data.insurance_contract_reserve,
            data.insurer_deposit_investment,
            data.uncertained_premium_reserve,
            data.unclaimed_indemnity_reserve,
            data.life_insurance_reserve,
            data.health_insurance_reserve,
            data.independent_account_liabilities,
            data.other_liabilities,
            data.deferred_revenue,
            data.total_liabilities,
            data.paid_in_capital,
            data.other_equity_instruments,
            data.equity_preferred_stock,
            data.perpetual_equity_debt,
            data.capital_reserve,
            data.surplus_reserve,
            data.undistributed_profit,
            data.treasury_stock,
            data.equity_parent_company,
            data.total_equity,
            data.general_reserve,
            data.trade_risk_allowances,
            data.foreign_currency_converted_difference,
            data.uncertained_impairment_losses,
            data.other_reserves,
            data.specific_reserve,
            data.minority_interest,
            data.total_equity_and_liabilities
        ])

    df = pd.DataFrame(data_array, columns=[
        "code",
        "quarter",
        "publish_date",
        "financial_asset_held_for_trading",
        "cash_equivalent",
        "client_deposits",
        "bill_receivable",
        "dividend_receivable",
        "bill_accts_receivable",
        "interest_receivable",
        "bad_debt_reserve",
        "net_accts_receivable",
        "contract_assets",
        "prepayment",
        "financial_receivable",
        "financial_lease_receivable",
        "other_equity_investment",
        "other_illiquidy_financial_assets",
        "non_current_asset_due_one_year",
        "other_receivables_interest_dividend",
        "inventory",
        "consumable_biological_assets",
        "assets_hold_for_sale",
        "contract_work",
        "other_current_assets",
        "current_assets",
        "financial_asset_available_for_sale",
        "non_current_liability_due_one_year",
        "debt_investment",
        "other_debt_investment",
        "financial_asset_hold_to_maturity",
        "real_estate_investment",
        "long_term_receivables",
        "net_long_term_equity_investment",
        "accumulated_depreciation",
        "depreciation_reserve",
        "net_fixed_assets",
        "total_fixed_assets",
        "engineer_material",
        "construction_in_progress",
        "total_construction_in_progress",
        "fixed_asset_to_be_disposed",
        "capitalized_biological_assets",
        "oil_and_gas_assets",
        "intangible_assets",
        "seat_costs",
        "impairment_intangible_assets",
        "use_right_assets",
        "goodwill",
        "long_term_deferred_expenses",
        "deferred_income_tax_assets",
        "other_non_current_assets",
        "non_current_assets",
        "loan_account_receivables",
        "fund_providing",
        "reinsurance_reserve_receivable",
        "settlement_provision",
        "client_provision",
        "interbank_deposits",
        "precious_metals",
        "lend_capital",
        "derivative_financial_assets",
        "resale_financial_assets",
        "loans_advances_to_customers",
        "insurance_receivable",
        "subrogation_fee_receivable",
        "reinsurance_receivable",
        "unearned_reserve_receivable",
        "unclaimed_reserve_receivable",
        "life_reserve_receivable",
        "health_reserve_receivable",
        "insurer_mortgage_loan",
        "fixed_deposits",
        "refundable_deposits",
        "refundable_capital_deposits",
        "independent_account_assets",
        "other_assets",
        "other_accts_receivable",
        "total_assets",
        "mortgaged_loan",
        "short_term_loans",
        "financial_liabilities",
        "notes_payable",
        "accts_payable",
        "bill_accts_payable",
        "contract_liabilities",
        "advance_from_customers",
        "payroll_payable",
        "dividend_payable",
        "tax_payable",
        "interest_payable",
        "other_fees_payable",
        "other_payable",
        "other_payable_interest_dividend",
        "short_term_debt",
        "accrued_expense",
        "liabilities_hold_for_sale",
        "estimated_liabilities",
        "deferred_income",
        "long_term_liabilities_due_one_year",
        "other_current_liabilities",
        "current_liabilities",
        "long_term_loans",
        "bond_payable",
        "preference_shares",
        "perpetual_bond",
        "long_term_payable",
        "accrued_staff_costs",
        "grants_received",
        "housing_revolving_funds",
        "deferred_income_tax_liabilities",
        "lease_liabilities",
        "financial_lease_payable",
        "other_non_current_liabilities",
        "non_current_liabilities",
        "borrowings_from_central_banks",
        "deposits_of_interbank",
        "borrowings_capital",
        "derivative_financial_liabilities",
        "buy_back_security_proceeds",
        "deposits",
        "proxy_security_proceeds",
        "sub_issue_security_proceeds",
        "security_deposits_received",
        "advance_insurance",
        "comission_payable",
        "reinsurance_payable",
        "compensation_payable",
        "policy_dividend_payable",
        "deposits_from_interbank",
        "insurance_contract_reserve",
        "insurer_deposit_investment",
        "uncertained_premium_reserve",
        "unclaimed_indemnity_reserve",
        "life_insurance_reserve",
        "health_insurance_reserve",
        "independent_account_liabilities",
        "other_liabilities",
        "deferred_revenue",
        "total_liabilities",
        "paid_in_capital",
        "other_equity_instruments",
        "equity_preferred_stock",
        "perpetual_equity_debt",
        "capital_reserve",
        "surplus_reserve",
        "undistributed_profit",
        "treasury_stock",
        "equity_parent_company",
        "total_equity",
        "general_reserve",
        "trade_risk_allowances",
        "foreign_currency_converted_difference",
        "uncertained_impairment_losses",
        "other_reserves",
        "specific_reserve",
        "minority_interest",
        "total_equity_and_liabilities"
    ])

    return df


def cf_pit(target_list: List[str], start_quarter: str = '', end_quarter: str = '', publish_date: str = ''):
    datas = dqtrader_rs.cf_pit(target_list, start_quarter, end_quarter, publish_date)
    data_array = []
    for data in datas:
        data_array.append([
            f"{data.market}.{data.code}",
            data.quarter,
            time_utils.ymd_to_date(data.info_date),
            data.cash_received_from_sales_of_goods,
            data.refunds_of_taxes,
            data.net_deposit_increase,
            data.net_increase_from_central_bank,
            data.net_increase_from_other_financial_institutions,
            data.draw_back_canceled_loans,
            data.cash_received_from_interests_and_commissions,
            data.net_increase_from_disposing_financial_assets,
            data.net_increase_from_repurchasing_business,
            data.cash_received_from_original_insurance,
            data.cash_received_from_reinsurance,
            data.net_increase_from_insurer_deposit_investment,
            data.net_increase_from_financial_institutions,
            data.cash_received_from_proxy_security,
            data.cash_received_from_sub_issue_security,
            data.cash_from_other_operating_activities,
            data.cash_from_operating_activities,
            data.cash_paid_for_goods_and_services,
            data.assets_depreciation_reserves,
            data.exchange_rate_change_effect,
            data.other_effecting_cash_equivalent_items,
            data.cash_equivalent_increase,
            data.begin_period_cash_equivalent,
            data.end_period_cash_equivalent,
            data.cash_paid_for_employee,
            data.cash_paid_for_taxes,
            data.net_increase_from_loans_and_advances,
            data.net_increase_from_central_bank_and_banks,
            data.net_increase_from_lending_capital,
            data.cash_paid_for_comissions,
            data.cash_paid_for_orignal_insurance,
            data.cash_paid_for_reinsurance,
            data.cash_paid_for_policy_dividends,
            data.net_increase_from_trading_financial_assets,
            data.net_increase_from_operating_buy_back,
            data.cash_paid_for_other_operation_activities,
            data.cash_paid_for_operation_activities,
            data.cash_flow_from_operating_activities,
            data.cash_received_from_disposal_of_investment,
            data.cash_received_from_investment,
            data.cash_received_from_disposal_of_asset,
            data.cash_received_from_other_investment_activities,
            data.cash_received_from_investment_activities,
            data.cash_paid_for_asset,
            data.cash_paid_to_acquire_investment,
            data.cash_paid_for_other_investment_activities,
            data.cash_paid_for_investment_activities,
            data.cash_flow_from_investing_activities,
            data.cash_received_from_investors,
            data.cash_received_from_minority_invest_subsidiaries,
            data.cash_received_from_issuing_security,
            data.cash_received_from_financial_institution_borrows,
            data.cash_received_from_issuing_equity_instruments,
            data.cash_received_from_other_financing_activities,
            data.cash_received_from_financing_activities,
            data.cash_paid_for_debt,
            data.cash_paid_for_dividend_and_interest,
            data.dividends_paid_to_minority_by_subsidiaries,
            data.cash_paid_for_other_financing_activities,
            data.cash_paid_to_financing_activities,
            data.cash_flow_from_financing_activities,
            data.net_cash_deal_from_sub,
            data.net_cash_payment_from_sub,
            data.net_increase_in_pledge_loans,
            data.net_increase_from_investing_buy_back,
            data.net_inc_cash_and_equivalents,
            data.fixed_asset_depreciation,
            data.deferred_expense_amortization,
            data.intangible_asset_amortization
        ])

    df = pd.DataFrame(data_array, columns=[
        "code",
        "quarter",
        "publish_date",
        "cash_received_from_sales_of_goods",
        "refunds_of_taxes",
        "net_deposit_increase",
        "net_increase_from_central_bank",
        "net_increase_from_other_financial_institutions",
        "draw_back_canceled_loans",
        "cash_received_from_interests_and_commissions",
        "net_increase_from_disposing_financial_assets",
        "net_increase_from_repurchasing_business",
        "cash_received_from_original_insurance",
        "cash_received_from_reinsurance",
        "net_increase_from_insurer_deposit_investment",
        "net_increase_from_financial_institutions",
        "cash_received_from_proxy_security",
        "cash_received_from_sub_issue_security",
        "cash_from_other_operating_activities",
        "cash_from_operating_activities",
        "cash_paid_for_goods_and_services",
        "assets_depreciation_reserves",
        "exchange_rate_change_effect",
        "other_effecting_cash_equivalent_items",
        "cash_equivalent_increase",
        "begin_period_cash_equivalent",
        "end_period_cash_equivalent",
        "cash_paid_for_employee",
        "cash_paid_for_taxes",
        "net_increase_from_loans_and_advances",
        "net_increase_from_central_bank_and_banks",
        "net_increase_from_lending_capital",
        "cash_paid_for_comissions",
        "cash_paid_for_orignal_insurance",
        "cash_paid_for_reinsurance",
        "cash_paid_for_policy_dividends",
        "net_increase_from_trading_financial_assets",
        "net_increase_from_operating_buy_back",
        "cash_paid_for_other_operation_activities",
        "cash_paid_for_operation_activities",
        "cash_flow_from_operating_activities",
        "cash_received_from_disposal_of_investment",
        "cash_received_from_investment",
        "cash_received_from_disposal_of_asset",
        "cash_received_from_other_investment_activities",
        "cash_received_from_investment_activities",
        "cash_paid_for_asset",
        "cash_paid_to_acquire_investment",
        "cash_paid_for_other_investment_activities",
        "cash_paid_for_investment_activities",
        "cash_flow_from_investing_activities",
        "cash_received_from_investors",
        "cash_received_from_minority_invest_subsidiaries",
        "cash_received_from_issuing_security",
        "cash_received_from_financial_institution_borrows",
        "cash_received_from_issuing_equity_instruments",
        "cash_received_from_other_financing_activities",
        "cash_received_from_financing_activities",
        "cash_paid_for_debt",
        "cash_paid_for_dividend_and_interest",
        "dividends_paid_to_minority_by_subsidiaries",
        "cash_paid_for_other_financing_activities",
        "cash_paid_to_financing_activities",
        "cash_flow_from_financing_activities",
        "net_cash_deal_from_sub",
        "net_cash_payment_from_sub",
        "net_increase_in_pledge_loans",
        "net_increase_from_investing_buy_back",
        "net_inc_cash_and_equivalents",
        "fixed_asset_depreciation",
        "deferred_expense_amortization",
        "intangible_asset_amortization"
    ])

    return df


def ins_pit(target_list: List[str], start_quarter: str = '', end_quarter: str = '', publish_date: str = ''):
    datas = dqtrader_rs.ins_pit(target_list, start_quarter, end_quarter, publish_date)
    data_array = []
    for data in datas:
        data_array.append([
            f"{data.market}.{data.code}",
            data.quarter,
            time_utils.ymd_to_date(data.info_date),
            data.revenue,
            data.operating_revenue,
            data.net_interest_income,
            data.net_commission_income,
            data.commission_income,
            data.commission_expense,
            data.net_proxy_security_income,
            data.sub_issue_security_income,
            data.net_trust_income,
            data.earned_premiums,
            data.premiums_income,
            data.reinsurance_income,
            data.reinsurance,
            data.unearned_premium_reserve,
            data.total_expense,
            data.operating_expense,
            data.refunded_premiums,
            data.compensation_expense,
            data.amortization_expense,
            data.premium_reserve,
            data.amortization_premium_reserve,
            data.policy_dividend_payout,
            data.reinsurance_cost,
            data.other_operating_revenue,
            data.other_operating_cost,
            data.rnd,
            data.other_net_income,
            data.net_open_hedge_income,
            data.other_revenue,
            data.credit_asset_impairment,
            data.amortization_reinsurance_cost,
            data.insurance_commission_expense,
            data.disposal_income_on_asset,
            data.cost_of_goods_sold,
            data.sales_tax,
            data.gross_profit,
            data.selling_expense,
            data.ga_expense,
            data.financing_expense,
            data.financing_interest_income,
            data.financing_interest_expense,
            data.exchange_gains_or_losses,
            data.profit_from_operation,
            data.invest_income_associates,
            data.fair_value_change_income,
            data.investment_income,
            data.asset_impairment,
            data.interest_income,
            data.interest_expense,
            data.non_operating_revenue,
            data.non_operating_expense,
            data.disposal_loss_on_asset,
            data.other_effecting_total_profits_items,
            data.profit_before_tax,
            data.income_tax,
            data.unrealised_investment_loss,
            data.other_effecting_net_profits_items,
            data.non_recurring_pnl,
            data.net_profit_deduct_non_recurring_pnl,
            data.classified_by_continuity_operation,
            data.continuous_operation_net_profit,
            data.discontinued_operation_net_profit,
            data.classified_by_ownership,
            data.net_profit_parent_company,
            data.minority_profit,
            data.other_income,
            data.other_income_unclassified_income_statement,
            data.remearsured_other_income,
            data.other_income_equity_unclassified_income_statement,
            data.other_equity_instruments_change,
            data.corporate_credit_risk_change,
            data.other_income_classified_income_statement,
            data.other_income_equity_classified_income_statement,
            data.financial_asset_available_for_sale_change,
            data.financial_asset_hold_to_maturity_change,
            data.cash_flow_hedging_effective_portion,
            data.foreign_currency_statement_converted_difference,
            data.others,
            data.other_debt_investment_change,
            data.assets_reclassified_other_income,
            data.other_debt_investment_reserve,
            data.other_income_minority,
            data.total_income,
            data.total_income_parent_company,
            data.total_income_minority,
            data.basic_earnings_per_share,
            data.fully_diluted_earnings_per_share
        ])

    df = pd.DataFrame(data_array, columns=[
        "code",
        "quarter",
        "publish_date",
        "revenue",
        "operating_revenue",
        "net_interest_income",
        "net_commission_income",
        "commission_income",
        "commission_expense",
        "net_proxy_security_income",
        "sub_issue_security_income",
        "net_trust_income",
        "earned_premiums",
        "premiums_income",
        "reinsurance_income",
        "reinsurance",
        "unearned_premium_reserve",
        "total_expense",
        "operating_expense",
        "refunded_premiums",
        "compensation_expense",
        "amortization_expense",
        "premium_reserve",
        "amortization_premium_reserve",
        "policy_dividend_payout",
        "reinsurance_cost",
        "other_operating_revenue",
        "other_operating_cost",
        "rnd",
        "other_net_income",
        "net_open_hedge_income",
        "other_revenue",
        "credit_asset_impairment",
        "amortization_reinsurance_cost",
        "insurance_commission_expense",
        "disposal_income_on_asset",
        "cost_of_goods_sold",
        "sales_tax",
        "gross_profit",
        "selling_expense",
        "ga_expense",
        "financing_expense",
        "financing_interest_income",
        "financing_interest_expense",
        "exchange_gains_or_losses",
        "profit_from_operation",
        "invest_income_associates",
        "fair_value_change_income",
        "investment_income",
        "asset_impairment",
        "interest_income",
        "interest_expense",
        "non_operating_revenue",
        "non_operating_expense",
        "disposal_loss_on_asset",
        "other_effecting_total_profits_items",
        "profit_before_tax",
        "income_tax",
        "unrealised_investment_loss",
        "other_effecting_net_profits_items",
        "non_recurring_pnl",
        "net_profit_deduct_non_recurring_pnl",
        "classified_by_continuity_operation",
        "continuous_operation_net_profit",
        "discontinued_operation_net_profit",
        "classified_by_ownership",
        "net_profit_parent_company",
        "minority_profit",
        "other_income",
        "other_income_unclassified_income_statement",
        "remearsured_other_income",
        "other_income_equity_unclassified_income_statement",
        "other_equity_instruments_change",
        "corporate_credit_risk_change",
        "other_income_classified_income_statement",
        "other_income_equity_classified_income_statement",
        "financial_asset_available_for_sale_change",
        "financial_asset_hold_to_maturity_change",
        "cash_flow_hedging_effective_portion",
        "foreign_currency_statement_converted_difference",
        "others",
        "other_debt_investment_change",
        "assets_reclassified_other_income",
        "other_debt_investment_reserve",
        "other_income_minority",
        "total_income",
        "total_income_parent_company",
        "total_income_minority",
        "basic_earnings_per_share",
        "fully_diluted_earnings_per_share"
    ])

    return df

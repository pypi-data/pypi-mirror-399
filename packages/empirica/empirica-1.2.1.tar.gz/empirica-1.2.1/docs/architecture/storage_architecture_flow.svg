<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 900" font-family="monospace, sans-serif">
  <!-- Title -->
  <text x="400" y="30" font-size="20" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Empirica Storage Architecture - Complete Data Flow
  </text>
  
  <!-- Epistemic Event -->
  <rect x="150" y="60" width="500" height="70" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5"/>
  <text x="400" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    EPISTEMIC EVENT
  </text>
  <text x="400" y="105" font-size="12" text-anchor="middle" fill="white">
    AI completes PREFLIGHT, CHECK, or POSTFLIGHT
  </text>
  <text x="400" y="120" font-size="11" text-anchor="middle" fill="white">
    (13 epistemic vectors assessed)
  </text>
  
  <!-- Arrow down -->
  <line x1="400" y1="130" x2="400" y2="170" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- GitEnhancedReflexLogger -->
  <rect x="150" y="170" width="500" height="60" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5"/>
  <text x="400" y="195" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    GitEnhancedReflexLogger
  </text>
  <text x="400" y="215" font-size="12" text-anchor="middle" fill="white">
    add_checkpoint(phase, round, vectors, metadata)
  </text>
  
  <!-- Arrow down splits into 3 -->
  <line x1="400" y1="230" x2="400" y2="270" stroke="#2c3e50" stroke-width="2"/>
  <line x1="400" y1="270" x2="200" y2="310" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="270" x2="400" y2="310" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="270" x2="600" y2="310" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Three storage layers -->
  <!-- SQLite -->
  <rect x="50" y="310" width="300" height="100" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5"/>
  <text x="200" y="335" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    SQLite Database
  </text>
  <text x="200" y="355" font-size="11" text-anchor="middle" fill="white">
    .empirica/sessions/sessions.db
  </text>
  <text x="200" y="375" font-size="10" text-anchor="middle" fill="white">
    • Table: reflexes
  </text>
  <text x="200" y="390" font-size="10" text-anchor="middle" fill="white">
    • 13 vector columns + metadata
  </text>
  <text x="200" y="405" font-size="10" text-anchor="middle" fill="white">
    • Fast SQL queries
  </text>
  
  <!-- Git Notes -->
  <rect x="370" y="310" width="300" height="100" fill="#16a085" stroke="#0e8c72" stroke-width="2" rx="5"/>
  <text x="520" y="335" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    Git Notes
  </text>
  <text x="520" y="355" font-size="11" text-anchor="middle" fill="white">
    refs/notes/empirica/session/{id}/{phase}/{round}
  </text>
  <text x="520" y="375" font-size="10" text-anchor="middle" fill="white">
    • Compressed (~450 tokens)
  </text>
  <text x="520" y="390" font-size="10" text-anchor="middle" fill="white">
    • Distributed, versioned
  </text>
  <text x="520" y="405" font-size="10" text-anchor="middle" fill="white">
    • Crypto signable (git SHA)
  </text>
  
  <!-- JSON Logs (separate row) -->
  <rect x="150" y="430" width="500" height="100" fill="#f39c12" stroke="#d68910" stroke-width="2" rx="5"/>
  <text x="400" y="455" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
    JSON Reflex Logs (Full Detail)
  </text>
  <text x="400" y="475" font-size="11" text-anchor="middle" fill="white">
    .empirica_reflex_logs/{date}/{agent_id}/{session_id}/
  </text>
  <text x="400" y="495" font-size="10" text-anchor="middle" fill="white">
    • Full reasoning transcripts (~6,500 tokens)
  </text>
  <text x="400" y="510" font-size="10" text-anchor="middle" fill="white">
    • Rationales, evidence, tool logs
  </text>
  <text x="400" y="525" font-size="10" text-anchor="middle" fill="white">
    • Audit trail &amp; debugging
  </text>
  
  <!-- Compression info -->
  <rect x="150" y="560" width="500" height="80" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="5"/>
  <text x="400" y="585" font-size="13" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Compression Strategy
  </text>
  <text x="400" y="605" font-size="11" text-anchor="middle" fill="#34495e">
    Full Transcript: 15,000 tokens → Compressed Checkpoint: 450 tokens
  </text>
  <text x="400" y="625" font-size="11" text-anchor="middle" fill="#34495e">
    (97% reduction - keep vectors + metadata, drop rationales + transcripts)
  </text>
  
  <!-- Use cases -->
  <text x="400" y="670" font-size="16" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Access Patterns by Use Case
  </text>
  
  <!-- Table -->
  <rect x="100" y="690" width="600" height="30" fill="#34495e"/>
  <text x="200" y="710" font-size="11" font-weight="bold" fill="white">Use Case</text>
  <text x="400" y="710" font-size="11" font-weight="bold" fill="white">Data Source</text>
  <text x="600" y="710" font-size="11" font-weight="bold" fill="white">Why</text>
  
  <rect x="100" y="720" width="600" height="25" fill="#ecf0f1"/>
  <text x="110" y="737" font-size="10" fill="#2c3e50">Live dashboard</text>
  <text x="360" y="737" font-size="10" fill="#2c3e50">Git Notes</text>
  <text x="510" y="737" font-size="10" fill="#2c3e50">Fast, compressed</text>
  
  <rect x="100" y="745" width="600" height="25" fill="#d5dbdb"/>
  <text x="110" y="762" font-size="10" fill="#2c3e50">Historical trends</text>
  <text x="360" y="762" font-size="10" fill="#2c3e50">SQLite</text>
  <text x="510" y="762" font-size="10" fill="#2c3e50">SQL queries, aggregation</text>
  
  <rect x="100" y="770" width="600" height="25" fill="#ecf0f1"/>
  <text x="110" y="787" font-size="10" fill="#2c3e50">Session resumption</text>
  <text x="360" y="787" font-size="10" fill="#2c3e50">Git Notes</text>
  <text x="510" y="787" font-size="10" fill="#2c3e50">Token efficiency</text>
  
  <rect x="100" y="795" width="600" height="25" fill="#d5dbdb"/>
  <text x="110" y="812" font-size="10" fill="#2c3e50">Deep debugging</text>
  <text x="360" y="812" font-size="10" fill="#2c3e50">JSON Logs</text>
  <text x="510" y="812" font-size="10" fill="#2c3e50">Full reasoning context</text>
  
  <rect x="100" y="820" width="600" height="25" fill="#ecf0f1"/>
  <text x="110" y="837" font-size="10" fill="#2c3e50">Crypto signing</text>
  <text x="360" y="837" font-size="10" fill="#2c3e50">Git Notes SHA</text>
  <text x="510" y="837" font-size="10" fill="#2c3e50">Tamper-proof, verifiable</text>
  
  <!-- Footer -->
  <text x="400" y="875" font-size="10" text-anchor="middle" fill="#7f8c8d">
    Three-layer architecture: SQLite (queryable) + Git Notes (compressed) + JSON (audit)
  </text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2c3e50"/>
    </marker>
  </defs>
</svg>

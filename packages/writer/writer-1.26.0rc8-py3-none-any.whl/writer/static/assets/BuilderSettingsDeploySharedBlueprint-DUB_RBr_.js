import{d as N,an as O,ap as z,i as S,a as x,V as E,u as F,X as U,c,r as f,Y as j,w as R,o as k,b as $,z as h,g as r,x as y,aw as H,s as w,G as K,a6 as X,b0 as Y,f as J,t as L,S as C,a3 as Q,ax as Z,_ as ee}from"./index-sQstXFSt.js";import{W as I}from"./WdsFieldWrapper-maD0JSPW.js";const le={class:"DeploySharedBlueprint"},ae={class:"DeploySharedBlueprint__globalOption"},te={class:"DeploySharedBlueprint__checkbox"},re={key:0,class:"DeploySharedBlueprint__success"},se=["href"],oe=N({__name:"BuilderSettingsDeploySharedBlueprint",props:O({blueprintId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const o=g,p=z(g,"modelValue"),n=S(x.core),V=S(x.builderManager),{pushToast:i}=E(),{setContentValue:m,extractBlueprintComponents:A}=Z(n,V),_=F(n),{writerApi:B}=U(),D=c(()=>n.getComponentById(o.blueprintId)),G=c(()=>{var l,e;return((e=(l=D.value)==null?void 0:l.content)==null?void 0:e.key)||"Shared Blueprint"}),P=c(()=>{var l,e;return((e=(l=D.value)==null?void 0:l.content)==null?void 0:e.deployedDescription)||""}),a=f({name:"",description:"",proposeAsGlobal:!1}),d=j({}),u=f(!1),s=f(null);function q(){const l={};return a.value.name.trim()||(l.name="Name is required"),a.value.description.trim()||(l.description="Description is required"),d.value=l,Object.keys(l).length===0}function M(l){o.blueprintId&&l.trim()&&m(o.blueprintId,"key",l.trim())}async function T(){if(!q())return;const l=n.writerOrgId.value;if(!l){i({type:"error",message:"Organization ID is required. Please set up your environment variable."});return}u.value=!0,s.value=null;try{const e=A(o.blueprintId);if(a.value.proposeAsGlobal){const t=await B.proposeSharedBlueprintGlobal({title:a.value.name.trim(),description:a.value.description.trim(),components:e,metadata:{}});s.value=t.pr_url,i({type:"success",message:"Global blueprint proposed! A PR has been created for review."}),_.track("blueprints_global_proposed")}else{const t=await B.publishSharedBlueprint(l,{title:a.value.name.trim(),description:a.value.description.trim(),components:e,metadata:{}});m(o.blueprintId,"publishedSnippetId",t.snippet_id),m(o.blueprintId,"deployedDescription",a.value.description.trim()),i({type:"success",message:`Blueprint "${a.value.name.trim()}" published successfully`}),_.track("blueprints_shared_published"),v(),p.value=!1;try{await n.init()}catch{i({type:"error",message:"Blueprint published but failed to reload. Please refresh the page."})}}}catch(e){i({type:"error",message:`Error publishing blueprint: ${e instanceof Error?e.message:String(e)}`})}finally{u.value=!1}}function b(){u.value||(v(),p.value=!1)}function v(){a.value={name:G.value,description:P.value,proposeAsGlobal:!1},d.value={},s.value=null}const W=c(()=>{const l=a.value.proposeAsGlobal?"Propose":"Publish",e=a.value.proposeAsGlobal?"Proposing...":"Publishing...";return s.value?[{desc:"Close",fn:b}]:[{desc:"Cancel",fn:b},{desc:u.value?e:l,fn:T,disabled:u.value}]});return R(p,l=>{l&&v()}),(l,e)=>p.value?(k(),$(Q,{key:0,actions:W.value,title:"Publish Blueprint","display-close-button":"",onClose:b},{default:h(()=>[r("div",le,[y(I,{label:"Name",required:""},{default:h(()=>[y(H,{modelValue:a.value.name,"onUpdate:modelValue":[e[0]||(e[0]=t=>a.value.name=t),M],placeholder:"e.g., Data Fetch Pipeline",error:d.value.name},null,8,["modelValue","error"])]),_:1}),y(I,{label:"Description",required:""},{default:h(()=>[w(r("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.description=t),placeholder:"Describe what this shared blueprint does",class:K(["DeploySharedBlueprint__textarea",{"DeploySharedBlueprint__textarea--error":d.value.description}])},null,2),[[X,a.value.description]])]),_:1}),r("div",ae,[r("label",te,[w(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.proposeAsGlobal=t),type:"checkbox"},null,512),[[Y,a.value.proposeAsGlobal]]),e[3]||(e[3]=r("span",null,"Propose as global blueprint",-1))]),e[4]||(e[4]=r("p",{class:"DeploySharedBlueprint__hint"}," Global blueprints are available to all organizations and require approval via GitHub PR. ",-1))]),s.value?(k(),J("div",re,[e[5]||(e[5]=r("p",null,"Pull request created successfully!",-1)),r("a",{href:s.value,target:"_blank",rel:"noopener noreferrer"},L(s.value),9,se)])):C("",!0)])]),_:1},8,["actions"])):C("",!0)}}),pe=ee(oe,[["__scopeId","data-v-1ad841f6"]]);export{pe as default};
//# sourceMappingURL=BuilderSettingsDeploySharedBlueprint-DUB_RBr_.js.map

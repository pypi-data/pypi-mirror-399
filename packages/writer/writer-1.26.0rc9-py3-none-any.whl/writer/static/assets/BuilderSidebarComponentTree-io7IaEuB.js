import{a as pe,B as me}from"./BuilderApp-Cw_QuIxo.js";import{c as p,d as X,r as Z,i as N,a as L,u as ee,w as F,b5 as ge,b4 as ve,L as S,o as l,b as T,z as b,g as h,f as v,D as I,x as _,y as k,S as y,R as u,t as z,E as Q,bD as fe,C as H,ax as te,l as he,aM as ye,_ as ne,a$ as K,bE as Ce,W as j,A as J}from"./index-BE6RSzCE.js";import"./WdsCheckbox-TLlfBAzj.js";import"./marked.esm-273vDTCT.js";function ae(c,s){function o(r){if(!s.value)return!0;const t=c.getComponentDefinition(r.type);return!!(t!=null&&t.name.toLocaleLowerCase().includes(s.value)||Object.values(r.content).filter(f=>typeof f=="string"&&f.toLocaleLowerCase().includes(s.value)).length>0)}return{isComponentMatchingQuery:o}}function _e(c,s,o){const{isComponentMatchingQuery:r}=ae(c,s);return{searchResultCount:p(()=>{if(!s.value)return;let d=0;for(const f of c.getComponentsNested(o.value))r(f)&&d++;return d})}}function be(c,s,o){const{isComponentMatchingQuery:r}=ae(c,s),t=p(()=>!s.value||r(o.value));return{hasMatchingChildren:p(()=>{if(!s.value)return!0;for(const f of c.getComponentsNested(o.value.id))if(r(f))return!0;return!1}),matched:t}}const Ie={class:"BuilderSidebarComponentTreeBranch__nameRight"},Be={class:"previewText"},Te=X({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch"],setup(c,{emit:s}){const o=c,r=Z(),t=N(L.core),d=N(L.builderManager),f=p(()=>d.isComponentIdSelected(o.componentId)),C=ee(t),{createAndInsertComponent:R,moveComponent:P,goToComponentParentPage:O,isDraggingAllowed:q}=te(t,d,C),{getComponentInfoFromDrag:A,removeInsertionCandidacy:D,isParentSuitable:E}=ye(t),{isComponentVisible:V}=he(t),i=s,m=p(()=>{var e;return((e=o.query)==null?void 0:e.toLocaleLowerCase())??""}),n=p(()=>t.getComponentById(o.componentId)),{hasMatchingChildren:x,matched:oe}=be(t,m,n);F(x,e=>{var a;return(a=r.value)==null?void 0:a.toggleCollapse(!e)},{immediate:!0});const W=p(()=>t.getComponents(o.componentId,{sortedByPosition:!0}).filter(e=>{var a;return((a=t.getComponentDefinition(e.type))==null?void 0:a.category)!=="Internal"})),{name:re,previewText:Y}=ge(t,n);async function se(e){O(o.componentId),await S(),d.handleSelectionFromEvent(e,o.componentId,void 0,"tree"),$()}function $(){r.value&&(r.value.expand(),i("expandBranch"))}function ie(){var M;const e=(M=r.value)==null?void 0:M.$el;if(!e)return;const a=e.closest(".BuilderSidebarComponentTree"),g=a.getBoundingClientRect(),B=r.value.$el.offsetTop-g.height/2,w=r.value.$el.offsetLeft-g.left-16;a.scrollTo({top:B,left:Math.max(0,w),behavior:"smooth"})}function le(e){d.setSelection(null),e.dataTransfer.setData(`application/json;writer=${n.value.type},${n.value.id}`,"{}")}function de(e){D(e)}function ue(e){const a=A(e);if(!a)return;const{draggedType:g,draggedId:B}=a;E(o.componentId,B,g)&&e.preventDefault()}function ce(e){const a=A(e);if(!a)return;const{draggedType:g,draggedId:B,sourceBlueprintId:w}=a;if(B)P(B,n.value.id);else{const M=w?{content:{sourceBlueprintId:w}}:void 0;R(g,n.value.id,void 0,M)}D(e)}const G=p(()=>{if(!t.activePageId.value)return!1;const e=t.getComponents(d.activeRootId.value).some(g=>g.id===t.activePageId.value);return ve.has(n.value.type)&&e&&o.componentId!==t.activePageId.value});return F(t.activePageId,()=>{var e;t.activePageId.value&&G.value&&((e=r.value)==null||e.toggleCollapse(!0))}),F(d.firstSelectedItem,async e=>{e&&e.componentId===o.componentId&&e.source!="tree"&&($(),await S(),ie())},{immediate:!0}),(e,a)=>n.value?(l(),T(pe,{key:0,ref_key:"treeBranch",ref:r,class:"BuilderSidebarComponentTreeBranch","component-id":c.componentId,name:u(re),query:c.query,"has-children":W.value.length>0,"data-automation-key":n.value.type,draggable:u(q)(c.componentId),matched:u(oe),selected:f.value,variant:u(fe).has(n.value.type)?"root":void 0,"disable-collapse":u(H).has(n.value.type),"no-nested-space":u(H).has(n.value.type),collapsed:G.value,onSelect:se,onDragover:ue,onDragstart:le,onDragend:de,onDrop:ce},{nameRight:b(()=>[h("span",Ie,[Object.keys(n.value.handlers??{}).length>0?(l(),v(I,{key:0},[a[0]||(a[0]=h("span",{class:"middot"},null,-1)),_(k,{name:"zap"})],64)):y("",!0),u(V)(n.value.id)?y("",!0):(l(),v(I,{key:1},[a[1]||(a[1]=h("span",{class:"middot"},null,-1)),_(k,{name:"eye-off"})],64)),n.value.isCodeManaged?(l(),v(I,{key:2},[a[2]||(a[2]=h("span",{class:"middot"},null,-1)),_(k,{name:"square-terminal"})],64)):y("",!0),u(Y)?(l(),v(I,{key:3},[a[3]||(a[3]=h("span",{class:"middot"},null,-1)),h("span",Be,z(u(Y)),1)],64)):y("",!0)])]),children:b(()=>[(l(!0),v(I,null,Q(W.value,g=>(l(),T(U,{key:g.id,"component-id":g.id,query:c.query,onExpandBranch:$},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected","variant","disable-collapse","no-nested-space","collapsed"])):y("",!0)}}),U=ne(Te,[["__scopeId","data-v-a553e087"]]),ke={key:0},Se={key:1,class:"sections"},Pe={class:"section__header"},Ae={class:"section__title"},De={class:"section__content"},Ee={key:0,class:"section__empty"},xe={class:"add"},we=X({__name:"BuilderSidebarComponentTree",setup(c){const s=N(L.core),o=N(L.builderManager),r=Z(""),t=ee(s),{createAndInsertComponent:d,setContentValue:f}=te(s,o,t),C=o.activeRootId,{searchResultCount:R}=_e(s,r,C),P=p(()=>s.getComponents("blueprints_root",{sortedByPosition:!0})),O=p(()=>P.value.filter(i=>!K(i))),q=p(()=>P.value.filter(i=>K(i))),A=p(()=>{var m;const i=[{key:"blueprints",title:"Blueprints",items:O.value,addAction:"add-blueprint",onAdd:E,emptyText:"No blueprints yet"}];return(m=s.featureFlags.value)!=null&&m.includes("shared_blueprints")&&i.push({key:"shared-blueprints",title:"Shared Blueprints",items:q.value,addAction:"add-shared-blueprint",onAdd:V,emptyText:"No shared blueprints yet"}),i});async function D(){const i=d("page","root");s.setActivePageId(i),await S(),o.setSelection(i),t.track("ui_page_added")}async function E(){const i=d("blueprints_blueprint","blueprints_root");s.setActivePageId(i),await S(),o.setSelection(i),t.track("blueprints_new_added")}async function V(){const i=d("blueprints_blueprint","blueprints_root");f(i,"isSharedBlueprint",Ce),s.setActivePageId(i),await S(),o.setSelection(i),t.track("blueprints_shared_added")}return(i,m)=>(l(),T(me,{modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=n=>r.value=n),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":u(R)},{footer:b(()=>[h("div",xe,[u(C)=="root"?(l(),T(j,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:D},{default:b(()=>[_(k,{name:"plus"}),m[1]||(m[1]=J(" Add page "))]),_:1})):y("",!0),u(C)=="blueprints_root"?(l(),T(j,{key:1,variant:"special",size:"small","data-automation-action":"add-blueprint-footer",onClick:E},{default:b(()=>[_(k,{name:"plus"}),m[2]||(m[2]=J(" Add blueprint "))]),_:1})):y("",!0)])]),default:b(()=>[u(C)=="root"?(l(),v("div",ke,[_(U,{class:"rootBranch","component-id":u(C),query:r.value},null,8,["component-id","query"])])):u(C)=="blueprints_root"?(l(),v("div",Se,[(l(!0),v(I,null,Q(A.value,n=>(l(),v("div",{key:n.key,class:"section"},[h("div",Pe,[h("span",Ae,z(n.title),1),_(j,{variant:"neutral",size:"smallIcon","data-automation-action":n.addAction,onClick:n.onAdd},{default:b(()=>[_(k,{name:"plus"})]),_:2},1032,["data-automation-action","onClick"])]),h("div",De,[(l(!0),v(I,null,Q(n.items,x=>(l(),T(U,{key:x.id,"component-id":x.id,query:r.value},null,8,["component-id","query"]))),128)),n.items.length===0?(l(),v("div",Ee,z(n.emptyText),1)):y("",!0)])]))),128))])):y("",!0)]),_:1},8,["modelValue","search-count"]))}}),Oe=ne(we,[["__scopeId","data-v-45d321fc"]]);export{Oe as default};
//# sourceMappingURL=BuilderSidebarComponentTree-io7IaEuB.js.map

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Visualization Debug Console</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #58a6ff; }
        h2 { color: #8b949e; margin-top: 30px; }
        .section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #2ea043;
        }
        button.secondary {
            background: #1f6feb;
        }
        button.secondary:hover {
            background: #388bfd;
        }
        pre {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            overflow-x: auto;
            font-size: 13px;
        }
        .error { color: #ff7b72; }
        .success { color: #7ee787; }
        .warning { color: #f0883e; }
        .info { color: #79c0ff; }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #30363d;
            border-radius: 6px;
            background: white;
            margin-top: 10px;
        }
        .instructions {
            background: #1f2937;
            border-left: 4px solid #f0883e;
            padding: 15px;
            margin: 20px 0;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            background: #161b22;
        }
    </style>
</head>
<body>
    <h1>üîç Visualization Debug Console</h1>
    <p>This page helps diagnose issues with Dagre and Circular layouts in the visualization.</p>

    <div class="instructions">
        <h3>‚ö†Ô∏è Instructions:</h3>
        <ol>
            <li>Open this page: <code>http://localhost:8089</code> in a new browser tab</li>
            <li>Open DevTools Console (F12 or Cmd+Option+I)</li>
            <li>Return to this page and click the test buttons below</li>
            <li>Copy the console output and share with the QA agent</li>
        </ol>
    </div>

    <div class="section">
        <h2>Manual Console Tests</h2>
        <p>Copy and paste these commands into the browser console at <code>http://localhost:8089</code>:</p>

        <h3>Test 1: Check Initial Data State</h3>
        <pre>// Run this BEFORE switching layouts
console.log('=== INITIAL DATA STATE ===');
console.log('allLinks.length:', allLinks?.length);
console.log('allNodes.length:', allNodes?.length);
console.log('First link:', allLinks?.[0]);
console.log('First link source type:', typeof allLinks?.[0]?.source);
console.log('First link target type:', typeof allLinks?.[0]?.target);
console.log('Current layout:', currentLayout);
console.log('================================');</pre>

        <h3>Test 2: Check After Switching to Dagre</h3>
        <pre>// Run this AFTER switching to Dagre layout
console.log('=== AFTER DAGRE SWITCH ===');
console.log('Current layout:', currentLayout);
console.log('Cytoscape exists:', !!cy);
console.log('Cytoscape nodes:', cy?.nodes().length);
console.log('Cytoscape edges:', cy?.edges().length);
if (cy && cy.edges().length > 0) {
    console.log('First edge data:', cy.edges()[0].data());
} else {
    console.log('‚ö†Ô∏è NO EDGES FOUND IN CYTOSCAPE');
}
console.log('First link source after switch:', typeof allLinks?.[0]?.source);
console.log('================================');</pre>

        <h3>Test 3: Check After Switching to Circular</h3>
        <pre>// Run this AFTER switching to Circular layout
console.log('=== AFTER CIRCULAR SWITCH ===');
console.log('Current layout:', currentLayout);
console.log('Cytoscape exists:', !!cy);
console.log('Cytoscape nodes:', cy?.nodes().length);
console.log('Cytoscape edges:', cy?.edges().length);
if (cy && cy.edges().length > 0) {
    console.log('First edge data:', cy.edges()[0].data());
} else {
    console.log('‚ö†Ô∏è NO EDGES FOUND IN CYTOSCAPE');
}
console.log('================================');</pre>

        <h3>Test 4: Check Visible Links</h3>
        <pre>// Check what links are being passed to Cytoscape
console.log('=== VISIBLE LINKS CHECK ===');
const visibleNodesList = allNodes.filter(n => visibleNodes.has(n.id));
const filteredLinks = getFilteredLinks();
const visibleLinks = filteredLinks.filter(l =>
    visibleNodes.has(l.source.id || l.source) &&
    visibleNodes.has(l.target.id || l.target)
);
console.log('Visible nodes:', visibleNodesList.length);
console.log('Filtered links:', filteredLinks.length);
console.log('Visible links:', visibleLinks.length);
if (visibleLinks.length > 0) {
    console.log('First visible link:', visibleLinks[0]);
    console.log('Source type:', typeof visibleLinks[0].source);
    console.log('Target type:', typeof visibleLinks[0].target);
} else {
    console.log('‚ö†Ô∏è NO VISIBLE LINKS');
}
console.log('================================');</pre>

        <h3>Test 5: Check for Errors</h3>
        <pre>// Monitor for errors during layout switch
console.clear();
console.log('=== SWITCHING TO DAGRE - WATCH FOR ERRORS ===');
document.getElementById('layoutSelector').value = 'dagre';
document.getElementById('layoutSelector').dispatchEvent(new Event('change'));</pre>

        <h3>Test 6: Verify Cytoscape Dagre Extension</h3>
        <pre>// Check if Dagre extension is loaded
console.log('=== CYTOSCAPE EXTENSIONS ===');
console.log('Cytoscape version:', cytoscape.version);
console.log('Dagre available:', typeof dagre !== 'undefined');
console.log('Cytoscape extensions:', Object.keys(cytoscape.extensions || {}));
console.log('================================');</pre>
    </div>

    <div class="section">
        <h2>Expected Results</h2>

        <h3>‚úÖ When Working Correctly:</h3>
        <div class="test-result success">
            <pre>allLinks.length: 150
allNodes.length: 80
First link source type: "string" (before Force layout) OR "object" (after Force layout)
Cytoscape nodes: 80
Cytoscape edges: 150
First edge data: {source: "some-id", target: "another-id", ...}</pre>
        </div>

        <h3>‚ùå When Broken (Edges):</h3>
        <div class="test-result error">
            <pre>Cytoscape edges: 0  ‚Üê NO EDGES!
‚ö†Ô∏è NO EDGES FOUND IN CYTOSCAPE
OR
Error: "Cannot create edge with source [object Object]"</pre>
        </div>

        <h3>‚ùå When Broken (Dagre Extension):</h3>
        <div class="test-result error">
            <pre>Error: Layout 'dagre' not found
OR
Dagre available: false</pre>
        </div>

        <h3>‚ö†Ô∏è When Circular Layout Has Wrong Config:</h3>
        <div class="test-result warning">
            <pre>Circular layout may show nodes but layout options like 'rankDir' don't apply to circle layout.
This won't cause errors but may result in unexpected layout.</pre>
        </div>
    </div>

    <div class="section">
        <h2>Testing Sequence</h2>
        <p>Follow this exact sequence and note results:</p>
        <ol>
            <li>Load <code>http://localhost:8089</code> in browser</li>
            <li>Open DevTools Console (F12)</li>
            <li>Run <strong>Test 1</strong> (initial state)</li>
            <li>Click "Hierarchical (Dagre)" in layout dropdown</li>
            <li>Run <strong>Test 2</strong> (after Dagre)</li>
            <li>Observe: Does graph show? Any errors?</li>
            <li>Click "Circular" in layout dropdown</li>
            <li>Run <strong>Test 3</strong> (after Circular)</li>
            <li>Observe: Does graph show? Any errors?</li>
            <li>Click "Force-Directed" in layout dropdown</li>
            <li>Click "Hierarchical (Dagre)" again</li>
            <li>Run <strong>Test 2</strong> again</li>
            <li>Note any differences from first Dagre test</li>
        </ol>
    </div>

    <div class="section">
        <h2>Copy Results Here</h2>
        <p>After running tests, paste console output here and save/screenshot:</p>
        <textarea id="results" style="width: 100%; height: 300px; background: #0d1117; color: #c9d1d9; border: 1px solid #30363d; border-radius: 6px; padding: 10px; font-family: monospace; font-size: 13px;" placeholder="Paste console output here..."></textarea>
        <br>
        <button onclick="saveResults()">üíæ Save Results to Console</button>
        <button class="secondary" onclick="copyResults()">üìã Copy to Clipboard</button>
    </div>

    <script>
        function saveResults() {
            const results = document.getElementById('results').value;
            console.log('=== DEBUG RESULTS ===');
            console.log(results);
            console.log('====================');
            alert('Results saved to console! Open DevTools to see.');
        }

        function copyResults() {
            const results = document.getElementById('results').value;
            navigator.clipboard.writeText(results).then(() => {
                alert('‚úÖ Results copied to clipboard!');
            }).catch(err => {
                alert('‚ùå Failed to copy: ' + err);
            });
        }
    </script>
</body>
</html>

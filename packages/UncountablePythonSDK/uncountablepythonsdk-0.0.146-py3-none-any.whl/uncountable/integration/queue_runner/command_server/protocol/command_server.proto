syntax = "proto3";
import "google/protobuf/timestamp.proto";

service CommandServer {
	rpc EnqueueJob(EnqueueJobRequest) returns (EnqueueJobResult) {}
	rpc RetryJob(RetryJobRequest) returns (RetryJobResult) {}
	rpc CheckHealth(CheckHealthRequest) returns (CheckHealthResult) {}
	rpc ListQueuedJobs(ListQueuedJobsRequest) returns (ListQueuedJobsResult) {}
	rpc VaccuumQueuedJobs(VaccuumQueuedJobsRequest) returns (VaccuumQueuedJobsResult) {}
	rpc CancelJob(CancelJobRequest) returns (CancelJobResult) {}
}

message EnqueueJobRequest {
	string job_ref_name = 1;
	string serialized_payload = 2;
}

message EnqueueJobResult {
	bool successfully_queued = 1;
	string queued_job_uuid = 2;
}

message RetryJobRequest {
	string uuid = 1;
}

message RetryJobResult {
	bool successfully_queued = 1;
	string queued_job_uuid = 2;
}

message VaccuumQueuedJobsRequest {
}

message VaccuumQueuedJobsResult {
}

message CheckHealthRequest {}

message CheckHealthResult {
	bool success = 1;
}

message ListQueuedJobsRequest {
	uint32 offset = 1;
	uint32 limit = 2;
	string status = 3;
}

message ListQueuedJobsResult {
	message ListQueuedJobsResultItem {
	string uuid = 1;
	string job_ref_name = 2;
	int64 num_attempts = 3;
	google.protobuf.Timestamp submitted_at = 4;
	string status = 5;
	}

	repeated ListQueuedJobsResultItem queued_jobs  = 1;
}

message CancelJobRequest {
        string job_uuid = 1;
}

enum CancelJobStatus {
	CANCELLED_WITH_RESTART = 0;
	NO_JOB_FOUND = 1;
	JOB_ALREADY_COMPLETED = 2;
}

message CancelJobResult {
	CancelJobStatus status = 1;
}

Metadata-Version: 2.4
Name: bc_trb_sdk
Version: 0.0.2
Classifier: Programming Language :: Rust
Classifier: Programming Language :: Python :: Implementation :: CPython
Classifier: Programming Language :: Python :: Implementation :: PyPy
Requires-Python: >=3.8
Description-Content-Type: text/markdown; charset=UTF-8; variant=GFM

# BrainSync TriggerHub SDK

[![Rust](https://img.shields.io/badge/rust-1.75%2B-orange.svg)](https://www.rust-lang.org/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](../LICENSE)

BrainSync TriggerHub è®¾å¤‡çš„å¤šè¯­è¨€ SDKï¼Œæä¾›ç®€å•ã€ç±»å‹å®‰å…¨ã€é«˜æ€§èƒ½çš„ APIã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Rust

```rust
use bc_trb_sdk::usb::open_triggerhub_device;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    // 1. æ‰“å¼€è®¾å¤‡
    let device_api = open_triggerhub_device().await?;
    
    // 2.è·å– TriggerHub å„ä¿¡å·æ¿€æ´»çŠ¶æ€
    let status = device_api.trigger().get_status().await?;
    println!("PD: {}, AUD: {}, MIC: {}, BTN: {}", 
        status.pd_active, status.aud_active, 
        status.mic_active, status.btn_active);
    
    // 3. è·å– ADC è¯»æ•°
    let adc = device_api.trigger().get_adc_value().await?;
    println!("å‚è€ƒç”µå‹: {:.2} V", adc.vref_v());
    println!("PD ç”µå‹: {:.2} mV", adc.pd_voltage_mv());
    
    // 4. é…ç½® Trigger ä¿¡å·
    let config = TrbConfig {
        pd_enabled: true,
        pd_threshold: 30000,
        aud_enabled: true,
        aud_threshold: 25000,
        mic_enabled: false,
        mic_threshold: 0,
    };
    device_api.trigger().set_config(&config).await?;
    
    Ok(())
}
```

### Python

```python
import asyncio
from bc_trb_sdk import open_triggerhub_device

async def main():
    # 1. æ‰“å¼€è®¾å¤‡
    device = await open_triggerhub_device()
    trigger = device.trigger()
    
    # 2.è·å– TriggerHub å„ä¿¡å·æ¿€æ´»çŠ¶æ€
    status = await trigger.get_status()
    print(f"PD: {status.pd_active}, AUD: {status.aud_active}")
    
    # 3. è·å– ADC è¯»æ•°
    adc = await trigger.get_adc_value()
    print(f"å‚è€ƒç”µå‹: {adc.vref_v():.2f} V")
    print(f"PD ç”µå‹: {adc.pd_voltage_mv():.2f} mV")
    
    # 4. é…ç½® Trigger ä¿¡å·
    config = TrbConfig(
        pd_enabled=True,
        pd_threshold=30000,
        aud_enabled=True,
        aud_threshold=25000,
        mic_enabled=False,
        mic_threshold=0
    )
    await trigger.set_config(config)

asyncio.run(main())
```

### Node.js

```javascript
const { open_triggerhub_device } = require('bc-trb-sdk');

async function main() {
    // 1. æ‰“å¼€è®¾å¤‡
    const device = await open_triggerhub_device();
    
    // 2.è·å– TriggerHub å„ä¿¡å·æ¿€æ´»çŠ¶æ€
    const status = await device.getTriggerStatus();
    console.log(`PD: ${status.pdActive}, AUD: ${status.audActive}`);
    
    // 3. è·å– ADC è¯»æ•°
    const adc = await device.getTriggerAdcValue();
    console.log(`å‚è€ƒç”µå‹: ${adc.vrefMv / 1000} V`);
    console.log(`PD ç”µå‹: ${adc.values[2] / adc.adcValueMax * adc.vrefMv} mV`);
    
    // 4. é…ç½® Trigger ä¿¡å·
    await device.setTriggerConfig({
        pdEnabled: true,
        pdThreshold: 30000,
        audEnabled: true,
        audThreshold: 25000,
        micEnabled: false,
        micThreshold: 0
    });
}

main().catch(console.error);
```

## ğŸ“š æ–‡æ¡£

- **[TriggerHub API ä½¿ç”¨æŒ‡å—](../docs/TRIGGERHUB_API_USAGE.md)** - API ä½¿ç”¨è¯´æ˜
- **[å¿«é€Ÿå¼€å§‹](QUICK_START.md)** - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### TriggerHub API

| åŠŸèƒ½ | æè¿° | å‘½ä»¤ |
|------|------|------|
| **è·å–çŠ¶æ€** | è·å–å„ä¸ª Trigger ä¿¡å·çš„å½“å‰çŠ¶æ€ | CMD_TRG_STATUS (0x10) |
| **ADC ä¼ è¾“æ§åˆ¶** | å¼€å¯/å…³é—­ ADC è¯»æ•°è¿ç»­ä¼ è¾“ | CMD_TRG_ADC_ENABLE_TRANSFER (0x11) |
| **è·å– ADC å€¼** | è·å–å•æ¬¡æˆ–è¿ç»­ ADC è¯»æ•° | CMD_TRG_ADC_VALUE (0x12) |
| **é…ç½®ç®¡ç†** | è·å–/è®¾ç½® Trigger ä¿¡å·é…ç½® | CMD_TRG_CONFIG (0x13) |

### æ•°æ®ç»“æ„

#### TrbStatus - Trigger ä¿¡å·çŠ¶æ€

```rust
pub struct TrbStatus {
    pub pd_active: bool,    // PD (å…‰ç”µ) ä¿¡å·æ˜¯å¦æ¿€æ´»
    pub aud_active: bool,   // AUD (éŸ³é¢‘) ä¿¡å·æ˜¯å¦æ¿€æ´»
    pub mic_active: bool,   // MIC (éº¦å…‹é£) ä¿¡å·æ˜¯å¦æ¿€æ´»
    pub btn_active: bool,   // BTN (æŒ‰é’®) ä¿¡å·æ˜¯å¦æ¿€æ´»
}
```

#### TrbAdcValue - ADC è¯»æ•°

```rust
pub struct TrbAdcValue {
    pub adc_value_max: u32,  // ADC æœ€å¤§å€¼ï¼ˆ0xFFFFï¼‰
    pub vref_mv: u32,        // å‚è€ƒç”µå‹ï¼ˆmVï¼Œé€šå¸¸ 3300mVï¼‰
    pub values: Vec<u16>,    // ADC è¯»æ•° [VREF_INT, PD_TRGLEVEL, PD, MIC, AUD]
}
```

#### TrbConfig - Trigger ä¿¡å·é…ç½®

```rust
pub struct TrbConfig {
    pub pd_enabled: bool,      // PD ä¿¡å·æ˜¯å¦å¼€å¯
    pub pd_threshold: u32,     // PD ä¿¡å·é˜ˆå€¼ï¼ˆADC åŸå§‹å€¼ï¼‰
    pub aud_enabled: bool,     // AUD ä¿¡å·æ˜¯å¦å¼€å¯
    pub aud_threshold: u32,    // AUD ä¿¡å·é˜ˆå€¼ï¼ˆADC åŸå§‹å€¼ï¼‰
    pub mic_enabled: bool,     // MIC ä¿¡å·æ˜¯å¦å¼€å¯
    pub mic_threshold: u32,    // MIC ä¿¡å·é˜ˆå€¼ï¼ˆADC åŸå§‹å€¼ï¼‰
}
```

## ğŸ“¦ ç¤ºä¾‹ç¨‹åº

### Rust ç¤ºä¾‹

```bash
# TriggerHub åŸºç¡€ç¤ºä¾‹
cargo run --example triggerhub_example

# TriggerHub ADC æµç¤ºä¾‹
cargo run --example triggerhub_adc_stream
```

### Python ç¤ºä¾‹

```bash
# å®‰è£…ä¾èµ–
cd sdk
pip install maturin
maturin develop

# è¿è¡Œç¤ºä¾‹
cd examples/python
python triggerhub_example.py
python triggerhub_adc_stream.py
```

### Node.js ç¤ºä¾‹

```bash
# æ„å»º Neon æ¨¡å—
cd sdk
npm install
npm run build

# è¿è¡Œç¤ºä¾‹
cd examples/neon
node triggerhub_example.js
node triggerhub_adc_stream.js
```

## ğŸ—ï¸ æ¶æ„

```
ç”¨æˆ·ä»£ç 
    â†“
DeviceApi
    â”œâ”€â”€ trigger() â†’ TriggerApi
    â”‚   â”œâ”€â”€ get_status()
    â”‚   â”œâ”€â”€ get_adc_value()
    â”‚   â”œâ”€â”€ set_config()
    â”‚   â””â”€â”€ set_adc_transfer()
    â†“
åè®®å±‚ (å¸§ç¼–è§£ç )
    â”œâ”€â”€ Frame (0xAA ... 0x55)
    â”œâ”€â”€ CMD_TRG_STATUS (0x10)
    â”œâ”€â”€ CMD_TRG_ADC_ENABLE_TRANSFER (0x11)
    â”œâ”€â”€ CMD_TRG_ADC_VALUE (0x12)
    â””â”€â”€ CMD_TRG_CONFIG (0x13)
    â†“
ä¼ è¾“å±‚ (USB Bulk Transfer)
    â”œâ”€â”€ VID: 0x5243 (BrainSync)
    â””â”€â”€ PID: 0x0009 (TriggerHub)
    â†“
TriggerHub ç¡¬ä»¶
```

## ğŸ¨ è®¾è®¡ç‰¹ç‚¹

### ç®€å•æ€§

```rust
// ä¸€è¡Œä»£ç æ‰“å¼€è®¾å¤‡
let device_api = open_triggerhub_device().await?;
```

### ç±»å‹å®‰å…¨

```rust
// ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
let status: TrbStatus = device_api.trigger().get_status().await?;
```

### å¼‚æ­¥ä¼˜å…ˆ

```rust
// æ‰€æœ‰ I/O æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„
let adc = device_api.trigger().get_adc_value().await?;
```

### å¤šè¯­è¨€æ”¯æŒ

- **Rust** - åŸç”Ÿ APIï¼Œé›¶å¼€é”€
- **Python** - PyO3 bindingsï¼Œç›´æ¥å¤ç”¨ Rust ç±»å‹
- **Node.js** - Neon bindingsï¼Œé«˜æ€§èƒ½

### ç›´æ¥ç±»å‹å¤ç”¨

Python å’Œ Node.js bindings ç›´æ¥å¤ç”¨ Rust æ•°æ®ç»“æ„ï¼Œæ— éœ€åŒ…è£…ç±»å‹ï¼š

```rust
// Rust å®šä¹‰
#[cfg_attr(feature = "python", pyclass(name = "TrbStatus", get_all))]
pub struct TrbStatus {
    pub pd_active: bool,
    pub aud_active: bool,
    pub mic_active: bool,
    pub btn_active: bool,
}
```

Python å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

```python
status = await trigger.get_status()  # è¿”å› TrbStatus
print(status.pd_active)  # ç›´æ¥è®¿é—®å­—æ®µ
```

## ğŸ”§ Feature Flags

```toml
[dependencies]
bc-trb-sdk = { path = "sdk", features = ["usb"] }
```

å¯ç”¨ featuresï¼š

- `usb` - USB é€šä¿¡ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
- `python` - Python bindings
- `node_addons` - Node.js bindings

## ğŸ“Š æ€§èƒ½

- **é›¶å¼€é”€æŠ½è±¡** - æ³›å‹ + é™æ€åˆ†å‘
- **é›¶æ‹·è´è§£æ** - ç›´æ¥ä»å­—èŠ‚æµè§£æ
- **å¼‚æ­¥ I/O** - åŸºäº Tokio
- **USB Bulk Transfer** - é«˜é€Ÿæ•°æ®ä¼ è¾“

## ğŸ”Œ USB è®¾å¤‡ä¿¡æ¯

- **VID**: 0x5243 (BrainSync)
- **PID**: 0x0009 (TriggerHub)
- **æ¥å£ç±»**: 0xFF (Vendor Defined)
- **ä¼ è¾“æ–¹å¼**: Bulk Transfer
- **ç«¯ç‚¹**: è‡ªåŠ¨æ£€æµ‹ IN/OUT ç«¯ç‚¹

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
cargo test --lib protocol
cargo test --lib model

# è¿è¡Œç¤ºä¾‹ä½œä¸ºé›†æˆæµ‹è¯•
cargo run --example triggerhub_example
```

### å¸§æ ¼å¼

```
[START 0xAA] [CMD 1B] [LEN 1B] [DATA byte[LEN]] [END 0x55]
```

### å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤ | å€¼ | æè¿° |
|------|-----|------|
| CMD_TRG_STATUS | 0x10 | Trigger ä¿¡å·çŠ¶æ€ |
| CMD_TRG_ADC_ENABLE_TRANSFER | 0x11 | ADC ä¼ è¾“æ§åˆ¶ |
| CMD_TRG_ADC_VALUE | 0x12 | ADC è¯»æ•° |
| CMD_TRG_CONFIG | 0x13 | Trigger é…ç½® |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·æŸ¥çœ‹ [è´¡çŒ®æŒ‡å—](../CONTRIBUTING.md)ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License

---

**å¿«é€Ÿé“¾æ¥**ï¼š
- [é€šè®¯åè®®](../docs/BrainSync%20TriggerBox%20é€šè®¯åè®®.md)
- [API ä½¿ç”¨æŒ‡å—](../docs/TRIGGERHUB_API_USAGE.md)
- [å¿«é€Ÿå¼€å§‹](QUICK_START.md)
- [ç¤ºä¾‹ç¨‹åº](examples/)


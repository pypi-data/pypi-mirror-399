from thsdk import THS
import pandas as pd
import time
from zoneinfo import ZoneInfo

bj_tz = ZoneInfo('Asia/Shanghai')

with THS() as ths:
    response = ths.index_list()
    df = response.df
    hs300_code = df.loc[df['名称'] == '沪深300', '代码']
    print("沪深300指数:")
    print(hs300_code)
    time.sleep(0.1)

    # Request K-line data for each code in 'hs300_code'
    for code in hs300_code:
        klines_response = ths.klines(code, count=100)
        if klines_response:
            klines_df = klines_response.df
            print(f"K-line data for {code}:")
            print(klines_df)
        else:
            print(f"Failed to fetch K-line data for {code}: {klines_response.error}")
        time.sleep(0.1)

    response = ths.wencai_nlp("沪深300 成份股")
    df = response.df
    print(df)

    time.sleep(1)

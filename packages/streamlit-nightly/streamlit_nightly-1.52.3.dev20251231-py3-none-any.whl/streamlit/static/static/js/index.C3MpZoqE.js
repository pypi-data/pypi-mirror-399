import{r as n,E as X,_ as q,F as k,bd as T,e as m,n as G,W as lt,l as ct,k as ut,aa as dt,aR as O,o as z,j as c,p as pt,ab as ft,ac as bt,ad as mt,Z as gt,ay as j}from"./index.DQm9mE0T.js";import{I as ht}from"./InputInstructions.B-hrhnKS.js";import{u as yt}from"./useBasicWidgetState.S1_DeDAF.js";import{s as It}from"./sprintf.DpPCfzXw.js";import{u as Tt}from"./uniqueId.Cx7-DRlG.js";import{I as Ct}from"./input.DnsJ8I9O.js";import"./FormClearHelper.CcrsaZUN.js";import"./base-input.bCQ8S-FY.js";var Z=n.forwardRef(function(t,e){var a={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(X,q({iconAttrs:a,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),n.createElement("path",{d:"M0 3v2h8V3H0z"}))});Z.displayName="Minus";var J=n.forwardRef(function(t,e){var a={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(X,q({iconAttrs:a,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),n.createElement("path",{d:"M3 0v3H0v2h3v3h2V5h3V3H5V0H3z"}))});J.displayName="Plus";const St=k("div",{target:"eaba2yi0"})(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",height:t.sizes.minElementHeight,borderWidth:t.sizes.borderWidth,borderStyle:"solid",borderColor:t.colors.widgetBorderColor??t.colors.secondaryBg,transitionDuration:"200ms",transitionProperty:"border",transitionTimingFunction:"cubic-bezier(0.2, 0.8, 0.4, 1)",borderRadius:t.radii.default,overflow:"hidden","&.focused":{borderColor:t.colors.primary},input:{MozAppearance:"textfield","&::-webkit-inner-spin-button, &::-webkit-outer-spin-button":{WebkitAppearance:"none",margin:t.spacing.none}}})),wt=k("div",{target:"eaba2yi1"})({display:"flex",flexDirection:"row",alignSelf:"stretch"}),K=k("button",{target:"eaba2yi2"})(({theme:t})=>({margin:t.spacing.none,border:"none",height:t.sizes.full,display:"flex",alignItems:"center",width:t.sizes.numberInputControlsWidth,justifyContent:"center",color:t.colors.bodyText,transition:"color 300ms, backgroundColor 300ms",backgroundColor:t.colors.secondaryBg,"&:hover:enabled, &:focus:enabled":{color:t.colors.white,backgroundColor:t.colors.primary,transition:"none",outline:"none"},"&:active":{outline:"none",border:"none"},"&:disabled":{cursor:"not-allowed",color:t.colors.fadedText40}})),vt=k("div",{target:"eaba2yi3"})(({theme:t,clearable:e})=>({position:"absolute",marginRight:t.spacing.twoXS,left:0,right:`calc(${t.sizes.numberInputControlsWidth} * 2 + ${e?"1em":"0em"})`})),xt=lt.getLogger("NumberInput");function Vt(t){return m(t)||t===""?void 0:t}const M=({value:t,format:e,step:a,dataType:u})=>{if(m(t))return null;let r=Vt(e);if(m(r)&&G(a)){const d=a.toString();u===T.DataType.FLOAT&&a!==0&&d.includes(".")&&(r=`%0.${d.split(".")[1].length}f`)}if(m(r))return t.toString();try{return It.sprintf(r,t)}catch(d){return xt.warn(`Error in sprintf(${r}, ${t}): ${d}`),String(t)}},kt=(t,e,a)=>m(t)?!1:t-e>=a,Dt=(t,e,a)=>m(t)?!1:t+e<=a,Nt=({step:t,dataType:e})=>t||(e===T.DataType.INT?1:.01);function _(t,e){return e.dataType===T.DataType.INT?t.getIntValue(e):t.getDoubleValue(e)}function Et(t){return t.default??null}function Rt(t){return t.value??t.default??null}function Ft(t,e,a,u){switch(t.dataType){case T.DataType.INT:e.setIntValue(t,a.value,{fromUi:a.fromUi},u);break;case T.DataType.FLOAT:e.setDoubleValue(t,a.value,{fromUi:a.fromUi},u);break;default:throw new Error("Invalid data type")}}const Wt=({disabled:t,element:e,widgetMgr:a,fragmentId:u})=>{const r=ct(),{dataType:d,formId:g,default:C,format:D,icon:N,min:h,max:y}=e,{width:B,elementRef:Q}=ut(),s=n.useMemo(()=>Nt({step:e.step,dataType:e.dataType}),[e.step,e.dataType]),I=n.useCallback(o=>M({value:o,dataType:d,format:D,step:s}),[d,D,s]),[p,w]=n.useState(!1),[b,S]=n.useState(()=>{const o=_(a,e)??C??null;return M({value:o,dataType:d,format:D,step:s})}),[L,U]=yt({getStateFromWidgetMgr:_,getDefaultStateFromProto:Et,getCurrStateFromProto:Rt,updateWidgetMgrState:Ft,element:e,widgetMgr:a,fragmentId:u,onFormCleared:n.useCallback(()=>{const o=C??null;w(!1),S(I(o))},[C,I])}),[P,A]=n.useState(!1),E=n.useRef(null),[H]=n.useState(()=>Tt("number_input_")),$=dt({formId:g}),Y=$?a.allowFormEnterToSubmit(g):p,tt=P&&B>r.breakpoints.hideWidgetDetails;n.useEffect(()=>{p||S(I(L))},[L,p,I]);const f=n.useCallback(({value:o,fromUi:i})=>{if(G(o)&&(h>o||o>y)){E.current?.reportValidity();return}const V=o??C??null;U({value:V,fromUi:i}),w(!1),S(I(V))},[h,y,C,I,U]),et=n.useCallback(()=>{A(!0)},[]);n.useEffect(()=>{const o=E.current;if(o){const i=V=>{V.preventDefault()};return o.addEventListener("wheel",i),()=>{o.removeEventListener("wheel",i)}}},[]);const R=m(e.default)&&!t,ot=n.useCallback(o=>{const{value:i}=o.target;i===""?(w(!0),S(null)):(w(!0),S(i))},[]),l=n.useMemo(()=>{if(b===null||b==="")return null;if(e.dataType===T.DataType.INT){const i=parseInt(b,10);return isNaN(i)?null:i}const o=parseFloat(b);return isNaN(o)?null:o},[b,e.dataType]),v=kt(l,s,h),x=Dt(l,s,y),rt=n.useCallback(()=>{p&&f({value:l,fromUi:!0}),A(!1)},[p,l,f]),F=n.useCallback(()=>{if(x){const o=(l??h)+s;f({value:o,fromUi:!0})}},[l,h,s,x,f]),W=n.useCallback(()=>{if(v){const o=(l??y)-s;f({value:o,fromUi:!0})}},[l,y,s,v,f]),nt=n.useCallback(o=>{const{key:i}=o;switch(i){case"ArrowUp":o.preventDefault(),F();break;case"ArrowDown":o.preventDefault(),W();break}},[F,W]),at=n.useCallback(o=>{o.key==="Enter"&&(p&&f({value:l,fromUi:!0}),a.allowFormEnterToSubmit(g)&&a.submitForm(g,u))},[p,l,f,a,g,u]),it=O(r.iconSizes.lg)+2*O(r.spacing.twoXS),st=N?r.breakpoints.hideNumberInputControls+it:r.breakpoints.hideNumberInputControls;return z("div",{className:"stNumberInput","data-testid":"stNumberInput",ref:Q,children:[c(bt,{label:e.label,disabled:t,labelVisibility:pt(e.labelVisibility?.value),htmlFor:H,children:e.help&&c(ft,{content:e.help,label:e.label})}),z(St,{className:P?"focused":"","data-testid":"stNumberInputContainer",children:[c(Ct,{type:"number",inputRef:E,value:b??"",placeholder:e.placeholder,onBlur:rt,onFocus:et,onChange:ot,onKeyPress:at,onKeyDown:nt,clearable:R,clearOnEscape:R,disabled:t,"aria-label":e.label,startEnhancer:e.icon&&c(gt,{"data-testid":"stNumberInputIcon",iconValue:e.icon,size:"lg"}),id:H,overrides:{ClearIconContainer:{style:{padding:0}},ClearIcon:{props:{overrides:{Svg:{style:{color:r.colors.grayTextColor,padding:r.spacing.threeXS,height:r.sizes.clearIconSize,width:r.sizes.clearIconSize,":hover":{fill:r.colors.bodyText}}}}}},Input:{props:{"data-testid":"stNumberInputField",step:s,min:h,max:y,type:"number",inputMode:""},style:{fontWeight:r.fontWeights.normal,lineHeight:r.lineHeights.inputWidget,paddingRight:r.spacing.sm,paddingLeft:r.spacing.md,paddingBottom:r.spacing.sm,paddingTop:r.spacing.sm,"::placeholder":{color:r.colors.fadedText60}}},InputContainer:{style:()=>({borderTopRightRadius:0,borderBottomRightRadius:0})},Root:{style:{borderTopRightRadius:0,borderBottomRightRadius:0,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeftWidth:0,borderRightWidth:0,borderTopWidth:0,borderBottomWidth:0,paddingRight:0,paddingLeft:N?r.spacing.sm:0}},StartEnhancer:{style:{paddingLeft:0,paddingRight:0,minWidth:r.iconSizes.lg,color:mt(N)?r.colors.fadedText60:"inherit"}}}}),B>st&&z(wt,{children:[c(K,{"data-testid":"stNumberInputStepDown",onClick:W,disabled:!v||t,tabIndex:-1,children:c(j,{content:Z,size:"xs",color:v?"inherit":r.colors.fadedText40})}),c(K,{"data-testid":"stNumberInputStepUp",onClick:F,disabled:!x||t,tabIndex:-1,children:c(j,{content:J,size:"xs",color:x?"inherit":r.colors.fadedText40})})]})]}),tt&&c(vt,{clearable:R,children:c(ht,{dirty:p,value:b??"",inForm:$,allowEnterToSubmit:Y})})]})},Ot=n.memo(Wt);export{Ot as default};

import{r as o,E as D,_ as L,F as p,aR as we,o as S,j as s,ay as I,b as V,c as ve,B as M,h as Ue,a0 as ze,k as Ce,ak as ee,bi as Ie,e as k,bW as Ee,p as Be,ab as ke,ac as De,bR as Le,bS as Ve}from"./index.DQm9mE0T.js";import{u as Me}from"./FormClearHelper.CcrsaZUN.js";import{g as oe,F as R,a as Re,D as Ae,I as Pe,s as Ne,b as Te}from"./FileHelper.BG4elCiu.js";import{S as We,P as He}from"./ProgressBar.D54tj-jr.js";import{U as j}from"./UploadFileInfo.Dr-zDST7.js";const $e=e=>{const t=o.useRef();return o.useEffect(()=>{t.current=e},[e]),t.current};var ne=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(D,L({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"}))});ne.displayName="ChevronLeft";var ae=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(D,L({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"}))});ae.displayName="ChevronRight";var le=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(D,L({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"}))});le.displayName="Clear";var se=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(D,L({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.createElement("path",{d:"M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95A5.469 5.469 0 0112 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11A2.98 2.98 0 0122 15c0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}))});se.displayName="CloudUpload";var ie=o.forwardRef(function(e,t){var n={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return o.createElement(D,L({iconAttrs:n,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),o.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))});ie.displayName="Error";const re=p("section",{target:"e16n7gab0"})(({isDisabled:e,theme:t})=>({display:"flex",gap:t.spacing.lg,alignItems:"center",padding:t.spacing.lg,backgroundColor:t.colors.secondaryBg,borderRadius:t.radii.default,border:t.colors.widgetBorderColor?`${t.sizes.borderWidth} solid ${t.colors.widgetBorderColor}`:void 0,height:t.sizes.largestElementHeight,":focus":{outline:"none"},":focus-visible":{boxShadow:`0 0 0 1px ${t.colors.primary}`},cursor:e?"not-allowed":"pointer"})),je=p("div",{target:"e16n7gab1"})(({theme:e})=>({marginRight:"auto",alignItems:"center",display:"flex",gap:e.spacing.lg,minWidth:0,width:"100%"})),ce=p("span",{target:"e16n7gab2"})(({theme:e})=>({color:e.colors.darkenedBgMix100})),de=p("span",{target:"e16n7gab3"})(({theme:e,disabled:t})=>({color:t?e.colors.fadedText40:e.colors.bodyText})),Xe=p("span",{target:"e16n7gab4"})(({theme:e,disabled:t})=>({fontSize:e.fontSizes.sm,color:t?e.colors.fadedText40:e.colors.fadedText60,display:"block",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%"})),Oe=p("div",{target:"e16n7gab5"})({display:"flex",flexDirection:"column",minWidth:0,maxWidth:"100%"}),_e=p("span",{target:"e16n7gab6"})({whiteSpace:"nowrap"}),pe=p("div",{target:"e16n7gab7"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg})),qe=p("ul",{target:"e16n7gab8"})(({theme:e})=>({listStyleType:"none",margin:e.spacing.none,padding:e.spacing.none})),ue=p("li",{target:"e16n7gab9"})(({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none})),ge=p("div",{target:"e16n7gab10"})(({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"})),fe=p("div",{target:"e16n7gab11"})(({theme:e,disabled:t})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:t?e.colors.fadedText40:e.colors.bodyText})),he=p("div",{target:"e16n7gab12"})(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS})),Ke=p("span",{target:"e16n7gab13"})(({theme:e})=>({marginRight:e.spacing.twoXS})),Ye=p("div",{target:"e16n7gab14"})(({theme:e,disabled:t})=>({display:"flex",padding:e.spacing.twoXS,color:t?e.colors.fadedText40:e.colors.darkenedBgMix100})),Fe=p("small",{target:"e16n7gab15"})(({theme:e})=>({color:e.colors.redTextColor,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"})),me=p("span",{target:"e16n7gab16"})({}),Ge=e=>({[re]:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"auto",gap:e.spacing.sm},[ce]:{display:"none"},[de]:{marginBottom:e.spacing.twoXS},[pe]:{paddingRight:e.spacing.lg},[he]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[fe]:{width:e.sizes.full},[ge]:{flexDirection:"column"},[Fe]:{height:"auto",whiteSpace:"initial"},[me]:{display:"none"},[ue]:{margin:e.spacing.none,padding:e.spacing.none}}),Je=p("div",{target:"e16n7gab17"})(({theme:e,width:t})=>{if(t<we("23rem"))return Ge(e)}),Qe=({multiple:e,acceptedExtensions:t,maxSizeBytes:n,acceptDirectory:i=!1,disabled:d})=>{const x=()=>i?"directories":e?"files":"file",c=()=>t.length?` â€¢ ${t.map(y=>y.replace(/^\./,"").toUpperCase()).join(", ")}`:null,F=()=>`Limit ${oe(n,R.Byte,0)} per file`;return S(je,{"data-testid":"stFileUploaderDropzoneInstructions",children:[s(ce,{children:s(I,{content:se,size:"threeXL"})}),S(Oe,{children:[S(de,{disabled:d,children:["Drag and drop ",x()," here"]}),S(Xe,{disabled:d,children:[F(),c()]})]})]})},Ze=o.memo(Qe),et=({onDrop:e,multiple:t,acceptedExtensions:n,maxSizeBytes:i,disabled:d,label:x,acceptDirectory:c=!1})=>s(Ae,{onDrop:e,multiple:t,accept:Re(n),maxSize:i,disabled:d,useFsAccessApi:!1,children:({getRootProps:F,getInputProps:y})=>{const v=y({multiple:t||!!c});return S(re,{...F(),"data-testid":"stFileUploaderDropzone",isDisabled:d,"aria-label":x,"aria-disabled":d,children:[s("input",{"data-testid":"stFileUploaderDropzoneInput",...v,...c&&{webkitdirectory:""}}),s(Ze,{multiple:t,acceptedExtensions:n,maxSizeBytes:i,acceptDirectory:c,disabled:d}),s(_e,{children:s(V,{kind:M.SECONDARY,disabled:d,size:ve.SMALL,children:c?"Browse directories":"Browse files"})})]})}}),tt=o.memo(et),ye=p("small",{target:"ek5bcwe0"})(({kind:e,disabled:t,theme:n})=>{const{redTextColor:i,fadedText60:d,fadedText40:x}=n.colors;let c=d;return t&&(c=x),e==="danger"&&(c=i),{color:c,fontSize:n.fontSizes.sm,lineHeight:n.lineHeights.tight}}),ot=({fileInfo:e,disabled:t})=>e.status.type==="uploading"?s(He,{value:e.status.progress,size:We.SMALL}):e.status.type==="error"?S(Fe,{children:[s(Ke,{"data-testid":"stFileUploaderFileErrorMessage",children:e.status.errorMessage}),s(me,{children:s(I,{content:ie,size:"lg"})})]}):e.status.type==="uploaded"?s(ye,{disabled:t,children:oe(e.size,R.Byte)}):null,nt=({fileInfo:e,onDelete:t,disabled:n})=>S(he,{className:"stFileUploaderFile","data-testid":"stFileUploaderFile",children:[s(Ye,{disabled:n,children:s(I,{content:Pe,size:"twoXL"})}),S(ge,{className:"stFileUploaderFileData",children:[s(fe,{className:"stFileUploaderFileName","data-testid":"stFileUploaderFileName",title:e.name,disabled:n,children:e.name}),s(ot,{fileInfo:e,disabled:n})]}),s("div",{"data-testid":"stFileUploaderDeleteBtn",children:s(V,{onClick:()=>t(e.id),kind:M.MINIMAL,disabled:n,"aria-label":`Remove ${e.name}`,children:s(I,{content:le,size:"lg"})})})]}),at=o.memo(nt),lt=p("div",{target:"egc9vxm0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS})),st=p("div",{target:"egc9vxm1"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40})),it=({currentPage:e,totalPages:t,onNext:n,onPrevious:i})=>S(lt,{"data-testid":"stFileUploaderPagination",children:[s(ye,{children:`Showing page ${e} of ${t}`}),S(st,{children:[s(V,{onClick:i,kind:M.MINIMAL,children:s(I,{content:ne,size:"xl"})}),s(V,{onClick:n,kind:M.MINIMAL,children:s(I,{content:ae,size:"xl"})})]})]}),rt=o.memo(it),te=(e,t)=>Math.ceil(e.length/t),ct=e=>Ue(({pageSize:n,items:i,resetOnAdd:d,...x})=>{const[c,F]=o.useState(0),[y,v]=o.useState(()=>te(i,n)),u=$e(i);o.useEffect(()=>{u&&u.length!==i.length&&v(te(i,n)),u&&u.length<i.length?d&&F(0):c+1>=y&&F(y-1)},[i,c,n,u,d,y]);const E=()=>{F(Math.min(c+1,y-1))},U=()=>{F(Math.max(0,c-1))},A=i.slice(c*n,c*n+n);return S(ze,{children:[s(e,{items:A,...x}),i.length>n?s(rt,{pageSize:n,totalPages:y,currentPage:c+1,onNext:E,onPrevious:U}):null]})},e),dt=({items:e,onDelete:t,disabled:n})=>s(qe,{children:e.map(i=>s(ue,{children:s(at,{fileInfo:i,onDelete:t,disabled:n})},i.id))}),pt=ct(dt),ut=e=>s(pe,{children:s(pt,{...e})}),gt=o.memo(ut),ft=(e,t)=>{const n=t.getFileUploaderStateValue(e);if(k(n))return{files:[],nextLocalId:1};const{uploadedFileInfo:i}=n;if(k(i)||i.length===0)return{files:[],nextLocalId:1};let d=1;return{files:i.map(c=>{const F=c.name,y=c.size,v=c.fileId,u=c.fileUrls,E=new j(F,y,d,{type:"uploaded",fileId:v,fileUrls:u});return d+=1,E}),nextLocalId:d}},$=e=>{const t=e.filter(n=>n.status.type==="uploaded").map(n=>{const{name:i,size:d,status:x}=n,{fileId:c,fileUrls:F}=x;return new Le({fileId:c,fileUrls:F,name:i,size:d})});return new Ve({uploadedFileInfo:t})},ht=({disabled:e,element:t,widgetMgr:n,uploadClient:i,fragmentId:d})=>{const{width:x,elementRef:c}=Ce(),{files:F,nextLocalId:y}=o.useMemo(()=>ft(t,n),[t,n]),v=o.useRef(y),[u,E]=o.useState(()=>F),U=o.useRef(u);o.useEffect(()=>{U.current=u},[u]);const[A,X]=o.useState(!1),B=o.useCallback(()=>{const a=v.current;return v.current+=1,a},[]),P=o.useMemo(()=>{const a=t.maxUploadSizeMb;return Ne(a,R.Megabyte,R.Byte)},[t.maxUploadSizeMb]),w=o.useCallback(a=>{ee.flushSync(()=>{E(l=>{const r=typeof a=="function"?a(l):a;return U.current=r,r})})},[]),N=o.useCallback(a=>{ee.flushSync(()=>{X(a)})},[X]),O=o.useCallback(a=>{w(l=>[...l,a])},[w]),T=o.useCallback(a=>{a.length!==0&&w(l=>[...l,...a])},[w]),_=o.useCallback(a=>{w(l=>l.filter(r=>r.id!==a))},[w]),z=o.useCallback((a,l)=>{w(r=>r.map(g=>g.id===a?l:g))},[w]),C=o.useCallback(a=>U.current.find(l=>l.id===a),[]),q=u.some(a=>a.status.type==="uploading")||A?"updating":"ready";o.useEffect(()=>{n.getFileUploaderStateValue(t)===void 0&&n.setFileUploaderStateValue(t,$(U.current),{fromUi:!1},d)},[n,t,d]),o.useEffect(()=>{if(q!=="ready")return;const a=$(u),l=n.getFileUploaderStateValue(t);Ie(a,l)||n.setFileUploaderStateValue(t,a,{fromUi:!0},d)},[q,u,n,t,d]);const xe=o.useCallback(()=>{w(()=>[]);const a=$([]);n.setFileUploaderStateValue(t,a,{fromUi:!0},d)},[t,d,w,n]);Me({element:t,widgetMgr:n,onFormCleared:xe});const K=o.useCallback(a=>{const l=t.type;if(!l||l.length===0)return!0;const r=a.name.toLowerCase();return l.some(g=>r.endsWith(g.toLowerCase()))},[t.type]),Y=o.useCallback(a=>{const l=[],r=[];return a.forEach(g=>{K(g)?l.push(g):r.push({file:g,errors:[{code:"file-invalid-type",message:`${g.type} files are not allowed.`}]})}),{accepted:l,rejected:r}},[K]),G=o.useCallback((a,l)=>{const r=C(a);k(r)||r.status.type!=="uploading"||z(r.id,r.setStatus({type:"uploaded",fileId:l.fileId,fileUrls:l}))},[C,z]),J=o.useCallback((a,l)=>{const r=C(l);if(k(r)||r.status.type!=="uploading")return;const g=Math.round(a.loaded*100/a.total);r.status.progress!==g&&z(l,r.setStatus({type:"uploading",abortController:r.status.abortController,progress:g}))},[C,z]),Q=o.useCallback((a,l)=>{const r=new AbortController,g=l.webkitRelativePath||l.name,f=new j(g,l.size,B(),{type:"uploading",abortController:r,progress:1});O(f),i.uploadFile(t,a.uploadUrl,l,h=>J(h,f.id),r.signal).then(()=>G(f.id,a)).catch(h=>{h instanceof DOMException&&h.name==="AbortError"||z(f.id,f.setStatus({type:"error",errorMessage:h?h.toString():"Unknown error"}))})},[O,t,B,G,J,z,i]),W=o.useCallback(a=>{if(e)return;const l=C(a);k(l)||(l.status.type==="uploading"&&l.status.abortController.abort(),l.status.type==="uploaded"&&l.status.fileUrls.deleteUrl&&i.deleteFile(l.status.fileUrls.deleteUrl),_(a))},[e,C,_,i]),Se=o.useCallback((a,l)=>{const{multipleFiles:r}=t,g=!!t.acceptDirectory;let f=[...a],h=[...l];if(g&&f.length>0){const{accepted:b,rejected:m}=Y(f);f=b,h=[...h,...m]}if(!r&&f.length===0&&h.length>1){const b=h.findIndex(m=>m.errors.length===1&&m.errors[0].code==="too-many-files");b>=0&&(f.push(h[b].file),h.splice(b,1))}if(i.fetchFileURLs(f).then(b=>{if(!r&&f.length>0){const m=U.current.find(H=>H.status.type!=="error");if(m){N(!0);try{W(m.id)}finally{N(!1)}}}Ee(b,f).forEach(([m,H])=>{Q(m,H)})}).catch(b=>{T(f.map(m=>new j(m.name,m.size,B(),{type:"error",errorMessage:b})))}),h.length>0){const b=h.map(m=>Te(m,B(),P));T(b)}},[T,W,t,Y,P,B,i,Q,N]),Z=o.useMemo(()=>u.slice().reverse(),[u]),be=t.type;return S(Je,{className:"stFileUploader","data-testid":"stFileUploader",width:x,ref:c,children:[s(De,{label:t.label,disabled:e,labelVisibility:Be(t.labelVisibility?.value),children:t.help&&s(ke,{content:t.help,label:t.label})}),s(tt,{onDrop:Se,multiple:t.multipleFiles,acceptedExtensions:be,maxSizeBytes:P,label:t.label,disabled:e,acceptDirectory:!!t.acceptDirectory}),Z.length>0&&s(gt,{items:Z,pageSize:3,onDelete:W,resetOnAdd:!0,disabled:e})]})},bt=o.memo(ht);export{bt as default};

import{r,E as x,_ as b,W as Ze,F as h,ai as ve,m as Je,cs as E,ct as xe,o as z,j as a,P as be,ay as A,az as Ee,a0 as $,b as Qe,B as et,Z as Se,bW as tt,l as rt,k as ot,b7 as nt,cu as at,e as Y,bR as Ce,bS as it}from"./index.DQm9mE0T.js";import{I as lt,g as ye,F as j,E as Ie,b as st,s as ct,u as dt,a as ut}from"./FileHelper.BG4elCiu.js";import{u as pt}from"./useWaveformController.DQSftrKy.js";import{I as gt}from"./InputInstructions.B-hrhnKS.js";import{u as ft,T as ht}from"./useTextInputAutoExpand.DJy7lTuU.js";import{i as mt}from"./inputUtils.CptNuJwn.js";import{T as wt}from"./TableChart.esm.BsEqAKaW.js";import{E as vt}from"./ErrorOutline.esm.bKqSjdNS.js";import{U as ze}from"./UploadFileInfo.Dr-zDST7.js";import"./base-input.bCQ8S-FY.js";var Ve=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),r.createElement("path",{d:"M14 17H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"}))});Ve.displayName="Article";var Re=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"}))});Re.displayName="Code";var Ae=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M8 16h8v2H8zm0-4h8v2H8zm6-10H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"}))});Ae.displayName="Description";var De=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M9.17 6l2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}))});De.displayName="Folder";var Fe=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z"}))});Fe.displayName="Image";var Me=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M12 3l.01 10.55c-.59-.34-1.27-.55-2-.55a4.001 4.001 0 100 8c2.22 0 3.99-1.79 3.99-4V7h4V3h-6zm-1.99 16c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"}))});Me.displayName="MusicNote";var ke=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M15 8v8H5V8h10m1-2H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4V7c0-.55-.45-1-1-1z"}))});ke.displayName="Videocam";var Ue=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z"}))});Ue.displayName="Add";var He=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M13 19V7.83l4.88 4.88c.39.39 1.03.39 1.42 0a.996.996 0 000-1.41l-6.59-6.59a.996.996 0 00-1.41 0l-6.6 6.58a.996.996 0 101.41 1.41L11 7.83V19c0 .55.45 1 1 1s1-.45 1-1z"}))});He.displayName="ArrowUpward";var Te=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm4.29 12.89a.996.996 0 11-1.41 1.41L12 13.41 9.11 16.3a.996.996 0 11-1.41-1.41L10.59 12 7.71 9.11A.996.996 0 119.12 7.7L12 10.59l2.89-2.89a.996.996 0 111.41 1.41L13.41 12l2.88 2.89z"}))});Te.displayName="Cancel";var Ne=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M18 6.7l-8.48 8.48-3.54-3.54a.996.996 0 10-1.41 1.41l4.24 4.24c.39.39 1.02.39 1.41 0l9.18-9.18a.999.999 0 00-.01-1.42c-.37-.38-1-.38-1.39.01z"}))});Ne.displayName="Check";var Be=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M18.3 5.71a.996.996 0 00-1.41 0L12 10.59 7.11 5.7A.996.996 0 105.7 7.11L10.59 12 5.7 16.89a.996.996 0 101.41 1.41L12 13.41l4.89 4.89a.996.996 0 101.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"}))});Be.displayName="Close";var Le=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 11c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm0 4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"}))});Le.displayName="ErrorOutline";var We=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),r.createElement("path",{d:"M17.91 11c-.49 0-.9.36-.98.85C16.52 14.21 14.47 16 12 16s-4.52-1.79-4.93-4.15a.998.998 0 00-.98-.85c-.61 0-1.09.54-1 1.14.49 3 2.89 5.34 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.44 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"}))});We.displayName="Mic";const P=Ze.getLogger("ChatInput"),Ct=h("div",{target:"el6d9ej0"})({position:"relative",display:"flex",flexDirection:"column"}),yt=h("div",{target:"el6d9ej1"})(({theme:e})=>({backgroundColor:e.colors.secondaryBg,border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.widgetBorderColor??e.colors.transparent,position:"relative",display:"flex",flexDirection:"column",alignItems:"stretch",padding:e.spacing.lg,gap:e.spacing.lg,borderRadius:e.radii.default,boxSizing:"border-box",":focus-within":{borderColor:e.colors.primary}})),xt=h("div",{target:"el6d9ej2"})(({theme:e})=>({position:"relative",display:"flex",flexDirection:"column",gap:e.spacing.sm})),bt=h("div",{target:"el6d9ej3"})({position:"relative",display:"flex",flexDirection:"column"}),Et=h("div",{target:"el6d9ej4"})(({theme:e})=>({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%",gap:e.spacing.sm})),St=h("div",{target:"el6d9ej5"})(({theme:e})=>({display:"flex",flexDirection:"row",flex:"1 0 0",gap:e.spacing.sm,alignItems:"center"})),It=h("div",{target:"el6d9ej6"})(({theme:e})=>({display:"flex",flexDirection:"row",gap:e.spacing.sm,alignItems:"center",position:"relative"})),zt=h("div",{target:"el6d9ej7"})(({theme:e})=>({position:"absolute",top:e.spacing.sm,right:e.spacing.lg,color:e.colors.fadedText60,fontSize:e.fontSizes.twoSm,textAlign:"right",whiteSpace:"nowrap",pointerEvents:"auto",cursor:"text",zIndex:e.zIndices.priority,"& .stChatInputInstructions":{position:"static"}})),H=h("button",{target:"el6d9ej8"})(({theme:e,disabled:t,hasError:o,primary:s})=>{if(s)return{border:"none",backgroundColor:t?e.colors.darkenedBgMix15:e.colors.primary,borderRadius:e.radii.button,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:e.lineHeights.none,margin:e.spacing.none,padding:e.spacing.xs,width:e.sizes.minElementHeight,height:e.sizes.minElementHeight,color:t?e.colors.fadedText40:e.colors.white,cursor:t?"not-allowed":"pointer",transition:"background-color 200ms ease","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{boxShadow:ve(e)},"&:hover":{backgroundColor:t?e.colors.darkenedBgMix15:e.colors.primary}};const c=Je(e),[p,d]=c?[e.colors.gray60,e.colors.gray80]:[e.colors.gray80,e.colors.gray40],w=()=>o?e.colors.redTextColor:t?p:d;return{border:"none",backgroundColor:e.colors.transparent,borderRadius:e.radii.default,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:e.lineHeights.none,margin:e.spacing.none,padding:e.spacing.none,color:w(),pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:c?e.colors.gray10:e.colors.gray90,boxShadow:ve(e)},"&:hover":{color:o?e.colors.red70:e.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:e.colors.transparent,borderColor:e.colors.transparent,color:e.colors.gray60,cursor:"not-allowed"},"& svg":{width:e.iconSizes.lg,height:e.iconSizes.lg}}}),Vt=h("div",{target:"el6d9ej9"})(({isRecording:e})=>({display:e?"flex":"none",flex:1,alignItems:"center",minWidth:0})),Rt=h("div",{target:"el6d9ej10"})(({theme:e})=>({position:"relative",width:"100%",minHeight:e.sizes.minElementHeight,borderRadius:e.radii.default,overflow:"hidden","& > div":{position:"absolute",inset:0}})),Pe=(e,t)=>t===E.Directory?{...e,webkitdirectory:"",multiple:!0}:e,At=(e,t)=>{if(!t||t.length===0)return!0;const o=e.name.toLowerCase(),s=o.lastIndexOf(".");if(s===-1||s===o.length-1)return t.some(d=>d===""||d===".");const c=o.substring(s),p=o.substring(s+1);return t.some(d=>{const w=d.toLowerCase();return w.startsWith(".")?c===w:p===w})},Dt=(e,t)=>At(e,t)?{isValid:!0}:{isValid:!1,errorMessage:`${e.type||"This type of"} files are not allowed.`},Q=e=>{switch(e){case E.None:return"a file";case E.Single:return"a file";case E.Multiple:return"files";case E.Directory:return"a directory";default:return xe(e),"a file"}},Ft=h("div",{target:"efarq9u0"})(({theme:e})=>({backgroundColor:e.colors.transparent,position:"absolute",inset:0,zIndex:e.zIndices.priority,borderRadius:e.radii.chatInput})),Mt=h("div",{target:"efarq9u1"})(({theme:e})=>({position:"absolute",inset:0,border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.primary,borderRadius:e.radii.chatInput,backgroundColor:e.colors.secondaryBg,color:e.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:e.fontWeights.bold,pointerEvents:"none",zIndex:e.zIndices.priority})),kt=h("div",{target:"efarq9u2"})(({disabled:e})=>({pointerEvents:e?"none":"auto"})),Ut=h("div",{target:"efarq9u3"})(({theme:e})=>({lineHeight:e.lineHeights.tight})),Ht=h("div",{target:"efarq9u4"})(({theme:e})=>({display:"flex",flexWrap:"wrap",gap:e.spacing.sm})),Tt=h("div",{target:"efarq9u5"})({flex:"0 0 auto",maxWidth:"100%"}),Nt=h("div",{target:"efarq9u6"})(({theme:e,isError:t,isClickable:o})=>({position:"relative",display:"inline-flex",alignItems:"center",width:"fit-content",minWidth:"9rem",maxWidth:"100%",backgroundColor:t?e.colors.redBackgroundColor:e.colors.bgColor,padding:e.spacing.twoXS,paddingRight:e.spacing.twoXL,borderRadius:e.radii.default,gap:e.spacing.sm,cursor:o?"pointer":"default"})),Bt=h("div",{target:"efarq9u7"})({display:"flex",flexDirection:"column",minWidth:0}),Lt=h("div",{target:"efarq9u8"})(({theme:e,fileStatus:t})=>({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:e.radii.md,width:e.sizes.chatInputFileIconSize,height:e.sizes.chatInputFileIconSize,flexShrink:0,...t==="uploaded"&&{backgroundColor:e.colors.bodyText,color:e.colors.bgColor},...t==="uploading"&&{backgroundColor:e.colors.fadedText10,color:e.colors.fadedText60},...t==="error"&&{backgroundColor:e.colors.redBackgroundColor,color:e.colors.redTextColor}})),Wt=h("div",{target:"efarq9u9"})(({theme:e,fileStatus:t})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:t.type==="uploading"?e.colors.fadedText60:e.colors.bodyText})),Pt=h("div",{target:"efarq9u10"})(({theme:e})=>({color:e.colors.fadedText60,fontSize:e.fontSizes.sm})),$t=h("div",{target:"efarq9u11"})(({theme:e})=>({color:e.colors.redTextColor,fontSize:e.fontSizes.sm})),jt=h("small",{target:"efarq9u12"})(({theme:e})=>({position:"absolute",top:e.spacing.twoXS,right:e.spacing.twoXS,display:"flex",alignItems:"center",justifyContent:"center",lineHeight:0,"& button":{display:"flex",alignItems:"center",justifyContent:"center",width:"fit-content",height:"fit-content",minHeight:"unset",minWidth:"unset",maxHeight:"unset",maxWidth:"unset",borderRadius:"50%",backgroundColor:"transparent",color:e.colors.fadedText20,padding:0,overflow:"hidden",boxSizing:"border-box",lineHeight:0,"&:hover":{backgroundColor:"transparent",color:e.colors.fadedText40}}})),Ot=({getRootProps:e,getInputProps:t,acceptFile:o,disabled:s})=>{const c=Pe(t(),o),p=e({tabIndex:-1});return z(kt,{"data-testid":"stChatInputFileUploadButton",disabled:s,...p,children:[a("input",{...c}),a(Ee,{content:`Upload or drag and drop ${Q(o)}`,placement:be.TOP,onMouseEnterDelay:500,children:a(H,{disabled:s,"aria-label":`Upload ${Q(o)}`,children:a(A,{content:Ue,size:"xl",color:"inherit"})})})]})},Xt=r.memo(Ot),qt=({getRootProps:e,getInputProps:t,acceptFile:o})=>{const s=Pe(t(),o);return z($,{children:[a(Ft,{...e(),children:a("input",{...s})}),a(Mt,{children:`Drag and drop ${Q(o)} here`})]})},_t=r.memo(qt),Kt=new Set(["jpg","jpeg","png","gif","webp","svg","bmp"]),Gt=new Set(["pdf"]),Yt=new Set(["csv","tsv","xlsx","xls"]),Zt=new Set(["txt","md","json","xml","yaml","yml"]),Jt=new Set(["py","js","ts","jsx","tsx","css","html","java","cpp","c","go","rs","rb","php","swift","kt","scala","sh","bash","sql"]),Qt=new Set(["mp3","wav","m4a","ogg","flac","aac"]),er=new Set(["mp4","webm","mov","avi","mkv","wmv"]),tr=new Set(["zip","tar","gz","rar","7z","bz2"]);function rr(e){const t=e.lastIndexOf(".");return t===-1||t===e.length-1?"":e.slice(t+1).toLowerCase()}function or(e){const t=rr(e);return Kt.has(t)?Fe:Gt.has(t)?Ve:Yt.has(t)?wt:Zt.has(t)?Ae:Jt.has(t)?Re:Qt.has(t)?Me:er.has(t)?ke:tr.has(t)?De:lt}const nr=36;function ar(e,t=nr){if(e.length<=t)return e;const o=e.lastIndexOf(".");if(!(o>0&&o<e.length-1)){const g=Math.floor((t-3)/2),m=g>0?e.slice(-g):"";return`${e.slice(0,g)}...${m}`}const c=e.slice(o),p=e.slice(0,o),d=t-c.length-3;if(d<=0){const g=Math.floor((t-3)/2),m=g>0?e.slice(-g):"";return`${e.slice(0,g)}...${m}`}const w=Math.ceil(d/2),y=Math.floor(d/2),v=y>0?p.slice(-y):"";return`${p.slice(0,w)}...${v}${c}`}const ir=({fileInfo:e})=>{const{type:t}=e.status;switch(t){case"uploading":return a(Se,{iconValue:"spinner",testid:"stChatInputFileIconSpinner",size:"lg"});case"error":return a(A,{content:vt,size:"lg",testid:"stChatInputFileIconError"});case"uploaded":return a(A,{content:or(e.name),size:"lg"});default:return xe(t),null}},lr=({fileInfo:e,onDelete:t,onRetry:o})=>{const s=e.status.type,c=s==="error",p=s==="uploading",d=c&&o!==void 0&&e.file!==void 0,w=e.status.type==="error"?e.status.errorMessage:"Upload failed",y=r.useCallback(()=>{d&&o(e)},[d,o,e]),v=r.useCallback(V=>{d&&(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),o(e))},[d,o,e]),g=r.useCallback(V=>{V.stopPropagation(),t(e.id)},[t,e.id]),m=p?`Cancel upload of ${e.name}`:`Remove ${e.name}`,f=ye(e.size,j.Byte),C=c?`${e.name}, ${w}`:`${e.name}, ${f}`;return z(Nt,{className:"stChatInputFile","data-testid":"stChatInputFile",isError:c,isClickable:d,onClick:d?y:void 0,onKeyDown:d?v:void 0,title:d?"Click to retry upload":void 0,role:d?"button":void 0,tabIndex:d?0:void 0,"aria-label":C,children:[a(Lt,{fileStatus:s,children:a(ir,{fileInfo:e})}),z(Bt,{children:[a(Wt,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:e.name,fileStatus:e.status,children:ar(e.name)}),c?a($t,{"data-testid":"stChatInputFileError",children:w}):a(Pt,{children:ye(e.size,j.Byte)})]}),a(jt,{"data-testid":"stChatInputDeleteBtn",children:a(Qe,{onClick:g,kind:et.MINIMAL,"aria-label":m,children:a(A,{content:Te,size:"md"})})})]})},sr=r.memo(lr),cr=({items:e,onDelete:t,onRetry:o})=>a(Ut,{"data-testid":"stChatUploadedFiles",children:a(Ht,{children:e.map(s=>a(Tt,{children:a(sr,{fileInfo:s,onDelete:t,onRetry:o})},s.id))})}),dr=r.memo(cr),ur=(e,t)=>{const o=[],s=[];return e.forEach(c=>{const p=Dt(c,t.fileType);p.isValid?o.push(c):s.push({file:c,errors:[{code:Ie.FileInvalidType,message:p.errorMessage||"File type not allowed."}]})}),{accepted:o,rejected:s}},pr=({acceptMultipleFiles:e,acceptDirectoryFiles:t,maxFileSize:o,uploadClient:s,uploadFile:c,addFiles:p,getNextLocalFileId:d,deleteExistingFiles:w,onUploadComplete:y,element:v})=>(g,m)=>{if(t&&g.length>0){const{accepted:f,rejected:C}=ur(g,v);g=f,m=[...m,...C]}if(!e&&g.length===0&&m.length>1){const f=m.findIndex(C=>C.errors?.[0].code===Ie.TooManyFiles);f>=0&&(g.push(m[f].file),m.splice(f,1))}if(!e&&g.length>0&&w(),s.fetchFileURLs(g).then(f=>{tt(f,g).forEach(([C,V])=>{c(C,V)})}).catch(f=>{p(g.map(C=>new ze(C.name,C.size,d(),{type:"error",errorMessage:f},C)))}),m.length>0){const f=m.map(C=>st(C,d(),o));p(f)}y()},gr=({getNextLocalFileId:e,addFiles:t,updateFile:o,uploadClient:s,element:c,onUploadProgress:p,onUploadComplete:d})=>(w,y)=>{const v=y.webkitRelativePath||y.name,g=new AbortController,m=new ze(v,y.size,e(),{type:"uploading",abortController:g,progress:1},y);t([m]),s.uploadFile({formId:"",...c},w.uploadUrl,y,f=>p(f,m.id),g.signal).then(()=>d(m.id,w)).catch(f=>{f instanceof DOMException&&f.name==="AbortError"||o(m.id,m.setStatus({type:"error",errorMessage:f?f.toString():"Unknown error"}))})},Z=(e,t,o)=>o.map(s=>s.id===e?t:s),J=(e,t)=>t.find(o=>o.id===e);function fr({disabled:e,element:t,widgetMgr:o,fragmentId:s,uploadClient:c}){const p=rt(),{placeholder:d,maxChars:w}=t,y=r.useRef(0),v=r.useRef(null),g=r.useRef(!1),m=r.useRef(null),f=r.useRef(null),{width:C,elementRef:V}=ot(),{innerWidth:ee,innerHeight:te}=nt(),[k,O]=r.useState(t.default),[D,F]=r.useState([]),[T,X]=r.useState(!1),[N,re]=r.useState(!1),[q,B]=r.useState(null),_=t.acceptAudio??!1;r.useEffect(()=>()=>{f.current&&f.current.abort()},[]);const U=ft({textareaRef:v,dependencies:[d]}),L=r.useMemo(()=>D.some(n=>n.status.type==="uploading")?!1:k!==""||D.length>0,[D,k]),I=at(t.acceptFile),oe=ct(t.maxUploadSizeMb,j.Megabyte,j.Byte),ne=r.useCallback(n=>F(l=>[...l,...n]),[]),ae=r.useCallback(n=>{n.status.type==="uploading"&&n.status.abortController.abort(),n.status.type==="uploaded"&&n.status.fileUrls.deleteUrl&&c.deleteFile(n.status.fileUrls.deleteUrl).catch(l=>{P.error("Failed to delete file from server:",l)})},[c]),ie=r.useCallback(n=>{F(l=>{const u=J(n,l);return Y(u)?l:(ae(u),l.filter(i=>i.id!==n))})},[ae]),K=r.useRef(null),$e=r.useCallback(n=>{!n.file||n.status.type!=="error"||(F(l=>l.filter(u=>u.id!==n.id)),K.current&&K.current([n.file],[]))},[]),le=r.useCallback(()=>{const n=D.filter(l=>l.status.type==="uploaded").map(l=>{const{name:u,size:i,status:S}=l,{fileId:G,fileUrls:Ye}=S;return new Ce({fileId:G,fileUrls:Ye,name:u,size:i})});return new it({uploadedFileInfo:n})},[D]),se=()=>y.current++,ce=pr({acceptMultipleFiles:I===E.Multiple||I===E.Directory,acceptDirectoryFiles:I===E.Directory,maxFileSize:oe,uploadClient:c,uploadFile:gr({getNextLocalFileId:se,addFiles:ne,updateFile:(n,l)=>{F(u=>Z(n,l,u))},uploadClient:c,element:t,onUploadProgress:(n,l)=>{F(u=>{const i=J(l,u);if(Y(i)||i.status.type!=="uploading")return u;const S=Math.round(n.loaded*100/n.total);return i.status.progress===S?u:Z(l,i.setStatus({type:"uploading",abortController:i.status.abortController,progress:S}),u)})},onUploadComplete:(n,l)=>{F(u=>{const i=J(n,u);return Y(i)||i.status.type!=="uploading"?u:Z(i.id,i.setStatus({type:"uploaded",fileId:l.fileId,fileUrls:l}),u)})}}),addFiles:ne,getNextLocalFileId:se,deleteExistingFiles:()=>D.forEach(n=>ie(n.id)),onUploadComplete:()=>{v.current&&v.current.focus()},element:t});K.current=ce;const{getRootProps:de,getInputProps:ue}=dt({onDrop:ce,multiple:I===E.Multiple||I===E.Directory,accept:ut(t.fileType),maxSize:oe}),W=r.useCallback(n=>{if(v.current&&v.current.focus(),!L&&!n||e)return;const l=le(),u={data:k,fileUploaderState:l,audioFileInfo:n};o.setChatInputValue(t,u,{fromUi:!0},s),F([]),O(""),U.clearScrollHeight()},[L,e,k,le,o,t,s,U]),pe=r.useCallback(async n=>{const l=new Date().toISOString().replace(/[:.]/g,"-"),u=new File([n],`audio-${l}.wav`,{type:"audio/wav"});try{re(!0);const i=await c.fetchFileURLs([u]);if(i.length===0)throw new Error("Failed to get upload URL for audio file");const S=i[0];f.current=new AbortController,await c.uploadFile({formId:"",...t},S.uploadUrl,u,()=>{},f.current.signal);const G=new Ce({fileId:S.fileId,fileUrls:S,name:u.name,size:u.size});W(G)}catch(i){const S="Recording failed";P.error("Audio upload failed:",i),B(S),v.current&&v.current.focus()}finally{re(!1)}},[c,t,W]),je=r.useMemo(()=>({onApprove:pe,onPermissionDenied:()=>{const n="Microphone access denied";B(n),P.error("Permission denied:",n)},onError:n=>{B("Recording failed"),P.error("Recording error:",n)},onRecordStart:()=>{B(null)}}),[pe]),R=pt({containerRef:m,sampleRate:t.audioSampleRate??void 0,events:je}),ge=r.useCallback(()=>{W()},[W]),Oe=n=>{const{metaKey:l,ctrlKey:u,shiftKey:i}=n;mt(n)&&!i&&!u&&!l&&(n.preventDefault(),ge())},Xe=n=>{const{value:l}=n.target;w!==0&&l.length>w||(O(l),U.updateScrollHeight(),q&&B(null))},fe=r.useCallback(async n=>{n.preventDefault(),n.stopPropagation(),!(!_||e||R.state==="recording")&&await R.start()},[_,e,R]),qe=r.useCallback(()=>{R.cancel(),v.current&&v.current.focus()},[R]),he=r.useCallback(async()=>{const{blob:n}=await R.stop();await R.approve(n)},[R]),me=r.useCallback(n=>{fe(n)},[fe]),_e=r.useCallback(()=>{he()},[he]),Ke=r.useCallback(()=>{v.current&&v.current.focus()},[]);r.useEffect(()=>{if(t.setValue&&!g.current){g.current=!0;const n=t.value||"";O(n)}},[t.setValue,t.value]),r.useEffect(()=>{g.current=!1},[t]),r.useEffect(()=>{const n=i=>{i.preventDefault(),i.stopPropagation(),!T&&i.dataTransfer?.types.includes("Files")&&X(!0)},l=i=>{i.preventDefault(),i.stopPropagation(),T&&(i.clientX<=0&&i.clientY<=0||i.clientX>=ee&&i.clientY>=te)&&X(!1)},u=i=>{i.preventDefault(),i.stopPropagation(),T&&X(!1)};return window.addEventListener("dragover",n),window.addEventListener("drop",u),window.addEventListener("dragleave",l),()=>{window.removeEventListener("dragover",n),window.removeEventListener("drop",u),window.removeEventListener("dragleave",l)}},[T,ee,te]);const Ge=I!==E.None&&T,M=R.state==="recording",we=!M&&C>p.breakpoints.hideWidgetDetails&&w>0;return a(Ct,{className:"stChatInput","data-testid":"stChatInput",ref:V,children:z(yt,{extended:U.isExtended||M,children:[we&&a(zt,{onClick:Ke,id:"stChatInputInstructions",children:a(gt,{dirty:L,value:k,maxLength:w,type:"chat",inForm:!1,className:"stChatInputInstructions"})}),z(xt,{children:[Ge&&a(_t,{getRootProps:de,getInputProps:ue,acceptFile:I}),I!==E.None&&D.length>0&&a(dr,{items:[...D],onDelete:ie,onRetry:$e}),z(bt,{children:[a(Vt,{isRecording:M,children:a(Rt,{ref:m})}),!M&&a($,{children:a(ht,{inputRef:v,value:k,placeholder:d,onChange:Xe,onKeyDown:Oe,"aria-label":d,disabled:e,rows:1,"aria-describedby":we?"stChatInputInstructions":void 0,overrides:{Root:{style:{minHeight:p.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0",width:"100%"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{fontWeight:p.fontWeights.normal,lineHeight:p.lineHeights.inputWidget,"::placeholder":{color:p.colors.fadedText60},height:U.height,maxHeight:U.maxHeight,overflowY:"auto",paddingLeft:p.spacing.none,paddingRight:p.spacing.none,paddingBottom:p.spacing.sm,paddingTop:p.spacing.sm,width:"100%"}}}})})]})]}),z(Et,{children:[z(St,{children:[I!==E.None&&!M&&a(Xt,{getRootProps:de,getInputProps:ue,acceptFile:I,disabled:e}),_&&!M&&a($,{children:q?a(Ee,{content:q,placement:be.TOP,error:!0,children:a(H,{onClick:me,disabled:e||N,hasError:!0,"data-testid":"stChatInputMicButton","aria-label":"Start recording",children:a(A,{content:Le,size:"xl",color:"inherit"})})}):a(H,{onClick:me,disabled:e||N,"data-testid":"stChatInputMicButton","aria-label":"Start recording",children:a(A,{content:We,size:"xl",color:"inherit"})})})]}),a(It,{children:M?z($,{children:[a(H,{onClick:qe,disabled:e,"data-testid":"stChatInputCancelButton","aria-label":"Cancel recording",children:a(A,{content:Be,size:"lg",color:"inherit"})}),a(H,{onClick:_e,disabled:e||N,"data-testid":"stChatInputApproveButton","aria-label":"Submit recording",children:N?a(Se,{size:"lg",iconValue:"spinner"}):a(A,{content:Ne,size:"lg",color:"inherit"})})]}):a(H,{onClick:ge,disabled:!L||e||N,"data-testid":"stChatInputSubmitButton","aria-label":"Send message",primary:!0,children:a(A,{content:He,size:"lg",color:"inherit"})})})]})]})})}const Ir=r.memo(fr);export{Ir as default};

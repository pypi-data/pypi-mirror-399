# PairCoder Capability Manifest
# This file tells LLMs (Claude Code, Codex CLI, etc.) what they can do and when

version: "2.2"
name: paircoder
description: |
  AI pair programming framework with planning, flows, and context management.
  LLMs should read this file to understand available capabilities.

# ============================================================================
# QUICK START FOR LLMs
# ============================================================================
#
# 1. Read .paircoder/context/project.md to understand this project
# 2. Read .paircoder/context/state.md to see current plan/task status
# 3. Check if any flows apply to the user's request
# 4. Execute the appropriate capability
#
# ============================================================================

# Where to find context
context_files:
  project: .paircoder/context/project.md      # Project constraints and goals
  workflow: .paircoder/context/workflow.md    # How we work here
  state: .paircoder/context/state.md          # Current plan/task status

# Where to find other resources
directories:
  flows: .paircoder/flows/          # Workflow definitions
  plans: .paircoder/plans/          # Plan files
  tasks: .paircoder/tasks/          # Task files organized by plan

# ============================================================================
# CAPABILITIES
# ============================================================================

capabilities:

  # --------------------------------------------------------------------------
  # PLANNING CAPABILITIES
  # --------------------------------------------------------------------------

  - id: create_plan
    name: "Create a new plan"
    description: |
      Creates a plan with goals and tasks for a feature, bugfix, or refactor.
      Use this when the user wants to start working on something substantial.
    when_to_use:
      - User describes a feature they want to build
      - User wants to fix a bug that requires multiple steps
      - User wants to refactor code
      - User says "let's plan" or "how should we approach"
    how_to_invoke:
      cli: "bpsai-pair plan new <slug> --type <feature|bugfix|refactor>"
      programmatic: |
        1. Create .paircoder/plans/plan-YYYY-MM-<slug>.plan.yaml
        2. Define goals, tasks with priorities and complexity
        3. Update .paircoder/context/state.md to reference new plan
    flow_to_run: designing-and-implementing
    outputs:
      - ".paircoder/plans/<plan-id>.plan.yaml"
      - ".paircoder/tasks/<plan-slug>/TASK-*.task.md"

  - id: view_plan
    name: "View current plan status"
    description: |
      Shows the current active plan, its goals, and task statuses.
    when_to_use:
      - User asks "what's the plan" or "where are we"
      - User wants to see task progress
      - Before starting any work (to understand context)
    how_to_invoke:
      cli: "bpsai-pair plan show <plan-id>"
      programmatic: |
        1. Read .paircoder/context/state.md for active plan
        2. Load plan from .paircoder/plans/
        3. Load tasks from .paircoder/tasks/<plan-slug>/

  - id: update_task_status
    name: "Update task status"
    description: |
      Marks a task as in_progress, done, or blocked.
      ⚠️ When marking done: You MUST also update state.md immediately.
    when_to_use:
      - After completing a task
      - When starting work on a task
      - When encountering a blocker
    how_to_invoke:
      cli: "bpsai-pair task update <task-id> --status <status>"
      programmatic: |
        1. If done + Trello card: First run ttask done to check acceptance criteria
        2. Load task from .paircoder/tasks/<plan-slug>/<task-id>.task.md
        3. Update status in YAML frontmatter
        4. IMMEDIATELY update .paircoder/context/state.md (NON-NEGOTIABLE)
           - Mark task done in task list
           - Add session entry under "What Was Just Done"

  # --------------------------------------------------------------------------
  # FLOW CAPABILITIES
  # --------------------------------------------------------------------------

  - id: run_flow
    name: "Run a workflow"
    description: |
      Executes a defined workflow (flow) for structured work.
    when_to_use:
      - Starting a new feature (run designing-and-implementing)
      - Implementing a task (run implementing-with-tdd)
      - Reviewing code (run reviewing-code)
      - Finishing a branch (run finishing-branches)
    how_to_invoke:
      cli: "bpsai-pair flow run <flow-name> [--plan <plan>] [--task <task>]"
      programmatic: |
        1. Load flow from .paircoder/flows/<name>.flow.md
        2. Parse YAML frontmatter for metadata
        3. Execute steps in Markdown body
        4. Track progress in state.md

  - id: list_flows
    name: "List available flows"
    description: |
      Shows all available workflows with descriptions.
    when_to_use:
      - User asks what workflows are available
      - Before deciding which flow to run
    how_to_invoke:
      cli: "bpsai-pair flow list"
      programmatic: "Read .paircoder/flows/*.flow.md"

  # --------------------------------------------------------------------------
  # CONTEXT CAPABILITIES
  # --------------------------------------------------------------------------

  - id: sync_context
    name: "Update context/state"
    description: |
      Updates the current state with what was done and what's next.
    when_to_use:
      - After completing significant work
      - When changing focus to a different task
      - Before ending a session
    how_to_invoke:
      cli: "bpsai-pair context-sync --last '<what>' --next '<next>' --blockers '<blockers>'"
      programmatic: |
        1. Update .paircoder/context/state.md
        2. Update relevant task status if applicable

  - id: pack_context
    name: "Package context for handoff"
    description: |
      Creates a tarball of context files for sharing with another agent or session.
    when_to_use:
      - User wants to share context
      - Handing off to another LLM
      - Creating a checkpoint
    how_to_invoke:
      cli: "bpsai-pair pack --out <filename.tgz>"

  # --------------------------------------------------------------------------
  # FEATURE BRANCH CAPABILITIES
  # --------------------------------------------------------------------------

  - id: create_feature_branch
    name: "Create feature branch"
    description: |
      Creates a git branch and initializes context for new work.
    when_to_use:
      - Starting work on a new feature
      - User says "let's start on X"
    how_to_invoke:
      cli: "bpsai-pair feature <name> --type <feature|fix|refactor> [--plan <plan>]"
      programmatic: |
        1. git checkout -b <type>/<name>
        2. Create/update plan if --plan specified
        3. Update state.md

  # --------------------------------------------------------------------------
  # VALIDATION CAPABILITIES
  # --------------------------------------------------------------------------

  - id: validate_structure
    name: "Validate PairCoder structure"
    description: |
      Checks that .paircoder/ structure is valid and complete.
    when_to_use:
      - After making changes to structure
      - When something seems wrong
      - Periodically to ensure integrity
    how_to_invoke:
      cli: "bpsai-pair validate"

  - id: show_status
    name: "Show overall status"
    description: |
      Shows git status, current branch, active plan, task progress.
    when_to_use:
      - User asks "where are we" or "what's the status"
      - Starting a new session
      - Before making decisions
    how_to_invoke:
      cli: "bpsai-pair status"

# ============================================================================
# FLOW TRIGGERS
# ============================================================================
# When certain conditions are met, these flows should be suggested or run

flow_triggers:

  - trigger: "user_describes_feature"
    patterns:
      - "build a"
      - "create a"
      - "add a"
      - "implement"
      - "new feature"
    suggested_flow: designing-and-implementing

  - trigger: "user_reports_bug"
    patterns:
      - "bug"
      - "broken"
      - "not working"
      - "error"
      - "fix"
    suggested_flow: implementing-with-tdd

  - trigger: "user_wants_review"
    patterns:
      - "review"
      - "check my"
      - "look at"
      - "is this right"
    suggested_flow: reviewing-code

  - trigger: "user_finishing_work"
    patterns:
      - "done"
      - "finished"
      - "ready to merge"
      - "complete"
    suggested_flow: finishing-branches

# ============================================================================
# ROLE DEFINITIONS
# ============================================================================
# Different "personas" the LLM can adopt based on the work being done

roles:
  navigator:
    description: |
      Strategic thinking, planning, design decisions.
      Asks clarifying questions, proposes approaches, creates plans.
    when_active:
      - During designing-and-implementing flow (phases 1-2)
      - When creating or modifying plans
      - When user needs guidance on approach

  driver:
    description: |
      Implementation, writing code, running tests.
      Follows plans, implements tasks, runs verification.
    when_active:
      - During implementing-with-tdd flow
      - When implementing specific tasks
      - When user says "let's code" or "implement this"

  reviewer:
    description: |
      Code review, quality checks, final verification.
      Checks correctness, suggests improvements, ensures gates pass.
    when_active:
      - During reviewing-code flow
      - When user asks for review
      - Before merging

# ============================================================================
# IMPORTANT NOTES FOR LLMs
# ============================================================================

notes:
  # NON-NEGOTIABLE REQUIREMENTS
  - "⚠️ CRITICAL: Update state.md IMMEDIATELY after EVERY task completion - this is non-negotiable"
  - "⚠️ CRITICAL: Use ttask done before task update to check Trello acceptance criteria"

  # Standard workflow
  - Always read state.md first to understand current context
  - If a flow applies to the user's request, suggest or run it
  - Tasks should be small (2-20 minutes of work each)
  - Use verification gates to ensure quality
  - When unsure, ask clarifying questions (Navigator role)
  - A task is NOT complete until state.md is updated

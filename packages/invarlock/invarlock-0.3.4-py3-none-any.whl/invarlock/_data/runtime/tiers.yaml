# Tier guard policy knobs for variance correction (balanced vs conservative)
#
# These values mirror the settings validated during the December 2025
# calibration runs. They should be kept in sync with the policy digest
# embedded in certificates and referenced by automation documentation.

balanced:
  metrics:
    pm_ratio:
      ratio_limit_base: 1.10
      min_tokens: 50000
      hysteresis_ratio: 0.002
      min_token_fraction: 0.01
    accuracy:
      delta_min_pp: -1.0
      min_examples: 200
      hysteresis_delta_pp: 0.1
      min_examples_fraction: 0.01
  variance_guard:
    deadband: 0.02
    min_abs_adjust: 0.012
    max_scale_step: 0.03
    min_effect_lognll: 0.0009
    predictive_one_sided: true
    topk_backstop: 1
    max_adjusted_modules: 1
    tap: "transformer.h.*.mlp.c_proj"
    predictive_gate: true
  spectral_guard:
    sigma_quantile: 0.95
    deadband: 0.10
    scope: all
    max_caps: 5
    max_spectral_norm: null
    family_caps:
      ffn: 3.834
      attn: 3.423
      embed: 3.1
      other: 3.1
    multiple_testing:
      method: bh
      alpha: 0.05
      m: 4
  rmt_guard:
    deadband: 0.10
    margin: 1.5
    epsilon_default: 0.10
    epsilon_by_family:
      ffn: 0.10
      attn: 0.08
      embed: 0.12
      other: 0.12

conservative:
  metrics:
    pm_ratio:
      ratio_limit_base: 1.05
      min_tokens: 20000
      hysteresis_ratio: 0.002
      min_token_fraction: 0.01
    accuracy:
      delta_min_pp: -0.5
      min_examples: 200
      hysteresis_delta_pp: 0.1
      min_examples_fraction: 0.01
  variance_guard:
    deadband: 0.03
    min_abs_adjust: 0.02
    max_scale_step: 0.015
    min_effect_lognll: 0.0018
    predictive_one_sided: false
    topk_backstop: 0
    max_adjusted_modules: 0
    tap: "transformer.h.*.mlp.c_proj"
    predictive_gate: true
  spectral_guard:
    sigma_quantile: 0.90
    deadband: 0.05
    scope: ffn
    max_caps: 3
    family_caps:
      ffn: 2.3
      attn: 2.6
      embed: 2.8
      other: 2.8
    multiple_testing:
      method: bonferroni
      alpha: 0.02
      m: 4
  rmt_guard:
    deadband: 0.05
    margin: 1.3
    epsilon_default: 0.06
    epsilon_by_family:
      ffn: 0.06
      attn: 0.05
      embed: 0.07
      other: 0.07

aggressive:
  metrics:
    pm_ratio:
      ratio_limit_base: 1.20
      min_tokens: 50000
      hysteresis_ratio: 0.002
      min_token_fraction: 0.01
    accuracy:
      delta_min_pp: -2.0
      min_examples: 200
      hysteresis_delta_pp: 0.1
      min_examples_fraction: 0.01
  variance_guard:
    deadband: 0.12
    min_effect_lognll: 0.0005
  spectral_guard:
    sigma_quantile: 0.98
    deadband: 0.15
    scope: ffn
    max_caps: 8
    family_caps:
      ffn: 3.0
      attn: 3.5
      embed: 2.5
      other: 3.5
    multiple_testing:
      method: bh
      alpha: 0.1
      m: 4
  rmt_guard:
    deadband: 0.15
    margin: 1.8
    epsilon_default: 0.15
    epsilon_by_family:
      ffn: 0.15
      attn: 0.15
      embed: 0.15
      other: 0.15

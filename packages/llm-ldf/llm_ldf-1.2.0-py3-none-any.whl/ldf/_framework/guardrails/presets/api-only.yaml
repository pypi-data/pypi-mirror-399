# API-Only Guardrails Preset
# Adds guardrails for pure API services

version: "1.0"
extends: "core"

guardrails:
  - id: 9
    name: "API Versioning"
    description: "Proper API version management"
    severity: high
    enabled: true
    checklist:
      - "Version in URL path (/v1/, /v2/)"
      - "Deprecation policy documented"
      - "Sunset headers for deprecated endpoints"
      - "Breaking changes in new versions only"
      - "Migration guides for version upgrades"
    config:
      versioning_strategy: "path"  # path, header, query
      deprecation_notice_days: 90
      sunset_header: true

  - id: 10
    name: "Rate Limiting Tiers"
    description: "Tiered rate limits by plan"
    severity: high
    enabled: true
    checklist:
      - "Rate limits documented per plan"
      - "429 Too Many Requests returned"
      - "Retry-After header included"
      - "Rate limit headers in responses"
      - "Graceful degradation for limit hits"
    config:
      tiers:
        free:
          requests_per_minute: 60
          requests_per_day: 1000
        basic:
          requests_per_minute: 300
          requests_per_day: 10000
        pro:
          requests_per_minute: 1000
          requests_per_day: 100000
      headers:
        - "X-RateLimit-Limit"
        - "X-RateLimit-Remaining"
        - "X-RateLimit-Reset"

  - id: 11
    name: "Webhook Signatures"
    description: "Secure webhook delivery"
    severity: high
    enabled: true
    checklist:
      - "Webhooks signed with HMAC"
      - "Signature in header"
      - "Timestamp included to prevent replay"
      - "Verification code samples provided"
      - "Retry with exponential backoff"
    config:
      algorithm: "HMAC-SHA256"
      signature_header: "X-Signature"
      timestamp_header: "X-Timestamp"
      replay_window_seconds: 300
      retry_schedule:
        - 60     # 1 minute
        - 300    # 5 minutes
        - 3600   # 1 hour
        - 86400  # 24 hours

  - id: 12
    name: "API Key Management"
    description: "Secure API key handling"
    severity: high
    enabled: true
    checklist:
      - "Keys generated with sufficient entropy"
      - "Keys hashed before storage"
      - "Key rotation supported"
      - "Key scopes/permissions enforced"
      - "Key revocation immediate"
    config:
      key_length: 32
      hash_algorithm: "bcrypt"
      prefix: "ldf_"  # e.g., ldf_live_xxx, ldf_test_xxx
